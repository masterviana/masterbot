define("webimnamespaces",["debug","lightobject","lightstring","lightarray"],function(){!function(){var e=window;e.ss=e.Sys,e.MC=e.MC||{},e.MSH=e.MSH||{},e.MSCr=e.MSCr||{},e.MSM=e.MSM||{},e.Web=e.Web||{},e.MSCo=e.MSCo||{},e.MSP=e.MSP||{},e.MSCh=e.MSCh||{},e.MSI=e.MSI||{};var t=e.Microsoft=e.Microsoft||{},n=t.Live=t.Live||{},i=n.Messenger=n.Messenger||{};i.Services=i.Services||{},i.Messaging=i.Messaging||{},i.Presence=i.Presence||{}}()}),define("coreconstants",["webimnamespaces"],function(){!function(){var e=window.MC;e.IMServiceDataProperties={isOnline:"IsOnline",isOnlineViaMobileDevice:"IsOnlineViaMobileDevice",isOnlineViaWeb:"IsOnlineViaWeb",videoCallSupports16By9AspectRatio:"VideoCallSupports16By9AspectRatio",status:"Status",supportsMultipartyConversations:"SupportsMultipartyConversations",version:"Version"},e.IMServiceEndpointDataProperties={capabilities:"Capabilities",domain:"DMN",isOnlineViaMobileDevice:"IsOnlineViaMobileDevice",isOnlineViaWeb:"IsOnlineViaWeb",videoCallSupports16By9AspectRatio:"VideoCallSupports16By9AspectRatio",messageExtensions:"MessageExtensions",presenceExtensions:"PresenceExtensions",supportsMultipartyConversations:"SupportsMultipartyConversations",version:"Version"},e.PDServiceEndpointDataProperties={epName:"EpName",clientType:"ClientType"},e.PEServiceDataProperties={displayName:"FriendlyName",displayPictureUrl:"DisplayPictureUrl",isIdentityVerified:"IsIdentityVerified",personalMessage:"PSM",richLinkType:"RLT",richUrl:"RUL",richUserMessage:"RUM",safeUrl:"SUL",userTileLocation:"UserTileLocation"},e.PEServiceEndpointDataProperties={capabilities:"Capabilities",client:"VER",clientName:"ClientName",clientType:"TYP",clientVersion:"ClientVersion"},e.SKPServiceDataProperties={mood:"Mood",skypeName:"Skypename"},e.SKPServiceEndpointDataProperties={nodeInfo:"NodeInfo"}}()}),define("coreenums",["coreconstants"],function(){!function(){var e=window,t=window.MC,n=e.ss,i=n.NotifyCollectionChangedAction=function(){};i.add=0,i.remove=1,i.reset=2;var s=t.AuthenticationType=function(){};s.rpsAuth=1;var o=t.BooleanValue=function(){};o.None=0,o.True=1,o.False=2;var r=t.CapabilitiesFlags=function(){};r.none=0,r.onlineViaMobile=1,r.onlineViaTexas=2,r.supportsGifInk=4,r.supportsIsfInk=8,r.supportsChunking=32,r.mobileEnabled=64,r.webWatchEnabled=128,r.supportsActivities=256,r.onlineViaWebIM=512,r.mobileDevice=1024,r.onlineViaFederatedInterface=2048,r.hasSpace=4096,r.isMceUser=8192,r.supportsDirectIM=16384,r.supportsWinks=32768,r.supportsSharedSearch=65536,r.isBot=131072,r.supportsTunneledSip=2097152,r.supportsVoiceIM=262144,r.supportsSChannel=524288,r.supportsSipInvite=1048576,r.supportsMultipartyMedia=2097152,r.supportsSDrive=4194304,r.supportsPageModeMessaging=8388608,r.hasOneCare=16777216,r.supportsTurn=33554432,r.supportsDirectBootstrapping=67108864,r.usingAlias=134217728,r.appVersion60=268435456,r.appVersion61=536870912,r.appVersion62=805306368,r.appVersion70=1073741824,r.appVersion75=1342177280,r.appVersion80=1610612736,r.appVersion81=1879048192,r.appVersion85=2147483648,r.appVersion90=2415919104,r.appVersion2009=2684354560,r.isSmsOnly=1,r.supportsVoiceOverMsnp=2,r.supportsUucpSipStack=4,r.rtcVideoEnabled=16,r.supportsPeerToPeerV2=32,r.isAuthenticatedWebIMUser=64,r.supportsOfflineIM=256,r.videoCallSupports16By9AspectRatio=262144,r.supportsPeerToPeerMixerRelay=32768,r.supportsPeerToPeerEnveloping=524288,r.sipTunnelVersion2=8388608,r.fTurnCapable=536870912,r.supportsMultipartyConversations=2147483648,r.supportsMissedConversations=1,r.supportsShortCircuit=32,r.appVersionMask=4026531840;var a=t.ClientType=function(){};a.unknown=0,a.computer=1,a.website=2,a.mobile=3,a.xbox=4,a.zune=5,a.iPhone=6,a.mac=7,a.SMS=8;var c=t.ConnectionServiceResultCode=function(){};c.success=0,c.failure=1,c.partialFailure=2,c.signedOutRoaming=3,c.signedOutExceededMaxEndpointCount=4,c.unauthenticated=5,c.signedOutSessionTimeout=6,c.badUic=7;var l=t.DatagramInfoType=function(){};l.sdg=0,l.imGroupPut=1,l.imGroupDel=2,l.put=3,l.del=4,l.serviceDataPut=5,l.serviceDataDel=6,l.networkDataPut=7,l.get=8,l.conversationPut=9;var u=t.GroupChatPhase=function(){};u.disabled=0,u.consumption=1,u.creation=2;var d=t.GroupConversationOperationResult=function(){};d.success=0,d.failure=1,d.partialFailure=2;var _=t.IdentityServiceResultCode=function(){};_.success=0,_.failure=1;var g=t.IMAddressInfoType=function(){};g.none=0,g.windowsLive=1,g.officeCommunicator=2,g.telephone=4,g.skype=8,g.circle=9,g.cid=11,g.connect=13,g.remoteNetwork=14,g.smtp=16,g.temporaryGroup=19,g.shortCircuit=20;var h=t.LogEntryType=function(){};h.normal=0,h.exception=1,h.httpRequest=2,h.stateChange=3;var p=t.LogLevel=function(){};p.error=0,p.warning=1,p.information=2,p.trace=3;var f=t.MailNotificationFolderType=function(){};f.inbox=0,f.trash=1,f.junkMail=2,f.sent=3,f.drafts=4,f.other=5,f.hidden=6;var m=t.MailNotificationInfoType=function(){};m.initial=0,m.incoming=1,m.activity=2;var v=t.MessageChannelType=function(){};v.none=0,v.online=1,v.offline=2,v.mobile=3,v.history=4;var C=t.MessageInfoType=function(){};C.unknownMessage=0,C.textMessage=1,C.callEventMessage=6,C.logRequestMessage=7,C.typingUserMessage=13,C.threadActivityMessage=14;var y=t.MessengerServiceResultCode=function(){};y.success=0,y.failure=1,y.notFound=2,y.unauthenticated=3,y.notAllowed=4,y.messageTooLong=5,y.messageRecipientInvalid=6,y.messageRecipientDisabled=7,y.failedToPersist=8,y.failedToConnect=9,y.transferred=10;var S=t.NetworkConnectionType=function(){};S.none=0,S.windowsLive=1,S.connect=2;var $=t.NetworkInfoStatus=function(){};$.signedOut=0,$.signingIn=1,$.signedIn=2,$.signingOut=3,$.autoReconnectWaiting=4;var w=t.NetworkOperationType=function(){};w.enableIM=1,w.disableIM=2;var I=t.PresenceInfoStatus=function(){};I.none=0,I.offline=1,I.online=2,I.appearOffline=3,I.busy=4,I.idle=5,I.beRightBack=6,I.away=7,I.inACall=8,I.outToLunch=9;var b=t.PrivacyOptions=function(){};b.none=0,b.blockByDefault=1,b.allowByDefault=2;var M=t.RichPsmLinkType=function(){};M.none=0,M.simpleText=1,M.link=2,M.linkToVideo=3,M.photo=4,M.photos=5,M.video=6,M.document=7,M.location=8;var k=t.RoleLists=function(){};k.none=0,k.forward=1,k.allow=2,k.block=4,k.hideCompat=5,k.reverse=8,k.pending=16,k.hide=64;var E=t.SendDatagramResultCode=function(){};E.success=0,E.failure=1,E.partialFailure=2,E.tooLong=3,E.recipientInvalid=4,E.recipientDisabled=5,E.recipientNotAcceptingIMs=6,E.invalidData=7;var T=t.ServiceType=function(){};T.none=0,T.PE=1,T.IM=2,T.PD=4,T.CM=8,T.SKP=16;var D=t.SessionServiceOptions=function(){};D.normal=0,D.notifications=1,D.contactPresence=2,D.full=3;var A=t.SignOutLocationFlags=function(){};A.none=0,A.localEndpoint=1,A.remoteEndpoints=2,A.allEndpoints=3,A.specificEndpoints=8;var x=t.SignOutReasonCode=function(){};x.signedOutByLocalEndpoint=0,x.signedOutByRemoteEndpoint=1,x.connectionLost=2,x.serverError=3,x.endpointLimitExceeded=4,x.signedOutForReconnect=5,x.userTransferred=6,x.sessionTimeout=7,x.badUic=8;var N=t.SubscriptionType=function(){};N.notificationSubscribe=1,N.presenceAndNotificationSubscribe=2,N.presenceUnsubscribe=3,N.presenceAndNotificationUnsubscribe=4;var P=t.ThreadActivityMessageType=function(){};P.addMember=0,P.deleteMember=1,P.topicUpdate=2,P.pictureUpdate=3,P.fileShared=4,P.contactShared=5,P.none=6;var R=t.UpdateIMAvailabilityOperationCode=function(){};R.none=0,R.addContacts=1,R.removeContacts=2,R.addNetwork=3,R.removeNetwork=4;var O=t.UploadLogsPreferenceType=function(){};O.none=0,O.accept=1,O.decline=2;var L=t.TestFlags=function(){};L.none=0,L.RecentListLoadFailure=1,L.EnableDeleteConversation=2,L.DeleteConversationFailure=4,L.DeleteConversationPartialFailure=8,t.enumToString=function(e,t){for(var n in e)if(e[n]===t)return n;return""}}()}),define("compatlayer",["coreenums"],function(){!function(){function e(e){s.event=e}function t(e,t,n){e[t]||(e[t]=n)}function n(e,t,n,i){Object.defineProperty?e.hasOwnProperty(t)||Object.defineProperty(e,t,{get:n,set:i}):e.__lookupGetter__&&void 0!==e.__lookupGetter__(t)||(e.__defineGetter__(t,n),e.__defineSetter__(t,i))}function i(e,t,n){Object.defineProperty?e.hasOwnProperty(t)||Object.defineProperty(e,t,{get:n}):e.__lookupGetter__&&void 0!==e.__lookupGetter__(t)||e.__defineGetter__(t,n)}var s=window,o=s.document;if(s.navigator.userAgent.indexOf("Trident/4")<0)try{var r=s.navigator.userAgent.indexOf("Opera")>=0,a=s.navigator.userAgent.indexOf("Gecko")>=0,c=function(e){try{for(;e&&1!=e.nodeType;)e=e.parentNode}catch(t){e=null}return e},l=function(t,n){var i=t.slice(2);return"mousewheel"==i&&(r||a)&&(i="DOMMouseScroll"),this.addEventListener(i,e,!0),this.addEventListener(i,n,!1),!0},u=function(t,n){var i=t.slice(2);"mousewheel"==i&&(r||a)&&(i="DOMMouseScroll"),this.removeEventListener(i,e,!0),this.removeEventListener(i,n,!1)};t(s,"attachEvent",l),t(s,"detachEvent",u),s.HTMLDocument&&(t(s.HTMLDocument.prototype,"attachEvent",l),t(s.HTMLDocument.prototype,"detachEvent",u)),t(s.HTMLElement.prototype,"attachEvent",l),t(s.HTMLElement.prototype,"detachEvent",u);var d=s.Event.prototype;i(d,"srcElement",function(){return c(this.target)||this.currentTarget}),n(d,"cancelBubble",function(){return this._bubblingCanceled||!1},function(e){e&&(this._bubblingCanceled=!0,this.stopPropagation())}),n(d,"returnValue",function(){return this._cancelDefault},function(e){return e||this.preventDefault(),this._cancelDefault=e,e});var _=s.HTMLElement.prototype;i(_,"parentElement",function(){return this.parentNode}),i(_,"children",function(){for(var e=[],t=this.childNodes.length,n=0;t>n;n++){var i=this.childNodes[n];1==i.nodeType&&e.push(i)}return e}),n(_,"innerText",function(){try{return this.textContent}catch(e){for(var t="",n=0;n<this.childNodes.length;n++)3==this.childNodes[n].nodeType&&(t+=this.childNodes[n].textContent);return t}},function(e){var t=o.createTextNode(e);this.innerHTML="",this.appendChild(t)}),i(_,"currentStyle",function(){return s.getComputedStyle(this,null)}),t(_,"contains",function(e){for(;null!=e&&e!=this;)e=e.parentElement;return null!=e});var g=s.DocumentFragment.prototype;t(g,"getElementsByTagName",function(e){var t,n,i=[],s=[],o=this.childNodes;for(n=0;n<o.length;n++)t=o[n],1==t.nodeType&&s.push(t);for(;s.length;)if(t=s.shift(),("*"==e||t.tagName==e)&&i.push(t),o=t.childNodes,0!=o.length)for(n=0;n<o.length;n++)t=o[n],1==t.nodeType&&s.push(t);return i});var h=function(e,t,n){if(!e.documentElement)return[];n=n?n:e;for(var i=new s.XPathEvaluator,o=i.evaluate(t,n,e.createNSResolver(e.documentElement),s.XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null),r=new Array(o.snapshotLength),a=0;a<o.snapshotLength;a++)r[a]=o.snapshotItem(a);return r},p=function(e,t,n){t+="[1]";var i=h(e,t,n);if(0!=i.length)for(var s=0;s<i.length;s++)if(i[s])return i[s];return null},f=s.Document.prototype;t(f,"selectNodes",function(e,t){return h(this,e,t)}),t(f,"selectSingleNode",function(e,t){return p(this,e,t)});var m=s.Node.prototype;t(m,"selectNodes",function(e){var t=this.ownerDocument;return t.selectNodes(e,this)}),t(m,"selectSingleNode",function(e){var t=this.ownerDocument;return t.selectSingleNode(e,this)}),n(m,"text",function(){return this.textContent},function(e){this.textContent=e}),i(m,"xml",function(){return(new s.XMLSerializer).serializeToString(this)})}catch(v){}}()}),define("corelibrary",["compatlayer"],function(){!function(){function e(e){for(var t="",n=e[0],s=0;;){var o=n.indexOf("{",s),r=n.indexOf("}",s);if(0>o&&0>r){t+=n.slice(s);break}if(r>0&&(o>r||0>o)){if("}"!==n.charAt(r+1))throw new Error("BraceMismatch");t+=n.slice(s,r+1),s=r+2}else if(t+=n.slice(s,o),s=o+1,"{"!==n.charAt(s)){if(0>r)throw new Error("BraceMismatch");var a=n.substring(s,r),c=a.indexOf(":"),l=parseInt(0>c?a:a.substring(0,c),10)+1;if(isNaN(l))throw new Error("BadFormat");var u=0>c?"":a.substring(c+1),d=e[l];i.isNullOrUndefined(d)&&(d=""),t+=d.toFormattedString?d.toFormattedString(u):d.format?d.format(u):d.toString(),s=r+1}else t+="{",s++}return t}function t(e,t){for(var n=e,i=1;t>i;i++)n+=e;return n}var n=window,i=n.ss;i.isUndefined=function(e){return void 0===e},i.isNullOrUndefined=function(e){return null===e||void 0===e},i.getKeyCount=function(e){var t=0;for(var n in e)t++;return t},i.clearKeys=function(e){for(var t in e)delete e[t]},i.keyExists=function(e,t){return void 0!==e[t]},i.isNullOrEmpty=function(e){return!e||!e.length},i.format=function(){return e(arguments)},i.replaceAll=function(e,t,n){return n=n||"",e.split(t).join(n)},i.padLeft=function(e,n,i){return e.length<n?(i=i||" ",t(i,n-e.length)+e):e.valueOf()},i.padRight=function(e,n,i){return e.length<n?(i=i||" ",e+t(i,n-e.length)):e.valueOf()},i.compare=function(e,t,n){return n&&(e&&(e=e.toUpperCase()),t&&(t=t.toUpperCase())),e=e||"",t=t||"",e==t?0:t>e?-1:1},i.parseXml=function(e){if(!n.DOMParser||n.$B&&n.$B.IE)for(var t=["Msxml2.DOMDocument.3.0","Msxml2.DOMDocument"],i=0;i<t.length;i++)try{var s=new n.ActiveXObject(t[i]);return s.async=!1,s.loadXML(e),s.setProperty("SelectionLanguage","XPath"),s}catch(o){}else try{var r=new n.DOMParser;return r.parseFromString(e,"text/xml")}catch(o){}return null}}()}),define("delegate",["corelibrary"],function(){!function(){var e=window,t=e.ss;t.Delegate=function(){},t.Delegate.Null=function(){},t.Delegate._contains=function(e,t,n){for(var i=0;i<e.length;i+=2)if(e[i]===t&&e[i+1]===n)return!0;return!1},t.Delegate._create=function(e){var n=function(){if(2==e.length)return e[1].apply(e[0],arguments);for(var n=e.clone(),i=0;i<n.length;i+=2)t.Delegate._contains(e,n[i],n[i+1])&&n[i+1].apply(n[i],arguments);return null};return n.invoke=n,n._targets=e,n},t.Delegate.create=function(e,n){return e?(e.ssDelegates||(e.ssDelegates={}),e.ssDelegates[n]||(e.ssDelegates[n]=t.Delegate._create([e,n])),e.ssDelegates[n]):n}}()}),define("ienumerator",["delegate"],function(){!function(){var e=window,t=e.ss,n=function(e){this._array=e,this._index=-1};n.prototype={get_current:function(){return this._array[this._index]},moveNext:function(){return this._index++,this._index<this._array.length},reset:function(){this._index=-1}},t.IEnumerator=function(){},t.IEnumerator.prototype={get_current:null,moveNext:null,reset:null},t.IEnumerator.getEnumerator=function(e){return e?e.getEnumerator?e.getEnumerator():new n(e):null}}()}),define("collectionchange",["ienumerator"],function(){!function(){var e=window,t=e.ss;t.CollectionChange=function(e,t,n,i,s){this.action=e,t&&(t instanceof Array||(t=[t])),this.newItems=t||null,"number"!=typeof n&&(n=-1),this.newStartingIndex=n,i&&(i instanceof Array||(i=[i])),this.oldItems=i||null,"number"!=typeof s&&(s=-1),this.oldStartingIndex=s}}()}),define("stringbuilder",["collectionchange"],function(){!function(){function e(e){return this._parts.push(e),this}function t(e){return this._parts.push("undefined"==typeof e||null===e||""===e?"\r\n":e+"\r\n"),this}function n(){if(0!==arguments.length)throw new Error("InvalidParameterCount");this._parts=[],this._value={},this._len=0}function i(){if(0!==arguments.length)throw new Error("InvalidParameterCount");return 0===this._parts.length?!0:""===this.toString()}function s(e){e=e||"";var t=this._parts;this._len!==t.length&&(this._value={},this._len=t.length);var n=this._value;if("undefined"==typeof n[e]){if(""!==e)for(var i=0;i<t.length;)"undefined"==typeof t[i]||""===t[i]||null===t[i]?t.splice(i,1):i++;n[e]=this._parts.join(e)}return n[e]}var o=window,r=o.ss;r.StringBuilder=function(e){this._parts=r.isNullOrEmpty(e)?[]:[e.toString()],this._value={},this._len=0},r.StringBuilder.prototype={append:e,appendLine:t,clear:n,isEmpty:i,toString:s}}()}),define("servicedatahelper",["stringbuilder"],function(){!function(){var e=window,t=e.ss,n=e.MC,i=n.ServiceType,s=n.PresenceInfoStatus,o=n.CapabilitiesFlags,r=n.RichPsmLinkType,a=n.ServiceDataHelper=function(){};a.shouldPublishProperty=function(e,t,n){switch(n){case i.IM:if(t&&"NOO"===e)return!1;break;case i.PE:if(t&&"DisplayPictureUrl"===e)return!1;break;case i.CM:return!1}return!0},a.parseServiceName=function(e){switch(e){case"IM":return i.IM;case"PE":return i.PE;case"PD":return i.PD;case"CM":return i.CM;case"SKP":return i.SKP;default:return i.none}},a.formatServiceType=function(e){switch(e){case i.IM:return"IM";case i.PE:return"PE";case i.PD:return"PD";case i.CM:return"CM";case i.SKP:return"SKP";default:return""}},a.parseStatus=function(e){if(t.isNullOrEmpty(e))return s.none;var n;switch(e){case"NLN":n=s.online;break;case"HDN":n=s.appearOffline;break;case"BSY":n=s.busy;break;case"IDL":n=s.idle;break;case"FLN":n=s.offline;break;case"BRB":n=s.beRightBack;break;case"AWY":n=s.away;break;case"PHN":n=s.inACall;break;case"LUN":n=s.outToLunch;break;default:n=s.none}return n},a.formatStatus=function(e){switch(e){case s.online:return"NLN";case s.appearOffline:return"HDN";case s.busy:return"BSY";case s.idle:return"IDL";case s.offline:return"FLN";case s.beRightBack:return"BRB";case s.away:return"AWY";case s.inACall:return"PHN";case s.outToLunch:return"LUN";case s.none:default:return""}},a.parseCapabilities=function(e){if(t.isNullOrEmpty(e))return[o.none];for(var n=e.split(":"),i=new Array(n.length),s=0;s<i.length;s++){var r=a._tryParseInt(n[s]);i[s]=0>r?o.none:r}return i},a.formatCapabilities=function(e){if(0===e.length)return"0";for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=a._capabilitiesToString(e[n]);return t.join(":")},a.isSet=function(e,t,n){return null!=n&&n.length>e?0!==(n[e]&t):!1},a.parseRichLinkType=function(e){switch(e){case"0":return r.simpleText;case"1":return r.link;case"2":return r.linkToVideo;case"3":return r.photo;case"4":return r.photos;case"5":return r.video;case"6":return r.document;case"7":return r.location;default:return r.none}},a.convertToRawLinkType=function(e){switch(e){case r.simpleText:return"0";case r.link:return"1";case r.linkToVideo:return"2";case r.photo:return"3";case r.photos:return"4";case r.video:return"5";case r.document:return"6";case r.location:return"7";case r.none:default:return""}},a._capabilitiesToString=function(e){var t=e;return 0>t&&(t+=4294967296),t.toString()},a._tryParseInt=function(e){var t=parseInt(e,10);return isNaN(t)?-1:t},a.getDefaultOfflineEndpointData=function(e){var t={};switch(e){case i.CM:t.events="<events />"}return t}}()}),define("nativejsonparser",["servicedatahelper"],function(){!function(){var e=window,t=e.$B,n=e.ss,i=e.MC,s=i._nativeJsonParser=function(){};s._dateTimePropertyChangedObjects=[],s._isUnpatchedIE8=!1,s._storedArrayPrototypeMethods={},s._storedObjectPrototypeMethods={},s._isFirefox=e.$B&&t.Firefox?!0:!1,s._addDateTimeChangedObject=function(e,t,n){s._dateTimePropertyChangedObjects.push([e,t,n])},s._recoverDateTimeChangedObjects=function(){for(var e=n.IEnumerator.getEnumerator(s._dateTimePropertyChangedObjects);e.moveNext();){var t=e.get_current();t[0][t[1]]=t[2]}s._dateTimePropertyChangedObjects.length=0},s._testUnpatchedIE8=function(){var t=e.JSON.stringify(void 0);return n.isUndefined(t)||"undefined"!==t?!1:!0},s._isUnpatchedIE8=e.$B&&t.IE&&8===t.V&&s._testUnpatchedIE8(),s._deserialize=function(t){s._isUnpatchedIE8&&(s._disablePrototypeExtensions(Array.prototype,s._storedArrayPrototypeMethods),s._disablePrototypeExtensions(Object.prototype,s._storedObjectPrototypeMethods));try{var n=e.JSON.parse(t,s._reviver);return n}finally{return s._isUnpatchedIE8&&(s._restorePrototypeMethods(Object.prototype,s._storedObjectPrototypeMethods),s._restorePrototypeMethods(Array.prototype,s._storedArrayPrototypeMethods)),null}},s._restorePrototypeMethods=function(e,t){var i=t;for(var s in i){var o={key:s,value:i[s]};e[o.key]=o.value}n.clearKeys(t)},s._disablePrototypeExtensions=function(e,t){var n=e;for(var i in n){var s={key:i,value:n[i]};t[s.key]=s.value}var o=t;for(var r in o){var a={key:r,value:o[r]};delete e[a.key]}},s._serialize=function(t){var n=e.JSON.stringify(t,s._replacer);return s._recoverDateTimeChangedObjects(),n},s._reviver=s.dateReviver=function(e,t){if(null!=t){var n=t.$date;if(null!=n)return new Date(n)}return t},s._replacer=s.dateReplacer=function(e,t){var n=this[e];if(n instanceof Date){var i={};return i.$date=n.getTime(),s._isFirefox&&(this[e]=i,s._addDateTimeChangedObject(this,e,n)),i}return""===n?"":t}}()}),define("json",["nativejsonparser"],function(){!function(){var e=window,t=e.MC,n=e.ss,i=t.JSON=function(){};i.deserialize=function(e){if(n.isNullOrEmpty(e))return null;try{return t._nativeJsonParser._deserialize(e)}catch(i){}return null},i.serialize=function(e){if(null==e)return"";try{return t._nativeJsonParser._serialize(e)}catch(n){}return null}}()}),define("authenticationinfo",["json"],function(){!function(){var e=window.MC;e.AuthenticationInfo=function(t,n){var i=this;switch(t){case e.AuthenticationType.rpsAuth:}i.authType=t,i.ticket=n,i.uicTicket=null}}()}),define("messengersessioninfo",["authenticationinfo"],function(){!function(){var e=window.MC;e.MessengerSessionInfo=function(e,t,n,i){var s=this;s.server=e,s.sessionToken=t,s.transactionID=n,s.pendingEvents=i,s.registrationToken=""}}()}),define("consumptionhorizoninfo",["messengersessioninfo"],function(){!function(){var e=window.MC;e.ConsumptionHorizonInfo=function(e,t){var n=this;n.lastReadMessageId=e,n.lastReadMessageTimestamp=t}}()}),define("contactinfo",["consumptionhorizoninfo"],function(){!function(){var e=window.MC;e.ContactInfo=function(e,t,n){var i=this;i.id=e,i.nickname=t,i.addresses=n,i.firstName="",i.lastName="",i.favoritesOrder=null,i.isBlocked=!1,i.fullName=null,i.cid=null,i.pictureUrl=null,i.skypePendingOutbound=!1}}()}),define("calleventmessageinfo",["contactinfo"],function(){!function(){var e=window.MC;e.CallEventMessageInfo=function(e){this.duration=e}}()}),define("threadactivitymessageinfo",["calleventmessageinfo"],function(){!function(){var e=window.MC;e.ThreadActivityMessageInfo=function(e,t,n,i){var s=this;s.type=e,s.initiator=t,s.targets=n,s.otherInfo=i}}()}),define("groupconversationmemberinfo",["threadactivitymessageinfo"],function(){!function(){var e=window.MC;e.GroupConversationMemberInfo=function(e,t){var n=this;n.address=e,n.linkedAddress=t,n.isAdmin=!1,n.capabilities=0}}()}),define("groupconversationinfo",["groupconversationmemberinfo"],function(){!function(){var e=window.MC;e.GroupConversationInfo=function(e,t){var n=this;n.id=e,n.version=t,n.capabilities=0,n.userInitiated=!1}}()}),define("skypeinitializationinfo",["groupconversationinfo"],function(){!function(){var e=window.MC;e.SkypeInitializationInfo=function(e,t,n,i){var s=this;s.liveId=e,s.cid=t,s.buddy=n,s.networks=i}}()}),define("dateinfo",["skypeinitializationinfo"],function(){!function(){var e=window.MC;e.DateInfo=function(e){this.utcMilliseconds=e.getTime()}}()}),define("datagraminfo",["dateinfo"],function(){!function(){var e=window.MC;e.DatagramInfo=function(e,t){var n=this;n.datagramType=e,n.payload=t}}()}),define("identityinfo",["datagraminfo"],function(){!function(){var e=window.MC;e.IdentityInfo=function(e,t){var n=this;n.liveId=e,n.skypeId="",n.endpointId=t,n.cid="",n.experienceId=null,n.applicationId=null,n.authenticationInfo=null}}()}),define("imaddressinfo",["identityinfo"],function(){!function(){var e=window.MC;e.IMAddressInfo=function(t,n,i,s){var o=this;o.address=n===e.IMAddressInfoType.connect?t:null!=t?t.toLowerCase():null,o.type=n,o.roleLists=i,o.messagingAddress=s,o.cid="",o.type===e.IMAddressInfoType.cid&&(o.cid=t),o.id=o.address,o.isFan=!1,o.isFacebookMobileEnabled=!1,o.network=null,o.applicationId=null,o.skypeId=null,o.inviteMessage=null}}()}),define("logrequestmessageinfo",["imaddressinfo"],function(){!function(){var e=window.MC;e.LogRequestMessageInfo=function(e,t){var n=this;n.uploadUrl=e,n.authToken=t}}()}),define("mailnotificationactivityinfo",["logrequestmessageinfo"],function(){!function(){var e=window.MC;e.MailNotificationActivityInfo=function(e,t,n){var i=this;i.source=e,i.destination=t,i.delta=n}}()}),define("mailnotificationincominginfo",["mailnotificationactivityinfo"],function(){!function(){var e=window.MC;e.MailNotificationIncomingInfo=function(e,t,n,i,s,o){var r=this;r.from=e,r.fromAddress=t,r.messageUrl=n,r.subject=i,r.folder=s,r.id=o}}()}),define("mailnotificationinfo",["mailnotificationincominginfo"],function(){!function(){var e=window.MC;e.MailNotificationInfo=function(e,t){var n=this;n.notification=e,n.type=t}}()}),define("mailnotificationinitialinfo",["mailnotificationinfo"],function(){!function(){var e=window.MC;e.MailNotificationInitialInfo=function(e,t,n,i){var s=this;s.inboxUnread=e,s.inboxTotal=t,s.foldersUnread=n,s.foldersTotal=i}}()}),define("messageinfo",["mailnotificationinitialinfo"],function(){!function(){var e=window.MC;e.MessageInfo=function(t,n){var i=this;i.type=t,i.sender=null,i.timestamp=new e.DateInfo(new Date),i.id=null,i.clientId=null,i.targetEndpointId=null,i.isOfflineMessage=!1,i.isHistoryMessage=!1,i.isRecentMessage=!1,i.isLastHistoryMessage=!1,i.info=n}}()}),define("messengersessionevents",["messageinfo"],function(){!function(){var e=window.MC;e.MessengerSessionEvents=function(e){this.events=e||[]}}()}),define("messengersessionstate",["messengersessionevents"],function(){!function(){var e=window.MC;e.MessengerSessionState=function(e,t,n,i,s,o){var r=this;r.server=e,r.sessionToken=t,r.transactionID=n,r.services=i,r.disconnected=s,r.identity=o,r.registrationToken=""}}()}),define("networkinfo",["messengersessionstate"],function(){!function(){var e=window.MC;e.NetworkInfo=function(t,n,i,s,o,r,a,c){var l=this;l.id=t,l.name=n,l.connectionType=i,l.photoUrlFormat=o,l.profileUrlFormat=r,l.sendMessageUrlFormat=a,l.reportAbuseUrlFormat=c,l.supportsIM=i!==e.NetworkConnectionType.none,l.imEnabled=!1,l.tokenState="",l.status=e.NetworkInfoStatus.signedOut,l.isRemoteNetwork=s,l.rank=0}}()}),define("personinfo",["networkinfo"],function(){!function(){var e=window.MC;e.PersonInfo=function(e,t){var n=this;n.id=e,n.contacts=t}}()}),define("servicedatainfo",["personinfo"],function(){!function(){var e=window.MC;e.ServiceDataInfo=function(e,t,n){var i=this;i.service=e,i.properties=t,i.endpointData=n}}()}),define("servicedatadiff",["servicedatainfo"],function(){!function(){var e=window.MC;e.ServiceDataDiff=function(e){this.service=e,this.updatedEndpoints={},this.updatedProperties=[],this.deletedEndpoints={},this.newEndpoints={}},e.ServiceDataDiff.prototype={service:e.ServiceType.none,updatedProperties:null,updatedEndpoints:null,newEndpoints:null,deletedEndpoints:null}}()}),define("serviceendpointdatainfo",["servicedatadiff"],function(){!function(){var e=window.MC;e.ServiceEndpointDataInfo=function(e,t,n){var i=this;i.endpointId=e,i.service=t,i.properties=n}}()}),define("textmessageformatinfo",["serviceendpointdatainfo"],function(){!function(){var e=window.MC;e.TextMessageFormatInfo=function(e,t,n,i){var s=this;s.fontColor=e,s.fontFamily=t||"",s.fontStyle=n,s.rightToLeft=i}}()}),define("textmessageinfo",["textmessageformatinfo"],function(){!function(){var e=window.MC;e.TextMessageInfo=function(e,t){var n=this;n.text=e,n.format=t,n.safeUrl=""}}()}),define("webmainhelper",["textmessageinfo"],function(){!function(){var e=window,t=e.ss,n=window.MC,i=e.$ScenarioQoS,s=e.wLive,o=n.WebmainHelper=function(){};o._qoSPropertyId="WebIM",o.qoSScenarioSendIm="WebIM_SendIm",o.qoSScenarioSignin="WebIM_Signin",o.qoSScenarioReconnect="WebIM_Reconnect",o.qoSScenarioRecentConversations="WebIM_RecentConversations",o.qoSScenarioConversationHistory="WebIM_ConversationHistory",o.qoSScenarioDeleteConversations="WebIM_DeleteConversations",o.qoSScenarioGroupChatCreateGroup="WebIM_GroupChatCreateGroup",o.qoSScenarioGroupChatAddContacts="WebIM_GroupChatAddContacts",o.qoSScenarioGroupChatLeaveGroup="WebIM_GroupChatLeaveGroup",o.qoSScenarioResetSkypePendingInboundCount="WebIM_ResetSkypePendingInboundCount",o.qoSScenarioGetInvitations="WebIM_SkypeGetInvitations",o.qoSScenarioOnOffThirdPartyChat="WebIM_OnOffThirdPartyChat",o.qoSScenarioUpdateWebIMSettings="WebIM_UpdateWebIMSettings",o.qoSScenarioSkypeAcceptRequest="WebIM_SkypeAcceptRequest",o.qoSApiGetUic="WebIM_Signin_GetUic",o.qoSApiContactsReady="WebIM_Signin_ContactsReady",o.qoSApiConnectMessenger="WebIM_Signin_ConnectMessenger",o.qoSApiReconnect="WebIM_Reconnect_Call",o.qoSApiSendIm="WebIM_SendIm_Call",o.qoSApiRecentConversations="WebIM_RecentConversations_Call",o.qoSApiDeleteConversations="WebIM_DeleteConversations_Call",o.qoSApiConversationHistory="WebIM_ConversationHistory_Call",o.qoSApiGroupChatCreateGroup="WebIM_GroupChatCreateGroup_Call",o.qoSApiGroupChatAddContacts="WebIM_GroupChatAddContacts_Call",o.qoSApiGroupChatLeaveGroup="WebIM_GroupChatLeaveGroup_Call",o.qoSApiResetSkypePendingInboundCount="WebIM_ResetSkypePendingInboundCount_Call",o.qoSApiGetInvitations="WebIM_GetInvitations_Call",o.qoSApiOnThirdPartyChat="WebIM_OnThirdPartyChat_Call",o.qoSApiOffThirdPartyChat="WebIM_OffThirdPartyChat_Call",o.qoSApiUpdateWebIMSettings="WebIM_UpdateWebIMSettings_Call",o.qoSApiSkypeAcceptRequest="WebIM_SkypeAcceptRequest_Call",o.qoSSigninApiStartTime=0,o.qoSReconnectApiStartTime=0,o.qoSGetInvitationsApiStartTime=0,o.qoSSkypeAcceptRequestApiStartTime=0,o.qoSResetSkypePendingInboundCountApiStartTime=0,o.qoSOnOffThirdPartyChatApiStartTime=0,o.isQoS=function(){return null!=e.$ScenarioQoS?!0:!1},o.isConfig=function(){return null!=e.$Config?!0:!1},o.isWlxIM=function(){return null!=e.$WLXIM?!0:!1},o.startQoS=function(e){return o.isQoS()?i.startScenario(e,o._qoSPropertyId):null},o.stopQoS=function(e,t,n,s){if(e&&e.id){var r=!t,a=t?null:n;o.peopleLog({eventType:e.id,resultCode:a},r)}o.isQoS()&&null!=e&&i.stopScenario(e,t,n,s?"c":void 0)},o.addQoSStats=function(e,t,n,i,s){o.isQoS()&&null!=i&&window.$WLXIM.addScenarioQoSStats(e,t,n,i,s)},o.qoSResetTime=function(e){switch(e){case o.qoSScenarioSignin:o.qoSSigninApiStartTime=(new Date).getTime();break;case o.qoSScenarioReconnect:o.qoSReconnectApiStartTime=(new Date).getTime();break;case o.qoSScenarioGetInvitations:o.qoSGetInvitationsApiStartTime=(new Date).getTime();break;case o.qoSScenarioResetSkypePendingInboundCount:o.qoSResetSkypePendingInboundCountApiStartTime=(new Date).getTime();break;case o.qoSScenarioOnOffThirdPartyChat:o.qoSOnOffThirdPartyChatApiStartTime=(new Date).getTime();break;case o.qoSScenarioSkypeAcceptRequest:o.qoSSkypeAcceptRequestApiStartTime=(new Date).getTime()}},o.getQueryParameterByName=function(e){var n=window.location.href.indexOf("?");if(0>n)return"";for(var i=window.location.href.substr(n+1),s=i.split("&"),o=t.IEnumerator.getEnumerator(s);o.moveNext();){var r=o.get_current();if(r.toLowerCase().startsWith(e.toLowerCase())){var a=r.indexOf("=");return decodeURIComponent(r.substr(a+1))}}return""},o.peopleLog=function(e,t){s&&s.People&&e&&e.eventType&&(0!=e.eventType.indexOf("WebIM_")&&(e.eventType="WebIM_"+e.eventType),s.People.Reporter.log(e,t))}}()}),define("groupchatfeatures",["webmainhelper"],function(){!function(){var e=window.MC;e.GroupChatFeatures=function(){},e.GroupChatFeatures.phase=e.GroupChatPhase.disabled,window.$Config.WebIM.gc&&(e.GroupChatFeatures.phase=e.GroupChatPhase.creation)}()}),define("webimsettings",["groupchatfeatures"],function(){!function(){var e=window,t=(e.$pwc,e.MC),n=t.WebmainHelper,i=1e3,s=0,o=1,r=2;t.Settings=function(){var t=this,a=[],c=-1,l=e.$pwc.settings.getWebIMSettings();l&&(a=l.split(",")),t.get_peopleFilter=function(){var e=parseInt(a[s]);return isNaN(e)?null:e},t.set_peopleFilter=function(e){!e&&0!==e||isNaN(e)||(a[s]=e.toString(),u())},t.get_userPresencePreference=function(){var e=parseInt(a[o]);return isNaN(e)?null:e},t.set_userPresencePreference=function(e){null==e||isNaN(e)||(a[o]=e.toString(),u())},t.get_upsellClosedFlag=function(){var e=parseInt(a[r]);return 1==e},t.set_upsellClosedFlag=function(e){a[r]=e===!0?1:0,u()};var u=function(){var t=a.join(",");l!=t&&(l=t,-1!=c&&e.clearTimeout(c),c=e.setTimeout(function(){c=-1;var t=new e.XMLHttpRequest;t.open("POST",e.location.protocol+"//"+e.location.host+"/Handlers/PeopleApi/UpdateWebIMSettings.mvc",!0),t.setRequestHeader("X-Requested-With","XMLHttpRequest"),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");var i,s;t.onreadystatechange=function(){if(4==t.readyState)if(200==t.status)n.addQoSStats(n.qoSApiUpdateWebIMSettings,null,i,s,!1),n.stopQoS(s,!0,null);
else{var e=t.status.toString();t.statusText&&(e+=", "+t.statusText),n.addQoSStats(n.qoSApiUpdateWebIMSettings,e,i,s,!1),n.stopQoS(s,!1,e)}},i=(new Date).getTime(),s=n.startQoS(n.qoSScenarioUpdateWebIMSettings),t.send("canary="+encodeURIComponent(e.$Config.ContactCache.canary)+"&webIMSettings="+l)},i))}}}()}),define("skyjshelper",["webimsettings"],function(){!function(e){var t=window,n=t.Microsoft,i=t.$BSI,s=n.Live.Messenger.Services.SkyJSHelper=function(){};s._id="SkyJS",s._skyjs=null,s._pluginStartTime=new Date,s.isCallInProgress=!1,s.isPluginLoaded=!1,s.skypeEnabled=!1,s.initErrorCode=null,s.skypeAudioVideoEnabled=!1,s.initCompleted=!1,s.getInstance=function(){return null==s._skyjs&&(s._skyjs=window[s._id]),s._skyjs},s.get_skypeInitCompleted=function(){return s.initCompleted},s.set_skypeInitCompleted=function(){s.initCompleted=!0,e(s).triggerHandler("initCompleted")},s.skypeCallStarted=function(){s.isCallInProgress=!0,s.isPluginLoaded=!1,e(s).triggerHandler("callStarted"),s._pluginStartTime=new Date},s.skypePluginStarted=function(){s.isPluginLoaded=!0,e(s).triggerHandler("pluginLoaded"),s.reportPluginStartDuration()},s.skypeCallFinished=function(){s.isCallInProgress=!1,s.isPluginLoaded=!1,e(s).triggerHandler("callFinished")},s.reportSkypeLogin=function(e,t){if(s.initErrorCode=t,window.$BSI){var n={};n.HasSkype=e?1:0,n.ErrorCode=t,i.reportEvent("WebIM.SkypeLogin",n)}},s.reportAudioVideoStarted=function(e){if(window.$BSI){var t={};t.WebIMLaunchPoint="recentConversations",t.ConversationType=e?"video":"voice",t.isOverlayMode=window.$WLXIM.isSidebarOverlay(),i.reportEvent("WebIM.ConversationStarted",t)}},s.reportPluginStartDuration=function(){if(window.$BSI){var e=Math.floor((new Date-s._pluginStartTime)/1e3),t={};t.PluginStartTime=e,i.reportEvent("WebIM.SkypePluginStart",t)}}}(window.originaljQuery||jQuery)}),define("serviceendpointdata",["skyjshelper"],function(){!function(){var e=window,t=e.ss,n=e.MC,i=n.ServiceType,s=n.ServiceEndpointData=function(e){this.info=e};s.create=function(e){switch(e.service){case i.PE:return new n.PEServiceEndpointData(e);case i.IM:return new n.IMServiceEndpointData(e);case i.PD:return new n.PDServiceEndpointData(e);case i.CM:return new n.CMServiceEndpointData(e);case i.SKP:return new n.SKPServiceEndpointData(e);default:return null}},s.createEmpty=function(e,t){return s.create(new n.ServiceEndpointDataInfo(t,e,{}))},s.prototype={info:null,get_capabilities:null,set_capabilities:null,get_client:null,set_client:null,get_clientName:null,set_clientName:null,get_clientType:null,set_clientType:null,get_clientVersion:null,set_clientVersion:null,get_properties:function(){return this.info.properties},get_service:function(){return this.info.service},get_endpointId:function(){return this.info.endpointId},get__info:function(){return this.info},clone:function(){var e=new n.ServiceEndpointDataInfo(this.info.endpointId,this.info.service,{}),t=this.info.properties;for(var i in t){var s={key:i,value:t[i]};e.properties[s.key]=s.value}return e},createDiff:function(e){return new n.ServiceEndpointDataInfo(this.info.endpointId,this.info.service,this._createDictionaryDiff(e.info.properties))},_update:function(e,t){var n=[],i=e.properties;for(var s in i){var o={key:s,value:i[s]},r=o.key;this.updateProperty(r,o.value)&&n.push(r)}n.length>0&&(t.updatedEndpoints[this.get__info().endpointId]=n)},propertyEquals:function(e,t){return this.info.properties[e]===t},propertyIsNullOrEmpty:function(e){return t.isNullOrEmpty(this.info.properties[e])},updateProperty:function(e,n){if(null==n){if(t.keyExists(this.info.properties,e)){var i=!this.propertyIsNullOrEmpty(e);return delete this.info.properties[e],i}}else if(!t.keyExists(this.info.properties,e)||!this.propertyEquals(e,n))return this.info.properties[e]=n,!0;return!1},_createDictionaryDiff:function(e){var i,s={},o=e;for(var r in o)i={key:r,value:o[r]},t.keyExists(this.info.properties,i.key)&&this.propertyEquals(i.key,i.value)||(s[i.key]=i.value);var a=this.info.properties;for(var c in a){i={key:c,value:a[c]};var l=i.key;t.keyExists(e,l)||n.ServiceDataHelper.shouldPublishProperty(l,!1,this.info.service)&&(s[l]=null)}return s},get_item:function(e){return t.keyExists(this.info.properties,e)?this.info.properties[e]:""},set_item:function(e,t){return this.info.properties[e]=t,t}}}()}),define("cmserviceendpointdata",["serviceendpointdata"],function(){!function(){var e=window.MC,t=e.ServiceEndpointData,n=e.CMServiceEndpointData=function(e){t.call(this,e)},i=n.prototype=new t;i.constructor=n,i._update=function(e,n){t.prototype._update.call(this,e,n)}}()}),define("skpserviceendpointdata",["cmserviceendpointdata"],function(){!function(){var e=window.MC,t=e.ServiceEndpointData,n=e.SKPServiceEndpointData=function(e){t.call(this,e)},i=n.prototype=new t;i.constructor=n,i.get_nodeInfo=function(){return this.get_item(e.SKPServiceEndpointDataProperties.nodeInfo)},i.set_nodeInfo=function(t){return this.set_item(e.SKPServiceEndpointDataProperties.nodeInfo,t),t},i._update=function(e,n){t.prototype._update.call(this,e,n)}}()}),define("servicedata",["skpserviceendpointdata"],function(){!function(){var e=window,t=e.MC,n=e.ss,i=t.ServiceType,s=t.ServiceData=function(e){if(this.info=e,this.endpointData={},e){var n=e.endpointData;for(var i in n){var s={key:i,value:n[i]};this.endpointData[s.key]=t.ServiceEndpointData.create(s.value)}}};s.create=function(e){switch(e.service){case i.PE:return new t.PEServiceData(e);case i.IM:return new t.IMServiceData(e);case i.PD:return new t.PDServiceData(e);case i.CM:return new t.CMServiceData(e);case i.SKP:return new t.SKPServiceData(e);default:return null}},s.createEmpty=function(e){var n=new t.ServiceDataInfo(e,{},{});return s.create(n)},s.prototype={info:null,endpointData:null,get_status:null,get_service:function(){return this.info.service},get_properties:function(){return this.info.properties},get_info:function(){return this.info},get__endpointData:function(){return this.endpointData},addEndpoint:function(e){this.endpointData[e.get_endpointId()]=e,this.info.endpointData[e.get_endpointId()]=e.get__info()},addEndpointFromInfo:function(e){this.endpointData[e.endpointId]=t.ServiceEndpointData.create(e),this.info.endpointData[e.endpointId]=e},getAllEndpoints:function(){var e=[],t=this.endpointData;for(var n in t){var i={key:n,value:t[n]};e.push(i.value)}return e},getEndpoint:function(e){return n.keyExists(this.endpointData,e)?this.endpointData[e]:null},deleteEndpoint:function(e){delete this.endpointData[e],delete this.info.endpointData[e]},clone:function(){var e=new t.ServiceDataInfo(this.info.service,{},{}),n=this.info.properties;for(var i in n){var s={key:i,value:n[i]};e.properties[s.key]=s.value}var o=this.endpointData;for(var r in o){var a={key:r,value:o[r]};e.endpointData[a.key]=a.value.clone()}return e},update:function(e){var i=new t.ServiceDataDiff(this.info.service),s=e.properties;for(var o in s){var r={key:o,value:s[o]},a=r.key;this._updateProperty(a,r.value)&&i.updatedProperties.push(a)}var c=e.endpointData;for(var l in c){var u,d={key:l,value:c[l]},_=d.key;if(n.keyExists(this.get__endpointData(),_))u=this.get__endpointData()[_],u._update(d.value,i);else{var g=d.value;u=t.ServiceEndpointData.createEmpty(g.service,_),this.addEndpoint(u),i.newEndpoints[_]=u,0===n.getKeyCount(g.properties)?i.updatedEndpoints[_]=[]:u._update(g,i)}}return i},Delete:function(e){var i=new t.ServiceDataDiff(this.info.service),s=e.endpointData;for(var o in s){var r={key:o,value:s[o]},a=r.key;if(n.keyExists(this.get__endpointData(),a)){var c=this.get__endpointData()[a];this.deleteEndpoint(c.get_endpointId());var l=[],u=c.get_properties();for(var d in u){var _={key:d,value:u[d]};l.push(_.key)}i.deletedEndpoints[a]=c,i.updatedEndpoints[a]=l}}return i},createDiff:function(e){for(var i=new t.ServiceDataInfo(this.info.service,this._createDictionaryDiff(e.info.properties),{}),s=n.IEnumerator.getEnumerator(e.getAllEndpoints());s.moveNext();){var o=s.get_current();if(n.keyExists(this.get__endpointData(),o.get__info().endpointId)){var r=this.endpointData[o.get__info().endpointId].createDiff(o);n.getKeyCount(r.properties)>0&&(i.endpointData[o.get__info().endpointId]=r)}else i.endpointData[o.get__info().endpointId]=o.clone()}return i},propertyEquals:function(e,t){return this.info.properties[e]===t},_updateProperty:function(e,t){if(null==t){if(n.keyExists(this.info.properties,e)){var i=""!==this.get_item(e);return delete this.info.properties[e],i}}else if(!n.keyExists(this.info.properties,e)||!this.propertyEquals(e,t))return this.info.properties[e]=t,!0;return!1},_createDictionaryDiff:function(e){var i,s={},o=e;for(var r in o)i={key:r,value:o[r]},n.keyExists(this.info.properties,i.key)&&this.propertyEquals(i.key,i.value)||(s[i.key]=i.value);var a=this.info.properties;for(var c in a){i={key:c,value:a[c]};var l=i.key;n.keyExists(e,l)||t.ServiceDataHelper.shouldPublishProperty(l,!0,this.info.service)&&(s[l]=null)}return s},get_item:function(e){return n.keyExists(this.info.properties,e)?this.info.properties[e]:""},set_item:function(e,t){return this.info.properties[e]=t,t}}}()}),define("cmservicedata",["servicedata"],function(){!function(){var e=window.MC,t=e.ServiceData,n=e.CMServiceData=function(e){t.call(this,e)},i=n.prototype=new t;i.constructor=n,i.update=function(e){return this._updateAggregatedProperties$1(e,!1)},i.Delete=function(e){return this._updateAggregatedProperties$1(e,!0)},i._updateAggregatedProperties$1=function(e,n){var i=n?t.prototype.Delete.call(this,e):t.prototype.update.call(this,e);return i}}()}),define("skpservicedata",["cmservicedata"],function(){!function(){var e=window,t=e.ss,n=e.MC,i=n.ServiceData,s=n.SKPServiceData=function(e){i.call(this,e)};n.SKPServiceData._emailNotVerified$1="(E-mail Address Not Verified)";var o=s.prototype=new i;o.constructor=s,o.get_mood=function(){return this.get_item(n.SKPServiceDataProperties.mood)},o.set_mood=function(e){return this.set_item(n.SKPServiceDataProperties.mood,e),e},o.get_skypeName=function(){return this.get_item(n.SKPServiceDataProperties.skypeName)},o.set_skypeName=function(e){return this.set_item(n.SKPServiceDataProperties.skypeName,e),e},o.getEndpointData=function(e){return t.keyExists(this.get__endpointData(),e)?this.get__endpointData()[e]:null},o.update=function(e){return i.prototype.update.call(this,e)}}()}),define("imserviceendpointdata",["skpservicedata"],function(){!function(){var e=window,t=e.ss,n=e.MC,i=n.IMServiceEndpointDataProperties,s=n.CapabilitiesFlags,o=n.ServiceEndpointData,r=n.IMServiceEndpointData=function(e){o.call(this,e)},a=r.prototype=new o;a.constructor=r,a.get_capabilities=function(){return n.ServiceDataHelper.parseCapabilities(this.get_item(i.capabilities))},a.set_capabilities=function(e){return this.set_item(i.capabilities,n.ServiceDataHelper.formatCapabilities(e)),e},a.get_domain=function(){return this.get_item(i.domain)},a.set_domain=function(e){return this.set_item(i.domain,e),e},a.get_isOnlineViaMobileDevice=function(){return n.ServiceDataHelper.isSet(0,s.onlineViaMobile,this.get_capabilities())},a.get_isOnlineViaWeb=function(){return n.ServiceDataHelper.isSet(0,s.onlineViaWebIM,this.get_capabilities())},a.get_videoCallSupports16By9AspectRatio=function(){return n.ServiceDataHelper.isSet(1,s.videoCallSupports16By9AspectRatio,this.get_capabilities())},a.get_supportsTunneledSip=function(){return n.ServiceDataHelper.isSet(0,s.supportsTunneledSip,this.get_capabilities())},a.get_sipTunnelVersion2=function(){return n.ServiceDataHelper.isSet(1,s.sipTunnelVersion2,this.get_capabilities())},a.get_fTurnCapable=function(){return n.ServiceDataHelper.isSet(1,s.fTurnCapable,this.get_capabilities())},a.get_rtcVideoEnabled=function(){return n.ServiceDataHelper.isSet(1,s.rtcVideoEnabled,this.get_capabilities())},a.get_supportsMultipartyConversations=function(){return n.ServiceDataHelper.isSet(1,s.supportsMultipartyConversations,this.get_capabilities())},a.get_version=function(){var e=this.get_capabilities();return null!=e&&e.length>=1?s.appVersionMask&e[0]:s.none},a._update=function(e,n){var s=this.get_isOnlineViaMobileDevice(),r=this.get_isOnlineViaWeb(),a=this.get_supportsMultipartyConversations(),c=this.get_videoCallSupports16By9AspectRatio(),l=this.get_version();if(o.prototype._update.call(this,e,n),t.keyExists(n.updatedEndpoints,this.get__info().endpointId)){var u=n.updatedEndpoints[this.get__info().endpointId];u.contains(i.capabilities)&&(s!==this.get_isOnlineViaMobileDevice()&&u.push(i.isOnlineViaMobileDevice),r!==this.get_isOnlineViaWeb()&&u.push(i.isOnlineViaWeb),c!==this.get_videoCallSupports16By9AspectRatio()&&u.push(i.videoCallSupports16By9AspectRatio),a!==this.get_supportsMultipartyConversations()&&u.push(i.supportsMultipartyConversations),l!==this.get_version()&&u.push(i.version))}},a.propertyEquals=function(e,t){return o.prototype.propertyEquals.call(this,e,t)},a.propertyIsNullOrEmpty=function(e){return o.prototype.propertyIsNullOrEmpty.call(this,e)},a._getObject$1=function(e){return t.keyExists(this.info.properties,e)?this.info.properties[e]:null},a._setObject$1=function(e,t){this.info.properties[e]=t}}()}),define("imservicedata",["imserviceendpointdata"],function(){!function(){var e=window,t=e.MC,n=e.ss,i=t.PresenceInfoStatus,s=t.IMServiceDataProperties,o=t.CapabilitiesFlags,r=t.ServiceData,a=t.IMServiceData=function(e){r.call(this,e)},c=a.prototype=new r;c.constructor=a,c.get_isOnline=function(){switch(this.get_status()){case i.none:case i.offline:case i.appearOffline:return!1;default:return!0}},c.get_status=function(){return t.ServiceDataHelper.parseStatus(this.get_item(s.status))},c.set_status=function(e){return this.set_item(s.status,t.ServiceDataHelper.formatStatus(e)),e},c.get_isOnlineViaMobileDevice=function(){return this._isSetAnd$1(0,o.onlineViaMobile)},c.get_isOnlineViaWeb=function(){return this._isSetAnd$1(0,o.onlineViaWebIM)},c.get_videoCallSupports16By9AspectRatio=function(){return this._isSetAnd$1(1,o.videoCallSupports16By9AspectRatio)},c.get_supportsTunneledSip=function(){return this._isSetOr$1(0,o.supportsTunneledSip)},c.get_sipTunnelVersion2=function(){return this._isSetAnd$1(1,o.sipTunnelVersion2)},c.get_fTurnCapable=function(){return this._isSetAnd$1(1,o.fTurnCapable)},c.get_supportsMultipartyConversations=function(){return this._isSetOr$1(1,o.supportsMultipartyConversations)},c.get_version=function(){var e=o.appVersionMask,t=this.endpointData;for(var n in t){var i={key:n,value:t[n]},s=i.value.get_version();e>s&&(e=s)}return e===o.appVersionMask?o.none:e},c.getEndpointData=function(e){return n.keyExists(this.get__endpointData(),e)?this.get__endpointData()[e]:null},c.update=function(e){return this._updateAggregatedProperties$1(e,!1)},c.Delete=function(e){return this._updateAggregatedProperties$1(e,!0)},c._updateAggregatedProperties$1=function(e,i){var o=this.get_isOnline(),a=this.get_isOnlineViaMobileDevice(),c=this.get_isOnlineViaWeb(),l=this.get_supportsMultipartyConversations(),u=this.get_videoCallSupports16By9AspectRatio(),d=this.get_version(),_=i?r.prototype.Delete.call(this,e):r.prototype.update.call(this,e);return i&&0===n.getKeyCount(this.endpointData)&&this.get_status()!==t.PresenceInfoStatus.offline&&(this.set_status(t.PresenceInfoStatus.offline),_.updatedProperties.push(s.status)),(n.getKeyCount(_.deletedEndpoints)>0||n.getKeyCount(_.newEndpoints)>0||n.getKeyCount(_.updatedEndpoints)>0)&&(this.get_isOnlineViaMobileDevice()!==a&&_.updatedProperties.push(s.isOnlineViaMobileDevice),this.get_isOnlineViaWeb()!==c&&_.updatedProperties.push(s.isOnlineViaWeb),this.get_videoCallSupports16By9AspectRatio()!==u&&_.updatedProperties.push(s.videoCallSupports16By9AspectRatio),this.get_supportsMultipartyConversations()!==l&&_.updatedProperties.push(s.supportsMultipartyConversations),this.get_version()!==d&&_.updatedProperties.push(s.version)),_.updatedProperties.contains(s.status)&&o!==this.get_isOnline()&&_.updatedProperties.push(s.isOnline),_},c._isSetAnd$1=function(e,t){if(0===n.getKeyCount(this.endpointData))return!1;var i=this.get__endpointData();for(var s in i){var o={key:s,value:i[s]},r=o.value.get_capabilities();if(null==r||r.length<=e||0===(r[e]&t))return!1}return!0},c._isSetOr$1=function(e,t){var n=this.get__endpointData();for(var i in n){var s={key:i,value:n[i]},o=s.value.get_capabilities();if(null!=o&&o.length>e&&0!==(o[e]&t))return!0}return!1}}()}),define("pdserviceendpointdata",["imservicedata"],function(){!function(){var e=window,t=e.ss,n=e.MC,i=n.PDServiceEndpointDataProperties,s=n.ClientType,o=n.ServiceEndpointData,r=n.PDServiceEndpointData=function(e){o.call(this,e)},a=r.prototype=new o;a.constructor=r,a.get_name=function(){return this.get_item(i.epName)},a.set_name=function(e){return this.set_item(i.epName,e),e},a.get_clientType=function(){var e=this.get_item(i.clientType);if(t.isNullOrEmpty(e))return s.unknown;var o=n.ServiceDataHelper._tryParseInt(e);return 0>o?s.unknown:o},a.set_clientType=function(e){return this.set_item(i.clientType,n.enumToString(s,e)),e}}()}),define("pdservicedata",["pdserviceendpointdata"],function(){!function(){var e=window,t=e.ss,n=e.MC,i=n.ServiceData,s=n.PDServiceData=function(e){i.call(this,e)},o=s.prototype=new i;o.constructor=s,o.getEndpointData=function(e){return t.keyExists(this.get__endpointData(),e)?this.get__endpointData()[e]:null}}()}),define("peserviceendpointdata",["pdservicedata"],function(){!function(){var e=window,t=e.ss,n=e.MC,i=n.PEServiceEndpointDataProperties,s=n.ClientType,o=n.ServiceEndpointData,r=n.PEServiceEndpointData=function(e){o.call(this,e)},a=r.prototype=new o;a.constructor=r,a.get_capabilities=function(){return n.ServiceDataHelper.parseCapabilities(this.get_item(i.capabilities))},a.set_capabilities=function(e){return this.set_item(i.capabilities,n.ServiceDataHelper.formatCapabilities(e)),e},a.get_client=function(){return this.get_item(i.client)},a.set_client=function(e){return this.set_item(i.client,e),e},a.get_clientName=function(){var e=this.get_client();return this._validateClient$1(e)?e.split(":")[0]:""},a.set_clientName=function(e){var n=this.get_client();return this.set_client(this._validateClient$1(n)?t.format("{0}:{1}",e,n.split(":")[1]):t.format("{0}:",e)),e},a.get_clientType=function(){var e=this.get_item(i.clientType);if(t.isNullOrEmpty(e))return s.unknown;var o=n.ServiceDataHelper._tryParseInt(e);return 0>o?s.unknown:o},a.set_clientType=function(e){return this.set_item(i.clientType,n.enumToString(s,e)),e},a.get_clientVersion=function(){var e=this.get_client();return this._validateClient$1(e)?e.split(":")[1]:""},a.set_clientVersion=function(e){var n=this.get_client();return this.set_client(this._validateClient$1(n)?t.format("{0}:{1}",n.split(":")[0],e):t.format(":{0}",e)),e},a._update=function(e,n){var s=this.get_clientName(),r=this.get_clientVersion();if(o.prototype._update.call(this,e,n),t.keyExists(n.updatedEndpoints,this.get__info().endpointId)){var a=n.updatedEndpoints[this.get__info().endpointId];a.contains(i.client)&&(s!==this.get_clientName()&&a.push(i.clientName),r!==this.get_clientVersion()&&a.push(i.clientVersion))}},a._validateClient$1=function(e){return!t.isNullOrEmpty(e)&&2===e.split(":").length}}()}),define("peservicedata",["peserviceendpointdata"],function(){!function(){var e=window,t=e.ss,n=e.MC,i=n.PEServiceDataProperties,s=n.ServiceData,o=n.PEServiceData=function(e){s.call(this,e)};o._emailNotVerified$1="(E-mail Address Not Verified)";var r=o.prototype=new s;r.constructor=o,r.get_personalMessage=function(){return this.get_item(i.personalMessage)},r.set_personalMessage=function(e){return this.set_item(i.personalMessage,e),e},r.get_displayName=function(){var e=this.get_item(i.displayName);if(null!=e&&e.endsWith(o._emailNotVerified$1)){var t=e.length-o._emailNotVerified$1.length;return e.substr(0,t).rTrim()}return e},r.set_displayName=function(e){return this.set_item(i.displayName,e),e},r.get_userTileLocation=function(){return this.get_item(i.userTileLocation)},r.set_userTileLocation=function(e){return this.set_item(i.userTileLocation,e),e},r.get_isIdentityVerified=function(){var e=this.get_item(i.displayName);return null!=e&&!e.endsWith(o._emailNotVerified$1)},r.get_displayPictureUrl=function(){return this.get_item(i.displayPictureUrl)},r.set_displayPictureUrl=function(e){return this.set_item(i.displayPictureUrl,e),e},r.get_richUserMessage=function(){return this.get_item(i.richUserMessage)},r.set_richUserMessage=function(e){return this.set_item(i.richUserMessage,e),this.get_richLinkType()===n.RichPsmLinkType.none&&this.set_richLinkType(n.RichPsmLinkType.simpleText),e},r.get_richUrl=function(){return this.get_item(i.richUrl)},r.set_richUrl=function(e){return this.set_item(i.richUrl,e),e},r.get_richLinkType=function(){return n.ServiceDataHelper.parseRichLinkType(this.get_item(i.richLinkType))},r.set_richLinkType=function(e){return this.set_item(i.richLinkType,n.ServiceDataHelper.convertToRawLinkType(e)),e},r.get_safeUrl=function(){return this.get_item(i.safeUrl)},r.set_safeUrl=function(e){return this.set_item(i.safeUrl,e),e},r.getEndpointData=function(e){return t.keyExists(this.get__endpointData(),e)?this.get__endpointData()[e]:null},r.update=function(e){var t=this.get_isIdentityVerified(),n=s.prototype.update.call(this,e);return n.updatedProperties.contains(i.displayName)&&t!==this.get_isIdentityVerified()&&n.updatedProperties.push(i.isIdentityVerified),n}}()}),define("serviceendpointdataset",["peservicedata"],function(){!function(){var e=window,t=e.ss,n=e.MC,i=n.ServiceType,s=n.ServiceEndpointDataSet=function(e,t){this.id=e;for(var s=0;s<t.length;s++)switch(t[s].service){case i.IM:this.imEndpointData=n.ServiceEndpointData.create(t[s]);break;case i.PD:this.pdEndpointData=n.ServiceEndpointData.create(t[s]);break;case i.PE:this.peEndpointData=n.ServiceEndpointData.create(t[s]);break;case i.CM:this.cmEndpointData=n.ServiceEndpointData.create(t[s]);break;case i.SKP:this.skpEndpointData=n.ServiceEndpointData.create(t[s])}};s.create=function(e){return new s(e,[new n.ServiceEndpointDataInfo(e,n.ServiceType.IM,{}),new n.ServiceEndpointDataInfo(e,n.ServiceType.PE,{}),new n.ServiceEndpointDataInfo(e,n.ServiceType.PD,{})])},s.prototype={imEndpointData:null,pdEndpointData:null,peEndpointData:null,cmEndpointData:null,skpEndpointData:null,id:null,toArray:function(){for(var e=[],n=t.IEnumerator.getEnumerator(this.toServiceDataArray());n.moveNext();){var i=n.get_current();e.push(i.get__info())}return e},toServiceDataArray:function(){var e=[];return null!=this.imEndpointData&&e.push(this.imEndpointData),null!=this.peEndpointData&&e.push(this.peEndpointData),null!=this.pdEndpointData&&e.push(this.pdEndpointData),e}}}()}),define("servicedataset",["serviceendpointdataset"],function(){!function(){var e=window,t=e.MC,n=e.ss,i=t.ServiceType,s=t.ServiceDataSet=function(e){for(var n=0;n<e.length;n++){var s=e[n].service;switch(s){case i.IM:this.imServiceData=t.ServiceData.create(e[n]);break;case i.PD:this.pdServiceData=t.ServiceData.create(e[n]);break;case i.PE:this.peServiceData=t.ServiceData.create(e[n]);break;case i.CM:this.cmServiceData=t.ServiceData.create(e[n]);break;case i.SKP:this.skpServiceData=t.ServiceData.create(e[n])}}};s.create=function(){return new s([new t.ServiceDataInfo(i.IM,{},{}),new t.ServiceDataInfo(i.PE,{},{}),new t.ServiceDataInfo(i.PD,{},{}),new t.ServiceDataInfo(i.CM,{},{}),new t.ServiceDataInfo(i.SKP,{},{})])},s.createMessengerUpdate=function(e,i){for(var o,r=[],a=new t.ServiceDataSet(i),c=n.IEnumerator.getEnumerator(e.toServiceDataArray());c.moveNext();)o=c.get_current(),null!=a.getServiceData(o.get_service())&&r.push(o.clone());for(var l=n.IEnumerator.getEnumerator(i);l.moveNext();)o=l.get_current(),null==e.getServiceData(o.service)&&r.push(o);var u=new s(r);return u.updateAll(i),u},s.prototype={imServiceData:null,pdServiceData:null,peServiceData:null,cmServiceData:null,skpServiceData:null,clone:function(){for(var e=[],t=n.IEnumerator.getEnumerator(this.toServiceDataArray());t.moveNext();){var i=t.get_current();e.push(i.clone())}return new s(e)},addEndpoint:function(e){var t=this.getServiceData(e.get_service());null!=t&&t.addEndpoint(e)},getEndpointSet:function(e){for(var i=[],s=n.IEnumerator.getEnumerator(this.toServiceDataArray());s.moveNext();){var o=s.get_current();i.push(n.keyExists(o.get__endpointData(),e)?o.get__endpointData()[e].get__info():new t.ServiceEndpointDataInfo(e,o.get_service(),{}))}return new t.ServiceEndpointDataSet(e,i)},createDiff:function(e){for(var t=[],i=n.IEnumerator.getEnumerator(e.toServiceDataArray());i.moveNext();){var s=i.get_current(),o=this.getServiceData(s.get_service());if(null==o)t.push(s.clone());else{var r=o.createDiff(s);(n.getKeyCount(r.properties)>0||n.getKeyCount(r.endpointData)>0)&&t.push(r)}}return t},toArray:function(){for(var e=[],t=n.IEnumerator.getEnumerator(this.toServiceDataArray());t.moveNext();){var i=t.get_current();e.push(i.get_info())}return e},toServiceDataArray:function(){var e=[];return null!=this.imServiceData&&e.push(this.imServiceData),null!=this.peServiceData&&e.push(this.peServiceData),null!=this.pdServiceData&&e.push(this.pdServiceData),null!=this.cmServiceData&&e.push(this.cmServiceData),null!=this.skpServiceData&&e.push(this.skpServiceData),e},update:function(e){var n=this.getServiceData(e.service);return null!=n?n.update(e):new t.ServiceDataDiff(e.service)},Delete:function(e){var n=this.getServiceData(e.service);return null!=n?n.Delete(e):new t.ServiceDataDiff(e.service)},updateAll:function(e){for(var t=[],i=n.IEnumerator.getEnumerator(e);i.moveNext();){var s=i.get_current();t.push(this.update(s))}return t},deleteAll:function(e){for(var t=[],i=n.IEnumerator.getEnumerator(e);i.moveNext();){var s=i.get_current();t.push(this.Delete(s))}return t},getServiceData:function(e){switch(e){case i.IM:return this.imServiceData;case i.PD:return this.pdServiceData;case i.PE:return this.peServiceData;case i.CM:return this.cmServiceData;case i.SKP:return this.skpServiceData}return null},getEndpointServiceData:function(e,t){var i=this.getServiceData(e);return null!=i&&n.keyExists(i.get__endpointData(),t)?i.get__endpointData()[t]:null}}}()}),define("logger",["servicedataset"],function(){!function(){var e=window,t=e.MC,n=t.WebmainHelper,i=t.Logger=function(){};i.logAction=function(e){n.peopleLog({eventType:e})},i.logDetails=function(e,t){n.peopleLog({eventType:e,resultDetails:t})},i.logError=function(e,t){n.peopleLog({eventType:e,error:t})},i.logResult=function(e,t){n.peopleLog({eventType:e,resultCode:t})}}()}),define("servicesconstants",["logger"],function(){!function(){var e=window.MSH;e.Timeout={infinite:-1}}()}),define("servicesenums",["servicesconstants"],function(){!function(){var e=window,t=e.MSCo,n=e.MSM,i=e.MSP,s=t.Environment=function(){};s.production=1,s.dogfood=2,s.integration=3;var o=t.HttpMethod=function(){};o.Get=0,o.Post=1,o.Put=2,o.Delete=3;var r=t.HttpStatusCode=function(){};r.none=0,r.aborted=1,r.OK=200,r.created=201,r.accepted=202,r.noContent=204,r.movedPermanently=301,r.found=302,r.notModified=304,r.badRequest=400,r.unauthorized=401,r.forbidden=403,r.notFound=404,r.requestTimeout=408,r.conflict=409,r.gone=410,r.serverError=500,r.notImplemented=501,r.badGateway=502,r.serviceUnavailable=503;var a=n.ContentDocumentType=function(){};a.none=0,a.circleDocument=1,a.userDocument=2,a.networkDocument=3;var c=n.MriCompareOptions=function(){};c.none=0,c.address=1,c.epId=2,c.addressAndEpId=3;var l=n.MsnpStatusCode=function(){};l.success=0,l.invalidParameter=201,l.invalidFederatedUser=203,l.unroutableUser=204,l.invalidUser=205,l.invalidUsername=208,l.invalidFriendlyName=209,l.contactListFull=210,l.alreadyThere=215,l.notAcceptingIMs=217,l.notAcceptingPages=220,l.invalidMsisdn=232,l.unknownMsisdn=233,l.unknownKeitaiDomain=234,l.invalidXmlData=240,l.detailedErrorInPayload=241,l.unknownP2PApp=282,l.unknownUunApp=283,l.messageTooLong=285,l.smsJustOutOfFunds=290,l.addressBookError=403,l.smsSubscriptionRequired=413,l.smsSubscriptionDisabled=414,l.smsOutOfFunds=415,l.smsDisabledMarket=416,l.smsDisabledGlobal=417,l.tryAgainLater=418,l.noMarketSpecified=419,l.internalServerError=500,l.upsDown=504,l.federatedPartnerError=508,l.pageModeMessageError=509,l.detailedError=511,l.oimNotSupported=537,l.smsAccountMuted=550,l.smsAccountDisabled=551,l.smsAccountMaxed=552,l.smsInternalServerError=580,l.smsCarrierInvalid=590,l.smsCarrierNoRoute=591,l.smsCarrierErrored=592,l.smsAddressMappingFull=593,l.smsIncorrectSourceCountry=594,l.smsMobileCacheFull=595,l.smsIncorrectFormat=596,l.smsInvalidText=597,l.smsMessageTooLong=598,l.serverUnavailable=601,l.pagingUnavailable=606,l.sessionRestricted=711,l.sessionOverloaded=712,l.userTooActive=713,l.notExpected=715,l.userRestricted=718,l.sessionFederated=719,l.userFederated=726,l.roamingLogoff=733,l.tooManyEndpoints=734,l.rateLimitExceeded=800,l.perUserLoginLimitExceeded=803,l.authFailed=911,l.accountCompromised=915,l.timedOut=921,l.childWithoutFullConsent=923,l.managedUserLimitedAccessWrongClient=926,l.managedUserAccessDenied=927,l.authError=928,l.domainReserved=931,l.invalidContactList=933,l.invalidSignature=935;var u=n.NotificationType=function(){};u.partialNotify=0,u.fullNotify=1;var d=i.ServiceDataDocumentType=function(){};d.put=0,d.del=1}()}),define("bigint",["servicesenums"],function(){!function(){var e="0123456789abcdef",t=16,n=3,i=window,s=i.ss,o=i.MSH,r=o.BigInt=function(e,t){this._elements=[],this._radix=e,this._elements.insert(0,t),this._length=1,this._normalize()};r.hexRadix=16,r.decRadix=1e3,r._createDec=function(e){return new o.BigInt(r.decRadix,e)},r._createHex=function(e){return new r(r.hexRadix,e)},r._computeHexNegative=function(e,n){var i,s=[];for(i=0;n>i;i++)s.insert(i,e[i]);for(i=0;i<s.length;i++)s[i]>0&&(s[i]=o.BigInt.hexRadix-s[i],i+1<s.length?s[i+1]=s[i+1]+1:s.length<t&&s.insert(i+1,1));return s},r.parseDecInt=function(e,t){switch(e){case r.decRadix:return r._parseDecIntToDecRadixBigInt(t);case r.hexRadix:return r._parseDecIntToHexRadixBigInt(t);default:return null}},r._parseDecIntToHexRadixBigInt=function(e){if(s.isNullOrEmpty(e))return null;var t="-"===e.charAt(0);t&&(e=e.substr(1));for(var n=9,i=o.BigInt._createHex(1e9),a=o.BigInt._createHex(0),c=Math.ceil(e.length/n),l=o.BigInt._createHex(1),u=e.length,d=0;c>d;d++){var _=0>u-n?0:u-n,g=parseInt(e.substr(_,u-_),10),h=r._createHex(g);h.multiply(l),a.add(h),l.multiply(i),u-=n}return a._isNegative=t,a},r._parseDecIntToDecRadixBigInt=function(e){if(0===e.length)return r._createDec(0);var t=!1,i=[];"-"===e.charAt(0)&&(t=!0,e=e.substr(1,e.length-1));var s;for(s=0;n*(s+1)<=e.length;s++)i.insert(s,parseInt(e.substring(e.length-n*(s+1),e.length-n*s),10));0!==e.length%n&&i.insert(s++,parseInt(e.substring(0,e.length%n),10));var o=r._createDec(0);return o._elements=i,o._length=s,o._isNegative=t,o},r._getHexValues=function(e){for(var t=new Array(e.length),n=0;n<e.length;n++)if(t[n]=r._hexCharValue(e.charAt(n)),t[n]<0)return null;return t},r._hexCharValue=function(e){if(e>="0"&&"9">=e)return e-"0";switch(e){case"a":return 10;case"b":return 11;case"c":return 12;case"d":return 13;case"e":return 14;case"f":return 15}return-1},r._toNegativeValues=function(e){for(var t=e.length-1;t>=0;t--)e[t]>0&&(e[t]=16-e[t],t>0&&(e[t-1]+=1));return e},r.prototype={_isNegative:!1,_length:0,_radix:0,_normalize:function(){var e;for(e=this._length-1;e>=0&&0===this._elements[e];e--)this._length--;for(var t=0;2>t;t++)if(0===this._length)this._isNegative=!1;else{if(this._elements[this._length-1]<0){for(e=0;e<this._length;e++)this._elements[e]=-this._elements[e];this._isNegative=!this._isNegative}for(e=0;e<this._length-1;e++){var n;this._elements[e]<0&&(n=Math.ceil(-this._elements[e]/this._radix),this._elements[e]=this._elements[e]+this._radix*n,this._elements[e+1]=this._elements[e+1]-n),this._elements[e]>=this._radix&&(n=Math.floor(this._elements[e]/this._radix),this._elements[e]=this._elements[e]%this._radix,this._elements[e+1]=this._elements[e+1]+n)}for(;this._elements[this._length-1]>=this._radix;)this._ensureCapacity(),this._elements[this._length]=Math.floor(this._elements[this._length-1]/this._radix),this._elements[this._length-1]=this._elements[this._length-1]%this._radix,this._length++;
if(!(this._elements[this._length-1]<0))break;for(e=0;e<this._length;e++)this._elements[e]=-this._elements[e];this._isNegative=!this._isNegative}},_ensureCapacity:function(){this._length===this._elements.length&&this._elements.push(0)},add:function(e){var t;for(t=0;t<this._length-e._length;t++)e._elements.insert(e._length+t,0);for(t=0;t<e._length-this._length;t++)this._elements.insert(this._length+t,0);if(this._length=Math.max(e._length,this._length),this._isNegative===e._isNegative)for(t=0;t<this._length;t++)this._elements[t]=this._elements[t]+e._elements[t];else for(t=0;t<this._length;t++)this._elements[t]=this._elements[t]-e._elements[t];this._normalize()},multiply:function(e){var t,n=new o.BigInt(this._radix,0);for(t=0;t<e._length+this._length;t++)t<n._elements.length?n._elements[t]=0:n._elements.insert(t,0);for(t=0;t<e._length;t++){for(var i=0;i<this._length;i++)n._elements[t+i]=n._elements[t+i]+e._elements[t]*this._elements[i],0!==n._elements[t+i]&&(n._length=Math.max(n._length,t+i+1));n._normalize()}n._isNegative=e._isNegative!==this._isNegative,this._elements=n._elements,this._isNegative=n._isNegative,this._length=n._length},modulus:function(e){for(;;){if(0===e._length||0===this._length)break;var t=this._length-e._length;if(0>t)break;var n=this._elements[this._length-1],i=e._elements[e._length-1];if(n>=i){for(var s=Math.floor(n/i),o=0;o<e._length;o++)this._elements[o+t]=this._elements[o+t]-s*e._elements[o];this._normalize()}else{if(0===t)break;this._elements[this._length-2]=this._elements[this._length-2]+this._radix*this._elements[this._length-1],this._length--}}this._isNegative&&(e._isNegative?(e._isNegative=!1,this.add(e),e._isNegative=!0):this.add(e)),this._normalize()},toString:function(){switch(this._radix){case r.hexRadix:return this._toHexString();case r.decRadix:return this._toDecString();default:return""}},_toHexString:function(){if(0===this._elements.length)return"0";var t=this._elements;this._isNegative&&(t=r._computeHexNegative(t,this._length));for(var n=new s.StringBuilder,i=!1,o=t.length-1;o>=0;o--)i||0!==t[o]&&(i=!0),i&&n.append(e.charAt(t[o]));return n.toString()},_toDecString:function(){if(0===this._length)return"0";for(var e="",t=0;t<this._length;t++)if(e=this._elements[t]+e,t<this._length-1)for(var n=10;n<this._radix;n*=10)this._elements[t]<n&&(e=0+e);return this._isNegative&&(e="-"+e),e}}}()}),define("converthelper",["bigint"],function(){!function(){var e=window,t=e.MSH;t.ConvertHelper={tryParseInt:function(e){var t=parseInt(e,10);return isNaN(t)?-1:t},parseHexInt:function(e){var t=parseInt(e,16);return isNaN(t)?0:t}}}()}),define("datetimehelper",["converthelper"],function(){!function(){var e=window,t=e.MSH;t.DateTimeHelper={minValue:new Date(0),parseTimeStamp:function(e){var t=new RegExp("^(\\d{4})-(\\d{2})-(\\d{2})(T|\\s{1})(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d*)Z$"),n=9,i=t.exec(e);return null!=i&&i.length===n?new Date(Date.UTC(parseInt(i[1],10),parseInt(i[2],10)-1,parseInt(i[3],10),parseInt(i[5],10),parseInt(i[6],10),parseInt(i[7],10),parseInt(i[8],10))):new Date},subtract:function(e,t){return e.getTime()-t.getTime()},addMilliseconds:function(e,t){return e.setTime(e.getTime()+t),e}}}()}),define("timedentry",["datetimehelper"],function(){!function(){var e=window,t=e.MSM;t._timedEntry=function(e,t,n){this._key=e,this._obj=t,this._expires=n},t._timedEntry.prototype={_key:0,_obj:null,_expires:null,hasExpired:function(e){return e.getTime()>=this._expires.getTime()},get_key:function(){return this._key},get_object:function(){return this._obj}}}()}),define("timeoutqueue",["timedentry"],function(){!function(){var e=window,t=e.MC,n=e.MSM,i=e.MSH;n._timeoutQueue=function(e){this._entries=[],this._timeout=1e3*e},n._timeoutQueue.prototype={_timeout:0,schedule:function(e,t){var s=i.DateTimeHelper.addMilliseconds(new Date,this._timeout);this._entries.push(new n._timedEntry(e,t,s))},cancel:function(e){if(e>0)for(var t=0;t<this._entries.length;t++){var n=this._entries[t];if(n.get_key()===e){var i=n.get_object();return this._entries.splice(t,1),i}}return null},expireEntries:function(){if(0!==this._entries.length)for(var e=new Date,n=0;n<this._entries.length;n++){var i=this._entries[n];i.hasExpired(e)&&(t.Logger.logAction("TimeoutQueueExpireEntries"),this._entries.splice(n--,1))}}}}()}),define("md5",["timeoutqueue"],function(){!function(){function e(e,t,n){return e&t|~e&n}function t(e,t,n){return e&n|t&~n}function n(e,t,n){return e^t^n}function i(e,t,n){return t^(e|~n)}function s(e,t){return e<<t|e>>>32-t}function o(t,n,i,o,r,a,c){return t+=e(n,i,o)+r+c,t=s(t,a),t+=n}function r(e,n,i,o,r,a,c){return e+=t(n,i,o)+r+c,e=s(e,a),e+=n}function a(e,t,i,o,r,a,c){return e+=n(t,i,o)+r+c,e=s(e,a),e+=t}function c(e,t,n,o,r,a,c){return e+=i(t,n,o)+r+c,e=s(e,a),e+=t}function l(e,t,n,i,s){for(var o=0;s>o;o++)n[i+o]=e[t+o]}var u=window,d=u.MSP,_=u.ss,g=7,h=12,p=17,f=22,m=5,v=9,C=14,y=20,S=4,$=11,w=16,I=23,b=6,M=10,k=15,E=21,T=[128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];d._mD5=function(){this._state=[0,0,0,0],this._count=[0,0],this._buffer=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this._init()},d._mD5.prototype={_init:function(){this._count[0]=this._count[1]=0,this._state[0]=1732584193,this._state[1]=4023233417,this._state[2]=2562383102,this._state[3]=271733878},_updateOperation:function(e,t,n){var i,s,o;if(s=this._count[0]>>>3&63,(this._count[0]+=n<<3)<n<<3&&this._count[1]++,this._count[1]+=n>>>29,o=64-s,n>=o){for(l(e,t,this._buffer,s,o),this._transform(this._buffer,0),i=o;n>i+63;i+=64)this._transform(e,t+i);s=0}else i=0;l(e,t+i,this._buffer,s,n-i)},_finalOperation:function(){var e,t,n=new Array(16),i=new Array(8);return this._encode(i,0,this._count,0,8),e=this._count[0]>>>3&63,t=56>e?56-e:120-e,this._updateOperation(T,0,t),this._updateOperation(i,0,8),this._encode(n,0,this._state,0,16),this._count[0]=this._count[1]=0,this._state[0]=0,this._state[1]=0,this._state[2]=0,this._state[3]=0,this._init(),n},_transform:function(e,t){var n=this._state[0],i=this._state[1],s=this._state[2],l=this._state[3],u=new Array(16);this._decode(u,0,e,t,64),n=o(n,i,s,l,u[0],g,3614090360),l=o(l,n,i,s,u[1],h,3905402710),s=o(s,l,n,i,u[2],p,606105819),i=o(i,s,l,n,u[3],f,3250441966),n=o(n,i,s,l,u[4],g,4118548399),l=o(l,n,i,s,u[5],h,1200080426),s=o(s,l,n,i,u[6],p,2821735955),i=o(i,s,l,n,u[7],f,4249261313),n=o(n,i,s,l,u[8],g,1770035416),l=o(l,n,i,s,u[9],h,2336552879),s=o(s,l,n,i,u[10],p,4294925233),i=o(i,s,l,n,u[11],f,2304563134),n=o(n,i,s,l,u[12],g,1804603682),l=o(l,n,i,s,u[13],h,4254626195),s=o(s,l,n,i,u[14],p,2792965006),i=o(i,s,l,n,u[15],f,1236535329),n=r(n,i,s,l,u[1],m,4129170786),l=r(l,n,i,s,u[6],v,3225465664),s=r(s,l,n,i,u[11],C,643717713),i=r(i,s,l,n,u[0],y,3921069994),n=r(n,i,s,l,u[5],m,3593408605),l=r(l,n,i,s,u[10],v,38016083),s=r(s,l,n,i,u[15],C,3634488961),i=r(i,s,l,n,u[4],y,3889429448),n=r(n,i,s,l,u[9],m,568446438),l=r(l,n,i,s,u[14],v,3275163606),s=r(s,l,n,i,u[3],C,4107603335),i=r(i,s,l,n,u[8],y,1163531501),n=r(n,i,s,l,u[13],m,2850285829),l=r(l,n,i,s,u[2],v,4243563512),s=r(s,l,n,i,u[7],C,1735328473),i=r(i,s,l,n,u[12],y,2368359562),n=a(n,i,s,l,u[5],S,4294588738),l=a(l,n,i,s,u[8],$,2272392833),s=a(s,l,n,i,u[11],w,1839030562),i=a(i,s,l,n,u[14],I,4259657740),n=a(n,i,s,l,u[1],S,2763975236),l=a(l,n,i,s,u[4],$,1272893353),s=a(s,l,n,i,u[7],w,4139469664),i=a(i,s,l,n,u[10],I,3200236656),n=a(n,i,s,l,u[13],S,681279174),l=a(l,n,i,s,u[0],$,3936430074),s=a(s,l,n,i,u[3],w,3572445317),i=a(i,s,l,n,u[6],I,76029189),n=a(n,i,s,l,u[9],S,3654602809),l=a(l,n,i,s,u[12],$,3873151461),s=a(s,l,n,i,u[15],w,530742520),i=a(i,s,l,n,u[2],I,3299628645),n=c(n,i,s,l,u[0],b,4096336452),l=c(l,n,i,s,u[7],M,1126891415),s=c(s,l,n,i,u[14],k,2878612391),i=c(i,s,l,n,u[5],E,4237533241),n=c(n,i,s,l,u[12],b,1700485571),l=c(l,n,i,s,u[3],M,2399980690),s=c(s,l,n,i,u[10],k,4293915773),i=c(i,s,l,n,u[1],E,2240044497),n=c(n,i,s,l,u[8],b,1873313359),l=c(l,n,i,s,u[15],M,4264355552),s=c(s,l,n,i,u[6],k,2734768916),i=c(i,s,l,n,u[13],E,1309151649),n=c(n,i,s,l,u[4],b,4149444226),l=c(l,n,i,s,u[11],M,3174756917),s=c(s,l,n,i,u[2],k,718787259),i=c(i,s,l,n,u[9],E,3951481745),this._state[0]+=n,this._state[1]+=i,this._state[2]+=s,this._state[3]+=l;for(var d=0;d<u.length;d++)u[d]=0},_encode:function(e,t,n,i,s){for(var o=t+s,r=i,a=t;o>a;r++,a+=4)e[a]=255&n[r],e[a+1]=n[r]>>>8&255,e[a+2]=n[r]>>>16&255,e[a+3]=n[r]>>>24&255},_decode:function(e,t,n,i,s){for(var o=i+s,r=t,a=i;o>a;r++,a+=4)e[r]=n[a]|n[a+1]<<8|n[a+2]<<16|n[a+3]<<24},digest:function(e){for(var t=new Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);this._updateOperation(t,0,t.length);var i=this._finalOperation(),s="0123456789abcdef",o=new _.StringBuilder;for(n=0;n<i.length;n++)o.append(s.charAt(i[n]>>>4&15)),o.append(s.charAt(15&i[n]));return o.toString()}}}()}),define("md5auth",["md5"],function(){!function(){function e(e){return(new i._mD5).digest(e)}function t(e,t){var n,i=e.toString(2),s=t.toString(2),r=new o.StringBuilder,a=new o.StringBuilder,c=Math.abs(i.length-s.length);for(n=0;c>n;n++)a.append("0");for(i.length<s.length?(a.append(i),i=a.toString()):s.length<i.length&&(a.append(s),s=a.toString()),n=0;n<i.length;n++)r.append(i.charAt(n)===s.charAt(n)?"0":"1");return parseInt(r.toString(),2)}var n=window,i=n.MSP,s=n.MSH,o=n.ss;i._mD5Auth=function(){},i._mD5Auth.prototype={_int32ToHexString:function(e){for(var t="0123456789abcdef",n=new o.StringBuilder,i=0;3>=i;i++)n.append(t.charAt(e>>8*i+4&15)),n.append(t.charAt(e>>8*i&15));return n.toString()},getMacMD5Hash:function(n,i,r){var a=n+i,c=a,l=8-c.length%8;8!==l&&(c=o.padRight(c,c.length+l,"0"));var u,d,_=c.length/4,g=[];for(u=0,d=0;_>u;u++)g.insert(u,0),g[u]=g[u]+1*c.charCodeAt(d++),g[u]=g[u]+256*c.charCodeAt(d++),g[u]=g[u]+65536*c.charCodeAt(d++),g[u]=g[u]+16777216*c.charCodeAt(d++);var h=new Array(4),p=e(n+r);for(u=0,d=0;u<h.length;u++)h[u]=0,h[u]+=1*s.ConvertHelper.parseHexInt(p.substr(d,2)),d+=2,h[u]+=256*s.ConvertHelper.parseHexInt(p.substr(d,2)),d+=2,h[u]+=65536*s.ConvertHelper.parseHexInt(p.substr(d,2)),d+=2,h[u]+=16777216*s.ConvertHelper.parseHexInt(p.substr(d,2)),d+=2;var f=new Array(2);this._cS64_C(g,h,f);var m=t(h[0],f[0]),v=t(h[1],f[1]),C=t(h[2],f[0]),y=t(h[3],f[1]);return this._int32ToHexString(m)+this._int32ToHexString(v)+this._int32ToHexString(C)+this._int32ToHexString(y)},_cS64_C:function(e,t,n){var i=2147483647;if(e.length<2||1===(1&e.length))return!1;for(var o=t[0]&i,r=t[1]&i,a=t[2]&i,c=t[3]&i,l=242854337,u=s.BigInt.parseDecInt(s.BigInt.decRadix,o.toString()),d=s.BigInt.parseDecInt(s.BigInt.decRadix,r.toString()),_=s.BigInt.parseDecInt(s.BigInt.decRadix,a.toString()),g=s.BigInt.parseDecInt(s.BigInt.decRadix,c.toString()),h=s.BigInt.parseDecInt(s.BigInt.decRadix,l.toString()),p=0,f=s.BigInt.parseDecInt(s.BigInt.decRadix,i.toString()),m=s.BigInt.parseDecInt(s.BigInt.decRadix,"0"),v=s.BigInt.parseDecInt(s.BigInt.decRadix,"0"),C=s.BigInt.parseDecInt(s.BigInt.decRadix,"0"),y=0;y<e.length/2;y++)m=s.BigInt.parseDecInt(s.BigInt.decRadix,e[p++].toString()),m.multiply(h),m.modulus(f),v.add(m),v.multiply(u),v.add(d),v.modulus(f),C.add(v),v.add(s.BigInt.parseDecInt(s.BigInt.decRadix,e[p++].toString())),v.multiply(_),v.add(g),v.modulus(f),C.add(v);return v.add(d),v.modulus(f),C.add(g),C.modulus(f),n[0]=parseInt(v.toString(),10),n[1]=parseInt(C.toString(),10),!0}}}()}),define("contacthelper",["md5auth"],function(){!function(){var e=window,t=e.ss,n=e.MC,i=e.MSH,s=n.RoleLists,o=n.IMAddressInfoType,r=wLive.People.Reporter;i.ContactHelper={getIMAddressInfoKey:function(e){return i.ContactHelper.computeIMAddressKey(e.address,e.type,e.network,null)},computeIMAddressKey:function(e,n,i,s){var r;switch(n){case o.connect:r="13:"+e+";via=14:"+i.toLowerCase();break;default:r=n+":"+(e||""),t.isNullOrEmpty(s)||(r+=";path="+s),r=r.toLowerCase()}return r},computeIMAddressId:function(e){var n;switch(e.type){case o.windowsLive:n=t.isNullOrEmpty(e.cid)?"1:"+e.address:"11:"+e.cid;break;case o.cid:var i=e.cid;n="11:"+i;break;case o.connect:n="13:{0};via=14:"+e.network;break;case o.telephone:n="4:tel:"+e.address;break;case o.smtp:n="16:smtp:"+e.address;break;case o.officeCommunicator:case o.skype:case o.shortCircuit:case o.temporaryGroup:n=e.type+":"+e.address;break;default:return""}return n=n.toLowerCase(),e.type===o.connect&&(n=t.format(n,e.address)),n},createAddressInfos:function(e){var n=[],o=s.allow|s.forward,r=e.getPerson();(r.getOnHideList()||3===r.getTrustLevel())&&(o|=s.hide);var a,c=e.getMessagingAddresses();if(null!=c&&c.length>0)for(var l=t.IEnumerator.getEnumerator(c);l.moveNext();){var u=l.get_current();a=i.ContactHelper.createAddressInfoFromMessagingAddress(u,o),null!=a&&(a.cid=r.getCid(),a.skypeId=e.getSkypeId(),n.push(a))}return n},createAddressInfoFromMessagingAddress:function(e,a){var c=null,l=e._getMri().trim().split(":"),u=e._getContact();if(null!=l){var d=i.ConvertHelper.tryParseInt(l[0]);if(-1!==d){var _=d;if(2===l.length)(_===o.windowsLive||_===o.officeCommunicator||_===o.skype||_===o.shortCircuit||_===o.temporaryGroup||_===o.telephone)&&(c=new n.IMAddressInfo(l[1],_,a,e));else if(3===l.length)if(_!==o.skype&&_!==o.shortCircuit||"live"!==l[1]&&"facebook"!==l[1]){if(_===o.connect){var g=u.getSourceId(),h="";if("GOOG"===g){var p=l[1].trim().split(";");null!=p&&p.length>0&&(h=p[0])}else h=u.getObjectId();if(!t.isNullOrEmpty(h)&&!t.isNullOrEmpty(g)){var f=s.allow|s.forward;c=new n.IMAddressInfo(h,o.connect,f,e),c.network=g}"FB"===g&&(c.isFacebookMobileEnabled=u.getOfflineImEnabled())}}else c=new n.IMAddressInfo(l[1]+":"+l[2],_,a,e)}}return null==c&&r.logError("InvalidMri",t.format("Failed to parse mri {0}",e._getMri())),c},areIMAddressesEqual:function(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.type===t.type)switch(e.type){case o.connect:return e.address===t.address&&e.network===t.network;case o.cid:return e.cid===t.cid;default:return e.address===t.address}return!1}}}()}),define("timer",["contacthelper"],function(){!function(){var e=window,t=e.MSH,n=e.ss;t.Timer=function(e,t,n,i){this._callback=e,this._state=t,this._initialize(n,i)},t.Timer.prototype={_callback:null,_state:null,_period:0,_timeoutId:0,_intervalId:0,change:function(e,t){this._clear(),this._initialize(e,t)},_initialize:function(i,s){this._period=s,i===t.Timeout.infinite||(0===i?this._onTimeout():i>0&&(this._timeoutId=e.setTimeout(n.Delegate.create(this,this._onTimeout),i)))},_clear:function(){0!==this._timeoutId&&(e.clearTimeout(this._timeoutId),this._timeoutId=0),0!==this._intervalId&&(e.clearInterval(this._intervalId),this._intervalId=0)},_onTimeout:function(){this._callback.invoke(this._state),this._timeoutId=0,this._period>0&&(this._intervalId=e.setInterval(n.Delegate.create(this,this._onInterval),this._period))},_onInterval:function(){this._callback.invoke(this._state)},dispose:function(){this._clear()}}}()}),define("scheduler",["timer"],function(){!function(){var e=window,t=e.MSH;t.Scheduler={defer:function(e){var n=null;n=new t.Timer(function(){n.dispose(),e.invoke()},null,1,t.Timeout.infinite)}}}()}),define("urihelper",["scheduler"],function(){!function(){var e=window,t=e.ss,n=e.MSH,i=e.document;n.UriHelper={addParameter:function(e,t,n){var i="?",s=e.indexOf("?");return-1!==s&&(i=-1!==e.indexOf("=",s)?"&":""),e+i+t+"="+n},updateUrlProtocol:function(e){return n.UriHelper.get_isSecureContext()&&null!=e&&e.startsWith("http:")&&(e=t.replaceAll(e,"http:","https:")),e},updateDisplayPictureUrl:function(e){if(e=n.UriHelper.updateUrlProtocol(e),t.isNullOrEmpty(e))return"";var i="https://";if(e.startsWith(i)){e=e.substr(i.length);var s=e,o="",r=e.indexOf("/");r>0&&(s=e.substring(0,r),o=e.substr(r)),s.indexOf("messenger.services.live.com")<0&&s.indexOf(".live.com")>0&&(s=t.replaceAll(s,".live.com",".msn.com")),s.indexOf("messenger.live-int.com")<0&&s.indexOf(".live-int.com")>0&&(s=t.replaceAll(s,".live-int.com",".msn-int.com")),e=i+s+o}return e},get_isSecureContext:function(){return"https:"===n.UriHelper.get_windowLocationProtocol()},get_windowLocationProtocol:function(){try{return e.location.protocol.toLowerCase()}catch(t){try{var n=i.location;return n.protocol.toLocaleLowerCase()}catch(s){return"http:"}}}}}()}),define("xmlhelper",["urihelper"],function(){!function(){var e=new RegExp("[\\x00-\\x08\\x0b-\\x0c\\x0e-\\x1f\\x22\\x26\\x27\\x3c\\x3e\\x60]","g"),t=window,n=t.MSH,i=t.ss;n.XmlHelper={getAttribute:function(e,t){var n=e.attributes.getNamedItem(t);return null!=n?n.value:null},isElement:function(e,t){return 1!==e.nodeType?!1:e.nodeName===t},xmlNodeValue:function(e){if(null==e)return"";if(3===e.nodeType)return e.nodeValue;if(0===e.childNodes.length)return e.text||"";for(var t=new i.StringBuilder,n=0;n<e.childNodes.length;n++){var s=e.childNodes[n];3===s.nodeType&&t.append(s.nodeValue)}return t.toString()},xmlEscape:function(t){return null==t?null:(e.lastIndex=0,e.test(t)&&(t=t.replace(e,function(e){return"&#x"+i.padLeft(e.charCodeAt(0).toString(16),2,"0")+";"})),t)}}}()}),define("iconnectionserviceevents",["xmlhelper"],function(){!function(){var e=window.MC;e.IConnectionServiceEvents=function(){},e.IConnectionServiceEvents.prototype={onABChangeNotificationReceived:null,onNetworkStatusChanged:null,onServiceDataChanged:null,onServiceDataDeleted:null,onMailNotificationReceived:null,onDatagramReceived:null,onDisconnected:null,onTransferred:null,onSignInEventsEmpty:null,onTridChanged:null,onRegistrationTokenChanged:null}}()}),define("iuserserviceevents",["iconnectionserviceevents"],function(){!function(){var e=window.MC;e.IUserServiceEvents=function(){},e.IUserServiceEvents.prototype={onABChangeNotificationReceived:null,onUpdateNetworkCompleted:null,onNetworkStatusChanged:null,onSignedIn:null,onSignedOut:null,onUserServicesUpdated:null,onUserServiceDataUpdated:null,onSignedOutRemotely:null,onMailNotification:null,onServicesChanged:null,onServiceDataChanged:null,onServiceDataDeleted:null,onConversationCreated:null,onConversationGroupCreated:null,onConversationGroupUpdated:null,onConversationAddMembersCompleted:null,onConversationRemoveMembersCompleted:null,onConversationAddressJoined:null,onConversationAddressLeft:null,onConversationGetRecentListCompleted:null,onConversationMessageReceived:null,onConversationHistoryMessagesReceived:null,onConversationConsumptionHorizonUpdated:null,onConversationClearedAtUpdated:null,onConversationClosed:null,onConversationSendMessageFailed:null,onConversationUpdatedId:null,onLogRequestReceived:null,onNotifyWebSignInPendingEventsCompleted:null}}()}),define("configuration",["iuserserviceevents"],function(){!function(){function e(){var e=d[l.WebIM.ev];switch(e){case d.dogfood:case d.production:case d.integration:break;default:e=d.production}return e}function t(e){return null!=n(e,"live.com",0)?"mail.live.com":null!=n(e,"live-int.com",0)?"mail.live-int.com":e.toLowerCase()}function n(e,t,n){if(t.startsWith(".")&&(t=t.substr(1)),t=t.toLowerCase(),e=e.toLowerCase(),!e.endsWith("."+t)&&e!==t)return null;if(0===n)return t;var i=e.split("."),s=n+t.split(".").length;return s>i.length&&(s=i.length),i.slice(-1*s).join(".")}var i=1e3,s=1500,o=1200,r=200,a=window,c=a.ss,l=a.$Config,u=a.MSCo,d=u.Environment,_="msmsgs",g=l.WebIM.cn,h="",p="908/6.4.0.0",f=e(),m=u.Configuration=function(){};m.maximumContactCount=i,m.maximumAllowedContactCount=s,m.maximumBlockedContactCount=o,m.maximumGroupCount=r,m.get_clientId=function(){return c.isNullOrEmpty(g)?"msgrlib":g},m.get_clientVersion=function(){return p},m.get_domainName=function(){return c.isNullOrEmpty(h)&&u.Configuration._initializeDomainName(),h},m.set_domainName=function(e){if(c.isNullOrEmpty(e))throw new Error("Invalid domain name.");return h=t(e),e},m.get_clientDomain=function(){return c.isNullOrEmpty(h)?_:h},m.get_clientVersion=function(){return p},m.set_clientVersion=function(e){return p=e,e},m.get_endpointName=function(){return h},m.get_presenceHostName=function(){return m._getEnvironmentString("geo.gateway.messenger.live.com","dogfood.gateway.messenger.live.com","vip.gateway.edge.messenger.live-int.com")},m.get_sendMessageUrlFormat=function(){var e="http://mail.live.com/?rru=compose%3fto={0}";return m._getEnvironmentString(e,e,"http://mail.live-int.com/?rru=compose%3fto={0}")},m.get_photoUrlFormat=function(){var e="http://cid-{0}.photos.live.com/albums.aspx";return m._getEnvironmentString(e,e,"http://cid-{0}.photos.live-int.com/albums.aspx")},m.get_profileUrlFormat=function(){var e="http://profile.live.com/cid-{0}/";return m._getEnvironmentString(e,e,"http://profile.live-int.com/cid-{0}/")},m.get_displayPictureUrlFormat=function(){var e="http://storage.live.com/users/{0}/myprofile/expressionprofile/profilephoto";return m._getEnvironmentString(e,e,"http://storage.live-int.com/users/{0}/myprofile/expressionprofile/profilephoto")},m.get_messageUrlFormat=function(){var e="http://www.hotmail.msn.com{0}";return m._getEnvironmentString(e,e,"http://www.hotmail.msn-int.com{0}")},m.get_storedMessengerSessionLifetime=function(){return 12e4},m.get_silentReauthDetectionUrl=function(){return""},m.get_silentReauthUrlFormat=function(){return""},m.get_reauthCompletedPageUrl=function(){return""},m.get_httpHeadersRestricted=function(){return!1},m._initializeDomainName=function(){var e=window.location.hostname;c.isNullOrEmpty(e)||m.set_domainName(e)},m._getEnvironmentString=function(e,t,n){switch(f){case d.production:return e;case d.integration:return n;case d.dogfood:return t}return""}}()}),define("httpresponse",["configuration"],function(){!function(){var e=window,t=e.MSCo,n=e.ss,i=t.HttpStatusCode;t.HttpResponse=function(e,t,n){this._request$1=e,this._state$1=t,this._status$1=n},t.HttpResponse.prototype={_responseXml:null,_request$1:null,_state$1:null,_status$1:i.none,_content$1:null,get_responseData:function(){return null},get_responseXml:function(){return null==this._responseXml&&(this._responseXml=n.parseXml(this.get_responseText())),this._responseXml},toString:function(){return this.get_responseText()},get_state:function(){return this._state$1},get_responseText:function(){try{return null==this._content$1&&(this._content$1=this._request$1.responseText),this._content$1}catch(e){return""}},get_hasContent:function(){return!n.isNullOrEmpty(this.get_responseText())},get_status:function(){try{if(this._status$1!==i.none)return this._status$1;if(0===this._request$1.readyState)return i.requestTimeout;if(n.isUndefined(this._request$1.status))return i.none;switch(this._request$1.status){case 1223:return i.noContent;case 12002:return i.requestTimeout;case 12007:case 12029:case 12030:case 12031:return i.aborted;case 12152:return i.serverError;default:return this._request$1.status}}catch(e){}return i.none},get_statusText:function(){try{if(0===this._request$1.readyState)return"Request Timeout";switch(this._request$1.status){case 1223:return"No Content";default:return this._request$1.statusText}}catch(e){}return""},getResponseHeader:function(e){try{return this._request$1.getResponseHeader(e)}catch(t){return null}}}}()}),define("httprequest",["httpresponse"],function(){!function(){function e(e){var t=new RegExp("^https?://([a-z0-9-]+(\\.[a-z0-9-]+)+)(\\:[0-9]+)?([/?].*)?","i"),n=t.exec(e);return n&&n.length>1?n[1]:null}var t=window,n=t.MSCo,i=t.MSH,s=t.ss,o=n.HttpStatusCode,r=n.HttpRequest=function(t,i,o,a,c){this._method=t,this._url=i,this._headers=a,this._postData=o||"",this._onResponse=c,this._timeout=r._requestTimeout,this._domain=e(this._url),s.isNullOrEmpty(this._domain)&&(this._domain=n._httpRequestManager.get_currentDomain()),this._domain!==n._httpRequestManager.get_currentDomain()&&(this._requiresProxy=!0),this._manager=n._httpRequestManager.getManager(this._domain,!0)};r._requestTimeout=3e4,r.get_defaultScheme=function(){return i.UriHelper.get_windowLocationProtocol()+"//"},r._abortRequest=function(e){if(null!=e&&"undefined"!=typeof e.abort)try{e.abort()}catch(t){}},r._attachOnAbort=function(e,t){if(null!=e)try{e.onabort=t}catch(n){}},r._mapMethodToString=function(e){switch(e){case n.HttpMethod.Get:return"GET";case n.HttpMethod.Post:return"POST";case n.HttpMethod.Put:return"PUT";case n.HttpMethod.Delete:return"DELETE";default:return null}},r.prototype={_method:n.HttpMethod.Get,_url:null,_postData:null,_headers:null,_onResponse:null,_domain:null,_requiresProxy:!1,_state:null,_timeout:0,_xmlHttp:null,_cachedXmlHttp:null,_manager:null,_timer:null,_executing:!1,_abortInvoked:!1,_aborted:!1,get_state:function(){return this._state},set_state:function(e){return this._state=e,e},get__method:function(){return this._method},setTimeout:function(e){this._timeout=e},execute:function(){this._executing||(this._executing=!0,this._manager.onExecute(this))},abort:function(){this._abortInvoked=!0,this._aborted=!0,this._executing&&r._abortRequest(this._xmlHttp)},_send:function(){if(this._startTimeoutTimer(),this._requiresProxy){var e={};e.type=this._method===n.HttpMethod.Post?"XMLPost":"XMLGet",e.verb=r._mapMethodToString(this._method),e.timeout=null,e.url=this._url,e.headers=this._headers,e.postString=this._postData,this._xmlHttp=this._manager.proxyRequest(e,s.Delegate.create(this,this._onComplete)),r._attachOnAbort(this._xmlHttp,s.Delegate.create(this,this._onAbort))}else{if(this._xmlHttp=new t.XMLHttpRequest,this._xmlHttp.open(r._mapMethodToString(this._method),this._url,!0),this._xmlHttp.onreadystatechange=s.Delegate.create(this,this._onReadyStateChange),r._attachOnAbort(this._xmlHttp,s.Delegate.create(this,this._onAbort)),null!=this._headers&&s.getKeyCount(this._headers)>0){var i=this._headers;for(var o in i){var a={key:o,value:i[o]};this._xmlHttp.setRequestHeader(a.key,a.value)}}try{this._xmlHttp.send(this._postData)}catch(c){this._onComplete(this._xmlHttp)}}},_onReadyStateChange:function(){4===this._xmlHttp.readyState&&this._onComplete(this._xmlHttp)},_onAbort:function(){this._aborted=!0},_onComplete:function(e){var t=this;i.Scheduler.defer(function(){t._onCompleteImpl(e)})},_onCompleteImpl:function(e){this._stopTimeoutTimer();var t=new n.HttpResponse(e,this._state,this._aborted?o.aborted:o.none);if(null!=this._cachedXmlHttp)t.get_status()===o.notModified&&(t=new n.HttpResponse(this._cachedXmlHttp,this._state,this._aborted?o.aborted:o.none)),this._cachedXmlHttp=null;else if(this._method===n.HttpMethod.Get&&s.isNullOrEmpty(t.getResponseHeader("Date")))return this._cachedXmlHttp=e,this._headers["If-Modified-Since"]=t.getResponseHeader("Last-Modified")||i.DateTimeHelper.minValue.toUTCString(),void this._send();this._executing=!1,this._xmlHttp=null,this._aborted&&!this._abortInvoked?this._manager.onComplete(this,null,t):this._manager.onComplete(this,this._onResponse,t)},_onTimeout:function(){this._abortInvoked=!0,r._abortRequest(this._xmlHttp)},_failRequest:function(e){e===o.none&&this._aborted&&(e=o.aborted);var i=new t.XMLHttpRequest,s=new n.HttpResponse(i,this._state,e);this._onResponse.invoke(s)},_startTimeoutTimer:function(){this._stopTimeoutTimer(),this._timer=new i.Timer(s.Delegate.create(this,this._onTimeout),null,this._timeout,i.Timeout.infinite)},_stopTimeoutTimer:function(){null!=this._timer&&(this._timer.dispose(),this._timer=null)}}}()}),define("httprequestmanager",["httprequest"],function(){!function(){var e="9.090515.0",t=4,n=window,i=n.document,s=n.MSCo,o=n.MSH,r=n.ss,a={},c=n.location.host.toLowerCase(),l=s._httpRequestManager=function(e){if(this._domain=e,this._pendingRequests=[],this._activeRequests=[],this._domain!==s._httpRequestManager.get_currentDomain()){var t=e.endsWith(i.domain),n=e.indexOf(":");n>0&&e.substring(0,n).endsWith(i.domain)&&(t=!0),t&&(this._requiresProxy=!0,this._generateProxy())}};l.get_currentDomain=function(){return c},l.getManager=function(e,t){e=e.toLowerCase();var i=a[e];return null!=i||t?(null==i?(i=new l(e),a[e]=i,n.attachEvent("onunload",r.Delegate.create(i,i.dispose))):i._ensureInitialized(),i):null},l.prototype={_domain:null,_pendingRequests:null,_activeRequests:null,_requiresProxy:!1,_iframeProxy:null,_proxyFailed:!1,_proxy:null,_proxyTimer:null,_disposed:!1,assignProxy:function(e){this._proxy=e,this._proxyFailed=!1,this._stopTimer(),this._process()},_generateProxy:function(){this._proxyFailed=!1,this._iframeProxy=i.createElement("iframe"),this._iframeProxy.style.display="none",this._iframeProxy.src=r.format("{0}//{1}/xmlProxy.htm?vn={2}&domain={3}",o.UriHelper.get_windowLocationProtocol(),this._domain,e,i.domain),this._proxyTimer=new o.Timer(r.Delegate.create(this,this._onTimeout),null,s.HttpRequest._requestTimeout,o.Timeout.infinite),i.body.appendChild(this._iframeProxy)},_ensureInitialized:function(){this._requiresProxy&&this._proxyFailed&&this._generateProxy()},_onTimeout:function(){null==this._proxy&&(this._proxyFailed=!0,i.body.removeChild(this._iframeProxy),this._iframeProxy=null,this._failAllRequests()),this._stopTimer()},onExecute:function(e){this._pendingRequests.push(e),this._process()},onComplete:function(e,t,n){this._activeRequests.remove(e),this._process(),this._disposed||null!=t&&t.invoke(n)},proxyRequest:function(e,t){return this._proxy.fetchXML(e,s.Network,this,t)},_process:function(){if(!this._disposed)if(this._requiresProxy&&null==this._proxy)this._proxyFailed&&this._failAllRequests();else for(;this._pendingRequests.length>0&&this._activeRequests.length<t;){var e=this._pendingRequests.shift();this._activeRequests.push(e),e._send()}},_failAllRequests:function(){for(;this._pendingRequests.length>0;){var e=this._pendingRequests.shift();e._failRequest(s.HttpStatusCode.notFound)}},_stopTimer:function(){null!=this._proxyTimer&&(this._proxyTimer.dispose(),this._proxyTimer=null)},dispose:function(){if(!this._disposed){this._disposed=!0;for(var e=r.IEnumerator.getEnumerator(this._activeRequests);e.moveNext();){var t=e.get_current();t.abort()}}}}}()}),define("proxynetwork",["httprequestmanager"],function(){!function(){var e=window,t=e.Web,n=e.MSCo,i=n.Network=function(){};i._registerProxy=i.registerProxy=function(e){var t=e.location.hostname,i=n._httpRequestManager.getManager(t,!1);null!=i&&i.assignProxy(e)},i.Type={XMLPost:"XMLPost"},i.oninvoke={fire:function(){}},i.onhttperror={fire:function(){}},t.Network=i,t.Browser={isIE:function(){}}}()}),define("mimeparser",["proxynetwork"],function(){!function(){var e=window,t=e.ss,n=e.MSM;n.MimeParser=function(e){this._rawHeaders={},this._normalizedHeaders={};var t,n=e.indexOf("\r\n\r\n");-1===n?(t=e,this._body=""):(t=e.substr(0,n),this._body=e.substr(n+4)),this._parseHeaders(t)},n.MimeParser.prototype={_rawHeaders:null,_normalizedHeaders:null,_body:null,_parseHeaders:function(e){for(var t=0,n=e.length;n>t;){var i=e.indexOf("\r\n",t);-1===i&&(i=n);var s=e.substring(t,i);if(s.length>0){var o=s.indexOf(": ");if(-1!==o){var r=s.substring(0,o),a=s.substr(o+2);this._rawHeaders[r]=a,this._normalizedHeaders[r.toLowerCase()]=a}}t=i+2}},getHeaders:function(){return this._rawHeaders},getHeader:function(e){return e=e.toLowerCase(),this._normalizedHeaders[e]||null},getBody:function(){return this._body},_getHeaderCount:function(){return t.getKeyCount(this._normalizedHeaders)},getIntHeader:function(e,n){var i=n,s=this.getHeader(e);return t.isNullOrEmpty(s)||(i=parseInt(s,10)),i}}}()}),define("mimebuilder",["mimeparser"],function(){!function(){function e(e){if(i.isNullOrEmpty(e))return 0;for(var t=0,n=0;n<e.length;n++){var s=e.charCodeAt(n);127>=s?t++:t+=2047>=s?2:s>=55296&&57343>=s?2:3}return t}var t=window,n=t.MSM,i=t.ss,s=n.MimeBuilder=function(){this._headers=[]};s.prototype={_headers:null,_body:null,_disableContentLengthHeader:!1,get_disableContentLengthHeader:function(){return this._disableContentLengthHeader},set_disableContentLengthHeader:function(e){return this._disableContentLengthHeader=e,e},toString:function(){for(var t=new i.StringBuilder,n=i.IEnumerator.getEnumerator(this._headers);n.moveNext();){var s=n.get_current();t.appendLine(i.format("{0}: {1}",s[0],s[1]))}var o=e(this._body);return this.get_disableContentLengthHeader()||t.appendLine(i.format("{0}: {1}","Content-Length",o)),t.appendLine(""),0!==o&&t.append(this._body),t.toString()},addHeaders:function(e){var t=e;for(var n in t){var i={key:n,value:t[n]};
this.setStringHeader(i.key,i.value)}},setStringHeader:function(e,t){i.isNullOrEmpty(t)||this._headers.push([e,t])},setIntHeader:function(e,t){-1!==t&&this._headers.push([e,t.toString()])},setBody:function(e){this._body=e}},s.getByteCount=e}()}),define("mri",["mimebuilder"],function(){!function(){var e="IM",t=window,n=t.MC,i=t.MSM,s=t.MSH,o=t.ss,r=n.IMAddressInfoType,a=i.MriCompareOptions,c=i.Mri=function(e){this._appId="",this._endpointId="",this._address="",this._path="",this._networkId="";var t=c.tryParse(e);null!=t&&(this._appId=t._appId,this._addressType=t._addressType,this._address=t._address,this._endpointId=t._endpointId,this._path=t._path,this._networkId=t._networkId)};c.getIMAddressInfo=function(e){var t="",i=r.none;o.isNullOrEmpty(e.get_liveId())||(t=e.get_liveId(),i=r.windowsLive),o.isNullOrEmpty(t)&&(o.isNullOrEmpty(e._address)||(t=e._address,i=e._addressType));var s=new n.IMAddressInfo(t,i,n.RoleLists.none);return o.isNullOrEmpty(e.get_appId())||(s.applicationId=e.get_appId()),o.isNullOrEmpty(e._networkId)||(s.network=e._networkId),s},c.create=function(t,n,i,s,a){var l=new c("");return l._address=t,l._addressType=n,o.isNullOrEmpty(i)||(l._endpointId=i),o.isNullOrEmpty(s)||(l._appId=s),o.isNullOrEmpty(a)||(l._networkId=a),n===r.temporaryGroup&&(l._path=e),l},c.createFromIMAddressInfo=function(t){var n=new c("");return n._address=t.address,n._addressType=t.type,o.isNullOrEmpty(t.applicationId)||(n._appId=t.applicationId),o.isNullOrEmpty(t.network)||(n._networkId=t.network),t.type===r.temporaryGroup&&(n._path=e),n},c.tryParse=function(e){if(!o.isNullOrEmpty(e)){for(var t=new c(""),n=e.split(";"),i=o.IEnumerator.getEnumerator(n);i.moveNext();){var s=i.get_current();if(s.startsWith("appid=")){var a=s.substr("appid=".length);if(""!==t.get_appId()||o.isNullOrEmpty(a))return null;t._appId=a}else if(s.startsWith("epid=")){var l=s.substr("epid=".length);if(""!==t._endpointId||o.isNullOrEmpty(l))return null;t._endpointId=l}else if(s.startsWith("path=")){var u=s.substr("path=".length);if(""!==t._path||o.isNullOrEmpty(u))return null;t._path=u}else if(s.startsWith("via=14:"))t._networkId=s.substr("via=14:".length),t._networkId=t._networkId.toUpperCase();else if(s.startsWith(o.format("{0}:",r.skype)))t._addressType=r.skype,t._address=s.substr(2);else{var d=s.split(":");if(!o.isNullOrEmpty(t._address)||null==d||2!==d.length)return null;t._addressType=parseInt(d[0],10),t._address=d[1],t._addressType===r.remoteNetwork&&(t._address=t._address.toUpperCase())}}return t}return null},c.prototype={_addressType:r.none,get_cid:function(){return this._addressType===r.cid?this._address:""},get_appId:function(){return this._appId},get_liveId:function(){return this._addressType===r.windowsLive?this._address:""},get_networkId:function(){return this._networkId},get_endpointId:function(){return this._endpointId},get_address:function(){return this._address},get_addressType:function(){return this._addressType},toString:function(){var e=new o.StringBuilder;return o.isNullOrEmpty(this._address)||e.append(o.format("{0}:{1}",this._addressType,this._address)),o.isNullOrEmpty(this._endpointId)||(e.append(";epid="),e.append(this._endpointId)),o.isNullOrEmpty(this._path)||(e.append(";path="),e.append(this._path)),this._addressType===r.connect&&(e.append(";via=14:"),e.append(this._networkId.toLowerCase())),e.toString()},equals:function(e,t){if((t&a.address)!==a.none){if(this._addressType!==e._addressType||this._address!==e._address)return!1;if(this._addressType===r.connect&&0!==o.compare(this._networkId,e._networkId,!0))return!1}return(t&a.epId)!==a.none&&this._endpointId!==e._endpointId?!1:!0},toConversationId:function(){return s.ContactHelper.computeIMAddressKey(this._address,this._addressType,this._networkId,this._path)}}}()}),define("msnpcommand",["mri"],function(){!function(){var e=window,t=e.MSM,n=e.ss;t._msnpCommand=function(e,t){this._fragments=e,this._onResponse=t},t._msnpCommand.prototype={_fragments:null,_onResponse:null,get_name:function(){return this._fragments[0].toString()},toString:function(){for(var e=new n.StringBuilder,i=this._fragments.length,s=0;i-2>s;s++)e.append(this._fragments[s].toString()),e.append(" ");var o=this._fragments[i-2],r=this._fragments[i-1],a=t.MimeBuilder.getByteCount(o),c=t.MimeBuilder.getByteCount(r),l=a+(a>0&&c>0?2:0)+c+(0===c?0:2);return e.append(l.toString()),e.append("\r\n"),e.append(o),a>0&&c>0&&e.append("\r\n"),c>0&&e.append("\r\n"),e.append(r),e.toString()},get_trid:function(){return this._fragments[1]},onComplete:function(e,t){null!=this._onResponse&&this._onResponse.invoke(e,t)}}}()}),define("msnpservercommand",["msnpcommand"],function(){!function(){var e=window,t=e.MSM,n=e.ss;t.MsnpServerCommand=function(e,t){this._name=e,this._parameters=t,this._parseHeaders()},t.MsnpServerCommand.prototype={_name:null,_parameters:null,_skypeIdHeader:null,_ackId:null,_registrationToken:null,get_name:function(){return this._name},get_ackId:function(){return this._ackId},get_registrationToken:function(){return this._registrationToken},get_parameters:function(){return this._parameters},get_skypeIdHeader:function(){return this._skypeIdHeader},set_skypeIdHeader:function(e){return this._skypeIdHeader=e,e},get_allParameters:function(){var e=[];e.addRange(this._parameters);var t=this.get__payload();return null!=t&&e.push(this.get__payload()),e},get__payload:function(){return null},_parseHeaders:function(){var e=this._parameters[2];if(this._parameters.splice(2,1),!n.isNullOrEmpty(e))for(var t=e.split("\r\n"),i=n.IEnumerator.getEnumerator(t);i.moveNext();){var s=i.get_current(),o=s.split(": ");if(o.length>1)switch(o[0]){case"Ack-Id":this._ackId=o[1];break;case"Set-Registration":this._registrationToken=o[1]}}}}}()}),define("msnptextparser",["msnpservercommand"],function(){!function(){var e=window,t=e.ss,n=e.MSM;n._msnpTextParser=function(){this._buffer$1=""},n._msnpTextParser.prototype={_buffer$1:null,_currCommand$1:null,textMode:!0,addTextToBuffer:function(e){this._buffer$1+=e},_onIncomplete$1:function(){return this._currCommand$1=null,!1},_onSuccess$1:function(e,t){return this._currCommand$1=new n.MsnpServerCommand(e,t),!0},moveNext:function(){for(;this._buffer$1.length>0;){var e=this._buffer$1.indexOf("\r\n");if(0>=e)return this._onIncomplete$1();for(var n=this._buffer$1.substring(0,3),i=[],s=this._buffer$1.substring(3,e).split(" "),o=0;o<s.length;o++)s[o].length>0&&i.push(s[o]);var r=e+2,a=i.length-1,c=parseInt(i[a]);i.splice(a,1);for(var l=c,u=r;c>0;){if(this._buffer$1.length<=u)return!1;var d=this._buffer$1.charCodeAt(u);127>=d?c--:2047>=d?(c-=2,l--):d>=55296&&57343>=d?(c-=2,l--):(c-=3,l-=2),u++}if(l>0){var _=this._buffer$1.substr(r,l);if(_.startsWith("\r\n"))i.push(""),i.push(_.trim());else{var g=_.substr(0,_.indexOf("\r\n\r\n"));i.push(g.trim());var h=_.substr(g.length,_.length-g.length).trim();t.isNullOrEmpty(h)||i.push(h)}}return r+=l,this._buffer$1=this._buffer$1.substr(r),this._onSuccess$1(n,i)}return this._onIncomplete$1()},get_currentCommand:function(){return this._currCommand$1},get_textMode:function(){return this.textMode},get_bytesMode:function(){return!this.textMode},addBytesToBuffer:function(){throw new Error("Invalid operation!")}}}()}),define("httpmsnptransport",["msnptextparser"],function(){!function(){function e(e){return e>=0?Math.floor(e):Math.ceil(e)}var t=5e3,n=3e4,i=1.5,s=15,o=1e3,r=5,a="/gateway/gateway.dll",c=window,l=c.MC,u=c.MSM,d=c.MSH,_=c.MSCo,g=c.ss,h=_.HttpStatusCode,p=l.Logger,f=u._httpMsnpResponse=function(){};f.success=0,f.closed=1,u._httpMsnpTransport=function(e,n,i,s){this._headers={},this._sendQueue=[],this._parser=new u._msnpTextParser,this._currentNonLongPollInterval=t,this._maxPollInterval=60,this._sessionCookie="",this._useLongPoll=!0,this._events=e,this._debugId=n,this._server=i.toLowerCase(),this._isSecure=s,this._sendCallback=g.Delegate.create(this,this._onSendTimerExpired),this._headers["X-Requested-Session-Content-Type"]="text/html",this._headers["Content-Type"]="text/html; charset=utf-8",this._headers.Pragma="No-Cache",this._headers["X-MSN-Auth"]="Use-Cookie"},u._httpMsnpTransport.prototype={_events:null,_serverType:"NS",_debugId:0,_identity:null,_lastTrid:0,_lastRequestId:0,_sendTimer:null,_maxPollInterval:0,_currentNonLongPollInterval:0,_msnpSendRequestPending:!1,_isSecure:!1,_server:null,_serverName:null,_sessionCookie:null,_sendCallback:null,_sessionPausedCallback:null,_actualInterval:0,_disconnected:!1,_disposed:!1,_hasPendingServerCommands:!1,_pendingRequest:null,_useLongPoll:!1,_consecutiveErrorResponseCount:0,_cachedPostData:null,_hasIssuedFirstRequest:!1,get__responseTimeout:function(){return 1e3*this._maxPollInterval+1e4},get__pollDelay:function(){return this._useLongPoll?s:this._currentNonLongPollInterval},_updateCurrentNonLongPollInterval:function(s){s?(this._currentNonLongPollInterval=e(this._currentNonLongPollInterval/i),this._currentNonLongPollInterval<t&&(this._currentNonLongPollInterval=t)):(this._currentNonLongPollInterval=e(this._currentNonLongPollInterval*i),this._currentNonLongPollInterval>n&&(this._currentNonLongPollInterval=n))},_scheduleSendTimer:function(e){this._disposed||(null==this._sendTimer?this._createSendTimer(e):(this._actualInterval===d.Timeout.infinite||this._actualInterval>e)&&(this._actualInterval=e,this._sendTimer.change(e,d.Timeout.infinite)))},_pauseSendTimer:function(){this._cancelSendTimer()},_createSendTimer:function(e){this._actualInterval=e,this._sendTimer=new d.Timer(this._sendCallback,null,e,d.Timeout.infinite)},_cancelSendTimer:function(){null!=this._sendTimer&&(this._sendTimer.dispose(),this._sendTimer=null)},_onSendTimerExpired:function(){this._pauseSendTimer(),this._msnpSendRequestPending||this._disposed||this._disconnected||this._sendBatch()},_buildUrl:function(e){var t=new g.StringBuilder;return t.append(this._isSecure?"https://":"http://"),t.append(this._server),t.append(a),t.append("?"),0===this._sessionCookie.length?(t.append("Version=1&Protocol=mtp&Action=open&Server="),t.append(this._serverType),t.append("&IP=none")):(e&&(t.append("Action=poll&"),this._useLongPoll&&this._hasIssuedFirstRequest&&(t.append("Lifespan="),t.append(this._maxPollInterval),t.append("&"))),t.append("SessionID="),t.append(this._sessionCookie)),t.toString()},_getHeaderValue:function(e,t){var n=t+"=",i=e.indexOf(n);if(-1!==i){i+=n.length;var s=e.indexOf(";",i);return-1!==s?e.substring(i,s):e.substr(i)}return null},_parseHeaders:function(e){var t={};t["X-MSNSERVER"]=e.getResponseHeader("X-MSNSERVER"),t["X-MSN-Messenger"]=e.getResponseHeader("X-MSN-Messenger"),t["X-MSN-Host"]=e.getResponseHeader("X-MSN-Host"),this._serverName=t["X-MSNSERVER"];var n=t["X-MSN-Messenger"],i=t["X-MSN-Host"],s=this._getHeaderValue(n,"SessionID"),o=this._getHeaderValue(n,"Session");return c.maxConnectionsPerServer&&c.maxConnectionsPerServer<=2&&(g.isNullOrEmpty(e.getResponseHeader("Via"))||(this._useLongPoll=!1)),g.isNullOrEmpty(i)?i=null:(i=i.toLowerCase(),i!==this._server?(p.logDetails("HttpMsnpTransportParseHeaders",{newHost:i}),this._server=i):i=null),null!=s&&(this._sessionCookie=s),"close"===o?f.closed:f.success},_onResponse:function(e){var t=h.OK,n=null,i=null,s=[],a=!1;if(!this._disposed){var c=e.get_state();if(!(c<this._lastRequestId)){if(this._updateCurrentNonLongPollInterval(e.get_hasContent()),this._pendingRequest=null,this._msnpSendRequestPending=!1,e.get_status()===h.OK){this._consecutiveErrorResponseCount=0;var u=f.success;if(u=this._parseHeaders(e),e.get_hasContent())try{this._parser.get_textMode()?this._parser.addTextToBuffer(e.get_responseText()):this._parser.addBytesToBuffer(e.get_responseData());for(var _=e.getResponseHeader("X-MSN-SkypeId");this._parser.moveNext();){var m=this._parser.get_currentCommand();g.isNullOrEmpty(_)||m.set_skypeIdHeader(_),s.push(m),this._hasPendingServerCommands=!0}}catch(v){throw p.logError("HttpMsnpTransportOnResponseParsingContentFailure",v),v}u===f.closed&&(p.logAction("HttpMsnpTransportOnResponseConnectionClosed"),this._disconnected=!0,this._cancelSendTimer(),t=h.none,a=!0)}else{if(p.logDetails("HttpMsnpTransportOnResponseParsingContentFailure",{status:e.get_status()}),this._consecutiveErrorResponseCount++,this._consecutiveErrorResponseCount<r&&this._isRecoverableStatus(e.get_status())){this._cachedPostData.length>0&&(this._msnpSendRequestPending=!0);{var C=this;new d.Timer(function(){p.logDetails("HttpMsnpTransportOnResponse",{requestId:c}),C._disposed||C._sendRequest(C._buildUrl(0===C._cachedPostData.length),C._cachedPostData,c)},null,o*this._consecutiveErrorResponseCount,d.Timeout.infinite)}return}this._disconnected=!0,this._cancelSendTimer(),t=e.get_status()}this._disconnected&&this.dispose();for(var y=g.IEnumerator.getEnumerator(s);y.moveNext();){var S=y.get_current();this._events.onCommand(S)}if(this._disconnected)return void this._events.onDisconnect(t,a);this._hasPendingServerCommands=!1,null!=this._sessionPausedCallback&&0===this._sendQueue.length?(i=this._sessionPausedCallback,n=new l.MessengerSessionInfo(this._server,this._sessionCookie,this._lastTrid,null),this._sessionPausedCallback=null,this.dispose()):this._scheduleSendTimer(this.get__pollDelay()),null!=i&&i.invoke(n)}}},_isRecoverableStatus:function(e){if(e===h.requestTimeout)return!0;var t=Math.floor(e/100);return 5===t||0===t?!0:!1},_sendBatch:function(){this._pauseSendTimer();for(var e=new g.StringBuilder;this._sendQueue.length>0;){var n=this._sendQueue.shift();e.append(n.toString()),this._lastTrid=n.get_trid()}var i=e.toString(),s=0===i.length;s||(this._msnpSendRequestPending=!0,this._currentNonLongPollInterval=t,p.logAction("SendBatch")),this._sendRequest(this._buildUrl(s),i,++this._lastRequestId)},_sendRequest:function(e,t,n){this._hasIssuedFirstRequest=!0,this._cachedPostData=t;var i=new _.HttpRequest(_.HttpMethod.Post,e,t,this._headers,g.Delegate.create(this,this._onResponse));this._pendingRequest=i,i.set_state(n),i.setTimeout(this.get__responseTimeout()),i.execute()},sendCommand:function(e){if(!(this._disconnected||this._disposed||(this._sendQueue.push(e),this._msnpSendRequestPending||this._hasPendingServerCommands))){if("OUT"===e.get_name())return void this._sendBatch();this._scheduleSendTimer(1)}},resume:function(e){this._sessionCookie=e,this._disposed||null!=this._pendingRequest||this._hasPendingServerCommands||this._sendBatch()},dispose:function(){if(!this._disposed){this._disposed=!0,this._cancelSendTimer();var e=this._pendingRequest;null!=e&&e.abort()}},pauseSession:function(e){var t=!1;if(!this._disposed&&(this._hasPendingServerCommands||this._sendQueue.length>0?this._sessionPausedCallback=e:(t=!0,this.dispose()),t)){var n=new l.MessengerSessionInfo(this._server,this._sessionCookie,this._lastTrid,null);e.invoke(n)}},setRpsTicket:function(e){var t="Cookie",n="RPSTAuth=";g.isNullOrEmpty(e)?delete this._headers[t]:this._headers[t]=e.indexOf(";")>0||e.startsWith(n)?e:n+e},setConnectionTimeout:function(e){},get_serverName:function(){return this._serverName},get_identity:function(){return this._identity},set_identity:function(e){return this._identity=e,e}}}()}),define("msnpconnection",["httpmsnptransport"],function(){!function(){var e=window,t=e.MC,n=e.MSM,i=e.ss,s=t.Logger,o=0,r=n.MsnpConnection=function(e,t){i.isNullOrUndefined(e)||(this._requests=new n._timeoutQueue(30),this._transport=new n._httpMsnpTransport(this,r._getNewDebugId(),e,t))};r._getNewDebugId=function(){return o++},r.prototype={_transport:null,_currentTrid:0,_disposed:!1,_identity:null,_registrationToken:null,onCommandReceived:null,onTridChanged:null,onDisconnected:null,get_serverName:function(){return this._transport.get_serverName()},get_identity:function(){return this._identity},set_identity:function(e){return this._identity=e,this._transport.set_identity(this._identity),null!=e.authenticationInfo&&e.authenticationInfo.authType===t.AuthenticationType.rpsAuth&&this._transport.setRpsTicket(e.authenticationInfo.ticket),e},get_registrationToken:function(){return this._registrationToken},set_registrationToken:function(e){return this._registrationToken=e,e},setConnectionTimeout:function(e){this._transport.setConnectionTimeout(e)},resume:function(e,t){this._transport.resume(e),this._currentTrid=t},pauseSession:function(e){this._transport.pauseSession(e)},get_nextTrid:function(){return this._currentTrid++,this.onTridChanged(this._currentTrid),this._currentTrid},sendCommand:function(e,t){if(this._disposed)return void s.logAction("MsnpConnectionSendCommand");var o=e.length;e[o]=e[o-1],e[o-1]="",i.isNullOrEmpty(this._registrationToken)||(e[o-1]=i.format("Registration: {0}",this._registrationToken));var r=new n._msnpCommand(e,t);this._requests.schedule(r.get_trid(),r),this.onSendCommand(r)},onSendCommand:function(e){this._transport.sendCommand(e)},getPendingCommand:function(e){return this._requests.cancel(e)},onCommand:function(e){if(this._disposed)return void s.logAction("MsnpConnectionOnCommand");this._requests.expireEntries();try{this.onCommandReceived(e)}catch(t){s.logError("MsnpConnectionOnCommandFailure",t)}},onDisconnect:function(e,t){return this._disposed?void s.logAction("MsnpConnectionOnDisconnect"):(this.onDisconnected(e,t),void(this._disposed=!0))},dispose:function(){this._disposed=!0,this._transport.dispose()}}}(window.originaljQuery||jQuery)}),define("contentlayer",["msnpconnection"],function(){!function(){var e=window,t=e.ss,n=e.MSM,i=n.ContentLayer=function(){};i.contentTypeHeader="Content-Type",i.contentTypeCircleDocument="application/circles+xml",i.contentTypeUserDocument="application/user+xml",i.contentTypeNetworkDocument="application/network+xml",i.contentTypeEndOfCallReport="qosreport/xml",i.deserialize=function(e){var t=new n.MimeParser(e);return null!=t.getHeader(n.MessagingLayer._messagingVersionHeader)?n.MessagingLayer.create(t):null!=t.getHeader(n.PublicationLayer._publicationVersionHeader)?n.PublicationLayer.create(t):null!=t.getHeader(n.NotificationLayer._notificationVersionHeader)?n.NotificationLayer.create(t):null},i.prototype={get_appId:null,serialize:null,get_body:null,getDocumentType:function(e,i){if(t.isNullOrEmpty(e))return null;switch(i){case n.ContentDocumentType.circleDocument:return n.ContentLayer.contentTypeCircleDocument;case n.ContentDocumentType.userDocument:return n.ContentLayer.contentTypeUserDocument}return null}}}()}),define("messaginglayer",["contentlayer"],function(){!function(){var e=window,t=e.ss,n=e.MSM,i=n.ContentLayer,s="2.0",o="Content-Transfer-Encoding",r="7bit",a="Application-ID",c="Messaging",l=n.MessagingLayer=function(e,t){i.call(this),this._headers$1=e,this._contentEncoding$1=r,this._body$1=t||""};l._messagingVersionHeader=c,l.create=function(e){var n=e.getHeader(c);return 0!==t.compare(n,s)?null:new l(e.getHeaders(),e.getBody())};var u=l.prototype=new i;u.constructor=l,u._headers$1=null,u._contentEncoding$1=null,u._body$1=null,u.get_appId=function(){return this.getHeader(a)},u.set_appId=function(e){return this._setHeader$1(a,e),e},u.get_contentEncoding=function(){return this._contentEncoding$1},u.set_contentEncoding=function(e){return this._contentEncoding$1=e,e},u.get_body=function(){return this._body$1},u.get_headers=function(){return this._headers$1},u.getHeader=function(e){return this._headers$1[e]||""},u._setHeader$1=function(e,t){this._headers$1[e]=t},u.serialize=function(){var e=new n.MimeBuilder;return e.setStringHeader(c,s),this._contentEncoding$1!==r&&e.setStringHeader(o,this._contentEncoding$1),e.addHeaders(this._headers$1),e.setBody(this._body$1),e.toString()}}()}),define("notificationlayer",["messaginglayer"],function(){!function(){var e=window,t=e.MSM,n=e.MSH,i=e.ss,s=t.NotificationType,o=t.ContentDocumentType,r=t.ContentLayer,a="1.0",c="Uri",l="NotifNum",u="NotifType",d="Full",_="Partial",g=t.NotificationLayer=function(e,t,n,i,s){r.call(this),this._uri$1=e,this._notificationSegment$1=t,this._notificationType$1=n,this._docType$1=i,this._content$1=s};g._notificationVersionHeader="Notification",g.create=function(e){var n=e.getHeader(g._notificationVersionHeader),r=e.getHeader(c),h=e.getHeader(t.ContentLayer.contentTypeHeader),p=e.getIntHeader(l,-1),f=e.getBody(),m=e.getHeader(u);if(0!==i.compare(n,a))return null;if(-1===p)return null;var v;if(0===i.compare(h,t.ContentLayer.contentTypeCircleDocument,!0))v=o.circleDocument;else if(0===i.compare(h,t.ContentLayer.contentTypeUserDocument,!0))v=o.userDocument;else{if(0!==i.compare(h,t.ContentLayer.contentTypeNetworkDocument,!0))return null;v=o.networkDocument}var C;switch(m){case d:C=s.fullNotify;break;case _:C=s.partialNotify;break;default:return null}return new g(r,p,C,v,f)};var h=g.prototype=new r;h.constructor=g,h._notificationType$1=s.partialNotify,h._uri$1=null,h._notificationSegment$1=0,h._docType$1=o.none,h._content$1=null,h._users$1=null,h._headers$1=null,h.get_body=function(){return this._content$1},h.get_documentType=function(){return this._docType$1},h.get_uri=function(){return this._uri$1},h.get_notificationSegment=function(){return this._notificationSegment$1},h.get_notificationType=function(){return this._notificationType$1},h.get_users=function(){return null==this._users$1&&this._parseBody$1(),this._users$1},h.get_pendingUsers=function(){return null==this._pendingUsers$1&&this._parseBody$1(),this._pendingUsers$1},h.serialize=function(){var e=new t.MimeBuilder;return e.setStringHeader(g._notificationVersionHeader,a),e.setStringHeader(c,this._uri$1),this._docType$1!==o.none&&e.setStringHeader(t.ContentLayer.contentTypeHeader,this.getDocumentType(this._content$1,this._docType$1)),e.setIntHeader(l,this._notificationSegment$1),e.setStringHeader(u,this._getNotifyType$1()),e.setBody(this._content$1),e.toString()},h._getNotifyType$1=function(){switch(this._notificationType$1){case s.partialNotify:return _;case s.fullNotify:return d;default:return null}},h._parseBody$1=function(){var e=[],s=[];if(i.isNullOrEmpty(this._content$1)){var o="roster(IM)/user(",r=this._uri$1.indexOf(o);if(-1!==r){var a=this._uri$1.lastIndexOf(")"),c=this._uri$1.substring(r+o.length,a);e.push(new t.Mri(c))}}else{var l=i.parseXml(this._content$1);if(null!=l){var u=l.documentElement.selectSingleNode("roster");if(null!=u){var d=u.selectNodes("user");if(null!=d)for(var _=0;_<d.length;_++){var g=d[_],h=new t.Mri(g.selectSingleNode("id").text),p=g.selectSingleNode("ep/id"),f=g.selectSingleNode("state");if(null!=p){var m=n.XmlHelper.xmlNodeValue(p);i.isNullOrEmpty(m)||(h=t.Mri.create(h.get_address(),h.get_addressType(),m,null,null))}null!=f&&"Pending"===n.XmlHelper.xmlNodeValue(f)?s.push(h):e.push(h)}}}}this._users$1=e,this._pendingUsers$1=s}}()}),define("publicationlayer",["notificationlayer"],function(){!function(){var e="Publication",t="1.0",n="Uri",i="Status-Priority",s="low",o=window,r=o.ss,a=o.MSM,c=a.ContentDocumentType,l=a.ContentLayer,u=a.PublicationLayer=function(e,t,n,i){l.call(this),this._uri$1=e,this._body$1=n,this._docType$1=t,this._statusPriorityLow$1=i};u._publicationVersionHeader=e,u.create=function(e){var i=e.getHeader(a.PublicationLayer._publicationVersionHeader),s=e.getHeader(n),o=e.getHeader(a.ContentLayer.contentTypeHeader)||null,l=e.getBody();return 0!==r.compare(i,t)||r.isNullOrEmpty(s)||o===a.ContentLayer.contentTypeCircleDocument?null:new u(s,c.circleDocument,l,!1)};var d=u.prototype=new l;d.constructor=u,d._uri$1=null,d._body$1=null,d._docType$1=c.none,d._statusPriorityLow$1=!1,d.get_body=function(){return this._body$1},d.serialize=function(){var e=new a.MimeBuilder;return e.setStringHeader(a.PublicationLayer._publicationVersionHeader,t),e.setStringHeader(n,this._uri$1),this._docType$1!==c.none&&e.setStringHeader(a.ContentLayer.contentTypeHeader,this.getDocumentType(this._body$1,this._docType$1)),this._statusPriorityLow$1&&e.setStringHeader(i,s),e.setBody(this._body$1),e.toString()}}()}),define("reliabilitylayer",["publicationlayer"],function(){!function(){var e="Reliability",t="1.0",n=window,i=n.ss,s=n.MSM,o=s.ReliabilityLayer=function(){};o.deserialize=function(n){var r=new s.MimeParser(n),a=r.getHeader(e)||"";return 0!==i.compare(a,t)?null:new o},o.prototype={serialize:function(){var n=new s.MimeBuilder;return n.set_disableContentLengthHeader(!0),n.setStringHeader(e,t),n.toString()}}}()}),define("routinglayer",["reliabilitylayer"],function(){!function(){function e(e){var t=e.split("/");if(t.length>1)switch(t[1]){case g:return w.online;case h:return w.offline;case f:return w.mobile;case p:return w.history;default:return w.none}return w.none}function t(e){var t=e.split("/");switch(t[0]){case u:return S.IM;case d:return S.PE;case _:return S.PD;default:return S.none}}function n(e){return e?"0":""}function i(e,t){var n="",i="",s="";switch(e){case S.PE:n=d;break;case S.PD:n=_;break;case S.IM:n=u}switch(t){case w.mobile:i=f;break;case w.offline:i=h;break;case w.online:i=g;break;case w.history:i=p}return v.isNullOrEmpty(n)||(s=n,v.isNullOrEmpty(i)||(s+="/",s+=i)),s}var s="Routing",o="1.0",r="To",a="From",c="Options",l="Service-Channel",u="IM",d="PE",_="PD",g="Online",h="Offline",p="History",f="Mobile",m=window,v=m.ss,C=m.MC,y=m.MSM,S=C.ServiceType,$=C.IMAddressInfoType,w=C.MessageChannelType,I=y.RoutingLayer=function(e,t){this._to=e,this._from=t};I.deserialize=function(n){var i=new y.MimeParser(n),c=i.getHeader(s)||"",u=i.getHeader(r),d=i.getHeader(a);if(0!==v.compare(c,o)||null==u||null==d)return null;var _=I._createMri(u),g=I._createMri(d),h=i.getHeader(l)||"",p=S.IM,f=w.online;if(!v.isNullOrEmpty(h)&&(p=t(h),f=e(h),p===S.none))return null;var m=new I(_,g);return m.set_service(p),m.set_channel(f),m},I._createMri=function(e){return e.startsWith("4:tel:")?y.Mri.create(e.substr(6),$.telephone,null,null,null):new y.Mri(e)},I.prototype={_service:S.none,_channel:w.none,_to:null,_from:null,_disableSelfFanOut:!1,get_to:function(){return this._to},get_from:function(){return this._from},get_service:function(){return this._service},set_service:function(e){return this._service=e,e},get_channel:function(){return this._channel},set_channel:function(e){return this._channel=e,e},get_disableSelfFanOut:function(){return this._disableSelfFanOut},set_disableSelfFanOut:function(e){return this._disableSelfFanOut=e,e},mapInterLayerInfo:function(e){var t=e instanceof y.MessagingLayer?e:null;if(null!=t){var n=t.get_appId();if(!v.isNullOrEmpty(n)){var i=y.Mri.create(this._from.get_address(),this._from.get_addressType(),this._from.get_endpointId(),n,this._from.get_networkId());this._from=i;var s=y.Mri.create(this._to.get_address(),this._to.get_addressType(),this._to.get_endpointId(),n,this._to.get_networkId());this._to=s}}},serialize:function(){var e=this._to.toString(),t=this._from.toString(),u=i(this._service,this._channel),d=n(this._disableSelfFanOut);this._to.get_addressType()===$.telephone&&(e=this._to.get_addressType()+":tel:"+this._to.get_address());var _=new y.MimeBuilder;return _.set_disableContentLengthHeader(!0),_.setStringHeader(s,o),_.setStringHeader(r,e),_.setStringHeader(a,t),(this._channel!==w.offline||this.get_to().get_addressType()!==$.skype)&&_.setStringHeader(l,u),_.setStringHeader(c,d),_.toString()}}}()}),define("mailnotificationparser",["routinglayer"],function(){!function(){var e=window,t=e.MC,n=e.MSP,i=e.MSM,s=e.MSH,o=e.ss,r=t.MailNotificationFolderType,a=t.MailNotificationInfoType,c=n._mailNotificationParser=function(e){this._message=e};c._mapStringToFolder=function(e){if(o.isNullOrEmpty(e))return r.hidden;switch(e.toLowerCase()){case"active":return r.inbox;case"saved":return r.sent;case"draft":return r.drafts;case"trash":return r.trash;case"hm_bulkmail_":return r.junkMail;case"00000000-0000-0000-0000-000000000006":case"00000000-0000-0000-0000-000000000007":case"00000000-0000-0000-0000-000000000008":case"00000000-0000-0000-0000-000000000009":return r.hidden}return r.other},c.prototype={_message:null,_notifications:null,get_notifications:function(){return this._notifications},parse:function(){var e=new i.MimeParser(this._message.getBody()),r=this._message.getHeader("Content-Type").split(";")[0];switch(r){case"text/x-msmsgsinitialmdatanotification":var c=o.parseXml(e.getHeader("Mail-Data")),l=null!=c?c.documentElement:null;if(null==l)return t.Logger.logAction("MailNotificationParserParseFailure"),!1;var u=l.selectSingleNode("E");if(null==u)return!1;for(var d=["IU","I","OU","O"],_=[0,0,0,0],g=0;g<d.length;g++){var h=u.selectSingleNode(d[g]);if(null!=h){var p=s.XmlHelper.xmlNodeValue(h.firstChild);null!=p&&(_[g]=parseInt(p,10))}}return this._notifications=[new t.MailNotificationInfo(new t.MailNotificationInitialInfo(_[0],_[1],_[2],_[3]),a.initial)],!0;case"text/x-msmsgsemailnotification":var f=n._mailNotificationParser._mapStringToFolder(e.getHeader("Dest-Folder"));return this._notifications=[new t.MailNotificationInfo(new t.MailNotificationIncomingInfo(e.getHeader("From"),e.getHeader("From-Addr"),e.getHeader("Message-URL"),e.getHeader("Subject"),f,e.getHeader("id")),a.incoming),new t.MailNotificationInfo(new t.MailNotificationActivityInfo(f,f,-1),a.activity)],!0;case"text/x-msmsgsactivemailnotification":return this._notifications=[new t.MailNotificationInfo(new t.MailNotificationActivityInfo(n._mailNotificationParser._mapStringToFolder(e.getHeader("Src-Folder")),n._mailNotificationParser._mapStringToFolder(e.getHeader("Dest-Folder")),parseInt(e.getHeader("Message-Delta"),10)),a.activity)],!0}return!1}}}()}),define("pagedmessage",["mailnotificationparser"],function(){!function(){function e(e){var t,n="\r\n\r\n",i=new Array(3),s=0;for(t=0;2>t;t++){var o=e.indexOf(n,s);if(-1===o)break;i[t]=e.substring(s,o),o+=n.length,s=o}return s<e.length&&(i[t]=e.substr(s)),i}var t=window,n=t.MC,i=t.MSM,s=t.ss,o=n.DatagramInfoType,r=i.ContentDocumentType,a=i.PagedMessage=function(e,t,n,i){this._pageType=e,this._routingLayer=t,this._reliabilityLayer=n,this._contentLayer=i};a.createPagedMessage=function(t,n){var c=e(n),l=i.RoutingLayer.deserialize(c[0]);if(null==l)return null;var u=i.ReliabilityLayer.deserialize(c[1]);if(null==u)return null;var d=null;if(3===c.length&&!s.isNullOrEmpty(c[2])){if(d=i.ContentLayer.deserialize(c[2]),null==d)return null;var _=d instanceof i.NotificationLayer?d:null;if(null!=_)if(t===o.del)t=_.get_documentType()===r.userDocument?o.serviceDataDel:o.imGroupDel;else if(t===o.put)switch(_.get_documentType()){case r.networkDocument:t=o.networkDataPut;break;case r.userDocument:t=o.serviceDataPut;break;case r.circleDocument:t=o.imGroupPut}}return l.mapInterLayerInfo(d),new a(t,l,u,d)},a.prototype={_pageType:o.sdg,_routingLayer:null,_reliabilityLayer:null,_contentLayer:null,payLoad:function(){var e=new s.StringBuilder;return e.append(this._routingLayer.serialize()),e.append(this._reliabilityLayer.serialize()),e.append(this._contentLayer.serialize()),e.toString()},get_pageType:function(){return this._pageType},get_routing:function(){return this._routingLayer},get_reliability:function(){return this._reliabilityLayer},get_content:function(){return this._contentLayer}}}()}),define("networkdatareader",["pagedmessage"],function(){!function(){var e=window,t=e.MC,n=e.MSP,i=e.ss,s=t.NetworkInfoStatus;n._networkDataReader=function(e){this._message=e,this._parse()},n._networkDataReader.prototype={_message:null,_status:s.signedOut,_hasStatus:!1,get_hasStatusData:function(){return this._hasStatus},get_networkId:function(){return this._message.get_routing().get_from().get_address()},get_networkStatus:function(){return this._status},_parse:function(){var e=i.parseXml(this._message.get_content().get_body()),n=e.documentElement;if(null==n||"network"!==n.nodeName)return void t.Logger.logAction("NetworkDataReaderParseFailure");var o,r=n.selectSingleNode("status");if(null!=r){switch(r.text){case"SigningIn":o=s.signingIn;break;case"SignedIn":o=s.signedIn;break;case"SignedOut":o=s.signedOut;var a=n.selectSingleNode("details");if(null!=a)switch(a.text){case"AbnormalDisconnect":case"CredentialsFetchFailed":case"InternalServerError":o=s.autoReconnectWaiting}break;default:return void t.Logger.logAction("NetworkDataReaderParseFailure")}this._status=o,this._hasStatus=!0}}}}()}),define("servicedatareader",["networkdatareader"],function(){!function(){var e=window,t=e.MC,n=e.MSP,i=e.MSH,s=e.ss,o=t.Logger;
n._serviceDataReader=function(e,n,i){this._sender=e,this._documentString=i,this._fromUser=e.type===t.IMAddressInfoType.windowsLive&&e.address===n},n._serviceDataReader.prototype={_documentString:null,_parsed:!1,_result:!1,_serviceData:null,_sender:null,_fromUser:!1,get_serviceData:function(){return this._serviceData},parse:function(){if(this._parsed)return this._result;var e=s.parseXml(this._documentString),n=e.documentElement;if(null==n)return o.logAction("ParseCommandInvalidXml"),this._onFailure(),this._result;if(!i.XmlHelper.isElement(n,"user"))return o.logDetails("ParseCommandInvalidXmlRoot",{element:n.nodeName}),this._onFailure(),this._result;for(var r={},a={},c=s.IEnumerator.getEnumerator(n.childNodes);c.moveNext();){var l=c.get_current(),u=l.nodeName;if("s"===u||"sep"===u){var d=i.XmlHelper.getAttribute(l,"n");if(s.isNullOrEmpty(d))return o.logDetails("ParseCommandMissingServiceName",{element:l.nodeName}),this._onFailure(),this._result;var _=this._parseProperties(l,d);switch(u){case"s":if(s.keyExists(r,d))return o.logDetails("ParseCommandDuplicateGlobalSericeData",{serviceName:d}),this._onFailure(),this._result;var g=t.ServiceDataHelper.parseServiceName(d);g!==t.ServiceType.none&&(r[d]=new t.ServiceDataInfo(g,_,null));break;case"sep":var h=i.XmlHelper.getAttribute(l,"epid");if(s.isNullOrEmpty(h))return o.logDetails("ParseCommandMisingEpidAttribute",{element:l.nodeName}),this._onFailure(),this._result;if(s.keyExists(a,d)){if(s.keyExists(a[d],h))return o.logDetails("ParseCommandDuplicateEpidAttribute",{serviceName:d,epid:h}),this._onFailure(),this._result}else a[d]={};a[d][h]=new t.ServiceEndpointDataInfo(h,t.ServiceDataHelper.parseServiceName(d),_)}}}var p=[],f=a;for(var m in f){var v={key:m,value:f[m]};s.keyExists(r,v.key)?(r[v.key].endpointData=v.value,p.push(r[v.key]),delete r[v.key]):p.push(new t.ServiceDataInfo(t.ServiceDataHelper.parseServiceName(v.key),{},v.value))}var C=r;for(var y in C){var S={key:y,value:C[y]};S.value.endpointData={},p.push(S.value)}return this._serviceData=p,this._onSuccess(),this._result},_parseProperties:function(e,t){for(var n={},i=s.IEnumerator.getEnumerator(e.childNodes);i.moveNext();){var o=i.get_current(),r=o.nodeName;switch(r){case"Scene":case"UserTileLocation":case"DDP":this._fromUser&&(n[r]=o.text);break;default:n[r]="CM"===t?o.xml:o.text}}return n},_onFailure:function(){this._parsed=!0,this._result=!1},_onSuccess:function(){this._parsed=!0,this._result=!0},get__isValid:function(){return this._parsed&&this._result}}}()}),define("servicedatawriter",["servicedatareader"],function(){!function(){var e=window,t=e.MC,n=e.MSP,i=e.MSH,s=e.ss,o=n.ServiceDataDocumentType;n.ServiceDataWriter=function(e,t,n,i){this._payload=new s.StringBuilder,this._serviceData=e,this._endpoint=t,this._services=n,this._docType=i},n.ServiceDataWriter.prototype={_serviceData:null,_endpoint:null,_services:0,_docType:0,_generated:!1,getPayload:function(){if(this._generated)return this._payload.toString();this._payload.append("<user>");for(var e=!1,t=s.IEnumerator.getEnumerator(this._serviceData);t.moveNext();){var n=t.get_current();if(this._shouldAppend(n.service)){switch(this._docType){case o.put:this._appendGlobalData(n),this._appendEndpointData(n);break;case o.del:this._appendEmptyEndpoints(n)}e=!0}}return e?(this._payload.append("</user>"),this._generated=!0,this._payload.toString()):null},_shouldAppend:function(e){return(e&this._services)===e},_appendGlobalData:function(e){var n=this._formatProperties(e.properties,!0,e.service);n.length>0&&(this._payload.append(s.format('<s n="{0}">',t.ServiceDataHelper.formatServiceType(e.service))),this._payload.append(n),this._payload.append("</s>"))},_appendEndpointData:function(e){var n=this._endpoint,i=e.service;s.keyExists(e.endpointData,n)||(e.endpointData[n]=new t.ServiceEndpointDataInfo(n,i,t.ServiceDataHelper.getDefaultOfflineEndpointData(i))),this._payload.append(s.format('<sep n="{0}">',t.ServiceDataHelper.formatServiceType(i))),this._payload.append(this._formatProperties(e.endpointData[n].properties,!1,i)),this._payload.append("</sep>")},_appendEmptyEndpoints:function(e){var n=e.endpointData;for(var i in n){var o={key:i,value:n[i]};this._payload.append(s.format('<sep n="{0}" epid="{1}"/>',t.ServiceDataHelper.formatServiceType(e.service),o.key))}},_formatProperties:function(e,n,o){var r=new s.StringBuilder,a=e;for(var c in a){var l={key:c,value:a[c]},u=l.key;null!=l.value&&t.ServiceDataHelper.shouldPublishProperty(u,n,o)&&r.append(s.format("<{0}>{1}</{0}>",i.XmlHelper.xmlEscape(u),i.XmlHelper.xmlEscape(l.value)))}return r.toString()}}}()}),define("csconnection",["servicedatawriter"],function(){!function(){function e(e){return parseInt(e,10)}function t(e){return e.indexOf("&")<0?e:e.replace(i,function(e){return"&"===e?"&amp;":e})}var n="&amp;|&lt;|&gt;|&apos;|&quot;|&#[0-9]{1,5};|&#x[0-9a-f]{1,5};|&",i=new RegExp(n,"ig"),s=window,o=s.MC,r=s.MSP,a=s.MSM,c=s.MSH,l=s.MSCo,u=s.ss,d=l.HttpStatusCode,_=o.DatagramInfoType,g=o.ConnectionServiceResultCode,h=o.SignOutReasonCode,p=a.MsnpStatusCode,f=o.Logger,m=a.MsnpConnection,v=r._csConnection=function(e,t,n,i){this._getRequestTimer$1=-1,m.call(this,t,i),this._events$1=e,this._outTrid$1=0,this._sessionInfo$1=new o.MessengerSessionInfo(t,null,0,new Array(0)),this._sessionInfo$1.registrationToken=n,this.set_registrationToken(n),this._getRequestQueue$1=[],this._getRequestCount$1=0},C=v.prototype=new m;C.constructor=v,C._events$1=null,C._sessionInfo$1=null,C._disconnectRaised$1=!1,C._outTrid$1=0,C._getRequestQueue$1=null,C._getRequestCount$1=0,C._getRequestLimit$1=20,C.get__sessionInfo=function(){return this._sessionInfo$1},C._onServerCnt$1=function(t){if(3!==t.length)return void this._onUnexpectedArgumentCount$1("CNT",t);var n=this.getPendingCommand(e(t[0]));if(null!=n){var i=t[2];n.onComplete(p.success,i)}},C._onServerAth$1=function(t,n){if(2!==t.length&&3!==t.length)return void this._onUnexpectedArgumentCount$1("ATH",t);u.isNullOrEmpty(n)||(this.get_identity().skypeId=n);var i=this.getPendingCommand(e(t[0]));null!=i&&i.onComplete(p.success,null)},C._onServerBnd$1=function(t){if(3!==t.length)return void this._onUnexpectedArgumentCount$1("BND",t);var n=this.getPendingCommand(e(t[0]));if(null!=n){var i=t[2];n.onComplete(p.success,i)}},C._onServerDel$1=function(e){if(2!==e.length&&3!==e.length)return void this._onUnexpectedArgumentCount$1("DEL",e);var t=this._getPendingRequest$1("DEL",e);if(null!=t){var n=e.length>2?e[2]:null;t.onComplete(p.success,n)}},C._onHotmailAlert$1=function(e){var t=new a.MimeParser(e),n=t.getHeader("Content-Type").split(";")[0];switch(n){case"text/x-msmsgsinitialmdatanotification":case"text/x-msmsgsactivemailnotification":case"text/x-msmsgsemailnotification":case"text/x-msmsgsoimnotification":var i=new r._mailNotificationParser(t);if(i.parse())for(var s=0;s<i.get_notifications().length;s++)this._events$1.onMailNotificationReceived(i.get_notifications()[s]);else f.logAction("ParseMailNotificationFailure");break;case"text/x-msmsgsservicemessage":break;case"text/x-msmsgsfamilysafetysettings":}},C._onServerNfy$1=function(e){if(3!==e.length)return void this._onUnexpectedArgumentCount$1("NFY",e);var t;switch(e[1]){case"MSGR\\NETWORKS":case"MSGR\\PUT":t=_.put;break;case"MSGR\\DEL":t=_.del;break;case"MSGR\\CONVERSATION":return void this._events$1.onDatagramReceived(new o.DatagramInfo(_.conversationPut,e[2]));case"MSGR\\THREAD":return void this._events$1.onDatagramReceived(new o.DatagramInfo(_.imGroupPut,e[2]));case"MSGR\\ABCH":return void this._onAbchAlert$1(e[2]);case"MSGR\\HOTMAIL":return void this._onHotmailAlert$1(e[2]);default:return}var n=a.PagedMessage.createPagedMessage(t,e[2]);if(null!=n)switch(n.get_pageType()){case _.networkDataPut:var i=new r._networkDataReader(n);i.get_hasStatusData()&&this._events$1.onNetworkStatusChanged(i.get_networkId(),i.get_networkStatus());break;case _.serviceDataDel:case _.serviceDataPut:var s=a.Mri.getIMAddressInfo(n.get_routing().get_from()),c=new r._serviceDataReader(s,this.get_identity().liveId,n.get_content().get_body());if(!c.parse())return;var l=new o.ServiceDataSet(c.get_serviceData());n.get_pageType()===_.serviceDataPut?this._events$1.onServiceDataChanged(s,l):this._events$1.onServiceDataDeleted(s,l);break;default:this._events$1.onDatagramReceived(new o.DatagramInfo(t,e[1]))}},C._onServerOut$1=function(e){if(3!==e.length)return this._onUnexpectedArgumentCount$1("OUT",e),void this._events$1.onDisconnected(g.failure,h.serverError,-1);this._disconnectRaised$1=!0;var t="",n=u.parseXml(e[2]),i=n.documentElement;if(null!=i){var s=i.selectSingleNode("reason");null==s||u.isNullOrEmpty(s.text)||(t=s.text)}switch(t){case"OTH":case"RemoteLogout":this._events$1.onDisconnected(g.signedOutRoaming,h.signedOutByRemoteEndpoint,-1);break;case"TME":this._events$1.onDisconnected(g.signedOutExceededMaxEndpointCount,h.endpointLimitExceeded,-1);break;case"RCT":if(2!==e.length)return void this._onUnexpectedArgumentCount$1("OUT",e);var o=parseInt(e[1],10);this._events$1.onDisconnected(g.success,h.signedOutForReconnect,o);break;case"SessionTimeout":this._events$1.onDisconnected(g.signedOutSessionTimeout,h.sessionTimeout,-1);break;case"BadUIC":this._events$1.onDisconnected(g.badUic,h.badUic,-1);break;case"SSD":default:this._events$1.onDisconnected(g.failure,h.serverError,-1)}},C._onServerPut$1=function(e){if(2!==e.length&&3!==e.length)return void this._onUnexpectedArgumentCount$1("PUT",e);var t=this._getPendingRequest$1("PUT",e);if(null!=t){var n=e.length>2?e[2]:null;t.onComplete(p.success,n)}},C._onServerGet$1=function(e){if(2!==e.length&&3!==e.length)return void this._onUnexpectedArgumentCount$1("GET",e);var t=this._getPendingRequest$1("GET",e);if(null!=t){var n=e.length>2?e[2]:null;t.onComplete(p.success,n)}},C._onServerSdg$1=function(e){if("0"!==e[0]){var t=this._getPendingRequest$1("SDG",e);return void(null!=t&&t.onComplete(p.success,e[2]))}return 3!==e.length?void this._onUnexpectedArgumentCount$1("SDG",e):void this._events$1.onDatagramReceived(new o.DatagramInfo(_.sdg,e[2]))},C._onServerXfr$1=function(e){if(3!==e.length)return void this._onUnexpectedArgumentCount$1("XFR",e);var t=u.parseXml(e[2]),n=t.documentElement,i="",s="";if(null!=n){var o=n.selectSingleNode("target");null==o||u.isNullOrEmpty(o.text)||(i=o.text);var r=n.selectSingleNode("state");null==r||u.isNullOrEmpty(r.text)||(s=r.text)}if(!u.isNullOrEmpty(i)){this._disconnectRaised$1=!0;var a=i.split(":");f.logAction("CsConnection"),this._events$1.onTransferred(a[0],s,!1)}},C._getPendingRequest$1=function(t,n){if(n.length<1)return this._onUnexpectedArgumentCount$1(t,n),null;var i=e(n[0]);return this.getPendingCommand(i)},C._onServerError$1=function(e,t,n){var i=this.getPendingCommand(t);if(f.logResult("CsConnectionOnServerError",e),null!=i){var s=e;if(s===p.detailedError&&(s=p.internalServerError,!u.isNullOrEmpty(n))){var o="<msnp>",r=n.indexOf(o);if(r>=0){r+=o.length;var a=n.indexOf("</msnp>",r);if(a>=0){var c=n.substr(r,a-r);s=parseInt(c,10)}}}i.onComplete(s,n)}},C._onUnexpectedArgumentCount$1=function(e,t){f.logDetails("CsConnectionOnUnexpectedArgument",{cmd:e,argCount:t.length})},C._onAbchAlert$1=function(e){e=t(e);var n=u.parseXml(e),i=n.documentElement;if(null==i)return void f.logAction("CsConnectionOnAlert");if(c.XmlHelper.isElement(i,"NOTIFICATION")){var s=c.XmlHelper.getAttribute(i,"siteurl")||"";(s.endsWith("contacts.msn.com")||s.endsWith("contacts.msn-int.com"))&&this._onABChangeNotificationReceived$1(i)}},C._onABChangeNotificationReceived$1=function(e){var t=e.selectSingleNode("MSG/BODY");null!=t&&this._events$1.onABChangeNotificationReceived(t.text)},C._createAbsoluteUrl$1=function(e,t){return u.isNullOrEmpty(e)?e:e.startsWith("http://")||e.startsWith("https://")||e.startsWith("ftp://")?e:e="/"===e.charAt(0)?t+e:t+"/"+e},C._doCnt=function(e,t){var n="winnt",i="en-us";this._updateRegistrationToken$1("");var s,o;u.isNullOrEmpty(e)?(s="<connect><ver>2</ver><agent><os>{0}</os><osVer>5.2</osVer><proc>x86</proc><lcid>{1}</lcid></agent></connect>",o=u.format(s,n,i)):(s="<connect><ver>2</ver><agent><os>{0}</os><osVer>5.2</osVer><proc>x86</proc><lcid>{1}</lcid></agent><xfr><state>{2}</state></xfr></connect>",o=u.format(s,n,i,e)),this.sendCommand(["CNT",this.get_nextTrid(),"CON",o],t)},C._doAth=function(e,t){var n;if(u.isNullOrEmpty(e))n="<user><web-compact-ticket /></user>";else{var i="<user><uic>{0}</uic><web-compact-ticket /></user>";n=u.format(i,e)}this.sendCommand(["ATH",this.get_nextTrid(),"CON\\USER",n],t)},C._doBnd=function(e,t,n,i){var s="<msgr><ver>2</ver><client><name>{0}</name><ver>{1}</ver></client><epid>{2}</epid></msgr>",o=u.format(s,e,t,n);this.sendCommand(["BND",this.get_nextTrid(),"CON\\MSGR",o],i)},C._doDel=function(e,t,n){this.sendCommand(["DEL",this.get_nextTrid(),e,t],n)},C._doOut=function(e){this._outTrid$1=this.get_nextTrid(),this.sendCommand(["OUT",this._outTrid$1,"CON",null],e)},C._doGet=function(e,t,n){this._queueGetRequest$1(["GET",this.get_nextTrid(),e,t],n)},C._doPut=function(e,t,n){this.sendCommand(["PUT",this.get_nextTrid(),e,t],n)},C._doSdg=function(e,t){this.sendCommand(["SDG",this.get_nextTrid(),"MSGR",e],t)},C.onDisconnected=function(e,t){if(!this._disconnectRaised$1){if(this._disconnectRaised$1=!0,0!==this._outTrid$1){var n=this.getPendingCommand(this._outTrid$1);if(null!=n)return void n.onComplete(p.success,null)}f.logResult("CsConnectionOnDisconnected",e);var i,s,o=-1;switch(e){case d.none:t?(i=g.success,s=h.serverError,o=0):(i=g.success,s=h.connectionLost);break;case d.badRequest:i=g.failure,s=h.connectionLost,o=0;break;default:i=g.failure,s=h.connectionLost}this._events$1.onDisconnected(i,s,o)}},C.onCommandReceived=function(t){var n=t.get_allParameters();switch(u.isNullOrEmpty(t.get_registrationToken())||this._updateRegistrationToken$1(t.get_registrationToken()),t.get_name()){case"CNT":this._onServerCnt$1(n);break;case"ATH":this._onServerAth$1(n,t.get_skypeIdHeader());break;case"BND":this._onServerBnd$1(n);break;case"DEL":this._onServerDel$1(n);break;case"NFY":this._onServerNfy$1(n);break;case"OUT":this._onServerOut$1(n);break;case"PUT":this._onServerPut$1(n);break;case"GET":this._onServerGet$1(n);break;case"SDG":this._onServerSdg$1(n);break;case"XFR":this._onServerXfr$1(n);break;case"SBS":break;default:var i=c.ConvertHelper.tryParseInt(t.get_name());if(0>i)return void f.logDetails("CsConnectionOnCommandReceived",{msnpError:i});var s=e(n[0]);this._onServerError$1(i,s,n.length>2?n[2]:null)}},C.onTridChanged=function(e){this._sessionInfo$1.transactionID=e,null!=this._events$1&&this._events$1.onTridChanged(e)},C._updateRegistrationToken$1=function(e){this.get_registrationToken()!==e&&(this.set_registrationToken(e),this._sessionInfo$1.registrationToken=e,null!=this._events$1&&this._events$1.onRegistrationTokenChanged(e))},C._queueGetRequest$1=function(e,t){this._getRequestCount$1<this._getRequestLimit$1?(this._getRequestCount$1++,this.sendCommand(e,t),this._setGetRequestTimer$1()):this._getRequestQueue$1.push([e,t])},C._dequeueGetRequests$1=function(){for(;this._getRequestQueue$1.length>0&&this._getRequestCount$1<this._getRequestLimit$1;){this._getRequestCount$1++;var e=this._getRequestQueue$1[0];this.sendCommand(e[0],e[1]),this._getRequestQueue$1.splice(0,1),this._setGetRequestTimer$1()}},C._setGetRequestTimer$1=function(){var e=this;-1===e._getRequestTimer$1&&(e._getRequestTimer$1=window.setTimeout(u.Delegate.create(e,function(){e._getRequestTimer$1=-1,e._getRequestCount$1=0,e._dequeueGetRequests$1()}),6e4))}}()}),define("cscommand",["csconnection"],function(){!function(e){var t=window,n=t.MC,i=t.MSP,s=t.MSM,o=t.ss;i._csCommand=function(){},i._csCommand.prototype={_executing:!1,_completed:!1,onExecuted:null,execute:function(){this._executing=!0,this.onExecuted()},fail:function(){this._completed||(this._completed=!0,this.onCompleted())},getError:function(e){return o.format("{0}-{1}",e,n.enumToString(s.MsnpStatusCode,e))},complete:function(){this._completed||(this._completed=!0,this.onCompleted())},onCompleted:function(){e(this).triggerHandler("completed",[this,{}])}}}(window.originaljQuery||jQuery)}),define("csupdateconversationpropertycommand",["cscommand"],function(){!function(){var e=window,t=e.MC,n=e.MSP,i=e.MSM,s=e.ss,o=t.ConnectionServiceResultCode,r=n._csCommand,a=n._csUpdateConversationPropertyCommand=function(e,t,n,i,s){r.call(this),this._id$1=t,this._propertyName$1=n,this._propertyValue$1=i,this._connection$1=e,this._callback$1=s},c=a.prototype=new r;c.constructor=a,c._connection$1=null,c._callback$1=null,c._putFormat$1="<conversation><id>{0}</id><properties><{1}>{2}</{1}></properties></conversation>",c._id$1=null,c._propertyName$1=null,c._propertyValue$1=null,c._result$1=o.success,c.get_resultCode=function(){return this._result$1},c.onExecuted=function(){var e=s.format(this._putFormat$1,this._id$1,this._propertyName$1,this._propertyValue$1);this._connection$1._doPut("MSGR\\CONVERSATION",e,s.Delegate.create(this,this._onPutCompleted$1))},c._onPutCompleted$1=function(e){switch(e){case i.MsnpStatusCode.success:this._result$1=e;break;default:this._result$1=e,t.Logger.logResult("UpdateConversationPropertyCommandOnPutCompletedFailure",e)}this.complete()},c.onCompleted=function(){null!=this._callback$1&&this._callback$1.invoke(this._result$1),r.prototype.onCompleted.call(this)}}()}),define("csgetgroupinfocommand",["csupdateconversationpropertycommand"],function(){!function(){var e=window,t=e.MC,n=e.MSP,i=e.MSM,s=e.ss,o=t.ConnectionServiceResultCode,r=n._csCommand,a=n._csGetGroupInfoCommand=function(e,t,n){r.call(this),this._ids$1=t,this._connection$1=e,this._callback$1=n},c=a.prototype=new r;c.constructor=a,c._connection$1=null,c._callback$1=null,c._getFormat$1="<threads>{0}</threads>",c._threadFormat$1="<thread><id>{0}</id></thread>",c._ids$1=null,c._response$1=null,c._result$1=o.success,c.get_resultCode=function(){return this._result$1},c.onExecuted=function(){for(var e=new s.StringBuilder,t=0;t<this._ids$1.length;t++)e.append(s.format(this._threadFormat$1,this._ids$1[t]));var n=s.format(this._getFormat$1,e.toString());this._connection$1._doGet("MSGR\\THREADS",n,s.Delegate.create(this,this._onGetCompleted$1))},c._onGetCompleted$1=function(e,n){switch(e){case i.MsnpStatusCode.success:this._result$1=o.success;break;default:this._result$1=o.failure,t.Logger.logResult("GetGroupInfoCommandOnGetCompletedFailure",e)}this._response$1=n,this.complete()},c.onCompleted=function(){null!=this._callback$1&&this._callback$1.invoke(this._result$1,this._response$1,null),r.prototype.onCompleted.call(this)}}()}),define("csgetconversationinfocommand",["csgetgroupinfocommand"],function(){!function(){var e=window,t=e.MC,n=e.MSP,i=e.MSM,s=e.ss,o=t.ConnectionServiceResultCode,r=n._csCommand,a=n._csGetConversationInfoCommand=function(e,t,n){r.call(this),this._id$1=t,this._connection$1=e,this._callback$1=n},c=a.prototype=new r;c.constructor=a,c._connection$1=null,c._callback$1=null,c._getFormat$1="<conversations><conversation><id>{0}</id></conversation></conversations>",c._id$1=null,c._response$1=null,c._result$1=o.success,c.get_resultCode=function(){return this._result$1},c.onExecuted=function(){var e=s.format(this._getFormat$1,this._id$1);this._connection$1._doGet("MSGR\\CONVERSATIONS",e,s.Delegate.create(this,this._onGetCompleted$1))},c._onGetCompleted$1=function(e,n){switch(e){case i.MsnpStatusCode.success:this._result$1=o.success;break;default:this._result$1=o.failure,t.Logger.logResult("GetConversationDataCommandOnGetCompletedFailure",e)}this._response$1=n,this.complete()},c.onCompleted=function(){null!=this._callback$1&&this._callback$1.invoke(this._result$1,this._response$1),r.prototype.onCompleted.call(this)}}()}),define("cscreategroupconversationcommand",["csgetconversationinfocommand"],function(){!function(){var e=window,t=e.MC,n=e.MSP,i=e.MSM,s=e.ss,o=t.ConnectionServiceResultCode,r=i.MsnpStatusCode,a=n._csCommand,c=n._csCreateGroupConversationCommand=function(e,t,n){this._response$1="",a.call(this),this._connection$1=e,this._members$1=t,this._callback$1=n},l=c.prototype=new a;l.constructor=c,l._connection$1=null,l._members$1=null,l._callback$1=null,l._createThreadFormat$1="<thread><id></id><members>{0}</members></thread>",l._memberNode$1="<member><mri>{0}</mri><role>{1}</role></member>",l._startTime$1=0,l._qosScenario$1=null,l._result$1=t.ConnectionServiceResultCode.success,l.get_resultCode=function(){return this._result$1},l.onExecuted=function(){for(var e=new s.StringBuilder,n=0;n<this._members$1.length;n++){var o=this._members$1[n];e.append(s.format(this._memberNode$1,i.Mri.createFromIMAddressInfo(o.address).toString(),this._members$1[n].isAdmin?"admin":"user"))}var r=s.format(this._createThreadFormat$1,e.toString());this._connection$1._doPut("MSGR\\THREAD",r,s.Delegate.create(this,this._onPutCompleted$1)),this._startTime$1=(new Date).getTime(),this._qosScenario$1=t.WebmainHelper.startQoS(t.WebmainHelper.qoSScenarioGroupChatCreateGroup)},l._onPutCompleted$1=function(e,n){switch(e){case r.success:this._result$1=o.success,this._response$1=n,t.WebmainHelper.addQoSStats(t.WebmainHelper.qoSApiGroupChatCreateGroup,null,this._startTime$1,this._qosScenario$1,!1),t.WebmainHelper.stopQoS(this._qosScenario$1,!0,null);break;case r.detailedErrorInPayload:this._result$1=o.partialFailure,this._response$1=n;break;default:this._result$1=o.failure;var i=this.getError(e);t.WebmainHelper.addQoSStats(t.WebmainHelper.qoSApiGroupChatCreateGroup,i,this._startTime$1,this._qosScenario$1,!1),t.WebmainHelper.stopQoS(this._qosScenario$1,!1,i)}this.complete()},l.onCompleted=function(){null!=this._callback$1&&this._callback$1.invoke(this._result$1,this._response$1),a.prototype.onCompleted.call(this)}}()}),define("csgetconversationhistorycommand",["cscreategroupconversationcommand"],function(){!function(){var e=window,t=e.MC,n=e.MSP,i=e.ss,s=n._csCommand,o=n._csGetConversationHistoryCommand=function(e,t,n,i){s.call(this),this._id$1=t,this._syncState$1=n,this._connection$1=e,this._callback$1=i},r=o.prototype=new s;r.constructor=o,r._connection$1=null,r._callback$1=null,r._getFormat$1="<messagesbyconversation><id>{0}</id><start>0</start><pagesize>{1}</pagesize>{2}</messagesbyconversation>",r._syncStateFormat$1="<messagessyncstate>{0}</messagessyncstate>",r._pageSize$1=20,r._id$1=null,r._syncState$1=null,r._result$1=t.ConnectionServiceResultCode.success,r.get_resultCode=function(){return this._result$1},r.onExecuted=function(){var e=i.format(this._getFormat$1,this._id$1,this._pageSize$1,i.isNullOrEmpty(this._syncState$1)?"":i.format(this._syncStateFormat$1,this._syncState$1));this._connection$1._doGet("MSGR\\MESSAGESBYCONVERSATION",e,i.Delegate.create(this,this._onGetCompleted$1)),this._startTime$1=(new Date).getTime(),this._qosScenario$1=t.WebmainHelper.startQoS(t.WebmainHelper.qoSScenarioConversationHistory)},r._onGetCompleted$1=function(e,t){this._result$1=e,this._response$1=t,this.complete()},r.onCompleted=function(){null!=this._callback$1&&this._callback$1.invoke(this._result$1,this._response$1),s.prototype.onCompleted.call(this)}}()}),define("csgetrecentconversationscommand",["csgetconversationhistorycommand"],function(){!function(){var e=window,t=e.MC,n=e.MSP,i=e.MSM,s=e.ss,o=n._csCommand,r=n._csGetRecentConversationsCommand=function(e,t,n,i){o.call(this),this._connection$1=e,this._syncState$1=t,this._syncStartTime=n,this._callback$1=i},a=r.prototype=new o;a.constructor=r,a._connection$1=null,a._callback$1=null,a._fullSyncFormat$1="<recentconversations><start>{0}</start><pagesize>{1}</pagesize><includenetworks>fb,goog</includenetworks></recentconversations>",a._deltaSyncFormat$1="<recentconversations><syncstate>{0}</syncstate><pagesize>{1}</pagesize></recentconversations>",a._pageSize$1=100,a._syncState$1=String,a._syncStartTime=null,a._response$1=String,a._result$1=t.ConnectionServiceResultCode.success,a.get_resultCode=function(){return this._result$1},a.onExecuted=function(){var e;e=s.isNullOrEmpty(this._syncState$1)?s.format(this._fullSyncFormat$1,this._syncStartTime.getTime(),this._pageSize$1):s.format(this._deltaSyncFormat$1,this._syncState$1,this._pageSize$1),this._connection$1._doGet("MSGR\\RECENTCONVERSATIONS",e,s.Delegate.create(this,this._onGetCompleted$1))},a._onGetCompleted$1=function(e,n){e!=i.MsnpStatusCode.success&&t.Logger.logResult("GetRecentConversationsCommandOnGetCompletedFailure",e),this._result$1=e,this._response$1=n,this.complete()},a.onCompleted=function(){null!=this._callback$1&&this._callback$1.invoke(this._result$1,this._response$1),o.prototype.onCompleted.call(this)}}()}),define("webimclientreportabusecommand",["csgetrecentconversationscommand"],function(){!function(){var e=window,t=e.MC,n=e.MSP,i=e.MSM,s=e.ss,o=t.ConnectionServiceResultCode,r=n._csCommand,a=n._reportAbuseCommand=function(e,t,n){r.call(this),this._connection$1=e,this._callback$1=t,this._alias$1=n},c=a.prototype=new r;c.constructor=a,c._connection$1=null,c._callback$1=null,c._reportSpamFormat$1="<reportspam><alias>{0}</alias></reportspam>",c._alias$1=null,c._result$1=o.success,c.get_resultCode=function(){return this._result$1},c.onExecuted=function(){this._connection$1._doPut("MSGR\\REPORTSPAM",s.format(this._reportSpamFormat$1,this._alias$1),s.Delegate.create(this,this._onPutCompleted$1))},c._onPutCompleted$1=function(e){switch(e){case i.MsnpStatusCode.success:this._result$1=o.success;break;default:this._result$1=o.failure,t.Logger.logResult("ReportAbuseCommandOnPutCompletedFailure",e)}this.complete()},c.onCompleted=function(){null!=this._callback$1&&this._callback$1.invoke(this._result$1),r.prototype.onCompleted.call(this)}}()}),define("updatesubscriptionscommand",["webimclientreportabusecommand"],function(){!function(){var e=window,t=e.MC,n=e.MSP,i=e.MSM,s=e.ss,o=t.SubscriptionType,r=t.ConnectionServiceResultCode,a=n._csCommand,c=n._updateSubscriptionsCommand=function(e,t,n){this._error$1="",a.call(this),this._subscriptionType$1=e,this._connection$1=t,this._callback$1=n},l=c.prototype=new a;l.constructor=c,l._connection$1=null,l._subscriptionType$1=0,l._callback$1=null,l._subscriptionPayload$1="<subscribe>{0}</subscribe>",l._buddySubscriptionPayload$1="<presence><buddies><all /></buddies></presence><messaging><im /><conversations /></messaging>",l._partnerSubscriptionPayload$1="<notifications><partners><partner>Hotmail</partner><partner>ABCH</partner></partners></notifications>",l._commandNamespace$1="MSGR\\SUBSCRIPTIONS",l._result$1=t.ConnectionServiceResultCode.success,l.get_resultCode=function(){return this._result$1},l.get_error=function(){return this._error$1},l.onExecuted=function(){switch(this._subscriptionType$1){case o.notificationSubscribe:this._connection$1._doPut(this._commandNamespace$1,s.format(this._subscriptionPayload$1,this._partnerSubscriptionPayload$1),s.Delegate.create(this,this._onUpdateCompleted$1));break;case o.presenceAndNotificationSubscribe:this._connection$1._doPut(this._commandNamespace$1,s.format(this._subscriptionPayload$1,this._partnerSubscriptionPayload$1+this._buddySubscriptionPayload$1),s.Delegate.create(this,this._onUpdateCompleted$1));break;case o.presenceUnsubscribe:this._connection$1._doDel(this._commandNamespace$1,s.format(this._subscriptionPayload$1,this._buddySubscriptionPayload$1),s.Delegate.create(this,this._onUpdateCompleted$1));break;case o.presenceAndNotificationUnsubscribe:this._connection$1._doDel(this._commandNamespace$1,s.format(this._subscriptionPayload$1,this._partnerSubscriptionPayload$1+this._buddySubscriptionPayload$1),s.Delegate.create(this,this._onUpdateCompleted$1))}},l._onUpdateCompleted$1=function(e){switch(e){case i.MsnpStatusCode.success:this._result$1=r.success;break;default:this._error$1=s.format("UpdateSubscriptions PUT response error: {0}",this.getError(e)),this._result$1=r.failure,t.Logger.logResult("UpdateSubscriptionsCommandOnUpdateCompletedFailure",e)}this.complete()},l.onCompleted=function(){null!=this._callback$1&&this._callback$1.invoke(this._result$1),a.prototype.onCompleted.call(this)}}()}),define("updatenetworksubscriptionscommand",["updatesubscriptionscommand"],function(){!function(){var e=window,t=e.MC,n=e.MSP,i=e.MSM,s=e.ss,o=t.NetworkOperationType,r=t.ConnectionServiceResultCode,a=n._csCommand,c=n._updateNetworkSubscriptionsCommand=function(e,t,n,i){a.call(this),null!=e&&(this._networkId$1=e.toLowerCase()),this._operation$1=t,this._connection$1=n,this._callback$1=i,this._result$1=r.success},l=c.prototype=new a;l.constructor=c,l._networkId$1=null,l._operation$1=0,l._connection$1=null,l._callback$1=null,l._updatePayload$1="<networks><network>{0}</network></networks>",l._commandNamespace$1="MSGR\\NETWORKS",l._result$1=0,l.onExecuted=function(){switch(this._operation$1){case o.enableIM:this._connection$1._doPut(this._commandNamespace$1,s.format(this._updatePayload$1,this._networkId$1),s.Delegate.create(this,this._onResponse$1));break;case o.disableIM:this._connection$1._doDel(this._commandNamespace$1,s.format(this._updatePayload$1,this._networkId$1),s.Delegate.create(this,this._onResponse$1))}},l._onResponse$1=function(e){switch(e){case i.MsnpStatusCode.success:this._result$1=r.success;break;default:this._result$1=r.failure,t.Logger.logResult("UpdateNetworkSubscriptionsCommandOnResponseFailure",e)}this.complete()},l.onCompleted=function(){null!=this._callback$1&&this._callback$1.invoke(this._result$1),a.prototype.onCompleted.call(this)}}()}),define("authenticatecommand",["updatenetworksubscriptionscommand"],function(){!function(){var e=window,t=e.MC,n=e.MSP,i=e.MSM,s=e.MSCo,o=e.ss,r=t.ConnectionServiceResultCode,a=i.MsnpStatusCode,c=t.Logger,l=n._csCommand,u={initial:0,failure:1,cntAthBndSent:2,bndReceived:3,challengeResponseReceived:4},d=n._authenticateCommand=function(e,t,n,i,s,o){this._error$1="",l.call(this),this._identity$1=e,this._clientId$1=t,this._services$1=i,this._transferState$1=n,this._connection$1=s,this._onCompleted$1=o},_=d.prototype=new l;_.constructor=d,_._identity$1=null,_._clientId$1=null,_._transferState$1=null,_._connection$1=null,_._onCompleted$1=null,_._state$1=0,_._resultCode$1=0,_._services$1=0,_.onExecuted=function(){this._process$1(r.success,null)},_.onCompleted=function(){this._onCompleted$1.invoke(this._resultCode$1,this._error$1),l.prototype.onCompleted.call(this)},_._process$1=function(e,i){switch(e!==r.success&&(this._state$1=u.failure),this._state$1){case u.initial:switch(this._connection$1._doCnt(this._transferState$1,o.Delegate.create(this,this._onCnt$1)),this._identity$1.authenticationInfo.authType){case t.AuthenticationType.rpsAuth:this._state$1=u.cntAthBndSent,this._connection$1._doAth(this._identity$1.authenticationInfo.uicTicket,o.Delegate.create(this,this._onAth$1)),this._connection$1._doBnd(s.Configuration.get_clientId(),s.Configuration.get_clientVersion(),this._identity$1.endpointId,o.Delegate.create(this,this._onBnd$1));break;default:this._error$1="Unsupported authentication type.",this._resultCode$1=r.failure,this.complete()}break;case u.cntAthBndSent:break;case u.bndReceived:var a=i,l=o.parseXml(a),d=l.documentElement;if(null==d)return this._error$1="Authenticate BND response invalid.",this._resultCode$1=r.failure,void this.complete();var _=d.selectSingleNode("nonce");if(null==_||o.isNullOrEmpty(_.text))this._resultCode$1=r.success,this.complete();else{var g="PROD0090YUAUV{2B",h=(new n._mD5Auth).getMacMD5Hash(_.text,g,"YMM8C_H7KCQ2S_KL"),p=o.format("<challenge><appId>{0}</appId><response>{1}</response></challenge>",g,h);this._connection$1._doPut("MSGR\\CHALLENGE",p,o.Delegate.create(this,this._onPut$1))}break;case u.challengeResponseReceived:this._resultCode$1=r.success,this.complete();break;case u.failure:c.logAction("AuthenticateCommandProcessFailure"),this._resultCode$1=e,this.complete()}},_._onCnt$1=function(e,t){switch(e){case a.success:this._process$1(r.success,t);break;default:this._error$1=o.format("Authenticate CNT response error: {0}",this.getError(e)),this._process$1(r.failure,t),c.logResult("AuthenticateCommandOnCntFailure",e)}},_._onAth$1=function(e,t){switch(e){case a.success:this._process$1(r.success,t);break;default:this._error$1=o.format("Authenticate ATH response error: {0}",this.getError(e)),this._process$1(e===a.authFailed||e===a.authError?r.unauthenticated:r.failure,t),c.logResult("AuthenticateCommandOnCthFailure",e)
}},_._onBnd$1=function(e,t){switch(this._state$1=u.bndReceived,e){case a.success:this._process$1(r.success,t);break;default:this._error$1=o.format("Authenticate BND response error: {0}",this.getError(e)),this._process$1(e===a.perUserLoginLimitExceeded||e===a.accountCompromised?r.unauthenticated:r.failure,t),c.logResult("AuthenticateCommandOnBndFailure",e)}},_._onPut$1=function(e,t){switch(this._state$1=u.challengeResponseReceived,e){case a.success:this._process$1(r.success,t);break;default:this._error$1=o.format("Authenticate PUT response error: {0}",this.getError(e)),this._process$1(r.failure,t),c.logResult("AuthenticateCommandOnPutFailure",e)}}}()}),define("disconnectedcommand",["authenticatecommand"],function(){!function(){var e=window,t=e.MSP,n=t._csCommand,i=t._disconnectedCommand=function(e,t,i,s){n.call(this),this._resultCode$1=e,this._events$1=t,this._reason$1=i,this._reconnectWaitTime$1=s},s=i.prototype=new n;s.constructor=i,s._resultCode$1=0,s._events$1=null,s._reason$1=0,s._reconnectWaitTime$1=0,s.onExecuted=function(){this._events$1.onDisconnected(this._resultCode$1,this._reason$1,this._reconnectWaitTime$1)}}()}),define("csdatagramreceivedcommand",["disconnectedcommand"],function(){!function(){var e=window,t=e.MSP,n=t._csCommand,i=t._csDatagramReceivedCommand=function(e,t){n.call(this),this._page$1=e,this._events$1=t},s=i.prototype=new n;s.constructor=i,s._page$1=null,s._events$1=null,s.onExecuted=function(){this.onCompleted()},s.onCompleted=function(){this._events$1.onDatagramReceived(this._page$1)}}()}),define("csdeleteservicedatacommand",["csdatagramreceivedcommand"],function(){!function(){var e=window,t=e.MC,n=e.MSP,i=e.MSM,s=e.ss,o=t.ServiceType,r=n._csCommand,a=n._csDeleteServiceDataCommand=function(e,t,n,i){r.call(this),this._identity$1=e,this._serviceData$1=t,this._connection$1=n,this._onCompleted$1=i},c=a.prototype=new r;c.constructor=a,c._identity$1=null,c._serviceData$1=null,c._connection$1=null,c._onCompleted$1=null,c._result$1=0,c.onExecuted=function(){for(var e=o.none,r=s.IEnumerator.getEnumerator(this._serviceData$1.toServiceDataArray());r.moveNext();){var a=r.get_current();a.getAllEndpoints().length>0&&(e|=a.get_service())}if(e!==o.none){var c=new t.IMAddressInfo(this._identity$1.liveId,t.IMAddressInfoType.windowsLive,t.RoleLists.none),l=new n.ServiceDataWriter(this._serviceData$1.toArray(),null,e,n.ServiceDataDocumentType.del),u=i.Mri.createFromIMAddressInfo(c),d=i.Mri.create(c.address,c.type,this._identity$1.endpointId,c.applicationId,c.network),_=l.getPayload();if(null==_)return void this.complete();var g=new i.PagedMessage(t.DatagramInfoType.serviceDataDel,new i.RoutingLayer(u,d),new i.ReliabilityLayer,new i.PublicationLayer("/user",i.ContentDocumentType.userDocument,_,!1));this._connection$1._doDel("MSGR\\PRESENCE",g.payLoad(),s.Delegate.create(this,this._onDel$1))}else this.complete()},c.onCompleted=function(){null!=this._onCompleted$1&&this._onCompleted$1.invoke(this._result$1),r.prototype.onCompleted.call(this)},c._onDel$1=function(e){e!==i.MsnpStatusCode.success?(this._result$1=t.ConnectionServiceResultCode.failure,this.fail()):this.complete()}}()}),define("csmailnotificationreceivedcommand",["csdeleteservicedatacommand"],function(){!function(){var e=window,t=e.MSP,n=t._csCommand,i=t._csMailNotificationReceivedCommand=function(e,t){n.call(this),this._mailNotification$1=e,this._events$1=t},s=i.prototype=new n;s.constructor=i,s._mailNotification$1=null,s._events$1=null,s.onExecuted=function(){this._events$1.onMailNotificationReceived(this._mailNotification$1)}}()}),define("publishservicedatacommand",["csmailnotificationreceivedcommand"],function(){!function(){function e(e){switch(e){case r.full:case r.normal:return a.IM|a.PD|a.PE|a.CM|a.SKP}return a.none}var t=window,n=t.MC,i=t.MSP,s=t.MSM,o=t.ss,r=n.SessionServiceOptions,a=n.ServiceType,c=i._csCommand,l=n.ConnectionServiceResultCode,u=i._publishServiceDataCommand=function(t,i,s,o,r,a,l){this._error$1="",c.call(this),this._address$1=new n.IMAddressInfo(t.liveId,n.IMAddressInfoType.windowsLive,n.RoleLists.none),this._identity$1=t,this._serviceData$1=i,this._services$1=e(s),this._connection$1=o,this._csEvents$1=r,this._overrideGlobalPresence$1=a,this._onCompleted$1=l},d=u.prototype=new c;d.constructor=u,d._address$1=null,d._identity$1=null,d._serviceData$1=null,d._services$1=a.none,d._connection$1=null,d._csEvents$1=null,d._onCompleted$1=null,d._overrideGlobalPresence$1=!1,d._resultCode$1=l.success,d.get_imAddress=function(){return this._address$1},d.get_serviceData=function(){return this._serviceData$1},d.onExecuted=function(){if(this._services$1===n.ServiceType.none)this.complete();else{var e=new i.ServiceDataWriter(this._serviceData$1.toArray(),this._identity$1.endpointId,this._services$1,i.ServiceDataDocumentType.put),t=e.getPayload();if(null==t)return void this.complete();var r=s.Mri.createFromIMAddressInfo(this._address$1),a=s.Mri.create(this._address$1.address,this._address$1.type,this._identity$1.endpointId,this._address$1.applicationId,this._address$1.network),c=new s.PagedMessage(n.DatagramInfoType.serviceDataPut,new s.RoutingLayer(r,a),new s.ReliabilityLayer,new s.PublicationLayer("/user",s.ContentDocumentType.userDocument,t,!this._overrideGlobalPresence$1));this._connection$1._doPut("MSGR\\PRESENCE",c.payLoad(),o.Delegate.create(this,this._onPutCompleted$1))}},d.onCompleted=function(){null!=this._onCompleted$1&&this._onCompleted$1.invoke(this._resultCode$1),c.prototype.onCompleted.call(this)},d.get_resultCode=function(){return this._resultCode$1},d.get_error=function(){return this._error$1},d._onPutCompleted$1=function(e,t){if(e!==s.MsnpStatusCode.success)return this._error$1=o.format("PublishService PUT Response error: {0}",this.getError(e)),this._resultCode$1=l.failure,void this.fail();if(!o.isNullOrEmpty(t)){var r=o.parseXml(t),a=r.documentElement;if(null!=a&&"presence-response"===a.nodeName){var c=a.selectSingleNode("from"),u=a.selectSingleNode("user"),d=s.Mri.getIMAddressInfo(new s.Mri(c.text)),_=new i._serviceDataReader(d,this._identity$1.liveId,u.xml);if(_.parse()){var g=new n.ServiceDataSet(_.get_serviceData());this._csEvents$1.onServiceDataChanged(d,g)}else;}}this.complete()}}()}),define("cssenddatagramcommand",["publishservicedatacommand"],function(){!function(){var e=window,t=e.MC,n=e.MSP,i=e.MSM,s=e.ss,o=t.DatagramInfoType,r=i.MsnpStatusCode,a=t.SendDatagramResultCode,c=n._csCommand,l=/\nMessage-Type: (Text)|(RichText)\r\n/,u=n._csSendDatagramCommand=function(e,t,n){c.call(this),this._message$1=e,this._connection$1=t,this._onCompleted$1=n},d=u.prototype=new c;d.constructor=u,d._message$1=null,d._connection$1=null,d._onCompleted$1=null,d._resultCode$1=0,d._response$1=null,d._startTime$1=0,d._qosScenario$1=null,d._qosApi$1=null,d._qosTimer=-1,d.onExecuted=function(){var n=this;switch(t.Logger.logDetails("SendPageCommandOnExecuted",{type:t.enumToString(t.DatagramInfoType,n._message$1.datagramType)}),n._message$1.datagramType){case o.sdg:n._connection$1._doSdg(n._message$1.payload,s.Delegate.create(n,n._onServerResponse$1)),l.test(n._message$1.payload)&&(n._startTime$1=(new Date).getTime(),n._qosApi$1=t.WebmainHelper.qoSApiSendIm,n._qosScenario$1=t.WebmainHelper.startQoS(t.WebmainHelper.qoSScenarioSendIm),n._qosTimer=e.setTimeout(function(){t.WebmainHelper.addQoSStats(n._qosApi$1,null,n._startTime$1,n._qosScenario$1,!1),t.WebmainHelper.stopQoS(n._qosScenario$1,!0,null)},3e4));break;case o.get:n._connection$1._doGet("",n._message$1.payload,s.Delegate.create(n,n._onServerResponse$1));break;case o.imGroupPut:n._connection$1._doPut("MSGR\\THREAD",n._message$1.payload,s.Delegate.create(n,n._onServerResponse$1)),n._startTime$1=(new Date).getTime(),n._qosApi$1=t.WebmainHelper.qoSApiGroupChatAddContacts,n._qosScenario$1=t.WebmainHelper.startQoS(t.WebmainHelper.qoSScenarioGroupChatAddContacts);break;case o.imGroupDel:n._connection$1._doDel("MSGR\\THREAD",n._message$1.payload,s.Delegate.create(n,n._onServerResponse$1)),n._startTime$1=(new Date).getTime(),n._qosApi$1=t.WebmainHelper.qoSApiGroupChatLeaveGroup,n._qosScenario$1=t.WebmainHelper.startQoS(t.WebmainHelper.qoSScenarioGroupChatLeaveGroup)}},d.onCompleted=function(){this._onCompleted$1.invoke(this._resultCode$1,this._response$1)},d._onServerResponse$1=function(n,i){if(-1!=this._qosTimer&&e.clearTimeout(this._qosTimer),this._message$1.datagramType===t.DatagramInfoType.imGroupPut&&null!=i&&(this._response$1=new t.DatagramInfo(this._message$1.datagramType,i)),n===r.success)this._resultCode$1=a.success,t.WebmainHelper.addQoSStats(this._qosApi$1,null,this._startTime$1,this._qosScenario$1,!1),t.WebmainHelper.stopQoS(this._qosScenario$1,!0,null),this._message$1.datagramType===t.DatagramInfoType.imGroupPut&&null!=i&&(this._response$1=new t.DatagramInfo(this._message$1.datagramType,i)),this.complete();else{var s=this.getError(n);if((this._message$1.datagramType==o.imGroupPut||this._message$1.datagramType==o.imGroupDel)&&n==r.detailedErrorInPayload){var c=this._getDetailedErrorString(n,i);c&&(s=c)}var l=!1;switch(n===r.oimNotSupported&&(l=!0),t.WebmainHelper.addQoSStats(this._qosApi$1,s,this._startTime$1,this._qosScenario$1,l),t.WebmainHelper.stopQoS(this._qosScenario$1,!1,s),n){case r.notAcceptingIMs:this._resultCode$1=a.recipientNotAcceptingIMs;break;case r.messageTooLong:case r.smsMessageTooLong:this._resultCode$1=a.tooLong;break;case r.invalidXmlData:this._resultCode$1=a.invalidData;break;case r.detailedErrorInPayload:this._resultCode$1=a.partialFailure;break;case r.smsIncorrectFormat:case r.smsCarrierInvalid:case r.smsCarrierNoRoute:this._resultCode$1=a.recipientInvalid;break;case r.smsAccountMuted:case r.smsAccountDisabled:case r.smsMobileCacheFull:this._resultCode$1=a.recipientDisabled;break;default:this._resultCode$1=a.failure}null==this._response$1&&(this._response$1=this._message$1),this.fail()}},d._getDetailedErrorString=function(e,t){var n=[];try{var i=s.parseXml(t),o=i.documentElement,r=o.selectSingleNode("errors");if(null!=r)for(var a=r.selectNodes("error"),c=s.IEnumerator.getEnumerator(a);c.moveNext();){var l=c.get_current(),u=l.selectSingleNode("code"),d=parseInt(u.text);n.contains(d)||n.push(d)}}catch(_){wLive.People.Reporter.logError("GroupChat","Failed to parse detailed error data.")}return n.length>0?e.toString()+"-"+n.join(","):""}}()}),define("csservicedatachangedcommand",["cssenddatagramcommand"],function(){!function(){var e=window,t=e.MSP,n=t._csCommand,i=t._csServiceDataChangedCommand=function(e,t,i){n.call(this),this._address$1=e,this._serviceData$1=t,this._events$1=i},s=i.prototype=new n;s.constructor=i,s._address$1=null,s._serviceData$1=null,s._events$1=null,s.get_imAddress=function(){return this._address$1},s.get_serviceData=function(){return this._serviceData$1},s.onExecuted=function(){this._events$1.onServiceDataChanged(this._address$1,this._serviceData$1)}}()}),define("messengerstatussnapshothelper",["csservicedatachangedcommand"],function(){!function(){var e=window,t=e.MC,n=e.MSCr,i=e.MSH,s=e.ss,o=t.IMAddressInfoType,r=t.MailNotificationInfoType,a=t.Logger,c=n._messengerStatusSnapshotHelper=function(){};c._markNetworkContactsOffline=function(e,n){for(var r=e.events,a={},l=r.length-1;l>=0;l--){var u=r[l];if("OnServiceDataChanged"===u[0].toString()){var d=u[1][0];if(null==d)continue;if(d.type===o.connect&&n===d.network){var _=i.ContactHelper.getIMAddressInfoKey(d);s.keyExists(a,_)||(a[_]=u)}}}var g={};g.Status="FLN";var h=new t.ServiceDataSet([new t.ServiceDataInfo(t.ServiceType.IM,g,{})]),p=a;for(var f in p){var m={key:f,value:p[f]};c._updateServiceDataEvent(m.value,h,!1)}},c._updateSignInServiceData=function(e,t,i,s){var o=e.events,r=n._messengerStatusSnapshotHelper._findServiceDataEvent(o,t);return null!=r?c._updateServiceDataEvent(r,i,s):s?null:(c._appendServiceDataEvent(e,t,i),i.toArray())},c._getServiceDataInfo=function(e,n){var i=e.events,s=c._findServiceDataEvent(i,n);if(null!=s){var o=s[1],r=new t.ServiceDataSet(o[1]);return r.clone().toArray()}return new Array(0)},c._findServiceDataEvent=function(e,t){var n=null;if(null==e)return null;for(var r=e.length-1;r>=0;r--){var a=e[r];if("OnServiceDataChanged"===a[0].toString()){var c=a[1][0];if(null==c)continue;if(t.type===o.cid&&c.type===o.cid&&!s.isNullOrEmpty(t.cid)&&t.cid===c.cid){n=a;break}if(!s.isNullOrEmpty(t.address)&&i.ContactHelper.areIMAddressesEqual(t,c)){n=a;break}}}return n},c._appendServiceDataEvent=function(e,t,n){var i=new Array(2);i[0]="OnServiceDataChanged",i[1]=[t,n.clone().toArray()],c._appendSigninInfoSessionEvent(e,i)},c._appendSigninInfoSessionEvent=function(e,t){for(var n=new Array(e.events.length+1),i=0,s=e.events.length;s>i;i++)n[i]=e.events[i];n[e.events.length]=t,e.events=n},c._updateServiceDataEvent=function(e,i,s){var o,r=e[1],a=new t.ServiceDataSet(r[1]);if(s)a.deleteAll(i.toArray()),r[1]=a.toArray(),o=null;else{o=a.createDiff(i);var c=n._messengerStatusSnapshotHelper._mergeServiceDataEventInfo(a,i);c.updateAll(o),r[1]=c.toArray()}return o},c._mergeServiceDataEventInfo=function(e,n){for(var i,o=[],r=s.IEnumerator.getEnumerator(e.toArray());r.moveNext();)i=r.get_current(),o.push(i);for(var a=s.IEnumerator.getEnumerator(n.toServiceDataArray());a.moveNext();)i=a.get_current(),null==e.getServiceData(i.get_service())&&o.push(i.clone());return new t.ServiceDataSet(o)},c._appendMailNotificationEvent=function(e,n){if(n.type===r.initial){a.logDetails("AppendMailNotificationEvent",{type:t.enumToString(t.MailNotificationInfoType,n.type)});var i=["OnMailNotification",[n]];c._appendSigninInfoSessionEvent(e,i)}},c._updateFromActivityNotification=function(e,n){var i=e.notification;i.source===t.MailNotificationFolderType.inbox?(n.inboxUnread-=i.delta,i.destination!==t.MailNotificationFolderType.inbox&&i.destination!==t.MailNotificationFolderType.hidden&&(n.foldersUnread+=i.delta)):i.source!==t.MailNotificationFolderType.hidden?(n.foldersUnread-=i.delta,i.destination===t.MailNotificationFolderType.inbox&&(n.inboxUnread+=i.delta)):i.destination===t.MailNotificationFolderType.inbox?n.inboxUnread+=i.delta:i.destination!==t.MailNotificationFolderType.hidden&&(n.foldersUnread+=i.delta),n.foldersUnread<0&&(n.foldersUnread=0)},c._updateSignInMailNotification=function(e,n){a.logDetails("UpdateSignInMailNotification",{type:t.enumToString(t.MailNotificationInfoType,n.type)});var i=e.events,s=c._findInitialMailNotificationEvent(i);null!=s?c._updateMailNotificationEvent(s,n):c._appendMailNotificationEvent(e,n)},c._updateMailNotificationEvent=function(e,i){a.logDetails("UpdateMailNotificationEvent",{type:t.enumToString(t.MailNotificationInfoType,i.type)});var s=e[1],o=s[0],c=o.notification;switch(i.type){case r.initial:o.notification=i.notification;break;case r.incoming:break;case r.activity:n._messengerStatusSnapshotHelper._updateFromActivityNotification(i,c)}},c._findInitialMailNotificationEvent=function(e){var t=null;if(null==e)return null;for(var n=e.length-1;n>=0;n--){var i=e[n];if("OnMailNotification"===i[0].toString()){var s=i[1],o=s[0];if(o.type===r.initial){t=i;break}}}return t},c._normalizeSignInEvents=function(e){for(var i=[],o={},a=null,l=s.IEnumerator.getEnumerator(e.events);l.moveNext();){var u,d,_,g=l.get_current();switch(g[0]){case"OnDatagramReceived":break;case"OnServiceDataChanged":u=n._messengerStatusSnapshotHelper._serviceDataEventAddressKey(g),s.keyExists(o,u)?(d=g[1],_=d[1],c._updateServiceDataEvent(o[u],new t.ServiceDataSet(_),!1)):(o[u]=g,i.push(g));break;case"OnServiceDataDeleted":u=c._serviceDataEventAddressKey(g),s.keyExists(o,u)&&(d=g[1],_=d[1],n._messengerStatusSnapshotHelper._updateServiceDataEvent(o[u],new t.ServiceDataSet(_),!0));break;case"OnMailNotification":var h=g[1][0];switch(h.type){case r.initial:null!=a&&i.remove(a),i.push(g),a=g;break;case r.activity:null!=a&&n._messengerStatusSnapshotHelper._updateMailNotificationEvent(a,h)}break;default:i.push(g)}}e.events=i},c._serviceDataEventAddressKey=function(e){var t=e[1][0];return s.format("{0}:{1}",t.type,t.type===o.cid?t.cid:t.address)}}()}),define("messengerstatussnapshot",["messengerstatussnapshothelper"],function(){!function(){function e(e,t,n,i,s){for(var o=0;s>o;o++)n[i+o]=e[t+o]}var t=window,n=t.MC,i=t.MSCr,s=t.MSH,o=t.ss,r=n.SignOutReasonCode;i.MessengerStatusSnapshot=function(e){this._lastModified=s.DateTimeHelper.minValue,this._liveId=e},i.MessengerStatusSnapshot.prototype={_networkStatusEvents:null,_messengerSessionState:null,_messengerSessionEvents:null,_liveId:null,_switchingServices:!1,get_lastModified:function(){return this._lastModified},get_ageInMilliSeconds:function(){return s.DateTimeHelper.subtract(new Date,this.get_lastModified())},get_networkStatusEvents:function(){return this._networkStatusEvents},set_networkStatusEvents:function(e){return this._networkStatusEvents!==e&&(this._networkStatusEvents=e,this._onSnapshotChanged()),e},get_messengerSessionState:function(){return this._messengerSessionState},set_messengerSessionState:function(e){return this._messengerSessionState!==e&&(this._messengerSessionState=e),e},get_messengerSessionEvents:function(){return this._messengerSessionEvents},set_messengerSessionEvents:function(e){return this._messengerSessionEvents!==e&&(this._messengerSessionEvents=e),e},get_services:function(){var e=this.get_messengerSessionState();return null!=e?e.services:n.SessionServiceOptions.normal},set_services:function(e){var t=this.get_messengerSessionState();return null!=t&&t.services!==e&&(t.services=e,this._onSnapshotChanged()),e},get_switchingServices:function(){return this._switchingServices},set_switchingServices:function(e){return this._switchingServices=e,e},updateSessionId:function(e){var t=this.get_messengerSessionState();null!=t&&(t.sessionToken=e,this._onSnapshotChanged())},updateTrid:function(e){var t=this.get_messengerSessionState();null!=t&&(t.transactionID=e,this._onSnapshotChanged())},updateRegistrationToken:function(e){var t=this.get_messengerSessionState();null!=t&&(t.registrationToken=e,this._onSnapshotChanged())},expire:function(){this._clearSignedInState(),this._onSnapshotChanged()},onSignedOut:function(e){if(e===r.signedOutByLocalEndpoint||e===r.signedOutByRemoteEndpoint)this._clearSignedInState();else{var t=this.get_messengerSessionState();null!=t&&(t.disconnected=!0,t.sessionToken=null,this._onSnapshotChanged())}},normalizeSignInEvents:function(){var e=this.get_messengerSessionEvents();null!=e&&(i._messengerStatusSnapshotHelper._normalizeSignInEvents(e),this._onSnapshotChanged())},onNetworkStatusChanged:function(t,s){var r=this.get_networkStatusEvents(),a=!1,c=!1;if(null==r)this._networkStatusEvents=[[t,s]],a=!0;else{for(var l=o.IEnumerator.getEnumerator(r);l.moveNext();){var u=l.get_current();if(0===o.compare(u[0],t,!0)){u[1]!==s&&(u[1]=s,a=!0),c=!0;break}}if(!c){var d=new Array(r.length+1);e(r,0,d,0,r.length),d[r.length]=[t,s],this._networkStatusEvents=d,a=!0}}a&&(s===n.NetworkInfoStatus.signedOut&&i._messengerStatusSnapshotHelper._markNetworkContactsOffline(this.get_messengerSessionEvents(),t),this._onSnapshotChanged())},serviceDataChanged:function(e,t,n){var s=this.get_messengerSessionEvents();if(null==s)return t.toArray();var o=i._messengerStatusSnapshotHelper._updateSignInServiceData(s,e,t,n);return this._onSnapshotChanged(),o},getServiceDataInfo:function(e){var t=this.get_messengerSessionEvents();return null==t?new Array(0):i._messengerStatusSnapshotHelper._getServiceDataInfo(t,e)},getLocalNetworkServiceData:function(){var e=this.get_messengerSessionEvents(),t=[],i={};if(null!=e&&null!=e.events)for(var r=e.events,a=r.length-1;a>=0;a--){var c=r[a];if("OnServiceDataChanged"===c[0].toString()){var l=c[1][0];if(null!=l&&l.type!==n.IMAddressInfoType.connect&&(l.address!==this._liveId||l.type!==n.IMAddressInfoType.windowsLive)){var u=s.ContactHelper.getIMAddressInfoKey(l);if(o.keyExists(i,u)){var d=c[1];i[u]=d;var _=new n.ServiceDataSet(d[1]);t.push([l,new n.ServiceDataSet(_.clone().toArray())])}}}}return t},mailNotificationReceived:function(e){var t=this.get_messengerSessionEvents();null!=t&&(i._messengerStatusSnapshotHelper._updateSignInMailNotification(t,e),this._onSnapshotChanged())},_onSnapshotChanged:function(){this._lastModified=new Date},_clearSignedInState:function(){this._networkStatusEvents=null,this._messengerSessionState=null,this._messengerSessionEvents=null}}}()}),define("csservicedatadeletedcommand",["messengerstatussnapshot"],function(){!function(){var e=window,t=e.MSP,n=t._csCommand,i=t._csServiceDataDeletedCommand=function(e,t,i){n.call(this),this._address$1=e,this._serviceData$1=t,this._events$1=i},s=i.prototype=new n;s.constructor=i,s._address$1=null,s._serviceData$1=null,s._events$1=null,s.get_imAddress=function(){return this._address$1},s.get_serviceData=function(){return this._serviceData$1},s.onExecuted=function(){this._events$1.onServiceDataDeleted(this._address$1,this._serviceData$1)}}()}),define("signedincommand",["csservicedatadeletedcommand"],function(){!function(){var e=window,t=e.MC,n=e.MSP,i=n._csCommand,s=n._signedInCommand=function(e,t){this._error$1="",i.call(this),this._events$1=e,this._onCompleted$1=t},o=s.prototype=new i;o.constructor=s,o._events$1=null,o._onCompleted$1=null,o._resultCode$1=null,o._address$1=null,o._serviceData$1=null,o.setResults=function(e,t,n,i){this._resultCode$1=e,this._error$1=t,this._address$1=n,this._serviceData$1=i},o.onExecuted=function(){this._onCompleted$1.invoke(this._resultCode$1,this._error$1),this._resultCode$1===t.ConnectionServiceResultCode.success&&this._events$1.onServiceDataChanged(this._address$1,this._serviceData$1)}}()}),define("cssignoutcommand",["signedincommand"],function(){!function(){var e=window,t=e.MC,n=e.MSP,i=e.MSM,s=e.ss,o=t.ConnectionServiceResultCode,r=n._csCommand,a=n._csSignOutCommand=function(e,t,n,i,s,o,a,c,l){r.call(this),this._identity$1=e,this._userServiceData$1=t,this._locations$1=n,this._initiatedRemotely$1=s,this._connection$1=o,this._service$1=a,this._events$1=c,this._onCompleted$1=l,null!=i&&(this._remoteEndpointIds$1=[],this._remoteEndpointIds$1.addRange(i))},c=a.prototype=new r;c.constructor=a,c._identity$1=null,c._userServiceData$1=null,c._locations$1=null,c._remoteEndpointIds$1=null,c._initiatedRemotely$1=!1,c._connection$1=null,c._service$1=null,c._events$1=null,c._onCompleted$1=null,c._deleteData$1=null,c._delCommand$1=null,c._result$1=0,c.onExecuted=function(){var e=this._signOutRemoteEndpoints$1();this.get_includesLocalEndpoint()?this._connection$1._doOut(s.Delegate.create(this,this._onOut$1)):e||this.complete()},c._onOut$1=function(e){e!==i.MsnpStatusCode.success&&(this._result$1=o.failure),this.complete()},c._signOutRemoteEndpoints$1=function(){return(this._shouldSignOutOfLocation$1(t.SignOutLocationFlags.specificEndpoints)||this._shouldSignOutOfLocation$1(t.SignOutLocationFlags.remoteEndpoints))&&(this._createServiceData$1(),null!=this._deleteData$1)?(this._delCommand$1=new n._csDeleteServiceDataCommand(this._identity$1,this._deleteData$1,this._connection$1,s.Delegate.create(this,this._onDel$1)),this._delCommand$1.execute(),!0):!1},c._shouldSignOut$1=function(e){return e===this._identity$1.endpointId?this.get_includesLocalEndpoint():this._shouldSignOutOfLocation$1(t.SignOutLocationFlags.remoteEndpoints)?!0:this._shouldSignOutOfLocation$1(t.SignOutLocationFlags.specificEndpoints)&&this._remoteEndpointIds$1.contains(e)?!0:!1},c._shouldSignOutOfLocation$1=function(e){return(this._locations$1&e)===e},c._createServiceData$1=function(){var e=this._userServiceData$1.imServiceData;if(null!=e){this._deleteData$1=new t.ServiceDataSet([new t.ServiceDataInfo(t.ServiceType.IM,{},{})]);for(var n=!1,i=s.IEnumerator.getEnumerator(e.getAllEndpoints());i.moveNext();){var o=i.get_current();this._shouldSignOut$1(o.get_endpointId())&&(e.deleteEndpoint(o.get_endpointId()),o.get_endpointId()!==this._identity$1.endpointId&&(this._deleteData$1.addEndpoint(t.ServiceEndpointData.createEmpty(t.ServiceType.IM,o.get_endpointId())),n=!0))}n||(this._deleteData$1=null)}},c.get_includesLocalEndpoint=function(){return this._shouldSignOutOfLocation$1(t.SignOutLocationFlags.localEndpoint)},c.onCompleted=function(){null!=this._onCompleted$1?this._onCompleted$1.invoke(this._result$1):this._initiatedRemotely$1&&this._events$1.onDisconnected(t.ConnectionServiceResultCode.signedOutRoaming,t.SignOutReasonCode.signedOutByRemoteEndpoint,-1),r.prototype.onCompleted.call(this)},c._onDel$1=function(e){this.get_includesLocalEndpoint()||(this._result$1=e,e!==o.success?this.fail():this.complete())}}()}),define("presenceabchangenotificationreceivedcommand",["cssignoutcommand"],function(){!function(){var e=window,t=e.MSP,n=t._csCommand,i=t._abChangeNotificationReceivedCommand=function(e,t){n.call(this),this._events$1=e,this._notificationData$1=t},s=i.prototype=new n;s.constructor=i,s._notificationData$1=null,s._events$1=null,s.onExecuted=function(){this._events$1.onABChangeNotificationReceived(this._notificationData$1)}}()}),define("cstransferredcommand",["presenceabchangenotificationreceivedcommand"],function(){!function(){var e=window,t=e.MSP,n=t._csCommand,i=t._csTransferredCommand=function(e,t,i,s,o){n.call(this),this._hostName$1=e,this._transferState$1=t,this._otherEndpointRequested$1=i,this._service$1=s,this._events$1=o},s=i.prototype=new n;s.constructor=i,s._hostName$1=null,s._transferState$1=null,s._otherEndpointRequested$1=!1,s._service$1=null,s._events$1=null,s.onExecuted=function(){this._service$1.setTransferServer(this._hostName$1,this._transferState$1),this._events$1.onTransferred(this._hostName$1,this._transferState$1,this._otherEndpointRequested$1)}}()}),define("connectionservicestate",["cstransferredcommand"],function(){!function(){var e=window,t=e.MSP;t._connectionServiceState=function(e){this._cxnService=e},t._connectionServiceState.prototype={_cxnService:null,get_service:function(){return this._cxnService},authenticate:function(){},updateBuddySubscriptions:function(){},updateNetworks:function(){},getRecentConversations:function(){},getConversationHistory:function(){},getConversationInfo:function(){},updateConversationProperty:function(){},getGroupInfo:function(){},createGroupConversation:function(){},reportAbuse:function(){},signIn:function(){},signOut:function(){},deleteServiceData:function(){},publishServiceData:function(){},sendPage:function(){},onServiceDataChanged:function(){},onServiceDataDeleted:function(){},onTransferred:function(){},onDisconnected:function(){},onMailNotificationReceived:function(){},onABChangeNotificationReceived:function(){},onPageReceived:function(){}}}()}),define("cssigninginstate",["connectionservicestate"],function(){!function(e){var t=window,n=t.MC,i=t.MSP,s=t.MSH,o=t.ss,r=n.ConnectionServiceResultCode,a=i._connectionServiceState,c=n.SessionServiceOptions,l=i._csSigningInState=function(e){this._queuedCommands$1=[],a.call(this,e)},u=l.prototype=new a;u.constructor=l,u._userServiceDataCommand$1=null,u._updateNetworkSubscriptionCommands$1=null,u._updateSubscriptionsCommand$1=null,u._userServiceDataPublished$1=!1,u._userServiceDataPublishCompleted$1=!1,u._updateNetworkSubscriptionsCompleted$1=!1,u._updateSubscriptionsIssued$1=!1,u._updateSubscriptionsCompleted$1=!1,u._commandQueueEmptied$1=!1,u._signedInCommand$1=null,u._serviceData$1=null,u._serviceOptions$1=c.normal,u.signIn=function(e,t,n,i,s){this._updateSubscriptionsCommand$1=t,this._updateNetworkSubscriptionCommands$1=n,this._userServiceDataCommand$1=i,this._signedInCommand$1=s,this._serviceData$1=this._userServiceDataCommand$1.get_serviceData(),this._serviceOptions$1=e,this._emptyPendingQueue$1(),this._updateSubscriptions$1(),e!==c.notifications&&(this._updateNetworkSubscriptions$1(),this._publishServiceData$1())},u.signOut=function(e){e.get_includesLocalEndpoint()&&this.get_service()._updateState(new i._csSigningOutState(this.get_service(),e)),this.get_service()._execute(e)},u.onServiceDataChanged=function(e){null==this._serviceData$1?this._queuedCommands$1.push(e):s.ContactHelper.areIMAddressesEqual(e.get_imAddress(),this._userServiceDataCommand$1.get_imAddress())?(this._serviceData$1.updateAll(e.get_serviceData().toArray()),this._publishServiceData$1()):this._queuedCommands$1.push(e)},u.onServiceDataDeleted=function(e){null==this._serviceData$1?this._queuedCommands$1.push(e):s.ContactHelper.areIMAddressesEqual(e.get_imAddress(),this._userServiceDataCommand$1.get_imAddress())?this._serviceData$1.deleteAll(e.get_serviceData().toArray()):this._queuedCommands$1.push(e)},u.onPageReceived=function(e){this._queuedCommands$1.push(e)},u.onABChangeNotificationReceived=function(e){this._queuedCommands$1.push(e)},u.onMailNotificationReceived=function(e){this._queuedCommands$1.push(e)},u.onTransferred=function(e){this.get_service()._updateState(new i._csSignedOutState(this.get_service())),this.get_service()._execute(e)},u.onDisconnected=function(e){this.get_service()._updateState(new i._csSignedOutState(this.get_service())),this.get_service()._execute(e)},u._emptyPendingQueue$1=function(){if(this._queuedCommands$1.length>0){n.Logger.logAction("CsSigningInStateSignIn");var e=this._queuedCommands$1;this._queuedCommands$1=[];for(var t=e.length,s=0;t>s;s++){var o=e.shift();o instanceof i._csServiceDataChangedCommand?this.onServiceDataChanged(o):o instanceof i._csServiceDataDeletedCommand?this.onServiceDataDeleted(o):this._queuedCommands$1.push(o)}}this._commandQueueEmptied$1=!0},u._updateSubscriptions$1=function(){this._updateSubscriptionsIssued$1||(this._updateSubscriptionsIssued$1=!0,e(this._updateSubscriptionsCommand$1).bind("completed",o.Delegate.create(this,this._onBuddySubscriptionsCompleted$1)),this.get_service()._execute(this._updateSubscriptionsCommand$1))},u._onBuddySubscriptionsCompleted$1=function(){this._updateSubscriptionsCompleted$1=!0,e(this._updateSubscriptionsCommand$1).unbind("completed",o.Delegate.create(this,this._onBuddySubscriptionsCompleted$1)),this._checkCompleteState$1(this._updateSubscriptionsCommand$1.get_resultCode(),this._updateSubscriptionsCommand$1.get_error())},u._updateNetworkSubscriptions$1=function(){if(null==this._updateNetworkSubscriptionCommands$1)return void(this._updateNetworkSubscriptionsCompleted$1=!0);if(!this._updateNetworkSubscriptionsCompleted$1){this._updateNetworkSubscriptionsCompleted$1=!0;for(var e=o.IEnumerator.getEnumerator(this._updateNetworkSubscriptionCommands$1);e.moveNext();){var t=e.get_current();this.get_service()._execute(t)}this._checkCompleteState$1(r.success,"")}},u._publishServiceData$1=function(){this._userServiceDataPublished$1||this._commandQueueEmptied$1&&(this._userServiceDataPublished$1=!0,e(this._userServiceDataCommand$1).bind("completed",o.Delegate.create(this,this._onServiceDataPublished$1)),this.get_service()._execute(this._userServiceDataCommand$1))},u._onServiceDataPublished$1=function(){this._userServiceDataPublishCompleted$1=!0,e(this._userServiceDataCommand$1).unbind("completed",o.Delegate.create(this,this._onServiceDataPublished$1)),this._checkCompleteState$1(this._userServiceDataCommand$1.get_resultCode(),this._userServiceDataCommand$1.get_error())},u._checkCompleteState$1=function(e,t){(e!==r.success||this._updateNetworkSubscriptionsCompleted$1&&this._userServiceDataPublishCompleted$1&&this._updateSubscriptionsCompleted$1||this._serviceOptions$1===c.notifications&&this._updateSubscriptionsCompleted$1)&&this._completeState$1(e,t)},u._completeState$1=function(e,t){if(this.get_service()._updateState(e===r.success?new i._csSignedInState(this.get_service()):new i._csSignedOutState(this.get_service())),this._signedInCommand$1.setResults(e,t,this._userServiceDataCommand$1.get_imAddress(),this._serviceData$1),this.get_service()._execute(this._signedInCommand$1),e===r.success){for(var n=this._queuedCommands$1.length,s=0;n>s;s++)this.get_service()._execute(this._queuedCommands$1.shift());this.get_service().onSignInEventsEmpty()}}}(window.originaljQuery||jQuery)}),define("cssignedoutstate",["cssigninginstate"],function(){!function(){var e=window,t=e.MSP,n=t._connectionServiceState,i=t._csSignedOutState=function(e){n.call(this,e)},s=i.prototype=new n;s.constructor=i,s.authenticate=function(e){this.get_service()._updateState(new t._csSigningInState(this.get_service())),this.get_service()._execute(e)
}}()}),define("cssignedinstate",["cssignedoutstate"],function(){!function(){var e=window,t=e.MSP,n=t._connectionServiceState,i=t._csSignedInState=function(e){n.call(this,e),e.setTransferServer(null,null)},s=i.prototype=new n;s.constructor=i,s.signOut=function(e){e.get_includesLocalEndpoint()&&this.get_service()._updateState(new t._csSigningOutState(this.get_service(),e)),this.get_service()._execute(e)},s.deleteServiceData=function(e){this.get_service()._execute(e)},s.onServiceDataChanged=function(e){this.get_service()._execute(e)},s.onServiceDataDeleted=function(e){this.get_service()._execute(e)},s.onMailNotificationReceived=function(e){this.get_service()._execute(e)},s.onPageReceived=function(e){this.get_service()._execute(e)},s.onABChangeNotificationReceived=function(e){this.get_service()._execute(e)},s.publishServiceData=function(e){this.get_service()._execute(e)},s.sendPage=function(e){this.get_service()._execute(e)},s.updateBuddySubscriptions=function(e){this.get_service()._execute(e)},s.updateNetworks=function(e){this.get_service()._execute(e)},s.getRecentConversations=function(e){this.get_service()._execute(e)},s.getConversationHistory=function(e){this.get_service()._execute(e)},s.getConversationInfo=function(e){this.get_service()._execute(e)},s.updateConversationProperty=function(e){this.get_service()._execute(e)},s.getGroupInfo=function(e){this.get_service()._execute(e)},s.createGroupConversation=function(e){this.get_service()._execute(e)},s.reportAbuse=function(e){this.get_service()._execute(e)},s.onTransferred=function(e){this.get_service()._updateState(new t._csSignedOutState(this.get_service())),this.get_service()._execute(e)},s.onDisconnected=function(e){this.get_service()._updateState(new t._csSignedOutState(this.get_service())),this.get_service()._execute(e)}}()}),define("cssigningoutstate",["cssignedinstate"],function(){!function(){var e=window,t=e.MSP,n=t._connectionServiceState,i=t._csSigningOutState=function(e,t){n.call(this,e),this._signOutCommand$1=t},s=i.prototype=new n;s.constructor=i,s._signOutCommand$1=null,s.onDisconnected=function(){this.get_service()._updateState(new t._csSignedOutState(this.get_service())),this._signOutCommand$1.complete()}}()}),define("connectionservice",["cssigningoutstate"],function(){!function(){var e=window,t=e.MC,n=e.MSP,i=e.MSCo,s=e.ss,o=t.IConnectionServiceEvents,r=n.ConnectionService=function(e,t,i){o.call(this),this._identity=e,this._events=t,this._isSecure=i,this._currentState=new n._csSignedOutState(this)},a=r.prototype=new o;a.constructor=r,a._identity=null,a._events=null,a._connection=null,a._transferServer=null,a._transferState=null,a._currentState=null,a._isSecure=!1,a.get__identity=function(){return this._identity},a.get_serverName=function(){return null!=this._connection?this._connection.get_serverName():""},a.get_isSignedIn=function(){return this._currentState instanceof n._csSignedInState},a.authenticate=function(e,t,o,r,a){s.isNullOrEmpty(t)&&(t=null!=this._transferServer?this._transferServer:i.Configuration.get_presenceHostName()),null==r&&(r=this._transferState),this._connection=new n._csConnection(this,t,"",this._isSecure),this._connection.set_identity(this._identity),this._currentState.authenticate(new n._authenticateCommand(this._identity,e,r,o,this._connection,a))},a.resumeSession=function(e){if(this._connection=new n._csConnection(this,e.server,e.registrationToken,this._isSecure),this._connection.set_identity(this._identity),this._connection.resume(e.sessionToken,e.transactionID),this._updateState(new n._csSignedInState(this)),null!=e.pendingEvents)for(var t=s.IEnumerator.getEnumerator(e.pendingEvents);t.moveNext();){var i=t.get_current(),o=i[1];switch(i[0]){case"OnDatagramReceived":this.onDatagramReceived(o[0]);break;case"OnABChangeNotificationReceived":this.onABChangeNotificationReceived(o[0]);break;case"OnNetworkStatusChanged":this.onNetworkStatusChanged(i[1],i[2])}}},a.updateNetworks=function(e,t,i){this._currentState.updateNetworks(new n._updateNetworkSubscriptionsCommand(e,t,this._connection,i))},a.updateBuddySubscriptions=function(e,t){this._currentState.updateBuddySubscriptions(new n._updateSubscriptionsCommand(e,this._connection,t))},a.getSession=function(){return null!=this._connection?this._connection.get__sessionInfo():null},a._setCsConnnection=function(e){this._connection=e,null!=this._identity&&this._connection.set_identity(this._identity)},a.sendDatagram=function(e,t){this._currentState.sendPage(new n._csSendDatagramCommand(e,this._connection,t))},a.signIn=function(e,i,s,o){var r=i!==t.SessionServiceOptions.notifications?t.SubscriptionType.presenceAndNotificationSubscribe:t.SubscriptionType.notificationSubscribe,a=new n._updateSubscriptionsCommand(r,this._connection,null),c=null;if(null!=s){c=new Array(s.length);for(var l=0;l<s.length;l++)c[l]=new n._updateNetworkSubscriptionsCommand(s[l],t.NetworkOperationType.enableIM,this._connection,null)}var u=new n._publishServiceDataCommand(this._identity,e,i,this._connection,this._events,!1,null),d=new n._signedInCommand(this._events,o);this._currentState.signIn(i,a,c,u,d)},a.signOut=function(e,t,i,s,o){this._currentState.signOut(new n._csSignOutCommand(this._identity,e,t,i,s,this._connection,this,this._events,o))},a.deleteServiceData=function(e,t){this._currentState.deleteServiceData(new n._csDeleteServiceDataCommand(this._identity,e,this._connection,t))},a.publishServiceData=function(e,t,i){this._currentState.publishServiceData(new n._publishServiceDataCommand(this._identity,e,t,this._connection,this._events,!0,i))},a.getRecentConversations=function(e,t,i){this._currentState.getRecentConversations(new n._csGetRecentConversationsCommand(this._connection,e,t,i))},a.getConversationHistory=function(e,t,i){this._currentState.getConversationHistory(new n._csGetConversationHistoryCommand(this._connection,e,t,i))},a.getConversationInfo=function(e,t){this._currentState.getConversationInfo(new n._csGetConversationInfoCommand(this._connection,e,t))},a.updateConversationProperty=function(e,t,i,s){this._currentState.updateConversationProperty(new n._csUpdateConversationPropertyCommand(this._connection,e,t,i,s))},a.getGroupInfo=function(e,t){this._currentState.getGroupInfo(new n._csGetGroupInfoCommand(this._connection,e,t))},a.createGroupConversation=function(e,t){this._currentState.createGroupConversation(new n._csCreateGroupConversationCommand(this._connection,e,t))},a.reportAbuse=function(e,t){this._currentState.reportAbuse(new n._reportAbuseCommand(this._connection,t,e))},a.onNetworkStatusChanged=function(e,t){this._events.onNetworkStatusChanged(e,t)},a.onTridChanged=function(e){null!=this._events&&this._events!==this&&this._events.onTridChanged(e)},a.onRegistrationTokenChanged=function(e){null!=this._events&&this._events!==this&&this._events.onRegistrationTokenChanged(e)},a.onServiceDataChanged=function(e,t){this._currentState.onServiceDataChanged(new n._csServiceDataChangedCommand(e,t,this._events))},a.onServiceDataDeleted=function(e,t){this._currentState.onServiceDataDeleted(new n._csServiceDataDeletedCommand(e,t,this._events))},a.onMailNotificationReceived=function(e){this._currentState.onMailNotificationReceived(new n._csMailNotificationReceivedCommand(e,this._events))},a.onABChangeNotificationReceived=function(e){this._currentState.onABChangeNotificationReceived(new n._abChangeNotificationReceivedCommand(this._events,e))},a.onDatagramReceived=function(e){this._currentState.onPageReceived(new n._csDatagramReceivedCommand(e,this._events))},a.onDisconnected=function(e,t,i){this._disposeConnection(),this._currentState.onDisconnected(new n._disconnectedCommand(e,this._events,t,i))},a.onTransferred=function(e,t,i){this._disposeConnection(),this._currentState.onTransferred(new n._csTransferredCommand(e,t,i,this,this._events))},a.onSignInEventsEmpty=function(){this._events.onSignInEventsEmpty()},a._disposeConnection=function(){null!=this._connection&&this._connection.dispose()},a._execute=function(e){e.execute()},a._updateState=function(e){this._currentState=e,this._currentState instanceof n._csSignedOutState&&this._disposeConnection()},a.setTransferServer=function(e,t){this._transferServer=e,this._transferState=t},a.abort=function(){this._disposeConnection()},a.pauseSession=function(e){this._connection.pauseSession(e)}}()}),define("identityreauthenticatecommand",["connectionservice"],function(){!function(e){var t=1e4,n=1,i=window,s=i.document,o=i.MC,r=i.MSCo,a=i.MSH,c=i.MSI,l=i.ss,u=o.IdentityServiceResultCode;c._identityReauthenticateCommand=function(e){this._callbacks=[],this._callbacks.push(e)},c._identityReauthenticateCommand.prototype={_callbacks:null,_image:null,_identityIframe:null,_timer:null,_completed:!1,execute:function(){this._timer=new a.Timer(l.Delegate.create(this,this._onTimedOut),null,t,a.Timeout.infinite),this._image=s.createElement("img"),this._image.attachEvent("onload",l.Delegate.create(this,this._onImageLoaded)),this._image.attachEvent("onerror",l.Delegate.create(this,this._onImageLoaded)),this._image.src=r.Configuration.get_silentReauthDetectionUrl()},addCallback:function(e){this._callbacks.push(e)},_registerCallback:function(){window.____ReauthenticationCompleted=l.Delegate.create(this,this._onSucceeded)},_onImageLoaded:function(){this._image.width===n?(this._registerCallback(),this._identityIframe=s.createElement("iframe"),this._identityIframe.style.display="none",this._identityIframe.src=l.format(r.Configuration.get_silentReauthUrlFormat(),encodeURIComponent(r.Configuration.get_reauthCompletedPageUrl())),s.body.appendChild(this._identityIframe)):this._onCompleted(u.failure)},_onSucceeded:function(){null!=this._timer&&(this._timer.dispose(),this._timer=null),this._onCompleted(u.success)},_onTimedOut:function(){this._onCompleted(u.failure)},_onCompleted:function(t){if(!this._completed){this._completed=!0,null!=this._identityIframe&&(s.body.removeChild(this._identityIframe),this._identityIframe=null);for(var n=l.IEnumerator.getEnumerator(this._callbacks);n.moveNext();){var i=n.get_current();i.invoke(t)}e(this).triggerHandler("completed",[this,{}])}}}}(window.originaljQuery||jQuery)}),define("identityservice",["identityreauthenticatecommand"],function(){!function(e){var t=window,n=t.MSI,i=t.ss;n.IdentityService=function(){},n.IdentityService.prototype={_pendingCommand:null,reauthenticate:function(t){null==this._pendingCommand?(this._pendingCommand=new n._identityReauthenticateCommand(t),e(this._pendingCommand).bind("completed",i.Delegate.create(this,this._onReauthenticateCompleted)),this._pendingCommand.execute()):this._pendingCommand.addCallback(t)},_onReauthenticateCompleted:function(){this._pendingCommand=null}}}(window.originaljQuery||jQuery)}),define("messageinfohandler",["identityservice"],function(){!function(){var e="Content-Type",t="Message-Type",n="Safe-Url",i="Message-ID",s="Client-Message-ID",o="IM-Display-Name",r="Original-Arrival-Time",a="X-MMS-IM-Format",c="Text",l="RichText",u="Event/Call",d="Signal/RequestLogs",_="Text/",g="Control/Typing",h="ThreadActivity/AddMember",p="ThreadActivity/DeleteMember",f="ThreadActivity/TopicUpdate",m="ThreadActivity/PictureUpdate",v="RichText/Files",C="RichText/Contacts",y=window,S=y.MC,$=y.MSCh,w=y.MSM,I=y.MSH,b=y.ss,M=S.MessageInfoType,k=S.MessageChannelType,E=S.ThreadActivityMessageType,T={regular:0,bold:1,italic:2,strikeout:4,underline:8},D=$._messageInfoHandler=function(e){this._message=e};D.parseMessageType=function(e){var n=e.getHeader(t);return D.parseMessageTypeText(n)},D.parseMessageTypeText=function(e){switch(e){case c:case l:return M.textMessage;case d:return M.logRequestMessage;case g:return M.typingUserMessage;case u:return M.callEventMessage;case h:case p:case m:case f:case v:case C:return M.threadActivityMessage;default:return e.startsWith(_)?M.textMessage:M.unknownMessage}},D.parseMessage=function(e,t){var n=D.parseMessageType(e),s=null,r=e.get_headers(),a=e.get_body();switch(n){case M.textMessage:s=D.parseTextMessage(r,a);break;case M.callEventMessage:s=D.parseCallEventMessage(a);break;case M.logRequestMessage:s=D.parseLogRequestMessage(a);break;case M.typingUserMessage:s=new S.MessageInfo(n,null);break;case M.threadActivityMessage:s=D.parseThreadActivityMessage(t.get_from(),r,a)}if(null!=s){s.id=e.getHeader(i),s.timestamp=new S.DateInfo(D._getTimestamp(e));var c=e.getHeader(o);if(b.isNullOrEmpty(c)||(c=decodeURIComponent(c)),s.displayNameOverride=c,t.get_service()===S.ServiceType.IM)switch(t.get_channel()){case k.offline:s.isOfflineMessage=!0;break;case k.history:s.isHistoryMessage=!0}}return s},D.createMessagingLayer=function(e){var t=new D(e);return new w.MessagingLayer(t._getHeaders(),t.getBody())},D._getTimestamp=function(e){var t=e.getHeader(r);return b.isNullOrEmpty(t)?new Date:I.DateTimeHelper.parseTimeStamp(t)},D.parseTextMessage=function(e,i){if(b.isNullOrEmpty(i))return null;var o=null,r=e[a];b.isNullOrEmpty(r)||(o=D.parseTextMessageFormat(r));var c=i;e[t]===l&&(c=D.parseRichTextBody(i));var u=new S.TextMessageInfo(c,o),d=e[n];b.isNullOrEmpty(d)||(u.safeUrl=d);var _=new S.MessageInfo(M.textMessage,u),g=e[s];return b.isNullOrEmpty(g)||(_.clientId=g),_},D.parseCallEventMessage=function(e){if(b.isNullOrEmpty(e))return null;var t=parseInt(e);if(!(t>=0))return null;var n=new S.CallEventMessageInfo(t),i=new S.MessageInfo(M.callEventMessage,n);return i},D.parseLogRequestMessage=function(e){var t=b.parseXml(e),n=t.documentElement;if(null==n||!I.XmlHelper.isElement(n,"LogRequest"))return null;for(var i=null,s=null,o=b.IEnumerator.getEnumerator(n.childNodes);o.moveNext();){var r=o.get_current(),a=r.nodeName;switch(a){case"Url":i=r.text;break;case"AuthToken":s=r.text}}if(b.isNullOrEmpty(i)||b.isNullOrEmpty(s))return null;var c=new S.LogRequestMessageInfo(i,s);return new S.MessageInfo(M.logRequestMessage,c)},D.parseThreadActivityMessage=function(e,n,i){var s=E.none;switch(n[t]){case h:s=E.addMember;break;case p:s=E.deleteMember;break;case f:s=E.topicUpdate;break;case m:s=E.pictureUpdate;break;case v:s=E.fileShared;break;case C:s=E.contactShared}try{var o;if(s===E.fileShared||s===E.contactShared)o=new S.ThreadActivityMessageInfo(s,w.Mri.getIMAddressInfo(e),null,null);else{var r=b.parseXml(i),a=r.documentElement,c=a.selectSingleNode("initiator"),l=w.Mri.getIMAddressInfo(new w.Mri(c.text)),u=null,d=a.selectNodes("target");if(d.length>0){u=[];for(var _=b.IEnumerator.getEnumerator(d);_.moveNext();){var g=_.get_current();u.push(w.Mri.getIMAddressInfo(new w.Mri(g.text)))}}var y=null==u?null:u,$=null,I=a.selectSingleNode("value");null!=I&&($=I.text),o=new S.ThreadActivityMessageInfo(s,l,y,$)}return new S.MessageInfo(M.threadActivityMessage,o)}catch(k){return null}},D.parseTextMessageFormat=function(e){for(var t="",n=0,i=T.regular,s=!1,o=e.split(";"),r=b.IEnumerator.getEnumerator(o);r.moveNext();){var a=r.get_current(),c=a.split(a,"=",2);if(2===c.length){var l=c[0].trim(),u=decodeURIComponent(c[1].trim()),d="@|(expression)|\\(|\\\\",_=new RegExp(d,"gi");"FN"!==l||_.test(u)?"EF"===l?(u.indexOf("B")>=0&&(i|=T.bold),u.indexOf("I")>=0&&(i|=T.italic),u.indexOf("U")>=0&&(i|=T.underline),u.indexOf("S")>=0&&(i|=T.strikeout)):"CO"===l?n=16777215&I.ConvertHelper.parseHexInt(u):"RL"===l&&(s="1"===u):t=u}}return new S.TextMessageFormatInfo(n,t,i,s)},D.formatTextMessageFormat=function(e){var t=new b.StringBuilder;t.append("FN="),t.append(encodeURIComponent(e.fontFamily)),t.append("; EF="),(e.fontStyle&T.bold)>0&&t.append("B"),(e.fontStyle&T.italic)>0&&t.append("I"),(e.fontStyle&T.strikeout)>0&&t.append("S"),(e.fontStyle&T.underline)>0&&t.append("U");var n=e.fontColor.toString(16);return t.append("; CO="),t.append(encodeURIComponent(n)),e.rightToLeft&&t.append("; RL=1"),t.toString()},D.toDebugString=function(e){var t=new b.StringBuilder;if(t.append(b.format("Message Type: {0} ",S.enumToString(M,e.type))),e.type===M.textMessage){var n=e.info;t.append(b.format("Text: {0}",n.text))}return null!=e.sender&&t.append(b.format("Sender: {0}:{1} ",e.sender.type,e.sender.address)),t.toString()},D.parseRichTextBody=function(e){var t=e;e.lTrim().toLowerCase().startsWith("<?xml")||(t=b.format('<?xml version="1.0"?><root>{0}</root>',e));try{var n=b.parseXml(t);return D._parseRichTextNode(n.documentElement)}catch(i){return""}},D._parseRichTextNode=function(e){if(1===e.nodeType){var t=e.attributes.getNamedItem("alt");if(b.isNullOrUndefined(t)){for(var n=new b.StringBuilder,i=b.IEnumerator.getEnumerator(e.childNodes);i.moveNext();){var s=i.get_current();n.append(D._parseRichTextNode(s))}return n.toString()}return t.text}return 3===e.nodeType?e.text:""},D._parseBoolean=function(e){var t=e.trim().toLowerCase();if("false"===t)return!1;if("true"===t)return!0;throw new Error("Expected true or false. Received: "+t)},D.prototype={_message:null,_getHeaders:function(){var n={};return n[e]=this._getContentType(),n[t]=this._getMessageType(),n[o]=this._message.displayNameOverride,this.getAdditionalHeaders(n),n},_getContentType:function(){switch(this._message.type){case M.textMessage:case M.typingUserMessage:case M.callEventMessage:return"text/plain; charset=UTF-8";default:return null}},_getMessageType:function(){switch(this._message.type){case M.textMessage:return c;case M.typingUserMessage:return g;case M.callEventMessage:return u;default:return null}},getAdditionalHeaders:function(e){switch(this._message.type){case M.textMessage:var t=this._message.info;null!=t.format&&(e[a]=D.formatTextMessageFormat(t.format)),null!=this._message.clientId&&(e[s]=this._message.clientId)}},getBody:function(){switch(this._message.type){case M.textMessage:return this._message.info.text;case M.callEventMessage:return this._message.info.duration.toString();default:return""}}}}()}),define("messagedatareader",["messageinfohandler"],function(){!function(){var e=window,t=e.MC,n=e.MSCh,i=e.MSM,s=e.MSH,o=e.ss,r=t.MessageInfoType;n._messageDataReader=function(e){this._data=e,this._parsed=!1},n._messageDataReader.prototype={_data:null,_parsed:!1,_message:null,get_parsed:function(){return this._parsed},get_message:function(){return this._message},parse:function(){try{var e=o.parseXml(this._data),a=e.documentElement,c=a.selectSingleNode("messagetype").text,l=n._messageInfoHandler.parseMessageTypeText(c);if(l===r.textMessage||l===r.threadActivityMessage){var u=a.selectSingleNode("content").text,d={};d["Message-Type"]=c;var _=a.selectSingleNode("safeurl");null!=_&&(d["Safe-Url"]=_.text);var g=new i.Mri(a.selectSingleNode("from").text);this._message=this._parseMessageBody(l,g,d,u),this._message.id=a.selectSingleNode("messageid").text,this._message.timestamp=new t.DateInfo(s.DateTimeHelper.parseTimeStamp(a.selectSingleNode("originalarrivaltime").text)),this._message.sender=i.Mri.getIMAddressInfo(g),this._message.isHistoryMessage=!0}this._parsed=!0}catch(h){this._message=null}},_parseMessageBody:function(e,i,s,o){var a;switch(e){case r.textMessage:a=n._messageInfoHandler.parseTextMessage(s,o);break;case r.threadActivityMessage:a=n._messageInfoHandler.parseThreadActivityMessage(i,s,o);break;default:a=new t.MessageInfo(r.textMessage,new t.TextMessageInfo("",null))}return a}}}()}),define("conversationdatareader",["messagedatareader"],function(){!function(){var e=window,t=e.MSCh,n=e.ss;t._conversationDataReader=function(e){this._data=e,this._parsed=!1,this._conversationInfo={},this._messages=[]},t._conversationDataReader.prototype={_data:null,_parsed:!1,_conversationInfo:null,_messages:null,get_parsed:function(){return this._parsed},get_conversationInfo:function(){return null!=this._conversationInfo&&n.getKeyCount(this._conversationInfo)>0?this._conversationInfo:null},parse:function(){try{var e=n.parseXml(this._data),i=e.documentElement;this._conversationInfo.id=i.selectSingleNode("id").text;var s=i.selectSingleNode("properties"),o=s.selectSingleNode("consumptionhorizon");if(null!=o){var r=o.text,a=r.split(";"),c=new Date(parseInt(a[0]));c.setMilliseconds(999),this._conversationInfo.lastreadmessagetimestamp=c,this._conversationInfo.lastreadmessageid=a[2]}var l=s.selectSingleNode("clearedat");null==l||n.isNullOrEmpty(l.text)||(this._conversationInfo.clearedat=l.text);for(var u=i.selectSingleNode("messages"),d=u.selectNodes("message"),_=n.IEnumerator.getEnumerator(d);_.moveNext();){var g=_.get_current(),h=new t._messageDataReader(g.xml);h.parse(),null!=h.get_message()&&(h.get_message().isRecentMessage=!0,this._messages.push(h.get_message()))}if(this._messages.length>0&&(this._conversationInfo.messages=this._messages),this._conversationInfo.id.startsWith("19:")){var p=i.selectSingleNode("thread");this._conversationInfo.threadversion=p.selectSingleNode("version").text,this._conversationInfo.threadtopic=p.selectSingleNode("topic").text}this._parsed=!0}catch(f){this._conversationInfo=null}}}}()}),define("conversationhistorydatareader",["conversationdatareader"],function(){!function(){var e=window,t=e.MSCh,n=e.ss;t._conversationHistoryDataReader=function(e){this._data=e,this._parsed=!1,this._hasMore=!1,this._syncState="",this._messages=[]},t._conversationHistoryDataReader.prototype={_data:null,_parsed:!1,_messages:null,_hasMore:!1,_syncState:null,get_parsed:function(){return this._parsed},get_messages:function(){return null!=this._messages&&this._messages.length>0?this._messages:null},get_hasMore:function(){return this._hasMore},get_syncState:function(){return this._syncState},parse:function(){if(!this._parsed)try{for(var e=n.parseXml(this._data),i=e.documentElement,s=i.selectSingleNode("messages"),o=s.selectNodes("message"),r=n.IEnumerator.getEnumerator(o);r.moveNext();){var a=r.get_current(),c=new t._messageDataReader(a.xml);c.parse(),null!=c.get_message()&&this._messages.push(c.get_message())}this._messages.sort(n.Delegate.create(this,this._compareMessages));var l=i.selectSingleNode("messagessyncstate");this._syncState=l.text;var u=i.selectSingleNode("hasmore");this._hasMore=t._messageInfoHandler._parseBoolean(u.text),this._parsed=!0}catch(d){this._hasMore=!1,this._syncState="",this._messages=null}},_compareMessages:function(e,t){return e.timestamp.utcMilliseconds-t.timestamp.utcMilliseconds}}}()}),define("groupconversationerrordatareader",["conversationhistorydatareader"],function(){!function(){var e=window,t=e.MC,n=e.MSCh,i=e.MSM,s=e.MSH,o=e.ss;n._groupConversationErrorDataReader=function(e){this._data=e,this._parsed=!1},n._groupConversationErrorDataReader.prototype={_data:null,_parsed:!1,_threadId:null,_failedMembers:null,get_parsed:function(){return this._parsed},get_threadId:function(){return this._threadId},get_failedMembers:function(){return this._failedMembers},parse:function(){try{var e=o.parseXml(this._data),n=e.documentElement;this._threadId=s.XmlHelper.xmlNodeValue(n.selectSingleNode("id"));var r=n.selectSingleNode("errors");if(null!=r){for(var a=r.selectNodes("error"),c=[],l=o.IEnumerator.getEnumerator(a);l.moveNext();){var u=l.get_current(),d=parseInt(u.selectSingleNode("code").text);if(735!=d){var _=u.selectSingleNode("mri"),g=i.Mri.getIMAddressInfo(new i.Mri(_.text));c.push(new t.GroupConversationMemberInfo(g,null))}}this._failedMembers=c}this._parsed=!0}catch(h){}}}}()}),define("groupconversationdatareader",["groupconversationerrordatareader"],function(){!function(){var e=window,t=e.MC,n=e.MSCh,i=e.MSM,s=e.MSH,o=e.ss;n._groupConversationDataReader=function(e){this._data=e,this._parsed=!1},n._groupConversationDataReader.prototype={_data:null,_parsed:!1,_groupConversationInfo:null,get_parsed:function(){return this._parsed},get_groupConversationInfo:function(){return this._groupConversationInfo},parse:function(){try{var e=o.parseXml(this._data),r=e.documentElement,a=s.XmlHelper.xmlNodeValue(r.selectSingleNode("id")),c=r.selectSingleNode("properties");if(a.endsWith("p2p.thread.skype")){var l=c.selectSingleNode("migrationcompleted");if(o.isNullOrUndefined(l)||!n._messageInfoHandler._parseBoolean(l.text))return}var u=s.XmlHelper.xmlNodeValue(r.selectSingleNode("version"));this._groupConversationInfo=new t.GroupConversationInfo(a,parseInt(u));for(var d=r.selectSingleNode("members"),_=d.selectNodes("member"),g=[],h=o.IEnumerator.getEnumerator(_);h.moveNext();){var p=h.get_current(),f=p.selectSingleNode("mri"),m=new i.Mri(f.text),v=p.selectSingleNode("linkedmri");if(null!=v){var C=new i.Mri(v.text);g.push(new t.GroupConversationMemberInfo(i.Mri.getIMAddressInfo(m),i.Mri.getIMAddressInfo(C)))}else g.push(new t.GroupConversationMemberInfo(i.Mri.getIMAddressInfo(m),null))}this._groupConversationInfo.members=g;var y=s.XmlHelper.xmlNodeValue(c.selectSingleNode("creator"));this._groupConversationInfo.creator=i.Mri.getIMAddressInfo(new i.Mri(y));var S=c.selectSingleNode("topic");null!=S&&(this._groupConversationInfo.title=n._messageInfoHandler.parseRichTextBody(S.text)),this._parsed=!0}catch($){this._groupConversationInfo=null}}}}()}),define("recentconversationsdatareader",["groupconversationdatareader"],function(){!function(){var e=window,t=e.MSCh,n=e.ss;t._recentConversationsDataReader=function(e){this._data=e,this._parsed=!1,this._hasMore=!1,this._syncState="",this._conversations=[]},t._recentConversationsDataReader.prototype={_data:null,_parsed:!1,_conversations:null,_hasMore:!1,_syncState:null,get_parsed:function(){return this._parsed},get_conversations:function(){return null!=this._conversations&&this._conversations.length>0?this._conversations:null},get_hasMore:function(){return this._hasMore},get_syncState:function(){return this._syncState},parse:function(){if(!this._parsed)try{var e=n.parseXml(this._data),i=e.documentElement,s=i.selectSingleNode("conversations");if(null!=s){for(var o=s.selectNodes("conversation"),r=n.IEnumerator.getEnumerator(o);r.moveNext();){var a=r.get_current(),c=new t._conversationDataReader(a.xml);c.parse();var l=c.get_conversationInfo();null!=l&&null!=l.id&&null!=l.messages&&this._conversations.push(l)}this._conversations.sort(n.Delegate.create(this,this._compareConversations))}var u=i.selectSingleNode("syncstate");this._syncState=u.text;var d=i.selectSingleNode("hasmore");this._hasMore=t._messageInfoHandler._parseBoolean(d.text),this._parsed=!0}catch(_){this._hasMore=!1,this._syncState="",this._conversations=null}},_compareConversations:function(e,t){var n=e.messages[0],i=t.messages[0];return n.timestamp.utcMilliseconds-i.timestamp.utcMilliseconds}}}()}),define("messagingcontext",["recentconversationsdatareader"],function(){!function(){{var e=window,t=e.MC,n=e.MSCh,i=e.MSM,s=e.ss;t.MessageInfoType}n.MessagingContext=function(e,t,n,i,s){this._messagingService=e,this._messagingEvents=n,this._userService=t,this._self=i,this._recipient=s},n.MessagingContext.prototype={_messagingService:null,_messagingEvents:null,_userService:null,_self:null,_recipient:null,_initialAddress:null,_initialAddressAdded:!1,get__from:function(){return this._self},get__to:function(){return this._recipient},sendMessage:function(e,t){var i=new n._sendPagedMessageCommand(this._messagingService,this,e,t);this._execute(i)},addMembers:function(e,t){var i=new n._addMembersCommand(this._messagingService,this,this._recipient.toString(),e,t);i.execute()},removeMembers:function(e,t){var i=new n._removeMembersCommand(this._messagingService,this,this._recipient.toString(),e,t);i.execute()},close:function(){},_onMessageReceived:function(e,t,n){n.sender=i.Mri.getIMAddressInfo(e),this._self.equals(e,i.MriCompareOptions.address)&&(n.isOfflineMessage=!1),this._messagingEvents.onReceivedMessage(e,n)},_onSendMessageFailed:function(e,t,n){this._messagingEvents.onSendMessageFailed(e,t,n)},_onAddressLeft:function(e,t,n){for(var i=s.IEnumerator.getEnumerator(n);i.moveNext();){var o=i.get_current();this._messagingEvents.onAddressLeft(o)}},_onAddressJoined:function(e,t,n){for(var o=s.IEnumerator.getEnumerator(n);o.moveNext();){var r=o.get_current();this._self.equals(r,i.MriCompareOptions.address)&&!this._initialAddressAdded&&null!=this._initialAddress?this._initialAddressAdded=!0:this._messagingEvents.onAddressJoined(r)}},_onAddressPending:function(e,t,n,o){1===n.length&&1===o.length&&this._self.equals(n[0],i.MriCompareOptions.address)&&(this._recipient=e,this._messagingService.updateSession(o[0],e));for(var r=s.IEnumerator.getEnumerator(n);r.moveNext();){var a=r.get_current();if(this._self.equals(a,i.MriCompareOptions.address))break}},_setInitialAddress:function(e){this._initialAddress=e},_execute:function(e){e.execute()}}}()}),define("conversationstate",["messagingcontext"],function(){!function(){var e=window,t=e.MC,n=e.MSCh,i=e.MSM,s=t.IMAddressInfoType;n._conversationState=function(e){e&&(this._conversation=e,this._messagingContext=e.get_messaging(),this._events=e.get_conversationEvents())},n._conversationState.create=function(e,t){var i=null;switch(e.get_addressType()){case s.none:case s.officeCommunicator:case s.windowsLive:case s.cid:case s.skype:case s.smtp:case s.telephone:case s.connect:case s.shortCircuit:i=new n._pageState(e,t);break;case s.temporaryGroup:i=new n._groupState(t)}return i},n._conversationState.prototype={_conversation:null,_events:null,_messagingContext:null,addMembers:null,removeMembers:null,onAddressJoined:null,onAddressLeft:null,get_conversation:function(){return this._conversation},get_events:function(){return this._events},get_messagingContext:function(){return this._messagingContext},sendMessage:function(e,t){this.get_messagingContext().sendMessage(e,t)},onMessageReceived:function(e,t){this._conversation.get_isExposed()||this._conversation.expose(),t.sender=i.Mri.getIMAddressInfo(e),this._conversation.get_service().onConversationMessageReceived(this._conversation.get_id(),t)},onOpened:function(){},onClosed:function(){this._conversation.get_service().onConversationClosed(this._conversation.get_id())},close:function(){this._messagingContext.close()}}}()}),define("conversation",["conversationstate"],function(){!function(){var e=5e3,t=window,n=t.MC,i=t.MSCh,s=t.MSM,o=t.MSH,r=t.ss,a=n.ConnectionServiceResultCode,c=n.MessageInfoType,l=n.Logger;i._conversation=function(e,t,o,r,a,c){this._consumptionHorizon=null,this._clearedAt=null,this._roster=[],this._id=e,this._service=t,this._events=r,this._mri=a,this._roster.push(this._mri),this._pendingMessages={};var l=new s.Mri(e);l.get_addressType()===n.IMAddressInfoType.temporaryGroup&&(c=l),this._messaging=o.getMessagingContext(this._mri,c,this),this._currentState=i._conversationState.create(c,this)},i._conversation.prototype={_service:null,_messaging:null,_events:null,_mri:null,_roster:null,_id:null,_messageSyncState:null,_hasMoreHistory:!0,_currentState:null,_pendingMessages:null,_isExposed:!1,_getInfoPending:!1,_getHistoryPending:!1,_consumptionHorizonUpdateTimer:null,_consumptionHorizonUpdateWhenReady:!1,_consumptionHorizonUpdateThrottled:!1,get_id:function(){return this._id},get_conversationEvents:function(){return this._events},get_messaging:function(){return this._messaging},get_service:function(){return this._service},get_mri:function(){return this._mri},get_isExposed:function(){return this._isExposed},set_isExposed:function(e){return this._isExposed=e,e},get_clearedAt:function(){return this._clearedAt},set_clearedAt:function(e){this._clearedAt!==e&&(this._clearedAt=e)},get_consumptionHorizon:function(){return this._consumptionHorizon},set_consumptionHorizon:function(e){this._consumptionHorizon&&this._consumptionHorizon.lastReadMessageId===e.lastReadMessageId&&this._consumptionHorizon.lastReadMessageTimestamp===e.lastReadMessageTimestamp||(this._consumptionHorizon=e)},get_roster:function(){return this._roster},open:function(){this._isExposed=!0},close:function(){this._currentState.close(),this._consumptionHorizon=null,this._disposeConsumptionHorizonUpdateTimer()},addMembers:function(e,t){this._currentState.addMembers(e,t)},removeMembers:function(e,t){this._currentState.removeMembers(e,t)},sendMessage:function(e,t){this._currentState.sendMessage(e,t),l.logAction("ChatConversationSendMessage")},updateState:function(e){this._currentState=e},updateId:function(e){var t=this._id;this._id=e,this._service.conversationUpdateId(t,e)},updateConsumptionHorizon:function(e){this.set_consumptionHorizon(e),this.get_consumptionHorizon()==e&&this._sendConsumptionHorizonUpdate()
},expose:function(){if(!this._isExposed){for(var e=this._roster.length,t=new Array(e),n=0;e>n;n++)t[n]=s.Mri.getIMAddressInfo(this._roster[n]);this._isExposed=!0,this._service.conversationExpose(this._id,t,this.get_consumptionHorizon())}},rosterAdd:function(e){null==this._findExistingAddress(e)&&this._roster.push(e)},rosterRemove:function(e){if(e=this._findExistingAddress(e),null!=e&&this._roster.length>2&&(this._roster.remove(e),0===this._roster.length)){var t=this.findOtherAddress(),n=t.toConversationId();this._service.isValidConversation(n)||this.updateId(n)}},isRosterAddress:function(e){return null!=this._findExistingAddress(e)},findOtherAddress:function(){var e=this._roster[0];return e.get_address()===this.get_mri().get_address()?this._roster.length>1?this._roster[1]:null:e},getHistory:function(){var e=this;if(e._getInfoPending)return void(e._getHistoryPending=!0);if(e._hasMoreHistory){var t={};t.startTime=(new Date).getTime(),t.scenario=n.WebmainHelper.startQoS(n.WebmainHelper.qoSScenarioConversationHistory),e._service.getConversationHistory(e._id,e._messageSyncState,function(n,i){r.Delegate.create(e,e._onGetHistoryCompleted)(n,i,t),$Do.register("WACUnreadCountNeedsRecompute")})}else e._events.onConversationHistoryMessagesReceived(e._id,null,!1)},getInfo:function(e){e&&(this._getInfoPending=!0,this._service.getConversationInfo(this._id,r.Delegate.create(this,this._onGetInfoCompleted)))},_sendConsumptionHorizonUpdate:function(){if(this._consumptionHorizonUpdateThrottled)return void(this._consumptionHorizonUpdateWhenReady=!0);this._consumptionHorizonUpdateWhenReady=!1;var e=new Array(3);e[0]=this.get_consumptionHorizon().lastReadMessageTimestamp.getTime().toString(),e[1]=(new Date).getTime().toString(),e[2]=this.get_consumptionHorizon().lastReadMessageId,this._service.updateConversationProperty(this._id,"consumptionhorizon",e.join(";"),null),this._scheduleConsumptionHorizonUpdateTimer()},_onConsumptionHorizonUpdateTimeout:function(){this._consumptionHorizonUpdateThrottled=!1,this._consumptionHorizonUpdateWhenReady&&this._sendConsumptionHorizonUpdate()},_scheduleConsumptionHorizonUpdateTimer:function(){null==this._consumptionHorizonUpdateTimer?this._consumptionHorizonUpdateTimer=new o.Timer(r.Delegate.create(this,this._onConsumptionHorizonUpdateTimeout),null,e,o.Timeout.infinite):this._consumptionHorizonUpdateTimer.change(e,o.Timeout.infinite),this._consumptionHorizonUpdateThrottled=!0},_disposeConsumptionHorizonUpdateTimer:function(){null!=this._consumptionHorizonUpdateTimer&&(this._consumptionHorizonUpdateTimer.dispose(),this._consumptionHorizonUpdateTimer=null),this._consumptionHorizonUpdateThrottled=!1,this._consumptionHorizonUpdateWhenReady=!1},_onGetHistoryCompleted:function(e,t,o){this.expose();var a=null,c=null;if(e!==s.MsnpStatusCode.success||r.isNullOrEmpty(t))c=r.format("{0}-{1}",e,n.enumToString(s.MsnpStatusCode,e)),this._hasMoreHistory=!1;else{var l=new i._conversationHistoryDataReader(t);l.parse(),l.get_parsed()||(c="Client - Conversation History response parsing failed."),null!=l.get_messages()&&(l.get_messages()[l.get_messages().length-1].isLastHistoryMessage=!0,a=l.get_messages()),this._messageSyncState=l.get_syncState(),this._hasMoreHistory=l.get_hasMore()}n.WebmainHelper.addQoSStats(n.WebmainHelper.qoSApiConversationHistory,c,o.startTime,o.scenario,!1),n.WebmainHelper.stopQoS(o.scenario,null==c,c),this._events.onConversationHistoryMessagesReceived(this._id,a,this._hasMoreHistory)},_onGetInfoCompleted:function(e,t){this._getInfoPending=!1;var s=null;if(e===a.success&&!r.isNullOrEmpty(t))try{var o=r.parseXml(t),c=o.documentElement,l=c.selectSingleNode("conversations"),u=l.selectNodes("conversation");if(null!=u){var d=new i._conversationDataReader(u[0].xml);d.parse();var _=d.get_conversationInfo().lastreadmessageid,g=d.get_conversationInfo().lastreadmessagetimestamp;(_||g)&&this.set_consumptionHorizon(new n.ConsumptionHorizonInfo(_,g));var h=d.get_conversationInfo().clearedat;r.isNullOrUndefined(h)||this.set_clearedAt(h),null!=d.get_conversationInfo()&&null!=d.get_conversationInfo().messages&&(s=d.get_conversationInfo().messages[0])}}catch(p){}null==s?(this._hasMoreHistory=!1,this._events.onConversationHistoryMessagesReceived(this._id,null,this._hasMoreHistory)):(this._service.onConversationMessageReceived(this._id,s),this._getHistoryPending&&this.getHistory()),this._getHistoryPending=!1},onAddressLeft:function(e){this._currentState.onAddressLeft(e),l.logAction("ChatConversationOnAddressLeft")},onAddressJoined:function(e){this._currentState.onAddressJoined(e),l.logAction("ChatConversationOnAddressJoined")},onOpened:function(){this._currentState.onOpened(),l.logAction("ChatConversationOnOpened")},onClosed:function(){this._isExposed=!1,this._consumptionHorizon=null,this._currentState.onClosed(),this._disposeConsumptionHorizonUpdateTimer(),l.logAction("ChatConversationOnClosed")},onNotificationReceived:function(e){var t=e.lastreadmessageid,i=e.lastreadmessagetimestamp;if(t||i){var s=new n.ConsumptionHorizonInfo(t,i);this.set_consumptionHorizon(s),this.get_consumptionHorizon()==s&&this._service.onConversationConsumptionHorizonUpdated(this.get_id(),this.get_consumptionHorizon())}this.get_clearedAt()!=e.clearedat&&(this.set_clearedAt(e.clearedat),this._service.onConversationClearedAtUpdated(this.get_id(),this.get_clearedAt()))},onReceivedMessage:function(e,t){(this._isExposed||t.type!==c.typingUserMessage)&&(this._messaging.get__to().get_addressType()===n.IMAddressInfoType.temporaryGroup&&e.equals(this._messaging.get__from(),s.MriCompareOptions.addressAndEpId)||(this._currentState.onMessageReceived(e,t),l.logAction("ChatConversationOnReceivedMessage")))},onSendMessageFailed:function(e,t,n){t.type!==c.typingUserMessage&&(this._events.onConversationSendMessageFailed(this.get_id(),e,t,n),l.logResult("ChatConversationOnSendMessageFailed",e))},_findExistingAddress:function(e){for(var t=r.IEnumerator.getEnumerator(this._roster);t.moveNext();){var n=t.get_current();if(e.get_address()===n.get_address()&&e.get_addressType()===n.get_addressType())return n}return null}}}()}),define("conversationservice",["conversation"],function(){!function(){var e=window,t=e.MC,n=e.MSCh,i=e.MSM,s=e.ss,o=t.IMAddressInfoType,r=t.MessengerServiceResultCode,a=t.ConnectionServiceResultCode,c=t.GroupChatPhase,l=new Date;l.setMonth(-1);var u=new Date;u.setMonth(-4),n.ConversationService=function(e,t,i){this._identity=e,this._service=t,this._serviceEvents=i,this.conversations={},this._messagingService=new n.MessagingService(e,this,this._service,s.Delegate.create(this,this.onIncomingRequest)),this._syncStartTime=l},n.ConversationService.prototype={conversations:null,_service:null,_serviceEvents:null,_messagingService:null,_identity:null,_syncState:null,_syncStartTime:null,_pendingConversations:[],_hasMoreRecentConversations:!0,get_cid:function(){return this._identity.cid},get_liveId:function(){return this._identity.liveId},get_skypeId:function(){return this._identity.skypeId},get_localEndpoint:function(){return this._identity.endpointId},isValidConversation:function(e){return null!=this._getConversationById(e)},_getConversationById:function(e){return s.keyExists(this.conversations,e)?this.conversations[e]:null},conversationCreate:function(e,t,s){var o;if(null==this._getConversationById(e)){var r=this._createUserMri(t.type,null),a=i.Mri.create(t.address,t.type,null,null,t.network);o=new n._conversation(e,this,this._messagingService,this,r,a),o.open(s),o.getInfo(s),this.conversations[e]=o}else o=this.conversations[e],o.open(s)},conversationCreateGroup:function(e){this._service.createConversationGroup(e,s.Delegate.create(this,this._onConversationGroupCreated))},conversationSendMessage:function(e,t,n){var i=this._getConversationById(e);null!=i&&i.sendMessage(t,n)},conversationAddMembers:function(e,t,n){var i=this._getConversationById(e);null!=i&&i.addMembers(t,n)},conversationRemoveMembers:function(e,t,n){var i=this._getConversationById(e);null!=i&&i.removeMembers(t,n)},conversationClose:function(e,t){var n=this._getConversationById(e);null!=n&&(n.close(t),n.get_roster().length>2?delete this.conversations[e]:n.set_isExposed(!1))},conversationDelete:function(e,n,o){var r=this,a=r._getConversationById(e);if(null!=a)if(a.set_isExposed(!1),delete r.conversations[e],a.get_clearedAt()!=n){var c={};c.startTime=(new Date).getTime(),c.scenario=t.WebmainHelper.startQoS(t.WebmainHelper.qoSScenarioDeleteConversations),r._service.updateConversationProperty(e,"clearedat",n,function(e){var n=null;e!=i.MsnpStatusCode.success&&(n=s.format("{0}-{1}",e,t.enumToString(i.MsnpStatusCode,e))),t.WebmainHelper.addQoSStats(t.WebmainHelper.qoSApiDeleteConversations,n,c.startTime,c.scenario,!1),t.WebmainHelper.stopQoS(c.scenario,null==n,n),o.invoke(e)})}else o.invoke(i.MsnpStatusCode.success)},conversationExpose:function(e,t,n){this._service.conversationExpose(e,t,n);var i=this._getConversationById(e);null!=i&&i.set_isExposed(!0)},conversationUpdateId:function(e,t){var n=this.conversations[e],i=s.keyExists(this.conversations,t);i&&n.set_isExposed(this.conversations[t].get_isExposed()),this.conversations[t]=n,delete this.conversations[e],n.get_isExposed()&&!i&&this._service.conversationUpdateId(e,t)},conversationUpdateConsumptionHorizon:function(e,t){var n=this._getConversationById(e);null!=n&&n.updateConsumptionHorizon(t)},conversationGetRecentList:function(){var e={};e.startTime=(new Date).getTime(),e.scenario=t.WebmainHelper.startQoS(t.WebmainHelper.qoSScenarioRecentConversations);var n=this;n._service.getRecentConversations(n._syncState,n._syncStartTime,function(t,i){s.Delegate.create(n,n._onGetRecentConversationsCompleted)(t,i,e)})},conversationGetHistory:function(e){var t=this._getConversationById(e);null!=t&&t.getHistory()},getConversationHistory:function(e,t,n){this._service.getConversationHistory(e,t,n)},getConversationInfo:function(e,t){this._service.getConversationInfo(e,t)},updateConversationProperty:function(e,t,n,i){this._service.updateConversationProperty(e,t,n,i)},getGroupInfo:function(e,t,n){this._service.getGroupInfo(e,t,n)},sendDatagram:function(e,t,n){this._service.sendDatagram(e,t,n)},onDatagramReceived:function(e){if(e.datagramType===t.DatagramInfoType.imGroupPut)this._onConversationGroupNotificationReceived(e.payload);else if(e.datagramType===t.DatagramInfoType.conversationPut){var i=new n._conversationDataReader(e.payload);i.parse();var s=i.get_conversationInfo();if(s){var o=this._getConversationById(s.id);o&&o.onNotificationReceived(s)}return}this._messagingService.onDatagramReceived(e)},onIncomingRequest:function(e,s){var r=this._createUserMri(e.get_addressType(),e.get_appId()),a=e.toConversationId(),c=i.Mri.create(e.get_address(),e.get_addressType(),null,e.get_appId(),e.get_networkId()),l=new n._conversation(a,this,this._messagingService,this,r,c);return e.get_addressType()===o.temporaryGroup&&s.datagramType===t.DatagramInfoType.sdg?(l.close(!1),!1):(this.conversations[a]=l,!0)},close:function(e){e&&this._closeAllConversations()},onConversationAddMembersCompleted:function(e,i,s,o){var r=new n._groupConversationErrorDataReader(s);r.parse();var a=r.get_failedMembers();this._serviceEvents.onConversationAddMembersCompleted(e,a&&a.length>0?i:t.GroupConversationOperationResult.success,a,o)},onConversationRemoveMembersCompleted:function(e,i,s,o){var r=new n._groupConversationErrorDataReader(s);r.parse();var a=r.get_failedMembers();this._serviceEvents.onConversationRemoveMembersCompleted(e,a&&a.length>0?i:t.GroupConversationOperationResult.success,a,o)},onConversationAddressJoined:function(e,t){this._serviceEvents.onConversationAddressJoined(e,t)},onConversationAddressLeft:function(e,t){this._serviceEvents.onConversationAddressLeft(e,t)},onConversationMessageReceived:function(e,t){this._serviceEvents.onConversationMessageReceived(e,t)},onConversationHistoryMessagesReceived:function(e,t,n){this._serviceEvents.onConversationHistoryMessagesReceived(e,t,n)},onConversationConsumptionHorizonUpdated:function(e,t){this._serviceEvents.onConversationConsumptionHorizonUpdated(e,t)},onConversationClearedAtUpdated:function(e,t){this._serviceEvents.onConversationClearedAtUpdated(e,t)},onConversationClosed:function(e){this._serviceEvents.onConversationClosed(e)},onConversationSendMessageFailed:function(e,n,i,s){var o=r.failure;switch(n){case t.SendDatagramResultCode.tooLong:o=r.messageTooLong;break;case t.SendDatagramResultCode.recipientInvalid:o=r.messageRecipientInvalid;break;case t.SendDatagramResultCode.recipientDisabled:o=r.messageRecipientDisabled}this._serviceEvents.onConversationSendMessageFailed(e,o,i,s)},_closeAllConversations:function(){var e=[],t=this.conversations;for(var n in t){var i={key:n,value:t[n]};e.push(i.key)}for(var o=s.IEnumerator.getEnumerator(e);o.moveNext();){var r=o.get_current();this.conversationClose(r,!1)}},_createUserMri:function(e,t){var n;return n=e===o.cid?i.Mri.create(this.get_cid(),o.cid,this.get_localEndpoint(),t,null):e!==o.skype&&e!==o.temporaryGroup||s.isNullOrEmpty(this.get_skypeId())?e!==o.shortCircuit||s.isNullOrEmpty(this.get_cid())?i.Mri.create(this.get_liveId(),o.windowsLive,this.get_localEndpoint(),null,null):i.Mri.create(this.get_cid(),o.shortCircuit,this.get_localEndpoint(),null,null):i.Mri.create(this.get_skypeId(),o.skype,this.get_localEndpoint(),null,null)},_onConversationGroupCreated:function(e,r){if(e===a.success||e===a.partialFailure){var c=new n._groupConversationErrorDataReader(r);c.parse();var l=c.get_threadId();if(!s.isNullOrEmpty(l)){var u=this._createUserMri(o.skype,null),d=new i.Mri(c.get_threadId()),_=new n._conversation(l,this,this._messagingService,this,u,d);_.open(!0),this.conversations[l]=_;var g=new t.GroupConversationInfo(l,0);if(g.creator=new t.IMAddressInfo(this._identity.skypeId,o.skype,t.RoleLists.none),g.userInitiated=!0,this._serviceEvents.onConversationGroupCreated(g,_.get_consumptionHorizon()),e===a.partialFailure){var h=this,p=c.get_failedMembers();window.setTimeout(function(){h._serviceEvents.onConversationAddMembersCompleted(l,p&&p.length>0?e:t.GroupConversationOperationResult.success,p,null)},2e3)}}}},_onConversationGroupNotificationReceived:function(e){if(t.GroupChatFeatures.phase!==c.disabled){var r=new n._groupConversationDataReader(e);if(r.parse(),null!=r.get_groupConversationInfo()){var a=r.get_groupConversationInfo().id,l=!1,u=this.conversations[a];if(null==u){var d=this._createUserMri(o.skype,null),_=new i.Mri(a);u=new n._conversation(a,this,this._messagingService,this,d,_),this.conversations[a]=u,l=!0}u.get_roster().length=0;for(var g=s.IEnumerator.getEnumerator(r.get_groupConversationInfo().members);g.moveNext();){var h=g.get_current();u.rosterAdd(i.Mri.createFromIMAddressInfo(h.address)),null!=h.linkedAddress&&u.rosterAdd(i.Mri.createFromIMAddressInfo(h.linkedAddress))}l?this._serviceEvents.onConversationGroupCreated(r.get_groupConversationInfo(),u.get_consumptionHorizon()):this._serviceEvents.onConversationGroupUpdated(r.get_groupConversationInfo())}}},_onGetRecentConversationsCompleted:function(e,o,r){var a=null;if(e!==i.MsnpStatusCode.success||s.isNullOrEmpty(o))a=s.format("{0}-{1}",e,t.enumToString(i.MsnpStatusCode,e)),this._hasMoreRecentConversations=!1;else{var c=new n._recentConversationsDataReader(o);c.parse(),c.get_parsed()||(a="Client - Recent Conversations response parsing failed."),null!=c.get_conversations()&&(this._pendingConversations=this._pendingConversations.concat(c.get_conversations())),this._syncState=c.get_syncState(),this._hasMoreRecentConversations=c.get_hasMore()}t.WebmainHelper.addQoSStats(t.WebmainHelper.qoSApiRecentConversations,a,r.startTime,r.scenario,!1),t.WebmainHelper.stopQoS(r.scenario,null==a,a),this._hasMoreRecentConversations?this.conversationGetRecentList():(this._syncStartTime==l&&(this._syncStartTime=u,this._syncState=null,this._hasMoreRecentConversations=!0),this._processRecentConversations(this._pendingConversations),this._pendingConversations=[],this._serviceEvents.onConversationGetRecentListCompleted(this._hasMoreRecentConversations,e!==i.MsnpStatusCode.success))},_processRecentConversations:function(e){for(var r=[],a=s.IEnumerator.getEnumerator(e);a.moveNext();){var l=a.get_current(),u=l.id,d=new i.Mri(u),_=d.get_addressType();if(_===o.windowsLive||_===o.skype||_===o.connect||_===o.temporaryGroup||_===o.shortCircuit){var g=this._createUserMri(d.get_addressType(),null);if(!(g.equals(d,i.MriCompareOptions.address)||_===o.temporaryGroup&&t.GroupChatFeatures.phase===c.disabled)){var h=this._getConversationById(u);if(!h){h=new n._conversation(u,this,this._messagingService,this,g,d),this.conversations[u]=h;var p=l.lastreadmessageid,f=l.lastreadmessagetimestamp;(p||f)&&h.set_consumptionHorizon(new t.ConsumptionHorizonInfo(p,f));var m=l.clearedat;s.isNullOrUndefined(m)||h.set_clearedAt(m);var v=l.messages[0];if(d.get_addressType()===o.temporaryGroup){r.push(u);var C=new t.GroupConversationInfo(u,parseInt(l.threadversion));C.members=[new t.GroupConversationMemberInfo(v.sender,null)],C.title=l.threadtopic,this._serviceEvents.onConversationGroupCreated(C,h.get_consumptionHorizon()),this._serviceEvents.onConversationMessageReceived(C.id,v)}else h.expose(),this.onConversationMessageReceived(u,v)}}}}if(r.length>0){var y,S=50,$=r.length%S,w=r.length-$;for(y=0;w>y;y+=S)this.getGroupInfo(r.slice(y,y+S),s.Delegate.create(this,this._onGetGroupInfoCompleted));this.getGroupInfo(r.slice(y,y+$),s.Delegate.create(this,this._onGetGroupInfoCompleted))}},_onGetGroupInfoCompleted:function(e,t){if(e!==a.success||s.isNullOrEmpty(t))Debug.trace;else try{for(var o=s.parseXml(t),r=o.documentElement,c=r.selectSingleNode("threads"),l=c.selectNodes("thread"),u=s.IEnumerator.getEnumerator(l);u.moveNext();){var d=u.get_current(),_=new n._groupConversationDataReader(d.xml);_.parse();var g=_.get_groupConversationInfo();if(g){var h=this._getConversationById(g.id);h.get_roster().length=0;for(var p=s.IEnumerator.getEnumerator(_.get_groupConversationInfo().members);p.moveNext();){var f=p.get_current();h.rosterAdd(i.Mri.createFromIMAddressInfo(f.address)),null!=f.linkedAddress&&h.rosterAdd(i.Mri.createFromIMAddressInfo(f.linkedAddress))}this._serviceEvents.onConversationGroupUpdated(g)}}}catch(m){}}}}()}),define("groupstate",["conversationservice"],function(){!function(){var e=window,t=e.MSCh,n=e.MSM,i=e.ss,s=t._conversationState,o=t._groupState=function(e){s.call(this,e),this._userInvitedAddress$1={}},r=o.prototype=new s;r.constructor=o,r._userInvitedAddress$1=null,r.addMembers=function(e){this.get_messagingContext().addMembers(e,i.Delegate.create(this,this._onAddMembersCompleted$1))},r.removeMembers=function(e){this.get_messagingContext().removeMembers(e,i.Delegate.create(this,this._onRemoveMembersCompleted$1))},r.onAddressJoined=function(e){var t=new n.Mri(this.get_conversation().get_id());if(t.equals(this.get_messagingContext().get__to(),n.MriCompareOptions.address)||this.get_conversation().updateId(this.get_messagingContext().get__to().toConversationId()),!this.get_conversation().isRosterAddress(e)){this.get_conversation().rosterAdd(e);var s=n.Mri.getIMAddressInfo(e);i.keyExists(this._userInvitedAddress$1,e.get_address())&&(this._getUserState$1(e),this._removeInvitedAddress$1(e)),this.get_conversation().get_isExposed()?this.get_events().onConversationAddressJoined(this.get_conversation().get_id(),s):this.get_conversation().expose()}},r.onAddressLeft=function(e){if(this.get_conversation().isRosterAddress(e)){this.get_conversation().rosterRemove(e),this._removeInvitedAddress$1(e);var t=n.Mri.getIMAddressInfo(e);this.get_events().onConversationAddressLeft(this.get_conversation().get_id(),t)}},r._removeInvitedAddress$1=function(e){i.keyExists(this._userInvitedAddress$1,e.get_address())&&delete this._userInvitedAddress$1[e.get_address()]},r._getUserState$1=function(e){if(i.keyExists(this._userInvitedAddress$1,e.get_address())){var t=this._userInvitedAddress$1[e.get_address()];return t[1]}return null},r._onAddMembersCompleted$1=function(e,t){this.get_events().onConversationAddMembersCompleted(this.get_conversation().get_id(),e,t,null)},r._onRemoveMembersCompleted$1=function(e,t){this.get_events().onConversationRemoveMembersCompleted(this.get_conversation().get_id(),e,t,null)}}()}),define("pagestate",["groupstate"],function(){!function(){var e=window,t=e.MSCh,n=t._conversationState,i=t._pageState=function(e,t){n.call(this,t),this._initialAddress$1=e,this.get_conversation().rosterAdd(e)},s=i.prototype=new n;s.constructor=i,s._initialAddress$1=null,s.addMembers=function(){},s.removeMembers=function(){},s.onAddressJoined=function(e){var n=new t._groupState(this.get_conversation());this.get_conversation().updateState(n),n.onAddressJoined(e)},s.onAddressLeft=function(){}}()}),define("messagingcommand",["pagestate"],function(){!function(e){var t=window,n=t.MSCh;n._messagingCommand=function(e){this._userState=e},n._messagingCommand.prototype={_userState:null,_completed:!1,onExecuted:null,get_userState:function(){return this._userState},execute:function(){this.onExecuted()},complete:function(){this._completed||(this._completed=!0,e(this).triggerHandler("completed",[this,{}]))}}}(window.originaljQuery||jQuery)}),define("pagedmessagingcommand",["messagingcommand"],function(){!function(){var e=window,t=e.MSCh,n=e.MSM,i=e.ss,s=t._messagingCommand,o=t._pagedMessagingCommand=function(e,t,n){s.call(this,n),this._service$1=e,this._context$1=t},r=o.prototype=new s;r.constructor=o,r._context$1=null,r._service$1=null,r._routingLayer$1=null,r._reliabilityLayer$1=null,r.get_messagingContext=function(){return this._context$1},r.get_routing=function(){return null==this._routingLayer$1&&(this._routingLayer$1=new n.RoutingLayer(this._context$1.get__to(),this._context$1.get__from())),this._routingLayer$1},r.get_reliability=function(){return null==this._reliabilityLayer$1&&(this._reliabilityLayer$1=new n.ReliabilityLayer),this._reliabilityLayer$1},r.sendMessage=function(e){this._service$1.sendDatagram(e,i.Delegate.create(this,this.onSendCompleted),this.get_userState())},r.onSendCompleted=function(){this.complete()}}()}),define("removememberscommand",["pagedmessagingcommand"],function(){!function(){var e="<thread><id>{0}</id><members>{1}</members></thread>",t="<member><mri>{0}</mri></member>",n=window,i=n.MC,s=n.MSCh,o=n.MSM,r=n.ss,a=s._pagedMessagingCommand,c=s._removeMembersCommand=function(e,t,n,i,s){a.call(this,e,t,null),this._id$2=n,this._members$2=i,this._onCompleted$2=s},l=c.prototype=new a;l.constructor=c,l._members$2=null,l._id$2=null,l._onCompleted$2=null,l.get_delDocument=function(){for(var n=new r.StringBuilder,i=0;i<this._members$2.length;i++){var s=this._members$2[i];n.append(r.format(t,o.Mri.createFromIMAddressInfo(s.address).toString()))}return r.format(e,this._id$2,n.toString())},l.onExecuted=function(){var e=new i.DatagramInfo(i.DatagramInfoType.imGroupDel,this.get_delDocument());this.sendMessage(e)},l.onSendCompleted=function(e,t){a.prototype.onSendCompleted.call(this,e,t);var n=i.GroupConversationOperationResult.success;e!==i.SendDatagramResultCode.success&&(n=i.GroupConversationOperationResult.failure),null!=this._onCompleted$2&&this._onCompleted$2.invoke(n,t?t.payload:null)}}()}),define("pagedmessagereceivedcommand",["removememberscommand"],function(){!function(){var e=window,t=e.MC,n=e.MSCh,i=t.DatagramInfoType,s=n._pagedMessagingCommand,o=n._pagedMessageReceivedCommand=function(e,t){s.call(this,null,e,null),this._message$2=t},r=o.prototype=new s;r.constructor=o,r._message$2=null,r.onExecuted=function(){var e;switch(this._message$2.get_pageType()){case i.sdg:var t=this._message$2.get_routing(),s=this._message$2.get_content(),o=n._messageInfoHandler.parseMessage(s,t);if(null==o)return;this.get_messagingContext()._onMessageReceived(this._message$2.get_routing().get_from(),this._message$2.get_routing().get_to(),o);break;case i.imGroupPut:e=this._message$2.get_content(),this.get_messagingContext()._onAddressPending(this._message$2.get_routing().get_from(),this._message$2.get_routing().get_to(),e.get_pendingUsers(),e.get_users()),this.get_messagingContext()._onAddressJoined(this._message$2.get_routing().get_from(),this._message$2.get_routing().get_to(),e.get_users());break;case i.imGroupDel:e=this._message$2.get_content(),this.get_messagingContext()._onAddressLeft(this._message$2.get_routing().get_from(),this._message$2.get_routing().get_to(),e.get_users())}}}()}),define("addmemberscommand",["pagedmessagereceivedcommand"],function(){!function(){var e="<thread><id>{0}</id><members>{1}</members></thread>",t="<member><mri>{0}</mri><role>{1}</role></member>",n=window,i=n.MC,s=n.MSCh,o=n.MSM,r=n.ss,a=i.GroupConversationOperationResult,c=i.SendDatagramResultCode,l=s._pagedMessagingCommand,u=s._addMembersCommand=function(e,t,n,i,s){l.call(this,e,t,null),this._id$2=n,this._invitedParties$2=i,this._onCompleted$2=s},d=u.prototype=new l;d.constructor=u,d._invitedParties$2=null,d._id$2=null,d._onCompleted$2=null,d.get_putDocument=function(){for(var n=new r.StringBuilder,i=0;i<this._invitedParties$2.length;i++){var s=this._invitedParties$2[i];n.append(r.format(t,o.Mri.createFromIMAddressInfo(s.address).toString(),this._invitedParties$2[i].isAdmin?"admin":"user"))}return r.format(e,this._id$2,n.toString())},d.onExecuted=function(){var e=new i.DatagramInfo(i.DatagramInfoType.imGroupPut,this.get_putDocument());this.sendMessage(e)},d.onSendCompleted=function(e,t){l.prototype.onSendCompleted.call(this,e,t);var n=a.success;e===c.partialFailure?n=a.partialFailure:e!==c.success&&(n=a.failure),null!=this._onCompleted$2&&this._onCompleted$2.invoke(n,t.payload)}}()}),define("sendpagedmessagecommand",["addmemberscommand"],function(){!function(){var e=window,t=e.MC,n=e.MSCh,i=e.MSM,s=t.SendDatagramResultCode,o=t.ServiceType,r=t.MessageInfoType,a=n._pagedMessagingCommand,c=n._sendPagedMessageCommand=function(e,t,n,i){a.call(this,e,t,i),this._messageInfo$2=n},l=c.prototype=new a;l.constructor=c,l._messageInfo$2=null,l.onExecuted=function(){var e=this.get_routing();null!=this._messageInfo$2.targetEndpointId&&(e=new i.RoutingLayer(i.Mri.create(this.get_routing().get_to().get_address(),this.get_routing().get_to().get_addressType(),this._messageInfo$2.targetEndpointId,null,null),this.get_routing().get_from()),e.set_disableSelfFanOut(!0)),this._messageInfo$2.isOfflineMessage&&(e.set_service(o.IM),e.set_channel(t.MessageChannelType.offline)),(e.get_to().get_addressType()===t.IMAddressInfoType.smtp||e.get_to().get_addressType()===t.IMAddressInfoType.telephone)&&(e.set_service(o.IM),e.set_channel(t.MessageChannelType.mobile));var s=n._messageInfoHandler.createMessagingLayer(this._messageInfo$2);s.set_appId(this.get_messagingContext().get__from().get_appId());var r=new i.PagedMessage(t.DatagramInfoType.sdg,e,this.get_reliability(),s),a=new t.DatagramInfo(t.DatagramInfoType.sdg,r.payLoad());this.sendMessage(a)},l.onSendCompleted=function(e,t){if(e===s.recipientNotAcceptingIMs&&this._messageInfo$2.type===r.textMessage){var n=this._messageInfo$2.info.text;n.length<=400&&(this._messageInfo$2.isOfflineMessage=!0,this.get_messagingContext().sendMessage(this._messageInfo$2,this.get_userState()),e=s.success)}e!==s.success&&this.get_messagingContext()._onSendMessageFailed(e,this._messageInfo$2,this.get_userState()),a.prototype.onSendCompleted.call(this,e,t)}}()}),define("messagingservice",["sendpagedmessagecommand"],function(){!function(){var e=window,t=e.ss,n=e.MC,i=e.MSCh,s=e.MSM,o=n.DatagramInfoType,r=n.IMAddressInfoType;i.MessagingService=function(e,t,n,i){this._identity=e,this._service=t,this._msgrService=n,this._onUnboundMessage=i,this._contexts={}},i.MessagingService.prototype={_identity:null,_service:null,_contexts:null,_onUnboundMessage:null,_msgrService:null,getMessagingContext:function(e,t,n){var s=this._getContext(t);return null==s&&(s=new i.MessagingContext(this,this._msgrService,n,e,t),this._contexts[this._getSessionKey(t)]=s),s},onDatagramReceived:function(e){var t=s.PagedMessage.createPagedMessage(e.datagramType,e.payload);if(null!=t){var r=t.get_routing().get_from(),a=t.get_routing().get_to();if(t.get_pageType()===o.sdg){var c=t.get_routing(),l=t.get_content();if(this._isSelfMri(c.get_to())&&this._isSelfMri(c.get_from())){var u=i._messageInfoHandler.parseMessageType(l);if(u===n.MessageInfoType.logRequestMessage)return}}if(t.get_pageType()===o.imGroupPut){var d=t.get_content();d.get_notificationType()===s.NotificationType.fullNotify&&1===d.get_pendingUsers().length&&1===d.get_users().length&&(r=d.get_users()[0],a=d.get_pendingUsers()[0])}var _=this._getOtherMri(r,a),g=this._getOrCreateContext(_,e);if(null!=g){var h=new i._pagedMessageReceivedCommand(g,t);h.execute()}}},sendDatagram:function(e,t,n){this._service.sendDatagram(e,t,n)},shutdown:function(){},updateSession:function(e,t){var n=this._getContext(e);null!=n&&(delete this._contexts[this._getSessionKey(e)],this._contexts[this._getSessionKey(t)]=n)},deleteSession:function(e){var t=this._getContext(e);null!=t&&delete this._contexts[this._getSessionKey(e)]},_getSessionKey:function(e){return t.format("{0}:{1}",e.get_addressType(),e.get_address())},_getContext:function(e){var n=this._getSessionKey(e);return t.keyExists(this._contexts,n)?this._contexts[n]:null},_getOrCreateContext:function(e,t){var i=this._getContext(e);return null==i&&this._onUnboundMessage.invoke(e,t)&&(i=this._getContext(e),null==i&&n.Logger.logAction("OnDatagramReceivedGetMessagingContextFailure")),i},_getOtherMri:function(e,n){var i=e;return e.get_addressType()===r.temporaryGroup?e:n.get_addressType()===r.temporaryGroup?n:(e.get_addressType()===r.windowsLive?i=0===t.compare(this._identity.liveId,e.get_address())?n:e:e.get_addressType()===r.skype?i=0===t.compare(this._identity.skypeId,e.get_address())?n:e:(e.get_addressType()===r.shortCircuit||e.get_addressType()===r.cid)&&(i=0===t.compare(this._identity.cid,e.get_address())?n:e),i)},_isSelfMri:function(e){var t=s.Mri.create(this._identity.liveId,r.windowsLive,null,null,e.get_networkId());return t.equals(e,s.MriCompareOptions.address)}}}()}),define("servicecommand",["messagingservice"],function(){!function(e){var t=window,n=t.MSCr;n._serviceCommand=function(){},n._serviceCommand.prototype={_startTime:null,_executing:!1,_succeeded:!1,_completed:!1,onExecuted:null,onCompleted:null,get_succeeded:function(){return this._succeeded},execute:function(){this._startTime=new Date,this._executing=!0,this.onExecuted()},timeOut:function(){this._completed||(this._completed=!0,this.onCompleted())},fail:function(){this._completed||(this._completed=!0,this.onCompleted())},complete:function(){this._completed||(this._completed=!0,this._succeeded=!0,this.onCompleted(),e(this).triggerHandler("completed",[this,{}]))}}}(window.originaljQuery||jQuery)}),define("abchangenotificationreceivedcommand2",["servicecommand"],function(){!function(){var e=window,t=e.MSCr,n=t._serviceCommand,i=t._abChangeNotificationReceivedCommand=function(e,t){n.call(this),this._notificationData$1=e,this._events$1=t},s=i.prototype=new n;s.constructor=i,s._notificationData$1=null,s._events$1=null,s.onExecuted=function(){this.complete()},s.onCompleted=function(){this._events$1.onABChangeNotificationReceived(this._notificationData$1)}}()}),define("updateconversationpropertycommand",["abchangenotificationreceivedcommand2"],function(){!function(){var e=window,t=e.MSCr,n=e.ss,i=t._serviceCommand,s=t._updateConversationPropertyCommand=function(e,t,n,s,o){i.call(this),this._id$1=t,this._propertyName$1=n,this._propertyValue$1=s,this._connService$1=e,this._callback$1=o},o=s.prototype=new i;o.constructor=s,o._connService$1=null,o._callback$1=null,o._id$1=null,o._propertyName$1=null,o._propertyValue$1=null,o.onExecuted=function(){this._connService$1.updateConversationProperty(this._id$1,this._propertyName$1,this._propertyValue$1,n.Delegate.create(this,this._onSendMessageCompleted$1))},o.onCompleted=function(){},o._onSendMessageCompleted$1=function(e){null!=this._callback$1&&this._callback$1.invoke(e),this.complete()}}()}),define("getgroupinfocommand",["updateconversationpropertycommand"],function(){!function(){var e=window,t=e.MSCr,n=e.ss,i=t._serviceCommand,s=t._getGroupInfoCommand=function(e,t,n,s){i.call(this),this._ids$1=t,this._connService$1=e,this._callback$1=n,this._state$1=s
},o=s.prototype=new i;o.constructor=s,o._connService$1=null,o._callback$1=null,o._ids$1=null,o._state$1=null,o.onExecuted=function(){this._connService$1.getGroupInfo(this._ids$1,n.Delegate.create(this,this._onSendMessageCompleted$1))},o.onCompleted=function(){},o._onSendMessageCompleted$1=function(e,t){null!=this._callback$1&&this._callback$1.invoke(e,t,this._state$1),this.complete()}}()}),define("getconversationinfocommand",["getgroupinfocommand"],function(){!function(){var e=window,t=e.MSCr,n=e.ss,i=t._serviceCommand,s=t._getConversationInfoCommand=function(e,t,n){i.call(this),this._id$1=t,this._connService$1=e,this._callback$1=n},o=s.prototype=new i;o.constructor=s,o._connService$1=null,o._callback$1=null,o._id$1=null,o.onExecuted=function(){this._connService$1.getConversationInfo(this._id$1,n.Delegate.create(this,this._onSendMessageCompleted$1))},o.onCompleted=function(){},o._onSendMessageCompleted$1=function(e,t){null!=this._callback$1&&this._callback$1.invoke(e,t),this.complete()}}()}),define("getrecentconversationscommand",["getconversationinfocommand"],function(){!function(){var e=window,t=e.MSCr,n=e.ss,i=t._serviceCommand,s=t._getRecentConversationsCommand=function(e,t,n,s){i.call(this),this._syncState$1=t,this._syncStartTime=n,this._connService$1=e,this._callback$1=s},o=s.prototype=new i;o.constructor=s,o._connService$1=null,o._callback$1=null,o._syncState$1=null,o._syncStartTime=null,o.onExecuted=function(){this._connService$1.getRecentConversations(this._syncState$1,this._syncStartTime,n.Delegate.create(this,this._onSendMessageCompleted$1))},o.onCompleted=function(){},o._onSendMessageCompleted$1=function(e,t){null!=this._callback$1&&this._callback$1.invoke(e,t),this.complete()}}()}),define("creategroupconversationcommand",["getrecentconversationscommand"],function(){!function(){var e=window,t=e.MSCr,n=e.ss,i=t._serviceCommand,s=t._createGroupConversationCommand=function(e,t,n){i.call(this),this._connService$1=e,this._members$1=t,this._onCompleted$1=n},o=s.prototype=new i;o.constructor=s,o._connService$1=null,o._onCompleted$1=null,o._members$1=null,o.onExecuted=function(){this._connService$1.createGroupConversation(this._members$1,n.Delegate.create(this,this._onCreateThreadCompleted$1))},o.onCompleted=function(){},o._onCreateThreadCompleted$1=function(e,t){null!=this._onCompleted$1&&this._onCompleted$1.invoke(e,t),this.complete()}}()}),define("datagramreceivedcommand",["creategroupconversationcommand"],function(){!function(){var e=window,t=e.MSCr,n=t._serviceCommand,i=t._datagramReceivedCommand=function(e,t){n.call(this),this._convService$1=e,this._message$1=t},s=i.prototype=new n;s.constructor=i,s._convService$1=null,s._message$1=null,s.onExecuted=function(){this._convService$1.onDatagramReceived(this._message$1)},s.onCompleted=function(){}}()}),define("mailnotificationreceivedcommand",["datagramreceivedcommand"],function(){!function(){var e=window,t=e.MSCr,n=t._serviceCommand,i=t._mailNotificationReceivedCommand=function(e,t){n.call(this),this._events$1=t,this._notification$1=e},s=i.prototype=new n;s.constructor=i,s._notification$1=null,s._events$1=null,s.onExecuted=function(){this._events$1.onMailNotification(this._notification$1)},s.onCompleted=function(){}}()}),define("networkstatuschangereceivedcommand",["mailnotificationreceivedcommand"],function(){!function(){var e=window,t=e.MSCr,n=t._serviceCommand,i=t._networkStatusChangeReceivedCommand=function(e,t,i,s){n.call(this),this._networkId$1=e,this._status$1=t,this._events$1=i,this._snapshot$1=s},s=i.prototype=new n;s.constructor=i,s._networkId$1=null,s._status$1=null,s._events$1=null,s._snapshot$1=null,s.onExecuted=function(){this.complete()},s.onCompleted=function(){this._events$1.onNetworkStatusChanged(this._networkId$1,this._status$1),this._snapshot$1.onNetworkStatusChanged(this._networkId$1,this._status$1)}}()}),define("senddatagramcommand",["networkstatuschangereceivedcommand"],function(){!function(){var e=window,t=e.MSCr,n=e.ss,i=t._serviceCommand,s=t._sendDatagramCommand=function(e,t,n,s){i.call(this),this._message$1=e,this._connService$1=t,this._callback$1=n,this._userState$1=s},o=s.prototype=new i;o.constructor=s,o._message$1=null,o._connService$1=null,o._callback$1=null,o._userState$1=null,o.onExecuted=function(){this._connService$1.sendDatagram(this._message$1,n.Delegate.create(this,this._onSendMessageCompleted$1))},o.onCompleted=function(){},o._onSendMessageCompleted$1=function(e,t){null!=this._callback$1&&this._callback$1.invoke(e,t)}}()}),define("getconversationhistorycommand",["senddatagramcommand"],function(){!function(){var e=window,t=e.MSCr,n=e.ss,i=t._serviceCommand,s=t._getConversationHistoryCommand=function(e,t,n,s){i.call(this),this._id$1=t,this._syncState$1=n,this._connService$1=e,this._callback$1=s},o=s.prototype=new i;o.constructor=s,o._connService$1=null,o._callback$1=null,o._id$1=null,o._syncState$1=null,o.onExecuted=function(){this._connService$1.getConversationHistory(this._id$1,this._syncState$1,n.Delegate.create(this,this._onSendMessageCompleted$1))},o.onCompleted=function(){},o._onSendMessageCompleted$1=function(e,t){null!=this._callback$1&&this._callback$1.invoke(e,t),this.complete()}}()}),define("servicedatachangedcommand",["getconversationhistorycommand"],function(){!function(){var e=window,t=e.MC,n=e.MSCr,i=n._serviceCommand,s=n._serviceDataChangedCommand=function(e,t,n,s,o){i.call(this),this._address$1=e,this._serviceData$1=t,this._userIdentity$1=n,this._snapshot$1=s,this._events$1=o},o=s.prototype=new i;o.constructor=s,o._address$1=null,o._serviceData$1=null,o._userIdentity$1=null,o._snapshot$1=null,o._events$1=null,o.get_address=function(){return this._address$1},o.onExecuted=function(){this.complete()},o.onCompleted=function(){var e=this._snapshot$1.serviceDataChanged(this._address$1,this._serviceData$1,!1);this._address$1.type===t.IMAddressInfoType.windowsLive&&this._address$1.address===this._userIdentity$1.liveId&&(e=this._serviceData$1.toArray()),this._events$1.onServiceDataChanged(this._address$1,e)}}()}),define("servicedatadeletedcommand",["servicedatachangedcommand"],function(){!function(){var e=window,t=e.MC,n=e.MSCr,i=e.ss,s=t.ServiceType,o=t.SessionServiceOptions,r=n._serviceCommand,a=n._serviceDataDeletedCommand=function(e,t,n,i,s,o,a,c){r.call(this),this._address$1=e,this._serviceData$1=t,this._service$1=n,this._identity$1=i,this._snapshot$1=s,this._connService$1=o,this._convService$1=a,this._events$1=c},c=a.prototype=new r;c.constructor=a,c._address$1=null,c._serviceData$1=null,c._identity$1=null,c._snapshot$1=null,c._connService$1=null,c._convService$1=null,c._events$1=null,c._service$1=null,c._removedUserServices$1=s.none,c._remoteEndpointsRemoved$1=!1,c._bubbleEvent$1=!1,c.onExecuted=function(){this._detectRemoteSignOut$1(),this.complete()},c.onCompleted=function(){this._bubbleEvent$1&&this._deleteEndpoints$1()},c._detectRemoteSignOut$1=function(){if(this._address$1.type!==t.IMAddressInfoType.windowsLive||this._address$1.address!==this._identity$1.liveId)return void(this._bubbleEvent$1=!0);if(this._filterEndpoints$1(),this._removedUserServices$1===s.none||this._snapshot$1.get_switchingServices())return this._remoteEndpointsRemoved$1&&this._deleteEndpoints$1(),this._removedUserServices$1!==s.none&&this._snapshot$1.set_switchingServices(!1),void this._checkForOfflineStatus$1();switch(this._snapshot$1.get_services()){case o.full:this._remoteEndpointsRemoved$1&&this._deleteEndpoints$1(),this._service$1.updateServices(o.notifications,!1,null);break;default:this._service$1.signOut(t.SignOutLocationFlags.localEndpoint,null,!1,null)}},c._checkForOfflineStatus$1=function(){if(this._removedUserServices$1!==s.none||this._snapshot$1.get_services()!==o.normal&&this._snapshot$1.get_services()!==o.full){var e=new t.ServiceDataSet(this._snapshot$1.getServiceDataInfo(this._address$1));if(!(e.imServiceData.getAllEndpoints().length>1)){var n=t.ServiceData.createEmpty(s.IM);n.set_status(t.PresenceInfoStatus.offline),this._events$1.onServiceDataChanged(this._address$1,[n.get_info()])}}},c._filterEndpoints$1=function(){this._removedUserServices$1=s.none;for(var e=i.IEnumerator.getEnumerator(this._serviceData$1.toServiceDataArray());e.moveNext();){var t=e.get_current();null!=t.getEndpoint(this._identity$1.endpointId)&&(this._removedUserServices$1|=t.get_service(),t.deleteEndpoint(this._identity$1.endpointId)),0!==t.getAllEndpoints().length&&(this._remoteEndpointsRemoved$1=!0)}},c._deleteEndpoints$1=function(){this._snapshot$1.serviceDataChanged(this._address$1,this._serviceData$1,!0),this._events$1.onServiceDataDeleted(this._address$1,this._serviceData$1.toArray())}}()}),define("signedoutremotelycommand",["servicedatadeletedcommand"],function(){!function(){var e=window,t=e.MC,n=e.MSCr,i=n._serviceCommand,s=t.ConnectionServiceResultCode,o=n._signedOutRemotelyCommand=function(e,t,n,s,o){i.call(this),this._convService$1=e,this._events$1=t,this._resultCode$1=n,this._reason$1=s,this._reconnectWaitTime$1=o},r=o.prototype=new i;r.constructor=o,r._convService$1=null,r._events$1=null,r._resultCode$1=s.success,r._reason$1=0,r._reconnectWaitTime$1=0,r.onExecuted=function(){var e=this._resultCode$1===s.signedOutRoaming;this._convService$1.close(e),this.complete()},r.onCompleted=function(){this._events$1.onSignedOutRemotely(this._reason$1,this._reconnectWaitTime$1)}}()}),define("signincommand",["signedoutremotelycommand"],function(){!function(){var e=window,t=e.MSCr,n=e.MSH,i=e.MC,s=e.MSCo,o=e.ss,r=e.Microsoft.Live.Messenger.Services.SkyJSHelper,a=i.ConnectionServiceResultCode,c=i.MessengerServiceResultCode,l=t._serviceCommand,u=t._signInCommandStates=function(){};u.initial=0,u.authenticated=1,u.needsToReauth=2,u.reauthenticated=4,u.signedIn=8;var d=t._signInCommand=function(e,t,n,i,o,r,a,c,u,d){this._error$1="",l.call(this),this._serviceData$1=e.clone(),this._services$1=t,this._reconnect$1=n,this._connectNetworks$1=i,this._snapshot$1=r,this._connService$1=a,this._identityService$1=c,this._callback$1=u,this._userState$1=d,this._clientId$1=s.Configuration.get_clientDomain(),this._startTime$1=new Date,this._identity$1=o},_=d.prototype=new l;_.constructor=d,_._connService$1=null,_._callback$1=null,_._identityService$1=null,_._identity$1=null,_._reconnect$1=!1,_._connectNetworks$1=null,_._userState$1=null,_._clientId$1=null,_._state$1=u.initial,_._serviceData$1=null,_._services$1=0,_._snapshot$1=null,_._startTime$1=null,_._resultCode$1=c.success,_.get__reauthenticationInProgress$1=function(){return this._stateContains$1(u.needsToReauth)&&!this._stateContains$1(u.reauthenticated)},_.onTransferred=function(e,t){this._connService$1.authenticate(this._clientId$1,e,this._services$1,t,o.Delegate.create(this,this._onAuthenticated$1))},_.onDisconnected=function(){this.get__reauthenticationInProgress$1()||(i.Logger.logAction("SignInCommandOnDisconnected"),this._error$1="SignInCommand.OnDisconnected - Transferred",this._process$1(c.transferred))},_.onExecuted=function(){this._process$1(c.success)},_.onCompleted=function(){null!=this._callback$1&&(this._resultCode$1===c.success?this._updateSnapshot$1():this._resultCode$1===c.unauthenticated&&this._snapshot$1.expire(),this._callback$1.onSignedIn(this._resultCode$1,this._error$1,n.DateTimeHelper.subtract(new Date,this._startTime$1).toString(),this._connService$1.get_serverName(),this._identity$1.skypeId,this._userState$1))},_._authenticate$1=function(){this._connService$1.authenticate(this._clientId$1,null,this._services$1,null,o.Delegate.create(this,this._onAuthenticated$1))},_._onAuthenticated$1=function(e,t){if(e!==a.success)switch(this._error$1=t,e){case a.unauthenticated:this._process$1(c.unauthenticated);break;default:this._process$1(c.failure)}else this._state$1|=u.authenticated,this._process$1(c.success)},_._onReauthenticated$1=function(e){return e!==i.IdentityServiceResultCode.success?void this._process$1(c.unauthenticated):(this._state$1|=u.reauthenticated,void this._authenticate$1())},_._onSignedIn$1=function(e,t){this._state$1|=u.signedIn,e!==a.success?(this._error$1=t,this._process$1(c.failure)):this._process$1(c.success)},_._process$1=function(e){if(e!==c.success)return this._resultCode$1=e,void this.fail();if(this._state$1===u.initial)return void this._authenticate$1();if(this._stateContains$1(u.signedIn))return this._resultCode$1=c.success,void this.complete();if(this._stateContains$1(u.authenticated)){var t=r.skypeAudioVideoEnabled;return t&&!o.isNullOrEmpty(this._identity$1.skypeId)&&this._serviceData$1.skpServiceData.set_skypeName(this._identity$1.skypeId),void this._connService$1.signIn(this._serviceData$1,this._services$1,this._connectNetworks$1,o.Delegate.create(this,this._onSignedIn$1))}return this._stateContains$1(u.needsToReauth)?void this._identityService$1.reauthenticate(o.Delegate.create(this,this._onReauthenticated$1)):void 0},_._updateSnapshot$1=function(){this._snapshot$1.set_messengerSessionState(this._getMessengerSessionState$1()),this._snapshot$1.set_messengerSessionEvents(new i.MessengerSessionEvents([]))},_._getMessengerSessionState$1=function(){var e=this._connService$1.getSession(),t=new i.MessengerSessionState(e.server,e.sessionToken,e.transactionID,this._services$1,!1,this._identity$1);return t.registrationToken=e.registrationToken,t},_._stateContains$1=function(e){return(this._state$1&e)===e}}()}),define("signoutcommand",["signincommand"],function(){!function(){var e=window,t=e.MC,n=e.MSCr,i=e.ss,s=t.SignOutLocationFlags,o=t.SignOutReasonCode,r=t.MessengerServiceResultCode,a=n._serviceCommand,c=n._signOutCommand=function(e,t,n,i,s,o,r,c,l){a.call(this),this._userServiceData$1=e,this._locations$1=t,this._endpointIds$1=n,this._initiatedRemotely$1=i,this._connService$1=s,this._convService$1=o,this._callback$1=c,this._userState$1=l,this._snapshot$1=r},l=c.prototype=new a;l.constructor=c,l._userServiceData$1=null,l._locations$1=s.none,l._endpointIds$1=null,l._initiatedRemotely$1=!1,l._connService$1=null,l._convService$1=null,l._callback$1=null,l._userState$1=null,l._resultCode$1=0,l._snapshot$1=null,l.get_includesLocalEndpoint=function(){return(this._locations$1&s.localEndpoint)===s.localEndpoint},l.onExecuted=function(){this.get_includesLocalEndpoint()&&this._convService$1.close(!0),this._connService$1.signOut(this._userServiceData$1,this._locations$1,this._endpointIds$1,this._initiatedRemotely$1,i.Delegate.create(this,this._onSignedOut$1))},l.onCompleted=function(){this.get_includesLocalEndpoint()&&this._snapshot$1.onSignedOut(this._initiatedRemotely$1?o.signedOutByRemoteEndpoint:o.signedOutByLocalEndpoint),this._initiatedRemotely$1?this._callback$1.onSignedOutRemotely(o.signedOutByRemoteEndpoint,-1):this._callback$1.onSignedOut(this._resultCode$1,this._locations$1,this._userState$1)},l._onSignedOut$1=function(e){e===t.ConnectionServiceResultCode.success?(this._resultCode$1=r.success,this.complete()):(this._resultCode$1=r.failure,this.fail())}}()}),define("transferredcommand",["signoutcommand"],function(){!function(){var e=window,t=e.MC,n=e.MSCr,i=n._serviceCommand,s=n._transferredCommand=function(e,t,n,s,o){i.call(this),this._hostName$1=e,this._transferState$1=t,this._snapshot$1=s,this._connServiceEvents$1=o},o=s.prototype=new i;o.constructor=s,o._hostName$1=null,o._transferState$1=null,o._snapshot$1=null,o._connServiceEvents$1=null,o.get_hostName=function(){return this._hostName$1},o.get_transferState=function(){return this._transferState$1},o.onExecuted=function(){this.complete()},o.onCompleted=function(){this._connServiceEvents$1.onDisconnected(t.ConnectionServiceResultCode.success,t.SignOutReasonCode.userTransferred,0)}}()}),define("updatenetworkcommand",["transferredcommand"],function(){!function(){var e=window,t=e.MC,n=e.MSCr,i=e.ss,s=t.MessengerServiceResultCode,o=n._serviceCommand,r=n._updateNetworkCommand=function(e,t,n,i,s,r){o.call(this),this._networkId$1=e,this._operation$1=t,this._imEnabledOperation$1=this._operation$1,this._events$1=i,this._snapshot$1=s,this._connectionService$1=n,this._writeToAbch$1=r},a=r.prototype=new o;a.constructor=r,a._networkId$1=null,a._operation$1=0,a._connectionService$1=null,a._chang_events$1e$1=null,a._result$1=0,a._snapshot$1=null,a._imEnabledOperation$1=0,a._writeToAbch$1=!1,a.onExecuted=function(){this._connectionService$1.updateNetworks(this._networkId$1,this._operation$1,i.Delegate.create(this,this._onUpdateNetworkCompleted$1))},a.onCompleted=function(){this._events$1.onUpdateNetworkCompleted(this._result$1,this._networkId$1,this._operation$1,this._writeToAbch$1)},a._onUpdateNetworkCompleted$1=function(e){this._result$1=e===t.ConnectionServiceResultCode.success?s.success:s.failedToConnect,this.complete()}}()}),define("updateservicedatacommand",["updatenetworkcommand"],function(){!function(){var e=window,t=e.MC,n=e.MSCr,i=e.MSCo,s=e.ss,o=t.MessengerServiceResultCode,r=n._serviceCommand,a=n._updateServiceDataCommand=function(e,t,n,i,s,o){r.call(this),this._change$1=e,this._identity$1=t,this._snapshot$1=n,this._connService$1=i,this._events$1=s,this._userState$1=o},c=a.prototype=new r;c.constructor=a,c._change$1=null,c._identity$1=null,c._snapshot$1=null,c._connService$1=null,c._events$1=null,c._userState$1=null,c._didCallback$1=!1,c._resultCode$1=0,c.onExecuted=function(){var e=new t.IMAddressInfo(this._identity$1.liveId,t.IMAddressInfoType.windowsLive,t.RoleLists.none),n=new t.ServiceDataSet(this._snapshot$1.getServiceDataInfo(e)),i=t.ServiceDataSet.createMessengerUpdate(n,this._change$1);this._getCorrectDomainForUpdate$1(i),this._snapshot$1.serviceDataChanged(e,i,!1),this._connService$1.publishServiceData(i,this._snapshot$1.get_services(),s.Delegate.create(this,this._onPublishServiceDataCompleted$1))},c.onCompleted=function(){this._events$1.onUserServiceDataUpdated(this._resultCode$1,this._userState$1)},c._getCorrectDomainForUpdate$1=function(e){if(null!=e.imServiceData){var t=e.imServiceData.getEndpoint(this._identity$1.endpointId);t.set_domain(i.Configuration.get_domainName())}},c._onPublishServiceDataCompleted$1=function(e){this._didCallback$1||(this._didCallback$1=!0,e!==t.ConnectionServiceResultCode.success?(this._resultCode$1=o.failure,this.fail()):(this._resultCode$1=o.success,this.complete()))}}()}),define("updateservicescommand",["updateservicedatacommand"],function(){!function(){var e=window,t=e.MC,n=e.MSCr,i=e.ss,s=t.ConnectionServiceResultCode,o=t.SessionServiceOptions,r=t.MessengerServiceResultCode,a=n._serviceCommand,c={none:0,updateSubscriptions:1,addServices:2,removeServices:4,surfaceData:8,deleteContactData:16,clearConversations:32,unsubscribeFromBuddies:64,unsubscribeFromConnectNetworks:128,subscribeToBuddies:256,subscribeToConnectNetworks:512},l=n._updateServicesCommand=function(e,n,i,s,o,r,c,l,u){a.call(this),this._address$1=new t.IMAddressInfo(n.liveId,t.IMAddressInfoType.windowsLive,t.RoleLists.none),this._connService$1=s,this._convService$1=o,this._connServiceEvents$1=r,this._connectNetworks$1=c,this._events$1=l,this._identity$1=n,this._services$1=e,this._snapshot$1=i,this._userInitiated$1=u},u=l.prototype=new a;u.constructor=l,u._services$1=o.normal,u._connService$1=null,u._convService$1=null,u._connServiceEvents$1=null,u._events$1=null,u._snapshot$1=null,u._address$1=null,u._resultCode$1=r.success,u._tasks$1=0,u._identity$1=null,u._connectNetworks$1=null,u._userInitiated$1=!1,u.get_services=function(){return this._services$1},u.onExecuted=function(){this._tasks$1=this._mapServicesToTasks$1(this._snapshot$1.get_services(),this._services$1),this._snapshot$1.set_switchingServices((this._tasks$1&c.removeServices)===c.removeServices),this._process$1()},u.onCompleted=function(){this._snapshot$1.set_services(this._services$1),this._userInitiated$1?this._events$1.onUserServicesUpdated(this._resultCode$1):this._events$1.onServicesChanged(this._services$1)},u._process$1=function(){if(this._resultCode$1===r.failure)return void this.fail();if((this._tasks$1&c.addServices)===c.addServices)this._addServices$1();else if((this._tasks$1&c.subscribeToBuddies)===c.subscribeToBuddies)this._connService$1.updateBuddySubscriptions(t.SubscriptionType.presenceAndNotificationSubscribe,i.Delegate.create(this,this._onBuddiesSubscribed$1));else if((this._tasks$1&c.subscribeToConnectNetworks)===c.subscribeToConnectNetworks){if(null!=this._connectNetworks$1)for(var e=i.IEnumerator.getEnumerator(this._connectNetworks$1);e.moveNext();){var n=e.get_current();this._connService$1.updateNetworks(n.toLowerCase(),t.NetworkOperationType.enableIM,i.Delegate.create(this,this._onConnectNetworkSubscribed$1))}}else if((this._tasks$1&c.unsubscribeFromBuddies)===c.unsubscribeFromBuddies)this._connService$1.updateBuddySubscriptions(t.SubscriptionType.presenceUnsubscribe,i.Delegate.create(this,this._onBuddiesUnsubscribed$1));else if((this._tasks$1&c.unsubscribeFromConnectNetworks)===c.unsubscribeFromConnectNetworks){if(null!=this._connectNetworks$1)for(var s=i.IEnumerator.getEnumerator(this._connectNetworks$1);s.moveNext();){var o=s.get_current();this._connService$1.updateNetworks(o.toLowerCase(),t.NetworkOperationType.disableIM,i.Delegate.create(this,this._onConnectNetworkSubscribed$1))}}else(this._tasks$1&c.clearConversations)===c.clearConversations?this._clearConversations$1():(this._tasks$1&c.deleteContactData)===c.deleteContactData?this._deleteContactData$1():(this._tasks$1&c.removeServices)===c.removeServices?this._removeServices$1():(this._tasks$1&c.surfaceData)===c.surfaceData?this._surfaceData$1():this.complete()},u._addServices$1=function(){var e=this._snapshot$1.getServiceDataInfo(this._address$1);if(null!=e&&e.length>0){var n=new t.ServiceDataSet(e);n.imServiceData.get_status()===t.PresenceInfoStatus.offline&&n.imServiceData.set_status(t.PresenceInfoStatus.online),this._connService$1.publishServiceData(n,this._services$1,i.Delegate.create(this,this._onServiceDataPublished$1))}else this._onServiceDataPublished$1(s.success)},u._removeServices$1=function(){var e=this._identity$1.endpointId,n=t.ServiceDataSet.create();n.addEndpoint(t.ServiceEndpointData.createEmpty(t.ServiceType.IM,e)),n.addEndpoint(t.ServiceEndpointData.createEmpty(t.ServiceType.PD,e)),n.addEndpoint(t.ServiceEndpointData.createEmpty(t.ServiceType.PE,e)),this._connService$1.deleteServiceData(n,i.Delegate.create(this,this._onServiceDataDeleted$1))},u._surfaceData$1=function(){var e=this._snapshot$1.getServiceDataInfo(this._address$1);null!=e&&e.length>0&&this._events$1.onServiceDataChanged(this._address$1,e),this._onTaskCompleted$1(s.success,c.surfaceData)},u._deleteContactData$1=function(){for(var e=this._snapshot$1.getLocalNetworkServiceData(),n=i.IEnumerator.getEnumerator(e);n.moveNext();){var o=n.get_current();this._connServiceEvents$1.onServiceDataDeleted(o[0],o[1])}for(var r=this._snapshot$1.getServiceDataInfo(this._address$1),a=!1,l=0;l<r.length;l++)i.keyExists(r[l].endpointData,this._identity$1.endpointId)&&delete r[l].endpointData[this._identity$1.endpointId],i.getKeyCount(r[l].endpointData)>0&&(a=!0);a&&this._connServiceEvents$1.onServiceDataDeleted(this._address$1,new t.ServiceDataSet(r)),this._onTaskCompleted$1(s.success,c.deleteContactData)},u._clearConversations$1=function(){this._convService$1.close(!0),this._onTaskCompleted$1(s.success,c.clearConversations)},u._mapServicesToTasks$1=function(e,t){if(e===o.full&&(e=o.normal),t===o.full&&(t=o.normal),e===o.contactPresence){if(t===o.normal)return c.subscribeToConnectNetworks|c.addServices|c.surfaceData;if(t===o.notifications)return c.unsubscribeFromBuddies|c.deleteContactData}else if(e===o.normal){if(t===o.contactPresence)return c.unsubscribeFromBuddies|c.removeServices|c.clearConversations;if(t===o.notifications)return c.unsubscribeFromBuddies|c.unsubscribeFromConnectNetworks|c.removeServices|c.deleteContactData|c.clearConversations}else if(e===o.notifications){if(t===o.contactPresence)return c.subscribeToBuddies;if(t===o.normal)return c.subscribeToBuddies|c.subscribeToConnectNetworks|c.addServices|c.surfaceData}return c.none},u._onServiceDataPublished$1=function(e){this._onTaskCompleted$1(e,c.addServices)},u._onServiceDataDeleted$1=function(e){this._onTaskCompleted$1(e,c.removeServices)},u._onConnectNetworkSubscribed$1=function(e){this._onTaskCompleted$1(e,c.subscribeToConnectNetworks)},u._onBuddiesSubscribed$1=function(e){this._onTaskCompleted$1(e,c.subscribeToBuddies)},u._onBuddiesUnsubscribed$1=function(e){this._onTaskCompleted$1(e,c.unsubscribeFromBuddies)},u._onTaskCompleted$1=function(e,t){e!==s.success&&(this._resultCode$1=r.failure),this._tasks$1&=~t,this._process$1()}}()}),define("reportabusecommand2",["updateservicescommand"],function(){!function(){var e=window,t=e.MSCr,n=e.ss,i=t._serviceCommand,s=t._reportAbuseCommand=function(e,t,n){i.call(this),this._connService$1=e,this._onCompleted$1=t,this._alias$1=n},o=s.prototype=new i;o.constructor=s,o._connService$1=null,o._onCompleted$1=null,o._alias$1=null,o.onExecuted=function(){this._connService$1.reportAbuse(this._alias$1,n.Delegate.create(this,this._onReportAbuseCompleted$1))},o.onCompleted=function(){},o._onReportAbuseCompleted$1=function(e){null!=this._onCompleted$1&&this._onCompleted$1.invoke(e),this.complete()}}()}),define("userservicestate",["reportabusecommand2"],function(){!function(){var e=window,t=e.MSCr;t._userServiceState=function(e){this._service=e},t._userServiceState.prototype={_service:null,get_service:function(){return this._service},updateNetwork:function(){},reportAbuse:function(){},createGroupConversation:function(){},getRecentConversations:function(){},getConversationHistory:function(){},getConversationInfo:function(){},updateConversationProperty:function(){},getGroupInfo:function(){},onNetworkStatusChanged:function(){},sendPage:function(){},signIn:function(){},signOut:function(){},updateServices:function(){},updateServiceData:function(){},onABChangeNotificationReceived:function(){},onTicketUpdated:function(){},onServiceDataChanged:function(){},onServiceDataDeleted:function(){},onSignedOutRemotely:function(){},onPageReceived:function(){},onTransferred:function(){},onMailNotificationReceived:function(){}}}()}),define("initialstate",["userservicestate"],function(){!function(){var e=window,t=e.MSCr,n=t._userServiceState,i=t._initialState=function(e){n.call(this,e)},s=i.prototype=new n;s.constructor=i,s.signIn=function(e){this.get_service()._updateState(new t._signingInState(this.get_service(),e)),this.get_service()._execute(e)}}()}),define("signedinstate",["initialstate"],function(){!function(e){var t=window,n=t.MSCr,i=t.ss,s=n._userServiceState,o=n._signedInState=function(e){this._pendingAuthenticationCommands$1=[],this._pendingUpdateServicesCommands$1=[],s.call(this,e)},r=o.prototype=new s;r.constructor=o,r._currentUpdateServicesCommand$1=null,r.updateNetwork=function(e){this.get_service()._execute(e)},r.onNetworkStatusChanged=function(e){this.get_service()._execute(e)},r.onTransferred=function(e){this.get_service()._execute(e)},r.signOut=function(e){e.get_includesLocalEndpoint()&&(this._clearCommandQueues$1(),this.get_service()._updateState(new n._signingOutState(this.get_service(),e))),this.get_service()._execute(e)},r.onTicketUpdated=function(){for(;this._pendingAuthenticationCommands$1.length>0;)this._pendingAuthenticationCommands$1[0].retry(),this._pendingAuthenticationCommands$1.splice(0,1)},r.updateServices=function(e){this._pendingUpdateServicesCommands$1.push(e),this._processPendingUpdateServicesCommands$1()},r.updateServiceData=function(e){this._pendingUpdateServicesCommands$1.push(e),this._processPendingUpdateServicesCommands$1()},r.onABChangeNotificationReceived=function(e){this.get_service()._execute(e)},r.onPageReceived=function(e){this.get_service()._execute(e)},r.onMailNotificationReceived=function(e){this.get_service()._execute(e)},r.onServiceDataChanged=function(e){this.get_service()._execute(e)},r.onServiceDataDeleted=function(e){this.get_service()._execute(e)},r.onSignedOutRemotely=function(e){this._clearCommandQueues$1(),this.get_service()._updateState(new n._signedOutState(this.get_service())),this.get_service()._execute(e)},r.sendPage=function(e){this.get_service()._execute(e)},r.getRecentConversations=function(e){this.get_service()._execute(e)},r.getConversationHistory=function(e){this.get_service()._execute(e)},r.getConversationInfo=function(e){this.get_service()._execute(e)},r.updateConversationProperty=function(e){this.get_service()._execute(e)},r.getGroupInfo=function(e){this.get_service()._execute(e)},r.createGroupConversation=function(e){this.get_service()._execute(e)},r.reportAbuse=function(e){this.get_service()._execute(e)},r._onUpdateServicesCompleted$1=function(){e(this._currentUpdateServicesCommand$1).unbind("completed",i.Delegate.create(this,this._onUpdateServicesCompleted$1)),this._currentUpdateServicesCommand$1=null,this._processPendingUpdateServicesCommands$1()},r._processPendingUpdateServicesCommands$1=function(){for(;null==this._currentUpdateServicesCommand$1&&0!==this._pendingUpdateServicesCommands$1.length;){var t=this._pendingUpdateServicesCommands$1.shift();this._currentUpdateServicesCommand$1=t instanceof n._updateServicesCommand?t:null,null!=this._currentUpdateServicesCommand$1&&e(this._currentUpdateServicesCommand$1).bind("completed",i.Delegate.create(this,this._onUpdateServicesCompleted$1)),this.get_service()._execute(t)}},r._clearCommandQueues$1=function(){null!=this._currentUpdateServicesCommand$1&&(e(this._currentUpdateServicesCommand$1).unbind("completed",i.Delegate.create(this,this._onUpdateServicesCompleted$1)),this._currentUpdateServicesCommand$1=null),this._pendingUpdateServicesCommands$1.length=0}}(window.originaljQuery||jQuery)}),define("signedoutstate",["signedinstate"],function(){!function(){var e=window,t=e.MSCr,n=t._userServiceState,i=t._signedOutState=function(e){n.call(this,e)},s=i.prototype=new n;s.constructor=i,s.signIn=function(e){this.get_service()._updateState(new t._signingInState(this.get_service(),e)),this.get_service()._execute(e)}}()}),define("signinginstate",["signedoutstate"],function(){!function(e){var t=window,n=t.MSCr,i=t.ss,s=n._userServiceState,o=n._signingInState=function(t,n){this._pendingServiceCommands$1=[],s.call(this,t),this._pendingSignInCommand$1=n,e(this._pendingSignInCommand$1).bind("completed",i.Delegate.create(this,this._onSignInCompleted$1))},r=o.prototype=new s;r.constructor=o,r._pendingSignInCommand$1=null,r.signOut=function(e){e.get_includesLocalEndpoint()&&this.get_service()._updateState(new n._signingOutState(this.get_service(),e)),this.get_service()._execute(e)},r.updateServices=function(e){this._pendingServiceCommands$1.push(e)},r.updateNetwork=function(e){this.get_service()._execute(e)},r.onTransferred=function(e){this._pendingSignInCommand$1.onTransferred(e.get_hostName(),e.get_transferState())},r.onSignedOutRemotely=function(){this.get_service()._updateState(new n._signedOutState(this.get_service())),this._pendingSignInCommand$1.onDisconnected()},r._onSignInCompleted$1=function(){if(e(this._pendingSignInCommand$1).unbind("completed",i.Delegate.create(this,this._onSignInCompleted$1)),this._pendingSignInCommand$1.get_succeeded()){var t=new n._signedInState(this.get_service());this.get_service()._updateState(t);for(var s=i.IEnumerator.getEnumerator(this._pendingServiceCommands$1);s.moveNext();){var o=s.get_current();t.updateServices(o)}}else this.get_service()._updateState(new n._signedOutState(this.get_service()))}}(window.originaljQuery||jQuery)}),define("signingoutstate",["signinginstate"],function(){!function(e){var t=window,n=t.MSCr,i=t.ss,s=n._userServiceState,o=n._signingOutState=function(t,n){s.call(this,t),e(n).bind("completed",i.Delegate.create(this,this._onSignedOut$1))},r=o.prototype=new s;r.constructor=o,r._onSignedOut$1=function(){this.get_service()._updateState(new n._signedOutState(this.get_service()))},r.sendPage=function(e){this.get_service()._execute(e)}}(window.originaljQuery||jQuery)}),define("userservice",["signingoutstate"],function(){!function(){var e=window,t=e.MC,n=e.MSCr,i=e.MSCo,s=e.MSM,o=e.ss,r=t.IConnectionServiceEvents,a=n.UserService=function(e,t,i,s){r.call(this),this._identity=e,this._currentState=new n._initialState(this),this._connService=t.createConnectionService(e,this),this._idService=s,this._snapshot=new n.MessengerStatusSnapshot(e.liveId),this._convService=t.createConversationService(e,this,i),this._events=i
},c=a.prototype=new r;c.constructor=a,c._identity=null,c._connService=null,c._idService=null,c._events=null,c._convService=null,c._currentState=null,c._snapshot=null,c._populateFinishedCallback=null,c._getHistoryPending=!0,c.updateNetwork=function(e,t,i){this._currentState.updateNetwork(new n._updateNetworkCommand(e,t,this._connService,this._events,this._snapshot,i))},c.conversationCreate=function(e,t){this._convService.conversationCreate(e,t,!0)},c.conversationCreateGroup=function(e){this._convService.conversationCreateGroup(e)},c.conversationSendMessage=function(e,t,n){this._convService.conversationSendMessage(e,t,n)},c.conversationGetRecentList=function(){this._convService.conversationGetRecentList()},c.conversationGetHistory=function(e){this._convService.conversationGetHistory(e)},c.conversationAddMembers=function(e,t,n){this._convService.conversationAddMembers(e,t,n)},c.conversationRemoveMembers=function(e,t,n){this._convService.conversationRemoveMembers(e,t,n)},c.conversationExpose=function(e,t,n){this._events.onConversationCreated(e,t,n)},c.conversationUpdateId=function(e,t){this._events.onConversationUpdatedId(e,t)},c.conversationUpdateConsumptionHorizon=function(e,t){this._convService.conversationUpdateConsumptionHorizon(e,t)},c.conversationClose=function(e){this._convService.conversationClose(e,!0)},c.conversationDelete=function(e,t,n){this._convService.conversationDelete(e,t,n)},c.signIn=function(e,t,i,s,o){this.updateTicket(e);var r=this._createSignInServiceData(t);this._currentState.signIn(new n._signInCommand(r,i,!1,s,this.get__identity(),this._snapshot,this._connService,this._idService,this._events,o))},c.reconnect=function(e,t,i,s){var o=this._createSignInServiceData(e);this._currentState.signIn(new n._signInCommand(o,t,!0,i,this.get__identity(),this._snapshot,this._connService,this._idService,this._events,s))},c.signOut=function(e,i,s,o){var r=null;s&&(r=new t.ServiceDataSet(this._snapshot.getServiceDataInfo(new t.IMAddressInfo(this._identity.liveId,t.IMAddressInfoType.windowsLive,t.RoleLists.none))));var a=new n._signOutCommand(r,e,i,!s,this._connService,this._convService,this._snapshot,this._events,o);this._currentState.signOut(a)},c.reportAbuse=function(e,t){var i=s.Mri.createFromIMAddressInfo(e);this._currentState.reportAbuse(new n._reportAbuseCommand(this._connService,t,i.toString()))},c.createConversationGroup=function(e,t){this._currentState.createGroupConversation(new n._createGroupConversationCommand(this._connService,e,t))},c.getRecentConversations=function(e,t,i){this._currentState.getRecentConversations(new n._getRecentConversationsCommand(this._connService,e,t,i))},c.getConversationHistory=function(e,t,i){this._currentState.getConversationHistory(new n._getConversationHistoryCommand(this._connService,e,t,i))},c.getConversationInfo=function(e,t){this._currentState.getConversationInfo(new n._getConversationInfoCommand(this._connService,e,t))},c.updateConversationProperty=function(e,t,i,s){this._currentState.updateConversationProperty(new n._updateConversationPropertyCommand(this._connService,e,t,i,s))},c.getGroupInfo=function(e,t,i){this._currentState.getGroupInfo(new n._getGroupInfoCommand(this._connService,e,t,i))},c.updateServices=function(e,t,i){this._currentState.updateServices(new n._updateServicesCommand(e,this._identity,this._snapshot,this._connService,this._convService,this,i,this._events,t))},c.updateServiceData=function(e,t){this._currentState.updateServiceData(new n._updateServiceDataCommand(e,this._identity,this._snapshot,this._connService,this._events,t))},c.sendDatagram=function(e,t,i){this._currentState.sendPage(new n._sendDatagramCommand(e,this._connService,t,i))},c._execute=function(e){e.execute()},c._updateState=function(e){this._currentState=e,this._getHistoryPending&&this._currentState instanceof n._signedInState&&(this._convService.conversationGetRecentList(),this._getHistoryPending=!1)},c._createSignInServiceData=function(e){var n=this._identity.endpointId,s=new t.ServiceDataSet(e),o=s.imServiceData.getEndpoint(n);if(o.set_domain(i.Configuration.get_domainName()),this._identity.authenticationInfo.authType!==t.AuthenticationType.rpsAuth){var r=o.get_capabilities();o.set_capabilities(r)}var a=s.peServiceData.getEndpoint(n);return a.set_clientName(i.Configuration.get_clientId()),a.set_clientVersion(i.Configuration.get_clientVersion()),s},c.get__authenticationType=function(){return this._identity.authenticationInfo.authType},c.get__identity=function(){return this._identity},c.get__identityService=function(){return this._idService},c._notifyWebSignInPendingEvents=function(e){for(var t=o.IEnumerator.getEnumerator(e);t.moveNext();){var n=t.get_current(),i=n[1];switch(n[0]){case"OnMailNotification":this._events.onMailNotification(i[0]);break;case"OnServiceDataChanged":this._events.onServiceDataChanged(i[0],i[1]);break;case"OnServiceDataDeleted":this._events.onServiceDataDeleted(i[0],i[1])}}},c.updateTicket=function(e){this._identity.liveId=e.liveId,this._identity.skypeId=e.skypeId,this._identity.authenticationInfo=e.authenticationInfo,this._identity.cid=e.cid,this._identity.endpointId=e.endpointId,t.Logger.logDetails("UserServiceUpdateTicket",{authType:null==this._identity.authenticationInfo?"Null":t.enumToString(t.AuthenticationType,this._identity.authenticationInfo.authType)}),this.onTicketUpdated()},c.onTicketUpdated=function(){this._currentState.onTicketUpdated()},c.onSignInPopulateCompleted=function(){null!=this._populateFinishedCallback&&(this._populateFinishedCallback.invoke(null,{}),this._populateFinishedCallback=null)},c.onNetworkStatusChanged=function(e,t){this._currentState.onNetworkStatusChanged(new n._networkStatusChangeReceivedCommand(e,t,this._events,this._snapshot))},c.onServiceDataChanged=function(e,t){this._currentState.onServiceDataChanged(new n._serviceDataChangedCommand(e,t,this._identity,this._snapshot,this._events))},c.onServiceDataDeleted=function(e,t){this._currentState.onServiceDataDeleted(new n._serviceDataDeletedCommand(e,t,this,this._identity,this._snapshot,this._connService,this._convService,this._events))},c.onMailNotificationReceived=function(e){this._currentState.onMailNotificationReceived(new n._mailNotificationReceivedCommand(e,this._events)),this._snapshot.mailNotificationReceived(e)},c.onABChangeNotificationReceived=function(e){this._currentState.onABChangeNotificationReceived(new n._abChangeNotificationReceivedCommand(e,this._events))},c.onDatagramReceived=function(e){this._currentState.onPageReceived(new n._datagramReceivedCommand(this._convService,e))},c.onDisconnected=function(e,t,i){this._currentState.onSignedOutRemotely(new n._signedOutRemotelyCommand(this._convService,this._events,e,t,i)),this._snapshot.onSignedOut(t)},c.onTransferred=function(e,t,i){this._currentState.onTransferred(new n._transferredCommand(e,t,i,this._snapshot,this))},c.onSignInEventsEmpty=function(){},c.onTridChanged=function(e){this._snapshot.updateTrid(e)},c.onRegistrationTokenChanged=function(e){this._snapshot.updateRegistrationToken(e)}}()}),define("modelconstants",["userservice"],function(){!function(){var e=window,t=e.Microsoft.Live.Messenger;t._localization={defaultFontFamily:"Segoe UI",facebookMobile:"On Facebook Mobile",fullName:"{0} {1}",statusAppearOffline:"Appear offline",statusAway:"Away",statusBusy:"Busy",statusOffline:"Offline",statusOnline:"Available",networkWindowsLive:"Messenger",networkOfficeCommunicator:"Microsoft Lync™",networkTelephone:"SMS",networkSkype:"Skype"}}()}),define("modelenums",["modelconstants"],function(){!function(){var e=window.Microsoft.Live.Messenger,t=e.AuthenticationResultCode=function(){};t.success=0,t.failure=1;var n=e.AuthenticationStatus=function(){};n.none=0,n.alreadySignedIn=1,n.unsupportedBrowser=2,n.multipleEndpointsNotSupported=4,n.blockedApplication=8,n.blockedUser=16,n.authenticationFailure=32,n.serviceUnavailable=64,n.insecureTransportNotSupported=128;var i=e.DisplayNameMode=function(){};i.displayName=0,i.fullName=1;var s=e.EmoticonSize=function(){};s.small=0,s.medium=1;var o=e.GroupConversationOperationType=function(){};o.addMembers=0,o.removeMembers=1,o.leaveGroup=2;var r=e.IMAddressType=function(){};r.none=0,r.windowsLive=1,r.officeCommunicator=2,r.telephone=4,r.skype=8,r.connect=13,r.smtp=16,r.temporaryGroup=19,r.shortCircuit=20;var a=e.InviteMessageType=function(){};a.historyInvite=0,a.newInvite=1,a.inviteSeen=2;var c=e.MessageType=function(){};c.textMessage=1,c.callEventMessage=6,c.threadActivityMessage=7;var l=e.NetworkStatus=function(){};l.signedOut=0,l.signingIn=1,l.signedIn=2,l.signingOut=3,l.autoReconnectWaiting=4;var u=e.NotifyCollectionChangedAction=function(){};u.add=0,u.remove=1,u.replaced=2,u.reset=3;var d=e.PresenceStatus=function(){};d.offline=0,d.online=1,d.appearOffline=2,d.busy=3,d.idle=4,d.beRightBack=5,d.away=6,d.inACall=7,d.outToLunch=8;var _=e.PrivacyMode=function(){};_.allowByDefault=0,_.blockByDefault=1;var g=e.SendMessageResultCode=function(){};g.success=0,g.failure=1,g.messageTooLong=2,g.recipientInvalid=3,g.recipientDisabled=4;var h=e.SignInPreference=function(){};h.none=0,h.autoSignIn=1,h.manualSignIn=2;var p=e.SessionServices=function(){};p.normal=0,p.notifications=1,p.contactPresence=2,p.full=3;var f=e.SignedOutReason=function(){};f.signedOutByLocalEndpoint=0,f.signedOutByRemoteEndpoint=1,f.connectionLost=2,f.serverError=3,f.endpointLimitExceeded=4,f.signedOutByServer=5;var m=e.SignInResultCode=function(){};m.success=0,m.failure=1,m.authenticationFailure=2;var v=e.SignOutLocations=function(){};v.local=1,v.remote=2,v.all=3,v.sameDomain=4;var C=e.SignOutResultCode=function(){};C.success=0,C.failure=1;var y=e.UploadLogsPreference=function(){};y.none=0,y.accept=1,y.decline=2;var S=e.UserStatus=function(){};S.signedOut=0,S.signingIn=1,S.signedIn=2,S.signingOut=3,S.autoReconnectWaiting=4;var $=e._userState=function(){};$.initialized=0,$.signingIn=1,$.signedIn=2,$.signingOut=3,$.signedOut=4,$.autoReconnectWaiting=5,$.disposed=6}()}),define("exceptions",["modelenums"],function(){!function(){var e=window,t=e.Microsoft.Live.Messenger;t._exceptions={argumentEmpty:"Value cannot be empty.",argumentInvalid:"Value is invalid: {1}\\r\\n{0}",argumentNull:"Value cannot be null: {0}.",argumentOutOfRange:"Specified argument was out of range.",argumentPositive:"Argument must be positive.",cantConvSelf:"Cannot create a conversation with self.",collectionItemDuplicate:"Collection already contains object.",collectionItemNotFound:"Collection does not contain object.",collectionReadOnly:"Collection is read-only.",contactAddressOperationUnsupported:"Cannot perform an IMAddress operation on a Contact that is not on WindowsLive network.",contactMustMemberUserContact:"The contact must be a member of User.Contacts to perform this operation.",endpointNameInvalid:"Endpoint name is invalid. Use Endpoint.IsNameValid() to validate user input.",endpointNotLocal:"Cannot update a contact's endpoint. Use User.LocalEndpoint to get the user's endpoint.",invalidOperation:"Operation is not valid due to the current state of the object. {0}",networkIMEnabledTogglingNotAllowed:"Cannot update Network.IMEnabled for networks that do not support instant messaging. Use Network.SupportsRemoteSignIn to determine whether it is possible.",objectDisposed:"Cannot access a disposed object named '{0}'.",objectNotBelongToUser:"Object does not belong to user.",objRetOnCreateMailboxInvalid:"Object returned by User.OnCreateMailbox is invalid.",onCreateConvRetInvalidConv:"Object returned by User.OnCreateConversation is invalid.",personalMessageInvalid:"Personal message is invalid. Use IMAddressPresence.IsPersonalMessageValid() to validate user input.",presenceReadOnly:"Cannot update a contact's presence.",sameTypeAddressExists:"An address of the same type already exists in the contact.",textMessageInvalid:"Text message is invalid. Use Conversation.IsTextMessageValid() to validate a message.",userAlreadySignedIn:"User is already signed in.",identityNotAuthenticated:"An Identity object must be authenticated prior to creating a User instance.",userMustBeSignedInForOperation:"User must be signed in in order to perform this operation.",userIdentityEnforceOneToOneBinding:"An Identity object cannot be associated with more than one User instance.",invalidOperationForCurrentAuthMode:"Invalid operation for the current authentication mode.",unsupportedContactOperation:"Cannot add or remove contact from the collection. To add email-only contacts, use User.AddContact().",conversationEmailOnly:"Cannot create a conversation with an email-only contact.",userInvalidServices:"Cannot perform operation in the current User.Services state.",unsupportedGroupOperation:"Cannot update group's AppearOfflineTo/AppearOnlineTo properties when User.Services is in Notifications or ContactPresence mode.",methodNotSupported:"This object does not support this method.",targetEndpointRosterCountInvalid:"A message can be sent to a single endpoint only when a conversation has 2 members."}}()}),define("exceptionhelper",["exceptions"],function(){!function(){var e=window,t=e.ss,n=e.Microsoft.Live.Messenger,i=n._exceptionHelper=function(){};i.createArgumentNullException=function(e){return new Error(t.format(n._exceptions.argumentNull,e))},i.createArgumentNullOrEmptyException=function(e,t){return null==t?n._exceptionHelper.createArgumentNullException(e):n._exceptionHelper.createArgumentException(n._exceptions.argumentEmpty,e)},i.createArgumentException=function(e,i){return new Error(t.format(n._exceptions.argumentInvalid,e,i))},i.createInvalidOperationException=function(e){return new Error(t.format(n._exceptions.invalidOperation,e))},i.createObjectDisposedException=function(e){return new Error(t.format(n._exceptions.objectDisposed,e))},i.createArgumentOutOfRangeException=function(){return new Error(n._exceptions.argumentOutOfRange)}}()}),define("globalconfiguration",["exceptionhelper"],function(){!function(){var e=window,t=e.ss,n=e.$Config,i=e.MC,s=e.Microsoft.Live.Messenger,o=e.MSCo,r=s._globalConfiguration=function(){};r._disablePopulateBatching=-1,r._configuration=null,r.get__instance=function(){return r._configuration},r.get__tryGetInstance=function(){return r._configuration},r._initialize=function(){r._configuration=new r},r.get__domainName=function(){return e.location.hostname.toLowerCase()},r._getDisplayPictureUrl=function(e){var n=r.get__instance();if(null!=n){var i=o.Configuration.get_displayPictureUrlFormat();if(!t.isNullOrEmpty(i))return t.replaceAll(i,"{0}",e)}return null},r._getNetworkIconUrl=function(e){var i,s=$pwc.getService(e);return null!=s&&(i=s.getIconUrlThumbnail()),t.isNullOrEmpty(i)&&(i=n.WebIM.imgBase+"webim/networkicons/"+e.toLowerCase()+"_1.png"),i},r._getNetworkIconErrorUrl=function(e){return n.WebIM.imgBase+"webim/networkicons/"+e.toLowerCase()+"error.png"},r.get__maxEndpointNameLength=function(){return 50},r.get__maxApplicationNameLength=function(){return 129},r.get__defaultServices=function(){return i.SessionServiceOptions.normal},r.get__userPopulationBatchSize=function(){return 100}}()}),define("contactsreaderchangedeventargs",["globalconfiguration"],function(){!function(){var e=window,t=e.Microsoft.Live.Messenger;t.ContactsReaderChangedEventArgs=function(e,t,n){this.added=e,this.changed=t,this.removed=n},t.ContactsReaderChangedEventArgs.prototype={added:null,changed:null,removed:null}}()}),define("notifycollectionchangedeventargs",["contactsreaderchangedeventargs"],function(){!function(){var e=window,t=e.ss,n=e.Microsoft.Live.Messenger,i=n.NotifyCollectionChangedAction,s=t.NotifyCollectionChangedAction,o=n.NotifyCollectionChangedEventArgs=function(e,t,n,s){this._newStartingIndex$1=-1,this._oldStartingIndex$1=-1,this._action$1=e,this._action$1!==i.reset&&(this._newItems$1=[],this._oldItems$1=[]),this._action$1===i.add?(this._newItems$1.push(t),this._newStartingIndex$1=s):this._action$1===i.remove?(this._oldItems$1.push(n),this._oldStartingIndex$1=s):this._action$1===i.replaced&&(this._newItems$1.push(t),this._oldItems$1.push(n),this._newStartingIndex$1=s,this._oldStartingIndex$1=s)};o._create=function(e,t,n,i){var s=new o(e,t,n,i);return null!=t&&t.length>1&&(s._newItems$1.length=0,s._newItems$1.addRange(t)),null!=n&&n.length>1&&(s._oldItems$1.length=0,s._oldItems$1.addRange(n)),s},o.prototype={_action$1:n.NotifyCollectionChangedAction.add,_newItems$1:null,_oldItems$1:null,_changes$1:null,get_action:function(){return this._action$1},get_newItems:function(){return this._newItems$1},get_newStartingIndex:function(){return this._newStartingIndex$1},get_oldItems:function(){return this._oldItems$1},get_oldStartingIndex:function(){return this._oldStartingIndex$1},get_changes:function(){return null==this._changes$1&&this._initializesChanges$1(),this._changes$1},_initializesChanges$1:function(){switch(this._action$1){case i.add:case i.remove:case i.reset:this._changes$1=[new t.CollectionChange(this._getChangesAction$1(),this._newItems$1,this._newStartingIndex$1,this._oldItems$1,this._oldStartingIndex$1)];break;case i.replaced:this._changes$1=[new t.CollectionChange(s.remove,null,-1,this._oldItems$1,this._oldStartingIndex$1),new t.CollectionChange(s.add,this._newItems$1,this._newStartingIndex$1,null,-1)]}},_getChangesAction$1:function(){switch(this._action$1){case i.add:return s.add;case i.remove:return s.remove;case i.reset:return s.reset}return s.add}}}()}),define("propertychangedeventargs",["notifycollectionchangedeventargs"],function(){!function(){var e=window,t=e.Microsoft.Live.Messenger;t.PropertyChangedEventArgs=function(e){this._propertyName$1=e},t.PropertyChangedEventArgs.prototype={_propertyName$1:null,get_propertyNamePascal:function(){return this._propertyName$1},get_propertyName:function(){return this._propertyName$1}}}()}),define("guid",["propertychangedeventargs"],function(){!function(){var e=window,t=e.ss,n=e.Microsoft.Live.Messenger,i=n.Guid=function(e){if(t.isNullOrEmpty(e))throw n._exceptionHelper.createArgumentNullOrEmptyException("g",e);"{"!==e.charAt(0)&&(e="{"+e+"}");var i="^\\{[a-f\\d]{8}\\-([a-f\\d]{4}\\-){3}[a-f\\d]{12}\\}$",s=new RegExp(i,"i");if(!s.test(e))throw n._exceptionHelper.createArgumentOutOfRangeException("g");this._g=e.toLowerCase()};i.newGuid=function(){for(var e=new Array(4),i=0;4>i;i++)e[i]=t.padLeft(Math.round(16777215*Math.random()).toString(16),8,"0");return new n.Guid("{"+e[0]+"-"+e[1].substr(0,4)+"-"+e[1].substr(4,4)+"-"+e[2].substr(0,4)+"-"+e[2].substr(4,4)+e[3]+"}")},i.prototype={_g:null,equals:function(e){return null==e?!1:this._g===e._g},toString:function(){return this._g}},i.empty=new n.Guid("{00000000-0000-0000-0000-000000000000}")}()}),define("version",["guid"],function(){!function(){var e=window,t=e.ss,n=e.Microsoft.Live.Messenger;n.Version=function(e,t,i,s){if(0>e||0>t||0>i||0>s)throw n._exceptionHelper.createArgumentOutOfRangeException(n._exceptions.argumentPositive);this._major=e,this._minor=t,this._build=i,this._revision=s},n.Version.prototype={_major:0,_minor:0,_build:0,_revision:0,get_major:function(){return this._major},get_minor:function(){return this._minor},get_build:function(){return this._build},get_revision:function(){return this._revision},toString:function(){return t.format("{0}.{1}.{2}.{3}",this._major,this._minor,this._build,this._revision)}}}()}),define("safeurlinfo",["version"],function(){!function(){var e=window,t=e.Microsoft.Live.Messenger;t._safeUrlInfo=function(e,t,n){var i=this;i.urlPosition=e,i.urlLength=t,i.safeLink=n}}()}),define("messengerutility",["safeurlinfo"],function(){!function(){var e=new RegExp("(\\(angel\\)|:@|:-@|:=@|x\\(|x-\\(|X\\(|X-\\(|x=\\(|X=\\(|\\(angry\\)|\\(bandit\\)|\\(headbang\\)|\\(banghead\\)|\\(beer\\)|:D|:-D|:=D|:d|:-d|:=d|\\(laugh\\)|\\(blush\\)|:\\$|:-\\$|:=\\$|:\">|\\(bow\\)|\\(u\\)|\\(U\\)|\\(brokenheart\\)|\\(bug\\)|\\(\\^\\)|\\(cake\\)|\\(call\\)|\\(cash\\)|\\(mo\\)|\\(\\$\\)|\\(clap\\)|\\(coffee\\)|8\\)|8-\\)|8=\\)|B\\)|B-\\)|B=\\)|\\(cool\\)|;\\(|;-\\(|;=\\(|:\\(|:-\\(|:=\\(|\\(cry\\)|\\(dance\\)|o/|:D/|:d/|\\(devil\\)|\\(doh\\)|\\(d\\)|\\(D\\)|\\(drink\\)|\\(drunk\\)|\\|-\\(|\\|\\(|\\|=\\(|\\(dull\\)|\\(emo\\)|\\(envy\\)|]:\\)|>:\\)|\\(grin\\)|\\(finger\\)|\\(F\\)|\\(f\\)|\\(flower\\)|\\(chuckle\\)|\\(giggle\\)|\\(handshake\\)|\\(happy\\)|\\(h\\)|\\(H\\)|\\(l\\)|\\(L\\)|\\(heart\\)|\\(love\\)|\\(hi\\)|\\(hug\\)|\\(bear\\)|\\(inlove\\)|\\(wasntme\\)|:\\*|:-\\*|:=\\*|\\(kiss\\)|\\(makeup\\)|\\(kate\\)|\\(mm\\)|\\(mmm\\)|\\(mmmm\\)|\\(mooning\\)|\\(~\\)|\\(film\\)|\\(movie\\)|\\(flex\\)|\\(muscle\\)|\\(music\\)|:x|:-x|:X|:-X|:#|:-#|:=x|:=X|:=#|8-\\||B-\\||8\\||B\\||8=\\||B=\\||\\(nerd\\)|\\(ninja\\)|\\(n\\)|\\(N\\)|\\(no\\)|\\(nod\\)|\\(party\\)|\\(mp\\)|\\(ph\\)|\\(phone\\)|\\(pi\\)|\\(pizza\\)|\\(poolparty\\)|\\(hrv\\)|:&|:-&|:=&|\\(punch\\)|\\(rain\\)|\\(st\\)|\\(london\\)|\\(rock\\)|\\(rofl\\)|:\\(|:-\\(|:=\\(|\\(sad\\)|\\(shake\\)|\\(skype\\)|\\(ss\\)|\\|-\\)|I-\\)|I=\\)|\\(snooze\\)|:\\)|:-\\)|:=\\)|\\(smile\\)|:P|:-P|:=P|:p|:-p|:=p|\\(tongueout\\)|\\(smirk\\)|\\(smoking\\)|\\(smoke\\)|\\(ci\\)|:\\||:-\\||:=\\||\\(speechless\\)|\\(\\*\\)|\\(star\\)|\\(sun\\)|:O|:-O|:=O|:o|:-o|:=o|\\(surprised\\)|\\(swear\\)|\\(sweat\\)|\\(:\\||\\(talk\\)|\\(think\\)|:-\\?|:\\?|:=\\?|\\(o\\)|\\(O\\)|\\(time\\)|\\(clock\\)|\\(toivo\\)|\\(tmi\\)|\\(wait\\)|\\(whew\\)|;\\)|;-\\)|;=\\)|\\(wink\\)|:\\^\\)|\\(wonder\\)|:S|:s|:-s|:-S|:=s|:=S|\\(worry\\)|\\(yawn\\)|\\|-\\(\\)|\\(y\\)|\\(Y\\)|\\(ok\\)|\\(yes\\)|\\(e\\)|\\(m\\)|\\(mail\\)|\\r\\n|\\r|\\n|((http|https):\\/\\/|\\/www|www\\.)[^\\s]*[^\\s?.!(;:'>\\[\\],])"),t=new RegExp('(\\(angel\\)|:@|:-@|:=@|x\\(|x-\\(|X\\(|X-\\(|x=\\(|X=\\(|\\(angry\\)|\\(bandit\\)|\\(headbang\\)|\\(banghead\\)|\\(beer\\)|:D|:-D|:=D|:d|:-d|:=d|\\(laugh\\)|\\(blush\\)|:\\$|:-\\$|:=\\$|:">|\\(bow\\)|\\(u\\)|\\(U\\)|\\(brokenheart\\)|\\(bug\\)|\\(\\^\\)|\\(cake\\)|\\(call\\)|\\(cash\\)|\\(mo\\)|\\(\\$\\)|\\(clap\\)|\\(coffee\\)|8\\)|8-\\)|8=\\)|B\\)|B-\\)|B=\\)|\\(cool\\)|;\\(|;-\\(|;=\\(|:\\(|:-\\(|:=\\(|\\(cry\\)|\\(dance\\)|o/|:D/|:d/|\\(devil\\)|\\(doh\\)|\\(d\\)|\\(D\\)|\\(drink\\)|\\(drunk\\)|\\|-\\(|\\|\\(|\\|=\\(|\\(dull\\)|\\(emo\\)|\\(envy\\)|]:\\)|>:\\)|\\(grin\\)|\\(finger\\)|\\(F\\)|\\(f\\)|\\(flower\\)|\\(chuckle\\)|\\(giggle\\)|\\(handshake\\)|\\(happy\\)|\\(h\\)|\\(H\\)|\\(l\\)|\\(L\\)|\\(heart\\)|\\(love\\)|\\(hi\\)|\\(hug\\)|\\(bear\\)|\\(inlove\\)|\\(wasntme\\)|:\\*|:-\\*|:=\\*|\\(kiss\\)|\\(makeup\\)|\\(kate\\)|\\(mm\\)|\\(mmm\\)|\\(mmmm\\)|\\(mooning\\)|\\(~\\)|\\(film\\)|\\(movie\\)|\\(flex\\)|\\(muscle\\)|\\(music\\)|:x|:-x|:X|:-X|:#|:-#|:=x|:=X|:=#|8-\\||B-\\||8\\||B\\||8=\\||B=\\||\\(nerd\\)|\\(ninja\\)|\\(n\\)|\\(N\\)|\\(no\\)|\\(nod\\)|\\(party\\)|\\(mp\\)|\\(ph\\)|\\(phone\\)|\\(pi\\)|\\(pizza\\)|\\(poolparty\\)|\\(hrv\\)|:&|:-&|:=&|\\(punch\\)|\\(rain\\)|\\(st\\)|\\(london\\)|\\(rock\\)|\\(rofl\\)|:\\(|:-\\(|:=\\(|\\(sad\\)|\\(shake\\)|\\(skype\\)|\\(ss\\)|\\|-\\)|I-\\)|I=\\)|\\(snooze\\)|:\\)|:-\\)|:=\\)|\\(smile\\)|:P|:-P|:=P|:p|:-p|:=p|\\(tongueout\\)|\\(smirk\\)|\\(smoking\\)|\\(smoke\\)|\\(ci\\)|:\\||:-\\||:=\\||\\(speechless\\)|\\(\\*\\)|\\(star\\)|\\(sun\\)|:O|:-O|:=O|:o|:-o|:=o|\\(surprised\\)|\\(swear\\)|\\(sweat\\)|\\(:\\||\\(talk\\)|\\(think\\)|:-\\?|:\\?|:=\\?|\\(o\\)|\\(O\\)|\\(time\\)|\\(clock\\)|\\(toivo\\)|\\(tmi\\)|\\(wait\\)|\\(whew\\)|;\\)|;-\\)|;=\\)|\\(wink\\)|:\\^\\)|\\(wonder\\)|:S|:s|:-s|:-S|:=s|:=S|\\(worry\\)|\\(yawn\\)|\\|-\\(\\)|\\(y\\)|\\(Y\\)|\\(ok\\)|\\(yes\\)|\\(e\\)|\\(m\\)|\\(mail\\))',"g"),n="((http|https):\\/\\/)[^\\s]*[^\\s?.!(;:'>\\[\\],]",i=window,s=i.document,o=i.$Config,r=i.Microsoft.Live.Messenger,a=i.MSH,c=i.ss,l=r.MessengerUtility=function(){};l.getEmoticonUrlPath=function(){return o.WebIM.imgBase+"webim/emoticons/modern/"},l.getImagePath=function(){return o.WebIM.imgBase+"webim/"},l.emoticonEncode=function(e){if(null==e)throw r._exceptionHelper.createArgumentNullException("text");return l._replaceEmoticonsAndUrls(e,"",r.EmoticonSize.small)},l.replaceEmoticons=function(e,t){var n=s.createElement("span");return l._parseEmoticons(e,n,!1,t),n},l._replaceEmoticonsAndUrls=function(e,t,n){for(var i=s.createElement("span"),o=l._parseSafeUrls(t),r=0,a=c.IEnumerator.getEnumerator(o);a.moveNext();){var u=a.get_current();u.urlPosition>0&&l._parseEmoticons(e.substring(r,u.urlPosition),i,!0,n);var d=e.substr(u.urlPosition,u.urlLength),_=l._createAnchorElement(d,u.safeLink);_.innerText=d,i.appendChild(_),r=u.urlPosition+u.urlLength+1}return r<e.length&&l._parseEmoticons(e.substr(r),i,!0,n),i},l._parseEmoticons=function(n,i,o,r){for(;n.length>0;){var a=!1;n.replace(e,function(){var e=arguments[1],c=arguments[4];if(c>0){var u=n.substr(0,c);i.appendChild(s.createTextNode(u))}switch(e){case"\r\n":case"\r":case"\n":i.appendChild(s.createElement("br"));break;default:if(e.startsWith("http")||e.startsWith("www"))if(o){var d=l._createAnchorElement(e.replace(t,""),null);d.innerText=e.replace(t,""),i.appendChild(d),e.replace(t,function(e){var t=l._createEmoticonElement(e,r);i.appendChild(t?t:s.createTextNode(e))})}else i.appendChild(s.createTextNode(e));else if(e.startsWith("/www"))i.appendChild(s.createTextNode(e));else{var _=l._createEmoticonElement(e,r);i.appendChild(null==_?s.createTextNode(e):_)}}return n=n.substr(c+e.length),a=!0,""}),a||(i.appendChild(s.createTextNode(n)),n="")}},l._createAnchorElement=function(e,t){var n=s.createElement("a"),i=e;return i.startsWith("http://")||i.startsWith("https://")||(i="http://"+i),n.href=i,n.target="_blank",n.attachEvent("onclick",function(){"Disabled"===n.className?window.event.returnValue=!1:window.event.cancelBubble=!0,null!=t&&(t.startsWith("http://")||t.startsWith("https://")||(t="http://"+t),n.href=t,a.Scheduler.defer(function(){n.href=i}))}),n},l._createEmoticonElement=function(e,t){var n=u[e.toLowerCase()];if(c.isNullOrEmpty(n))return null;var i=o.WebIM.imgBase+"webim/emoticons/modern/";i+=c.isNullOrUndefined(t)||t===r.EmoticonSize.small?"16px/":"19px/",i+=n+".png";var a=s.createElement("img");return a.title=e,a.alt=e,a.className="Emoticon",a.src=i,a},l._parseSafeUrls=function(e){var t=[];if(c.isNullOrEmpty(e))return t;for(var n=e.split(" "),i=c.IEnumerator.getEnumerator(n);i.moveNext();){var s=i.get_current(),o=s.split(",");t.push(new r._safeUrlInfo(a.ConvertHelper.tryParseInt(o[0]),a.ConvertHelper.tryParseInt(o[1]),o[2]))}return t},l._createPersonalMessageElement=function(e,t){var n=s.createElement("span");n.className="PersonalMessage";var i=t.get_safeUrl()||"",o=l._replaceEmoticonsAndUrls(e,i,r.EmoticonSize.small);return o.className="PersonalMessage_Text",n.appendChild(o),n},l._validateUrl=function(e){if(c.isNullOrEmpty(e))return!1;var t=new RegExp(n,"i");return t.test(e)};var u={};u["(angel)"]="29",u[":@"]=u[":-@"]=u[":=@"]=u["x("]=u["x-("]=u["X("]=u["X-("]=u["x=("]=u["X=("]=u["(angry)"]="20",u["(bandit)"]="47",u["(beer)"]="54",u[":D"]=u[":-D"]=u[":=D"]=u[":d"]=u[":-d"]=u[":=d"]=u["(laugh)"]="3",u["(blush)"]=u[":$"]=u[":-$"]=u[":=$"]=u[':">']="12",u["(bow)"]="36",u["(^)"]=u["(cake)"]="53",u["(cash)"]=u["(mo)"]=u["($)"]="51",u["(clap)"]="34",u["(coffee)"]="49",u["8)"]=u["8-)"]=u["8=)"]=u["B)"]=u["B-)"]=u["B=)"]=u["(cool)"]="4",u[";("]=u[";-("]=u[";=("]=u[":("]=u[":-("]=u[":=("]=u["(cry)"]="7",u["(dance)"]=u["o/"]=u[":D/"]=u[":d/"]="56",u["(devil)"]="28",u["(doh)"]="19",u["(d)"]=u["(D)"]=u["(drink)"]="55",u["|-("]=u["|("]=u["|=("]=u["(dull)"]="14",u["(envy)"]="30",u["(F)"]=u["(f)"]=u["(flower)"]="43",u["(chuckle)"]=u["(giggle)"]="33",u["(h)"]=u["(H)"]=u["(l)"]=u["(L)"]=u["(heart)"]=u["(love)"]="42",u["(hi)"]="27",u["(inlove)"]="15",u["(wasntme)"]="21",u[":*"]=u[":-*"]=u[":=*"]=u["(kiss)"]="10",u["(mm)"]=u["(mmm)"]=u["(mmmm)"]="24",u["(flex)"]=u["(muscle)"]="52",u["(music)"]="46",u[":x"]=u[":-x"]=u[":X"]=u[":-X"]=u[":#"]=u[":-#"]=u[":=x"]=u[":=X"]=u[":=#"]="26",u["8-|"]=u["B-|"]=u["8|"]=u["B|"]=u["8=|"]=u["B=|"]=u["(nerd)"]="25",u["(n)"]=u["(N)"]=u["(no)"]="41",u["(nod)"]="39",u["(party)"]="22",u["(pi)"]=u["(pizza)"]="50",u["(rain)"]=u["(st)"]=u["(london)"]="44",u["(rofl)"]="37",u[":("]=u[":-("]=u[":=("]=u["(sad)"]="2",u["|-)"]=u["I-)"]=u["I=)"]=u["(snooze)"]="13",u[":)"]=u[":-)"]=u[":=)"]=u["(smile)"]="1",u[":P"]=u[":-P"]=u[":=P"]=u[":p"]=u[":-p"]=u[":=p"]=u["(tongueout)"]="11",u["(smirk)"]="38",u[":|"]=u[":-|"]=u[":=|"]=u["(speechless)"]="9",u["(*)"]=u["(star)"]="57",u["(sun)"]="45",u[":O"]=u[":-O"]=u[":=O"]=u[":o"]=u[":-o"]=u[":=o"]=u["(surprised)"]="5",u["(think)"]=u[":-?"]=u[":?"]=u[":=?"]="35",u["(tmi)"]="48",u["(wait)"]="31",u[";)"]=u[";-)"]=u[";=)"]=u["(wink)"]="6",u[":^)"]=u["(wonder)"]="32",u[":S"]=u[":s"]=u[":-s"]=u[":-S"]=u[":=s"]=u[":=S"]=u["(worry)"]="23",u["(yawn)"]=u["|-()"]="17",u["(y)"]=u["(Y)"]=u["(ok)"]=u["(yes)"]="40"}()}),define("contactsreader",["messengerutility"],function(){!function(e){var t=window,n=t.Microsoft.Live.Messenger,i=n.Services;i.ContactsReader=function(){},i.ContactsReader.prototype={_initializationCallback:null,notifyAddressBookChange:null,get_networks:null,get_persons:null,get_settings:null,initialize:function(e){this._initializationCallback=e},onInitialized:function(e){null!=this._initializationCallback&&(this._initializationCallback.invoke(e),this._initializationCallback=null)},onNetworksChanged:function(t,i,s){e(this).triggerHandler("networksChanged",[this,new n.ContactsReaderChangedEventArgs(t,i,s)])},onPersonsChanged:function(t,i,s){e(this).triggerHandler("personsChanged",[this,new n.ContactsReaderChangedEventArgs(t,i,s)])},onSettingsChanged:function(){e(this).triggerHandler("settingsChanged",[this,null])}}}(window.originaljQuery||jQuery)}),define("peoplecache",["contactsreader"],function(){!function(e){var t="$pwc",n=window,i=n.MC,s=n.Microsoft.Live.Messenger.Services,o=n.ss,r=s.ContactsReader,a=["GOOG","FB"],c=s.PeopleCache=function(e){this._changeProcessingTimer$1=-1,r.call(this),null==e&&(e=t),this._id$1=e,this._networksChanges$1=[],this._personsChanges$1=[]},l=c.prototype=new r;l.constructor=c,l._id$1=null,l._dataSource$1=null,l._checkInterval$1=5,l._networksChanges$1=null,l._personsChanges$1=null,l.get_networks=function(){var e=this;if(!e._dataSource$1||!e._dataSource$1.services)return null;for(var t=[],n=0;n<e._dataSource$1.services.length;n++){var i=e._dataSource$1.services[n],s=i._d[0];a.contains(s)||t.push(i)}return t},l.get_persons=function(){return null!=this._dataSource$1?this._dataSource$1.persons:null},l.get_settings=function(){return null!=this._dataSource$1?this._dataSource$1.settings:null},l.initialize=function(e){r.prototype.initialize.call(this,e),this._checkPeopleCache$1()},l.notifyAddressBookChange=function(e){this._dataSource$1.processABChangedEvent(e)},l._checkPeopleCache$1=function(){var e=this.get__dataSource$1();if(null!=e)if(e.isReady)this._onDataSourceReady$1();else if(e.isFailed)this.onInitialized(i.MessengerServiceResultCode.failure);else{var t=o.Delegate.create(this,this._onDataSourceReady$1);this._bindEvent$1(this.get__dataSource$1(),"$events","ready",t);var s=o.Delegate.create(this,this._onDataSourceFailed);this._bindEvent$1(this.get__dataSource$1(),"$events","failed",s)}else n.setTimeout(o.Delegate.create(this,this._checkPeopleCache$1),this._getCheckInterval$1())},l.get__dataSource$1=function(){return null==this._dataSource$1&&(this._dataSource$1=n[this._id$1]),this._dataSource$1},l._getCheckInterval$1=function(){return this._checkInterval$1<1e3&&(this._checkInterval$1+=10),this._checkInterval$1},l._onDataSourceReady$1=function(){this._bindChangedEvents$1(),this.onInitialized(i.MessengerServiceResultCode.success)},l._onDataSourceFailed=function(){this.onInitialized(i.MessengerServiceResultCode.failure)},l._bindChangedEvents$1=function(){var t=o.Delegate.create(this,this._onPcNetworksChanged$1),n=o.Delegate.create(this,this._onPcPersonsChanged$1),i=o.Delegate.create(this,this._onPcSettingsChanged$1);this._bindEvent$1(this.get__dataSource$1(),"$services","changed",t),this._bindEvent$1(this.get__dataSource$1(),"$persons","changed",n),this._bindEvent$1(this.get__dataSource$1().settings,"$changes","changed",i),e(this.get__dataSource$1()).bind("fullSync",o.Delegate.create(this,this._onFullSync))},l._onFullSync=function(){this._onPcNetworksChanged$1(null,{changed:this.get__dataSource$1().services}),this._onPcPersonsChanged$1(null,{changed:this.get__dataSource$1().persons}),this._onPcSettingsChanged$1({changed:this.get__dataSource$1().settings})
},l._bindEvent$1=function(e,t,n,i){var s=e[t];o.isNullOrUndefined(s)||s.bind(n,i)},l._filterNetworkUpdateType$1=function(e){var t,n;for(t=e.length;t--;)n=e[t].getId(),a.contains(n)&&e.splice(t,1)},l._filterNetworkUpdates$1=function(e){this._filterNetworkUpdateType$1(e.added),this._filterNetworkUpdateType$1(e.changed),this._filterNetworkUpdateType$1(e.removed)},l._onPcNetworksChanged$1=function(e,t){this._filterNetworkUpdates$1(t),this._networksChanges$1.push(t),this._scheduleProcessChanges$1()},l._onPcPersonsChanged$1=function(e,t){this._personsChanges$1.push(t),this._scheduleProcessChanges$1()},l._onPcSettingsChanged$1=function(){r.prototype.onSettingsChanged.call(this)},l._scheduleProcessChanges$1=function(){-1===this._changeProcessingTimer$1&&(this._changeProcessingTimer$1=n.setTimeout(o.Delegate.create(this,this._processChanges$1),1))},l._processChanges$1=function(){n.clearTimeout(this._changeProcessingTimer$1),this._changeProcessingTimer$1=-1;for(var e=0;e<this._networksChanges$1.length;e++){var t=this._networksChanges$1[e];r.prototype.onNetworksChanged.call(this,t.added,t.changed,t.removed)}for(e=0;e<this._personsChanges$1.length;e++)t=this._personsChanges$1[e],r.prototype.onPersonsChanged.call(this,t.added,t.changed,t.removed)}}(window.originaljQuery||jQuery)}),define("personinforeader",["peoplecache"],function(){!function(){var e=window,t=e.MC,n=e.Microsoft.Live.Messenger,i=n.Services,s=i.ContactsReader,o=i._personInfoReader=function(e,t){s.call(this),null==e||0===e.length?n._exceptionHelper.createArgumentException("Persons must contain at least one item.","persons"):(null==t||0===t.length)&&n._exceptionHelper.createArgumentException("Networks must contain at least one item.","networks"),this._persons$1=e,this._networks$1=t},r=o.prototype=new s;r.constructor=o,r._persons$1=null,r._networks$1=null,r.get_networks=function(){return this._networks$1},r.get_persons=function(){return this._persons$1},r.get_settings=function(){return null},r.notifyAddressBookChange=function(){},r.initialize=function(e){s.prototype.initialize.call(this,e),this.onInitialized(t.MessengerServiceResultCode.success)}}()}),define("authenticationcompletedeventargs",["personinforeader"],function(){!function(){var e=window,t=e.Microsoft.Live.Messenger,n=t.AuthenticationStatus;t.AuthenticationCompletedEventArgs=function(e){this._identity$1=e,this._authStatus$1=n.none},t.AuthenticationCompletedEventArgs.prototype={_identity$1:null,_authStatus$1:n.none,_resultCode$1:t.AuthenticationResultCode.success,_serverName$1:null,get_status:function(){return this._authStatus$1},set_status:function(e){return this._authStatus$1=e,e},get_identity:function(){return this._identity$1},get_isAlreadySignedIn:function(){return 0!==(this._authStatus$1&n.alreadySignedIn)},get_isUnsupportedBrowser:function(){return 0!==(this._authStatus$1&n.unsupportedBrowser)},get_insecureTransportNotSupported:function(){return 0!==(this._authStatus$1&n.insecureTransportNotSupported)},get_multipleEndpointsNotSupported:function(){return 0!==(this._authStatus$1&n.multipleEndpointsNotSupported)},get_isBlockedApplication:function(){return 0!==(this._authStatus$1&n.blockedApplication)},get_isBlockedUser:function(){return 0!==(this._authStatus$1&n.blockedUser)},get_authenticationFailure:function(){return 0!==(this._authStatus$1&n.authenticationFailure)||0!==(this._authStatus$1&n.serviceUnavailable)},get_serviceUnavailable:function(){return 0!==(this._authStatus$1&n.serviceUnavailable)},get_resultCode:function(){return this._resultCode$1},set_resultCode:function(e){return this._resultCode$1=e,e},get_user:function(){return this.get_identity().get__user()},get_serverName:function(){return this._serverName$1},set_serverName:function(e){return this._serverName$1=e,e}}}()}),define("identity",["authenticationcompletedeventargs"],function(){!function(e){var t=window,n=t.$Config,i=t.MC,s=t.Microsoft.Live.Messenger,o=s.Services,r=t.MSH,a=t.ss,c=s.AuthenticationStatus,l=s.AuthenticationResultCode;s.Identity=function(){this._identityInfo=new i.IdentityInfo(null,null),this._identityInfo.authenticationInfo=new i.AuthenticationInfo(i.AuthenticationType.rpsAuth,""),this._isAuthenticated=!0,this._services=s._globalConfiguration.get__defaultServices()},s.Identity.prototype={_identityInfo:null,_userService:null,_userEvents:null,_user:null,_isAuthenticated:!1,_disposed:!1,_reloaded:!1,_signinScenarioQoSObject:null,_reconnectScenarioQoSObject:null,isAuthenticationCompleted:!1,isGetMappingContainerCompleted:!1,_skypeInitTimeoutId:-1,_skypeLoginStartTime:null,skypeLoginTime:0,get_liveId:function(){return this._identityInfo.liveId},get_signinScenarioQoSObject:function(){return this._signinScenarioQoSObject},set_signinScenarioQoSObject:function(e){return this._signinScenarioQoSObject=e,e},get_reconnectScenarioQoSObject:function(){return this._reconnectScenarioQoSObject},set_reconnectScenarioQoSObject:function(e){return this._reconnectScenarioQoSObject=e,e},get_skypeId:function(){return this._identityInfo.skypeId},get_cid:function(){return this._identityInfo.cid},get_token:function(){return this.get__authenticationInfo().ticket},set_token:function(e){if(a.isNullOrEmpty(e))throw s._exceptionHelper.createArgumentNullOrEmptyException("value",e);return this.get__authenticationInfo().ticket=e,e},_setLiveId:function(e){this._identityInfo.liveId!==e&&(this._identityInfo.liveId=e,this.onPropertyChanged(new s.PropertyChangedEventArgs("LiveId")))},_setCid:function(e){this._identityInfo.cid!==e&&(this._identityInfo.cid=e,this.onPropertyChanged(new s.PropertyChangedEventArgs("Cid")))},_setSkypeId:function(e){this._identityInfo.skypeId!==e&&(this._identityInfo.skypeId=e,this.onPropertyChanged(new s.PropertyChangedEventArgs("SkypeId")))},_initializeSkyJS:function(){var e=this;e._skypeLoginStartTime=new Date;var s={};s.liveIframePath="/handlers",s.mwtEnv=n.WebIM.ev,s.region=n.mkt.toLowerCase(),s.cid=this._identityInfo.cid,s.hostProperty=n.WebIM.cn,s.mappingReady=a.Delegate.create(this,this.onSkyJSInitMappingReady),s.success=a.Delegate.create(this,this.onSkyJSInitSuccess),s.error=a.Delegate.create(this,this.onSkyJSInitFailure),s.callStarted=a.Delegate.create(this,this.onCallStarted),s.pluginStarted=a.Delegate.create(this,this.onpluginStarted),s.callFinished=a.Delegate.create(this,this.onCallFinished),o.SkyJSHelper.getInstance().Outlook.init&&o.SkyJSHelper.getInstance().Outlook.init(s)?null!=t.InboxPage&&null!=t.InboxPage.Config&&!t.Config.SkypeOptions.isSkypeIntegrated&&t.OptionsWriter&&t.OptionsWriter.fireOption(t.InboxPage.Config.SkypeOptions.skypeIntegratedSettingUrl):(e._onGetMappingContainerCompleted(),i.Logger.logAction("WebIM_Skype_DisabledByRollout")),e.isGetMappingContainerCompleted||(e._skypeInitTimeoutId=t.setTimeout(function(){e._skypeInitTimeoutId=-1,e.onSkyJSInitFailure({code:408,text:"WebIM timeout"})},3e4))},onSkyJSInitMappingReady:function(){if(this._clearInitTimeout(),!o.SkyJSHelper.get_skypeInitCompleted()&&(this.skypeLoginTime=Math.floor((new Date-this._skypeLoginStartTime)/1e3),!this.isGetMappingContainerCompleted)){var e=o.SkyJSHelper.getInstance().Outlook.getMappingContainer();a.isNullOrEmpty(e)?i.WebmainHelper.addQoSStats(i.WebmainHelper.qoSApiGetUic,"UicTicketMissing",i.WebmainHelper.qoSSigninApiStartTime,this.get_signinScenarioQoSObject(),!1):(this._setUicTicket(e),i.WebmainHelper.addQoSStats(i.WebmainHelper.qoSApiGetUic,null,i.WebmainHelper.qoSSigninApiStartTime,this.get_signinScenarioQoSObject(),!1))}},onSkyJSInitSuccess:function(){this._clearInitTimeout(),o.SkyJSHelper.get_skypeInitCompleted()||o.SkyJSHelper.set_skypeInitCompleted()},onSkyJSInitFailure:function(e){if(this._clearInitTimeout(),!o.SkyJSHelper.get_skypeInitCompleted()){this.skypeLoginTime=Math.floor((new Date-this._skypeLoginStartTime)/1e3),o.SkyJSHelper.set_skypeInitCompleted();var t=e.code;if(403===t)o.SkyJSHelper.skypeAudioVideoEnabled=!1,i.Logger.logAction("WebIM_Skype_AudioVideoDisabled_BrowserNotSupported");else{o.SkyJSHelper.reportSkypeLogin(!1,t.toString());var n=a.isNullOrEmpty(e.text)?t.toString():a.format("{0}-{1}",t,e.text),s=!1;413==t&&(s=!0,n="FailedToSignTrouterUrlTooManyConnections"),i.WebmainHelper.addQoSStats(i.WebmainHelper.qoSApiGetUic,n,i.WebmainHelper.qoSSigninApiStartTime,this.get_signinScenarioQoSObject(),s)}this._onGetMappingContainerCompleted()}},onCallStarted:function(){o.SkyJSHelper.skypeCallStarted()},onCallFinished:function(){o.SkyJSHelper.skypeCallFinished()},onpluginStarted:function(){o.SkyJSHelper.skypePluginStarted()},get_isAuthenticated:function(){return this._isAuthenticated},get_reloaded:function(){return this._reloaded},set_reloaded:function(e){return this._reloaded!==e&&(this._reloaded=e,this.onPropertyChanged(new s.PropertyChangedEventArgs("Reloaded"))),e},_setIsAuthenticated:function(e){this._isAuthenticated!==e&&(this._isAuthenticated=e,this.onPropertyChanged(new s.PropertyChangedEventArgs("IsAuthenticated")))},get__endpointId:function(){return a.isNullOrEmpty(this._identityInfo.endpointId)&&this.set__endpointId(s.Guid.newGuid().toString()),this._identityInfo.endpointId},set__endpointId:function(e){return e=e.toLowerCase(),this._identityInfo.endpointId!==e&&(this._identityInfo.endpointId=e,this.onPropertyChanged(new s.PropertyChangedEventArgs("EndpointId"))),e},get__initialServices:function(){return this._services},get__userEvents:function(){return null==this._userEvents&&(this._userEvents=new s._userEvents(this)),this._userEvents},_failSignInStatus:function(){var e=new s.AuthenticationCompletedEventArgs(this);e.set_status(c.serviceUnavailable|c.unsupportedBrowser),e.set_resultCode(l.failure),this.onAuthenticationCompleted(e)},_onInitialized:function(){this._setIsAuthenticated(!0),this.get_isAuthenticated()&&this.set__endpointId(s.Guid.newGuid().toString()),this.isAuthenticationCompleted=!0,this.isGetMappingContainerCompleted&&this._onInitializationCompleted()},_onGetMappingContainerCompleted:function(){this.isGetMappingContainerCompleted||(this.isGetMappingContainerCompleted=!0,this.isAuthenticationCompleted&&this._onInitializationCompleted())},_setUicTicket:function(e){a.isNullOrEmpty(e)?o.SkyJSHelper.reportSkypeLogin(!1,"UicTicketMissing"):(this.get__authenticationInfo().uicTicket=e,o.SkyJSHelper.skypeEnabled=!0,o.SkyJSHelper.skypeAudioVideoEnabled=!0,o.SkyJSHelper.reportSkypeLogin(!0,"success")),this._onGetMappingContainerCompleted()},_onInitializationCompleted:function(){var e=new s.AuthenticationCompletedEventArgs(this);this.get_isAuthenticated()?(e.set_status(c.none),e.set_resultCode(l.success)):(e.set_status(c.none),e.set_resultCode(l.failure)),this.onAuthenticationCompleted(e)},onAuthenticationCompleted:function(t){var n=this;r.Scheduler.defer(function(){e(n).triggerHandler("authenticationCompleted",[n,t])})},get__authenticationInfo:function(){return this._identityInfo.authenticationInfo},set__authenticationInfo:function(e){return this._identityInfo.authenticationInfo=e,e},_getIdentityInfo:function(){var e=new i.IdentityInfo(this.get_liveId(),this.get__endpointId());return e.cid=this.get_cid(),e.authenticationInfo=this.get__authenticationInfo(),e.skypeId=this.get_skypeId(),e},get__userService:function(){return null==this._userService&&(this._userService=o.UserServiceFactory.create(this,this.get__userEvents())),this._userService},_setUserService:function(e){this._userService=e},onPropertyChanged:function(t){e(this).triggerHandler("propertyChanged",[this,t])},_onTokenExpired:function(){},get__user:function(){return this._user},set__user:function(e){if(null!=this._user&&this._user!==e)throw s._exceptionHelper.createInvalidOperationException(s._exceptions.userIdentityEnforceOneToOneBinding);return this._user=e,e},get__isDisposed:function(){return this._disposed},dispose:function(){this._disposed||(this._disposed=!0,e(this).triggerHandler("disposed",[this,{}]))},_clearInitTimeout:function(){this._skypeInitTimeoutId>-1&&(t.clearTimeout(this._skypeInitTimeoutId),this._skypeInitTimeoutId=-1)}}}(window.originaljQuery||jQuery)}),define("delayedservicefactory",["identity"],function(){!function(){var e=window,t=e.MC,n=e.MSP,i=e.MSCr,s=e.MSI,o=e.MSCh,r=e.MSCo;i.DelayedServiceFactory=function(){this._identityService=this._createIdentityService(),this._identity=new t.IdentityInfo(null,null)},i.DelayedServiceFactory.prototype={_identity:null,_identityService:null,_userServiceEvents:null,_userService:null,createUserService:function(e){return this._userServiceEvents=e,this._userService=new i.UserService(this._identity,this,this._userServiceEvents,this._createIdentityService()),this._userService},createConnectionService:function(e,t){var i=new n.ConnectionService(e,t,"https://"===r.HttpRequest.get_defaultScheme());return i},createConversationService:function(e,t,n){var i=new o.ConversationService(e,t,n);return i},_createIdentityService:function(){return null==this._identityService&&(this._identityService=new s.IdentityService),this._identityService}}}()}),define("userservicefactory",["delayedservicefactory"],function(){!function(){var e=window,t=e.Microsoft.Live.Messenger,n=t.Services,i=e.MSCr,s=null,o=n.UserServiceFactory=function(){};o.get__defaultImplementation=function(){return s},o.set__defaultImplementation=function(e){return s=e,e},o.create=function(e,t){if(null!=s)return s;var n=new i.DelayedServiceFactory;return n.createUserService(t)}}()}),define("icontactcollectionowner",["userservicefactory"],function(){!function(){var e=window,t=e.Microsoft.Live.Messenger;t._iContactCollectionOwner=function(){},t._iContactCollectionOwner.prototype={canAddContact:null,canRemoveContact:null,addContact:null,removeContact:null,containsContact:null,setCollection:null,get_capacity:null}}()}),define("iimaddresscollectionowner",["icontactcollectionowner"],function(){!function(){var e=window,t=e.Microsoft.Live.Messenger;t._iimAddressCollectionOwner=function(){},t._iimAddressCollectionOwner.prototype={addAddress:null,removeAddress:null}}()}),define("collection",["iimaddresscollectionowner"],function(){!function(e){var t=window,n=t.Microsoft.Live.Messenger,i=t.ss;n.Collection=function(){this._items=[],this._resetting=!1},n.Collection.prototype={_resetting:!1,onCollectionChanged:function(t){e(this).triggerHandler("collectionChanged",[this,t])},onPropertyChanged:function(t){e(this).triggerHandler("propertyChanged",[this,t])},get__isResetting:function(){return this._resetting},get_count:function(){return this._items.length},get__items:function(){return this._items},_onPropertyChangedInternal:function(e){this._resetting||this.onPropertyChanged(new n.PropertyChangedEventArgs(e))},_onCollectionChangedInternal:function(e,t,i,s){this._resetting||this.onCollectionChanged(new n.NotifyCollectionChangedEventArgs(e,t,i,s))},_onCollectionChangedAddRange:function(e,t){this._resetting||this.onCollectionChanged(n.NotifyCollectionChangedEventArgs._create(n.NotifyCollectionChangedAction.add,e,null,t,-1))},_beginReset:function(){this._resetting=!0},_endReset:function(){this._resetting=!1,this._onPropertyChangedInternal("Count"),this._onCollectionChangedInternal(n.NotifyCollectionChangedAction.reset,null,null,0)},_contains:function(e){return this._items.contains(e)},_addInternal:function(e){this._items.push(e),this._resetting||(this._onPropertyChangedInternal("Count"),this._onCollectionChangedInternal(n.NotifyCollectionChangedAction.add,e,null,this._items.length-1))},_removeInternal:function(e){var t=this._items.indexOf(e);t>=0&&(this._items.splice(t,1),this._onPropertyChangedInternal("Count"),this._onCollectionChangedInternal(n.NotifyCollectionChangedAction.remove,null,e,t))},_setInternal:function(e,t){var i=this._items[e];i!==t&&(this._items[e]=t,this._onCollectionChangedInternal(n.NotifyCollectionChangedAction.replaced,t,i,e))},_insertInternal:function(e,t,i){this._items.insert(e,t),this._onPropertyChangedInternal("Count"),i&&this._onCollectionChangedInternal(n.NotifyCollectionChangedAction.add,t,null,e)},_removeAtInternal:function(e,t){var i=this._items[e];this._items.splice(e,1),this._onPropertyChangedInternal("Count"),t&&this._onCollectionChangedInternal(n.NotifyCollectionChangedAction.remove,null,i,e)},_insertRangeInternal:function(e,t){for(var n=e;n<e+t.length;n++)null!=t[n]&&this._items.insert(n,t[n]);this._onPropertyChangedInternal("Count"),this._onCollectionChangedAddRange(t,e)},_moveInternal:function(e,t){if(t!==e&&e>=0&&e<=this.get_count()){var i=this._items[t];this._removeAtInternal(t,!1),this._insertInternal(e,i,!1),this._onCollectionChangedInternal(n.NotifyCollectionChangedAction.replaced,i,i,e)}},getItem:function(e){var t=this._items;if(0>e||e>=t.length)throw n._exceptionHelper.createArgumentOutOfRangeException("index");return t[e]},getEnumerator:function(){return i.IEnumerator.getEnumerator(this._items)}}}(window.originaljQuery||jQuery)}),define("network",["collection"],function(){!function(e){function t(e,t,n,i,s){var o={};o[0]=e,o[1]=t,o[3]=1,o[8]=n,o[9]=i,o[10]=s;var r=new wLive.People.Service(o);return r}var n=window,i=n.MC,s=(n.MSH,n.ss,n.Microsoft.Live.Messenger),o=i.NetworkConnectionType,r=i.NetworkOperationType,a=s.NetworkStatus,c=s.Network=function(e,t){this._pwcService=e,this._connectionType=t,this._imEnabled=e.getSupportsIm()&&!e.getOnHideList()};c._networkIdWindowsLive="WL",c._networkIdSkype="SKYPE",c._networkIdOfficeCommunicator="OCS",c._networkIdTelephone="SMS",c._networkIdFacebook="FB",c._networkIdGoogle="GOOG",c._networkIdMySpace="MYSP",c._windowsLive=null,c._officeCommunicator=null,c._telephone=null,c._skype=null,c.get__windowsLive=function(){if(null==c._windowsLive){var e=t(c._networkIdWindowsLive,s._localization.networkWindowsLive,MSCo.Configuration.get_profileUrlFormat(),MSCo.Configuration.get_photoUrlFormat(),MSCo.Configuration.get_sendMessageUrlFormat());c._windowsLive=new c(e,o.windowsLive)}return c._windowsLive},c.get__skype=function(){if(null==c._skype){var e=t(c._networkIdSkype,s._localization.networkSkype,null,null,null);c._skype=new c(e,o.windowsLive)}return c._skype},c.get__officeCommunicator=function(){if(null==c._officeCommunicator){var e=t(c._networkIdOfficeCommunicator,s._localization.networkOfficeCommunicator,null,null,null);c._officeCommunicator=new c(e,o.windowsLive)}return c._officeCommunicator},c.get_telephone=function(){if(null==c._telephone){var e=t(c._networkIdTelephone,s._localization.networkTelephone,null,null,null);c._telephone=new c(e,o.windowsLive)}return c._telephone},c.prototype={_pwcService:null,_imEnabled:!1,_user:null,_status:a.signedOut,_connectionType:o.none,get_iconUrl:function(){return s._globalConfiguration._getNetworkIconUrl(this._pwcService.getId())},get_iconErrorUrl:function(){return s._globalConfiguration._getNetworkIconErrorUrl(this._pwcService.getId())},get_id:function(){return this._pwcService.getId()},get_imEnabled:function(){return this._imEnabled},set_imEnabled:function(e){if(!this.get_supportsRemoteSignIn())throw s._exceptionHelper.createInvalidOperationException(s._exceptions.networkIMEnabledTogglingNotAllowed);if(this._imEnabled!==e){this._imEnabled=e;var t=e?r.enableIM:r.disableIM;this._user._updateNetwork(this.get_id(),t,!0),this._onPropertyChanged("IMEnabled")}return e},get_name:function(){return this._pwcService.getName()},get_status:function(){return this._status},get_tokenState:function(){return this._pwcService.getTokenState()},get_supportsIM:function(){return this._pwcService.getSupportsIm()},get_pwcService:function(){return this._pwcService},get_supportsRemoteSignIn:function(){return this._connectionType===o.connect},get_isWindowsLive:function(){return this._pwcService.getId()===c._networkIdWindowsLive},get_isOfficeCommunicator:function(){return this._pwcService.getId()===c._networkIdOfficeCommunicator},get_isFacebook:function(){return this._pwcService.getId()===c._networkIdFacebook},get_isGoogle:function(){return this._pwcService.getId()===c._networkIdGoogle},get_isSkype:function(){return this._pwcService.getId()===c._networkIdSkype},get__info:function(){var e=new i.NetworkInfo(this.get_id(),this.get_name(),this._connectionType,this.get__isRemoteNetwork(),this._pwcService.getPhotosUrl(),this._pwcService.getProfileUrl(),this._pwcService.getSendMessageUrl(),this._pwcService.getReportAbuseUrl());return e.rank=this._pwcService.getRank(),e.imEnabled=this._imEnabled,e},get__user:function(){return this._user},set__user:function(e){return this._user=e,e},get__isRemoteNetwork:function(){return this._connectionType!==o.windowsLive},get__rank:function(){return this._pwcService.getRank()},_setStatus:function(e){this._status!==e&&(this._status=e,this._status===i.NetworkInfoStatus.signedOut&&this._markLinkedContactsOffline(),this._onPropertyChanged("Status"))},_onUpdateNetworkCompleted:function(e,t){if(e!==i.MessengerServiceResultCode.success&&e===i.MessengerServiceResultCode.failedToPersist){var n=t&(r.enableIM|r.disableIM),s=!1;switch(n){case r.enableIM:this.get_imEnabled()&&(s=!0,this._imEnabled=!1);break;case r.disableIM:this.get_imEnabled()||(s=!0,this._imEnabled=!0)}s&&this._onPropertyChanged("IMEnabled")}},_setNetworkChanges:function(e){var t=[];this._pwcService.getName()!==e.getName()&&t.push("Name"),this._pwcService.getSupportsIm()!==e.getSupportsIm()&&t.push("SupportsIM");var n=e.getSupportsIm()&&!e.getOnHideList();if(this._imEnabled!==n){this._imEnabled=n,t.push("IMEnabled");var i=this._imEnabled?r.enableIM:r.disableIM;this._user._updateNetwork(this.get_id(),i,!0)}this._pwcService.getTokenState()!==e.getTokenState()&&t.push("TokenState"),this._pwcService=e;for(var s=0;s<t.length;s++)this._onPropertyChanged(t[s])},_markLinkedContactsOffline:function(){this._user.get_contactMap()._markOffline(!0,this.get_id())},_onPropertyChanged:function(t){e(this).triggerHandler("propertyChanged",[this,new s.PropertyChangedEventArgs(t)])}}}(window.originaljQuery||jQuery)}),define("presenceproperty",["network"],function(){!function(){var e=window,t=e.ss,n=e.Microsoft.Live.Messenger;n.PresenceProperty=function(e,i){if(t.isNullOrEmpty(e))throw n._exceptionHelper.createArgumentNullOrEmptyException("name",e);if(null==i)throw n._exceptionHelper.createArgumentNullException("value");this._name=e,this._value=i},n.PresenceProperty.prototype={_name:null,_value:null,get_name:function(){return this._name},get_value:function(){return this._value}}}()}),define("presencepropertycollection",["presenceproperty"],function(){!function(){var e=window,t=e.ss,n=e.Microsoft.Live.Messenger,i=n.Collection,s=n.PresencePropertyCollection=function(e,t){i.call(this),this._loadServiceData(e,t)},o=s.prototype=new i;o.constructor=s,o._serviceData$1=null,o._serviceEndpointData$1=null,o._onServiceDataChanged=function(e){var t=!1,n=this._findServiceByType$1(e.service);return null!=n&&(t=this._setChangesOnProperties$1(e.updatedProperties,n.get_properties())),t},o._onEndpointServiceDataChanged=function(e,t){var n=!1,i=this._findServiceByType$1(e.service);null!=i&&(n=this._setChangesOnProperties$1(e.updatedProperties,i.get_properties()));var s=this._findServiceEndpointByType$1(e.service);return null!=s&&(n=1===(n|this._setChangesOnProperties$1(e.updatedEndpoints[t],s.get_properties()))),n},o._loadServiceData=function(e,t){this._serviceData$1=e,this._serviceEndpointData$1=t,this._initializeItems$1()},o._setChangesOnProperties$1=function(e,i){for(var s=!1,o=e.length,r=0;o>r;r++){var a=e[r],c=this._indexOf$1(a);if(t.keyExists(i,a)){var l=i[a];Object.isString(l)&&(-1===c?this._addInternal(new n.PresenceProperty(a,l)):this._setInternal(c,new n.PresenceProperty(a,l)),s=!0)}else this._removeInternal(c),s=!0}return s},o._indexOf$1=function(e){for(var t=this.get_count(),n=0;t>n;n++)if(this.get__items()[n].get_name()===e)return n;return-1},o._findServiceByType$1=function(e){for(var t=0;t<this._serviceData$1.length;t++)if(this._serviceData$1[t].get_service()===e)return this._serviceData$1[t];return null},o._findServiceEndpointByType$1=function(e){for(var t=0;t<this._serviceEndpointData$1.length;t++)if(this._serviceEndpointData$1[t].get_service()===e)return this._serviceEndpointData$1[t];return null},o._initializeItems$1=function(){for(var e=0;e<this._serviceData$1.length;e++)this._initializeProperties$1(this._serviceData$1[e].get_properties());for(e=0;e<this._serviceEndpointData$1.length;e++)this._initializeProperties$1(this._serviceEndpointData$1[e].get_properties())},o._initializeProperties$1=function(e){var t=e;for(var i in t){var s={key:i,value:t[i]},o=s.value;Object.isString(o)&&this._addInternal(new n.PresenceProperty(s.key,o))}},o.get_item=function(e){if(null==e)throw n._exceptionHelper.createArgumentNullException("key");if(Object.isString(e)){var i=e;if(t.isNullOrEmpty(i))throw n._exceptionHelper.createArgumentNullOrEmptyException("name",i);for(var s=0;s<this.get_count();s++)if(this.get__items()[s].get_name()===i)return this.get__items()[s];return null}if(Object.isNumber(e))return this.getItem(e);throw n._exceptionHelper.createArgumentOutOfRangeException("key")}}()}),define("imaddress",["presencepropertycollection"],function(){!function(e){var t=window,n=t.$WLXIM,i=t.MC,s=t.Microsoft.Live.Messenger,o=(s.Network,s.Services),r=t.MSH,a=t.ss,c=i.IMAddressInfoType,l=i.IMServiceDataProperties,u=i.RoleLists,d=i.ServiceType,_=s.IMAddressType,g=s.PresenceStatus,h=s.IMAddress=function(e,t){this._user=e,this._addressInfo=t,this._network=this._checkNetwork(),this._messagingAddress=t.messagingAddress,this._updateMessagingAddress()};h._checkAddressType=function(e){return a.isNullOrEmpty(e)?c.none:(e=e.trim(),e.indexOf("@")>0?c.windowsLive:e.startsWith("+")?c.telephone:c.cid)},h._isInviteMessageValid=function(e){return a.isNullOrEmpty(e)||e.length<256},h.prototype={_user:null,_addressInfo:null,_endpoints:null,_capabilities:null,_presence:null,_network:null,_linkedContact:null,_serviceData:null,_isPendingInbound:!1,changeToSkypeAddress:function(){var e=new i.IMAddressInfo(this.get_skypeName(),c.skype,this._addressInfo.roleLists);this._addressInfo=e},get_address:function(){switch(this._addressInfo.type){case c.cid:case c.connect:return"";case c.telephone:return this._addressInfo.address;default:return this._user.get_identity().get__authenticationInfo().authType!==i.AuthenticationType.rpsAuth?"":this._addressInfo.address}},get_type:function(){switch(this._addressInfo.type){case c.windowsLive:case c.cid:return _.windowsLive;case c.connect:return _.connect;case c.officeCommunicator:return _.officeCommunicator;case c.telephone:return _.telephone;case c.smtp:return _.smtp;case c.skype:return _.skype;case c.shortCircuit:return _.shortCircuit;case c.temporaryGroup:return _.temporaryGroup;default:return _.none}},get_id:function(){return r.ContactHelper.computeIMAddressId(this._addressInfo)},get_linkedContact:function(){return this._linkedContact},get_network:function(){return this._network},get_endpoints:function(){return null==this._endpoints&&(this._endpoints=new s.EndpointCollection(this)),this._endpoints},get_capabilities:function(){return null==this._capabilities&&(this._capabilities=new s._imAddressCapabilities(this)),this._capabilities},get_cid:function(){return this.get_type()===_.windowsLive?this.get__info().cid:""},get_skypeName:function(){if(a.isNullOrEmpty(this.get__info().skypeId)){if(this.get_type()===_.skype)return this.get_address();if(this.get_type()===_.windowsLive&&null!=this._serviceData&&null!=this._serviceData.skpServiceData){var e=this._serviceData.skpServiceData.get_item(i.SKPServiceDataProperties.skypeName);return null==e?"":e}return""}return this.get__info().skypeId},get_presence:function(){return null==this._presence&&(this._presence=new s.IMAddressPresence(this)),this._presence},get_isOnline:function(){if(null==this._presence)return!1;switch(this.get_presence().get_status()){case g.appearOffline:case g.offline:return!1}return!0},get_isPendingInbound:function(){return this._isPendingInbound},set_isPendingInbound:function(e){return this._isPendingInbound!==e&&(this._isPendingInbound=e,this._onPropertyChanged("IsPendingInbound")),e},get_supportsAppearOfflineTo:function(){return!this._network.get__isRemoteNetwork()&&this._linkedContact.get__isContact()},get_isFederated:function(){switch(this._addressInfo.type){case c.windowsLive:case c.cid:return!1;default:return!0}},get_canSendInvite:function(){return n.isSkypeInvitesEnabled()&&this.get_type()===_.shortCircuit?!0:!1},get_isIdentityVerified:function(){return this.get__serviceDataSet().peServiceData.get_isIdentityVerified()},get_isContact:function(){return 0!==(this._addressInfo.roleLists&u.forward)},get_isAllowed:function(){return 0!==(this._addressInfo.roleLists&u.allow)},get_isBlocked:function(){return 0!==(this._addressInfo.roleLists&u.block)},get_isAppearOfflineTo:function(){return this.get__user().get_presence().get_status()===g.appearOffline?!0:s.Contact._isAppearOfflineRoleLists(this._addressInfo.roleLists)},get_supportsReportAbuse:function(){return this.get_type()===_.windowsLive||this.get_type()===_.skype||this.get_type()===_.shortCircuit?!0:!1},get_isGroupChatCapable:function(){return this.get_type()===_.skype&&i.GroupChatFeatures.phase!=i.GroupChatPhase.disabled?!0:!1},get_isAudioVideoCapable:function(){if(!o.SkyJSHelper.skypeEnabled||!o.SkyJSHelper.skypeAudioVideoEnabled)return!1;if(this.get_type()===_.shortCircuit)return!0;if(this.get_presence().get_status()!==g.offline&&this.get_presence().get_status()!==g.appearOffline){if(this.get_type()===_.skype)return!0;if(null!=this._serviceData&&null!=this._serviceData.skpServiceData&&!a.isNullOrEmpty(this._serviceData.skpServiceData.get_item(i.SKPServiceDataProperties.skypeName)))return!0}return!1},get_networkIconUrl:function(){return this.get_network().get_iconUrl()},get_contact:function(){return null==this._linkedContact?null:this._linkedContact.get__contact()},get_rank:function(){var e=this.get_type(),t=100;switch(e){case c.skype:t=1;break;case c.windowsLive:t=2;break;case c.connect:this.get_network().get_isFacebook()?t=3:this.get_network().get_isGoogle()&&(t=4);break;case c.shortCircuit:t=5;break;case c.telephone:t=6;break;case c.officeCommunicator:t=7;break;default:t=100}return this.get_isOnline()||(t+=10),t},get_isUser:function(){return this._user.get_address()===this||null!=this._user.get_skypeAddress()&&this._user.get_skypeAddress().get_address()===this.get_address()||this._user.get_shortCircuitAddress()===this},get__user:function(){return this._user},get__messagingAddress:function(){return this._messagingAddress},get__isMobile:function(){switch(this._addressInfo.type){case c.smtp:case c.telephone:return!0;default:return!1}},get_isFacebookMobileEnabled:function(){return this._addressInfo.isFacebookMobileEnabled},get_isAnonymous:function(){return this._addressInfo.address.endsWith("@anonymous.messenger.live.com")},get__isActive:function(){if(null==this._presence)return!1;switch(this.get_presence().get_status()){case g.online:case g.busy:case g.inACall:return!0}return!1},_isLocalEndpoint:function(e){return this._user.get_localEndpoint()===e},get__info:function(){return this._addressInfo},get__serviceDataSet:function(){return null==this._serviceData&&(this._serviceData=i.ServiceDataSet.create()),this._serviceData},get__addressKey:function(){return r.ContactHelper.getIMAddressInfoKey(this._addressInfo)},get__chatKey:function(){return r.ContactHelper.getIMAddressInfoKey(this.get__info())},equals:function(e){return null==e?!1:r.ContactHelper.areIMAddressesEqual(this._addressInfo,e._addressInfo)},_equalsByAddressAndType:function(e,t){return this._addressInfo.address===e&&this.get_type()===t},_setLinkedContact:function(e){this._linkedContact=e},_onUserAppearOfflineStatusChanged:function(){this._onPropertyChanged("IsAppearOfflineTo")},_setRoleListChanges:function(e,t){if(this._addressInfo.roleLists=e,t!==u.none){0!==(t&u.forward)&&this._onPropertyChanged("IsContact"),0!==(t&u.allow)&&this._onPropertyChanged("IsAllowed"),0!==(t&u.block)&&this._onPropertyChanged("IsBlocked");var n=null!=this._user.get_address()&&this._user.get_presence().get_status()===g.appearOffline,i=s.Contact._isAppearOfflineRoleLists(e^t),o=s.Contact._isAppearOfflineRoleLists(e);n||1!==(i^o)||this._onPropertyChanged("IsAppearOfflineTo")
}},_onServiceDataChanged:function(e){for(var t=!1,n=!1,i=!1,s=this.get__serviceDataSet().updateAll(e),o=a.IEnumerator.getEnumerator(s);o.moveNext();){var r=o.get_current();if(a.getKeyCount(r.deletedEndpoints)>0||a.getKeyCount(r.newEndpoints)>0||a.getKeyCount(r.updatedEndpoints)>0||r.updatedProperties.length>0)switch(t=1===(t|this.get_capabilities()._onServiceDataChanged(r)),n=1===(n|this.get_endpoints()._onServiceDataChanged(r)),i=1===(i|this.get_presence()._onServiceDataChanged(r)),r.service){case d.IM:this._setChangesIM(r);break;case d.PE:this._setChangesPE(r)}}t&&this._onPropertyChanged("Capabilities"),n&&this._onPropertyChanged("Endpoints"),i&&this._onPropertyChanged("Presence")},_onServiceDataDeleted:function(e){for(var t=!1,n=!1,i=!1,s=this.get__serviceDataSet().deleteAll(e),o=a.IEnumerator.getEnumerator(s);o.moveNext();){var r=o.get_current();switch(t=1===(t|this.get_capabilities()._onServiceDataChanged(r)),n=1===(n|this.get_endpoints()._onServiceDataDeleted(r)),i=1===(i|this.get_presence()._onServiceDataChanged(r)),r.service){case d.IM:this._setChangesIM(r);break;case d.PE:this._setChangesPE(r)}}t&&this._onPropertyChanged("Capabilities"),n&&this._onPropertyChanged("Endpoints"),i&&this._onPropertyChanged("Presence")},_onPropertyChanged:function(t){e(this).triggerHandler("propertyChanged",[this,new s.PropertyChangedEventArgs(t)]),this._updateMessagingAddress()},_updateMessagingAddress:function(){null!=this._messagingAddress&&this._messagingAddress._setProperty(this.get_contact()&&this.get_contact().get_currentAddress()==this,this.get_presence().get_status(),this.get_isAudioVideoCapable(),!0,this.get_isGroupChatCapable())},_setChangesIM:function(e){var t=e.updatedProperties;t.contains(l.status)&&this.get_contact()._onIMAddressStatusChanged(),t.contains(l.isOnline)&&(this._onPropertyChanged("IsOnline"),this.get_contact()._onIMAddressIsOnlineChanged())},_setChangesPE:function(e){e.updatedProperties.contains(i.PEServiceDataProperties.isIdentityVerified)&&(this._onPropertyChanged("IsIdentityVerified"),this.get_contact()._onIMAddressIdentityVerifiedChanged())},_checkNetwork:function(){switch(this._addressInfo.type){case c.connect:return this._user.get_networks().get_item(this._addressInfo.network);case c.officeCommunicator:return this._user.get_networks()._addOfficeCommunicator(),s.Network.get__officeCommunicator();case c.telephone:return this._user.get_networks()._addTelephone(),s.Network.get_telephone();case c.skype:case c.shortCircuit:case c.temporaryGroup:return this._user.get_networks()._addSkype(),s.Network.get__skype();default:return s.Network.get__windowsLive()}}}}(window.originaljQuery||jQuery)}),define("imaddresspresence",["imaddress"],function(){!function(e){var t="comments",n=window,i=n.MC,s=n.Microsoft.Live.Messenger,o=n.MSH,r=n.ss,a=i.IMServiceDataProperties,c=i.PEServiceDataProperties,l=i.SKPServiceDataProperties,u=i.ServiceType,d=i.PresenceInfoStatus,_=s.PresenceStatus,g=s.IMAddressPresence=function(e){this._address=e,this._serviceData=e.get__serviceDataSet(),this._properties=new s.PresencePropertyCollection([this._serviceData.imServiceData,this._serviceData.peServiceData,this._serviceData.cmServiceData,this._serviceData.skpServiceData],new Array(0))};g.isDisplayNameValid=function(e){if(null==e)return!1;var t=129;return e.length>t?!1:e.indexOf("&#")>=0?!1:!0},g.isPersonalMessageValid=function(e){return null==e?!1:e.length<=512},g._getLocalizedStatusText=function(e,t,n,i){switch(e){case _.appearOffline:return s._localization.statusAppearOffline;case _.offline:var o;return o=t===s.IMAddressType.connect&&n&&!i?"On Facebook Mobile":s._localization.statusOffline;case _.away:case _.idle:case _.beRightBack:case _.outToLunch:return s._localization.statusAway;case _.busy:case _.inACall:return s._localization.statusBusy;case _.online:return s._localization.statusOnline;default:return""}},g.prototype={_address:null,_properties:null,_serviceData:null,_displayPictureUrl:null,get_imAddress:function(){return this._address},get_properties:function(){return this._properties},get_displayName:function(){return this._serviceData.peServiceData.get_displayName()},get_displayPictureUrl:function(){return r.isNullOrEmpty(this._displayPictureUrl)&&(this._setDisplayPictureUrl(),r.isNullOrEmpty(this._displayPictureUrl))?null:this._displayPictureUrl},get_personalMessage:function(){return r.isNullOrEmpty(this._serviceData.peServiceData.get_richUserMessage())?this._serviceData.peServiceData.get_personalMessage():this._serviceData.peServiceData.get_richUserMessage()},set_personalMessage:function(e){if(this._ensureCanUpdate(),null==e)throw s._exceptionHelper.createArgumentNullException("value");if(e=e.trim(),!s.IMAddressPresence.isPersonalMessageValid(e))throw s._exceptionHelper.createArgumentException(s._exceptions.personalMessageInvalid,"value");if(this.get_personalMessage()!==e){var t=129,n=i.ServiceData.createEmpty(u.PE);n.set_personalMessage(e.substr(0,t)),n.set_richUserMessage(e),n.set_richLinkType(i.RichPsmLinkType.simpleText),n.set_richUrl(null),n.set_safeUrl(null),this._address.get__user()._updateServiceData(n)}return e},get_status:function(){switch(this._serviceData.imServiceData.get_status()){case d.appearOffline:return _.appearOffline;case d.away:return _.away;case d.beRightBack:return _.beRightBack;case d.busy:return _.busy;case d.idle:return _.idle;case d.inACall:return _.inACall;case d.online:return _.online;case d.outToLunch:return _.outToLunch;case d.none:case d.offline:return _.offline;default:return _.offline}},set_status:function(e){this._ensureCanUpdateStatus();var t=d.none;switch(e){case _.appearOffline:t=d.appearOffline;break;case _.away:t=d.away;break;case _.beRightBack:t=d.beRightBack;break;case _.busy:t=d.busy;break;case _.idle:t=d.idle;break;case _.inACall:t=d.inACall;break;case _.online:t=d.online;break;case _.outToLunch:t=d.outToLunch;break;case _.offline:t=d.none}if(t===d.none)throw s._exceptionHelper.createArgumentOutOfRangeException("Status");if(this._serviceData.imServiceData.get_status()!==t){var n=i.ServiceData.createEmpty(u.IM);n.set_status(t);var o=this._address.get__user();o._updateServiceData(n)}return e},get_statusText:function(){return g._getLocalizedStatusText(this.get_status(),this.get_imAddress().get_type(),this.get_imAddress().get__info().isFacebookMobileEnabled,this.get_imAddress().get_isUser())},get__currentServiceData:function(){return this._serviceData},createPersonalMessageElement:function(){var e=this.get_personalMessage()||"";return e=e.replace(new RegExp("(\\r?\\n)+","g")," "),s.MessengerUtility._createPersonalMessageElement(e,this._serviceData.peServiceData)},_onServiceDataChanged:function(e){var t=!1;switch(e.service){case u.IM:t=this._setChangesIM(e);break;case u.PE:t=this._setChangesPE(e);break;case u.CM:t=this._setChangesCM(e);break;case u.SKP:t=this._setChangesSKP(e)}return this._properties._onServiceDataChanged(e)&&(t=!0,this._onPropertyChanged("Properties")),t&&null!=this._address.get_contact()&&this._address.get_contact()._setPresenceChanges(this._address),t},_onPropertyChanged:function(t){e(this).triggerHandler("propertyChanged",[this,new s.PropertyChangedEventArgs(t)])},_ensureUser:function(){if(!this._address.get_isUser())throw s._exceptionHelper.createInvalidOperationException(s._exceptions.presenceReadOnly)},_ensureCanUpdate:function(){this._ensureUser(),this._ensureServices(),this._address.get__user()._ensureSignedIn()},_ensureCanUpdateStatus:function(){this._ensureUser(),this._ensureServices(),this._address.get__user()._ensureStatusChangeAllowed()},_ensureServices:function(){this._address.get__user()._ensureServicesRichOperation()},_setDisplayPictureUrl:function(){var e=null;if(this._address.get_type()===s.IMAddressType.connect)return void(this._displayPictureUrl=this._address.get_linkedContact().get_displayPictureUrl());var t,n=this._address.get_isUser(),a=this._address.get_contact().get_isContact();if((a||n)&&(t=this._serviceData.peServiceData,!r.isNullOrEmpty(t.get_userTileLocation())&&"1"!==t.get_userTileLocation())){var c=r.parseXml(t.get_userTileLocation()),l=c.documentElement;if(null!=l&&"msnobj"===l.nodeName){var u=o.XmlHelper.getAttribute(l,"Url1");if(s.MessengerUtility._validateUrl(u))return void(this._displayPictureUrl=o.UriHelper.updateDisplayPictureUrl(u))}}if(n&&(t=this._serviceData.peServiceData,r.isNullOrEmpty(t.get_displayPictureUrl())||(e=t.get_displayPictureUrl())),null==e){if(r.isNullOrEmpty(this._address.get_cid())||null==s._globalConfiguration.get__tryGetInstance())return;e=s._globalConfiguration._getDisplayPictureUrl(this._address.get_cid())}if(null!=e){var d=this._address.get__user(),_=d.get_identity().get__authenticationInfo(),g=_.ticket;if(!r.isNullOrEmpty(g))switch(_.authType){case i.AuthenticationType.rpsAuth:e=o.UriHelper.addParameter(e,"t",g)}this._displayPictureUrl=o.UriHelper.updateDisplayPictureUrl(e)}},_setChangesIM:function(e){for(var t=!1,n=e.updatedProperties.length,i=0;n>i;i++){var s=e.updatedProperties[i];switch(s){case a.status:t=!0,this._onPropertyChanged("Status")}}return t},_setChangesSKP:function(e){for(var t=!1,n=e.updatedProperties.length,i=0;n>i;i++){var s=e.updatedProperties[i];switch(s){case l.skypeName:t=!0}}return t},_setChangesPE:function(e){for(var t=!1,n=!1,i=e.updatedProperties.length,s=0;i>s;s++){var o=e.updatedProperties[s];switch(o){case c.displayName:t=!0,this._onPropertyChanged("DisplayName");break;case c.personalMessage:case c.richLinkType:case c.richUrl:case c.richUserMessage:case c.safeUrl:n||(n=!0,t=!0,this._onPropertyChanged("PersonalMessage"));break;case c.displayPictureUrl:case c.userTileLocation:this._displayPictureUrl=null,t=!0,this._onPropertyChanged("DisplayPictureUrl")}}return t},_setChangesCM:function(e){for(var n=!1,i=e.updatedProperties.length,s=0;i>s;s++){var o=e.updatedProperties[s];switch(o){case t:n=!0}}return n}}}(window.originaljQuery||jQuery)}),define("addresschangingeventargs",["imaddresspresence"],function(){!function(){var e=window,t=e.Microsoft.Live.Messenger;t.AddressChangingEventArgs=function(e,t){this._oldAddress$1=e,this._newAddress$1=t},t.AddressChangingEventArgs.prototype={_oldAddress$1:null,_newAddress$1:null,get_oldAddress:function(){return this._oldAddress$1},get_newAddress:function(){return this._newAddress$1}}}()}),define("endpointid",["addresschangingeventargs"],function(){!function(){var e=window,t=e.Microsoft.Live.Messenger;t.EndpointId=function(e){this._id=e},t.EndpointId.prototype={_id:null,equals:function(e){return null!=e&&this._id===e._id},toString:function(){return this._id||""}}}()}),define("endpoint",["endpointid"],function(){!function(e){var t="events",n=window,i=n.MC,s=n.Microsoft.Live.Messenger,o=n.ss,r=i.ServiceType,a=s.Endpoint=function(e,t){this._address=e,this._serviceData=t,this._capabilities=new s._endpointCapabilities(this._address,this),this._presence=new s.EndpointPresence(this)};a.isNameValid=function(e){return null==e?!1:e.trim().length<=s._globalConfiguration.get__maxEndpointNameLength()},a.prototype={_address:null,_capabilities:null,_presence:null,_serviceData:null,_id:null,get_id:function(){return null==this._id&&(this._id=new s.EndpointId(this._serviceData.id)),this._id},get_name:function(){return this._serviceData.pdEndpointData.get_name()||""},set_name:function(e){if(!this.get__isLocal())throw s._exceptionHelper.createInvalidOperationException(s._exceptions.endpointNotLocal);if(null==e)throw s._exceptionHelper.createArgumentNullException("value");var t=e.trim();if(!a.isNameValid(t))throw s._exceptionHelper.createArgumentException(s._exceptions.endpointNameInvalid,"value");if(this._address.get__user()._ensureStatusChangeAllowed(),this._serviceData.pdEndpointData.get_name()!==t){var n=this._createServiceData(r.PD);n.getEndpointData(this._serviceData.id).set_name(t),this._address.get__user()._updateServiceData(n)}return e},get_imAddress:function(){return this._address},get_capabilities:function(){return this._capabilities},get_presence:function(){return this._presence},get_isInstance:function(){if(!this._address.get_isUser())return!1;if(this.get__isLocal())return!0;var e=this._address.get__user().get_localEndpoint();return null==this._serviceData.imEndpointData||null==e._serviceData.imEndpointData?!1:""!==this._serviceData.imEndpointData.get_domain()&&this._serviceData.imEndpointData.get_domain()===e._serviceData.imEndpointData.get_domain()},get__isLocal:function(){return this._address._isLocalEndpoint(this)},get__serviceEndpointDataSet:function(){return this._serviceData},get__isEndpointDataSetEmpty:function(){return 0===o.getKeyCount(this._serviceData.imEndpointData.get_properties())&&0===o.getKeyCount(this._serviceData.pdEndpointData.get_properties())},get__isIMEndpoint:function(){return o.getKeyCount(this._serviceData.imEndpointData.get_properties())>0},equals:function(e){return null==e?!1:this._serviceData.id===e._serviceData.id},_onServiceDataChanged:function(e){var t=!1;switch(e.service){case r.IM:t=this._setChangesIM(e);break;case r.PD:t=this._setChangesPD(e);break;case r.CM:t=this._setChangesCM(e)}return this._capabilities._onServiceDataChanged(e)&&(t=!0,this._onPropertyChanged("Capabilities")),this._presence._onServiceDataChanged(e)&&(t=!0,this._onPropertyChanged("Presence")),t},_onEndpointSetChanged:function(e,t){return this._serviceData=this._address.get__serviceDataSet().getEndpointSet(this.get_id().toString()),e?(this._presence._reloadServiceData(this._serviceData),this._presence.get_properties()._onEndpointServiceDataChanged(t,this._id.toString())):!1},_createServiceData:function(e){var t=i.ServiceEndpointData.createEmpty(e,this._serviceData.id),n=i.ServiceData.createEmpty(e);return n.addEndpoint(t),n},_onPropertyChanged:function(t){e(this).triggerHandler("propertyChanged",[this,new s.PropertyChangedEventArgs(t)])},_setChangesIM:function(){return!1},_setChangesPD:function(e){var t=e.updatedEndpoints[this._serviceData.id];return t.contains(i.PDServiceEndpointDataProperties.epName)?(this._onPropertyChanged("Name"),!0):!1},_setChangesCM:function(e){var n=e.updatedEndpoints[this._serviceData.id];return n.contains(t)}}}(window.originaljQuery||jQuery)}),define("capabilities",["endpoint"],function(){!function(e){var t=window,n=t.MC,i=t.Microsoft.Live.Messenger,s=t.MSH,o=t.ss,r=n.CapabilitiesFlags,a=n.IMAddressInfoType,c=i.IMAddressType;i.Capabilities=function(e){this._address=e},i.Capabilities.prototype={_address:null,_version:null,get__sipTunnelVersion2:null,set__sipTunnelVersion2:null,_getVersion:null,get__supportsMultipartyConversationsInternal:null,get__supportsTunneledSip:null,get_version:function(){return null==this._version&&(this._version=this._getVersion()),this._version},get_supportsMultipartyConversations:function(){return this._address.get__info().type===a.cid?!1:this.get__supportsMultipartyConversationsInternal()},get_supportsOfflineMessages:function(){switch(this._address.get__info().type){case a.windowsLive:case a.skype:case a.telephone:case a.smtp:case a.connect:case a.shortCircuit:return!0;default:return!1}},get__supportsTypingIndicators:function(){switch(this._address.get__info().type){case a.telephone:case a.smtp:return!1;default:return!0}},get_address:function(){return this._address},supportsMessageType:function(e){var t=this._address.get_type();switch(t){case c.windowsLive:switch(e){case i.MessageType.textMessage:case i.MessageType.callEventMessage:return!0}break;case c.skype:switch(e){case i.MessageType.textMessage:case i.MessageType.callEventMessage:return!0}break;case c.officeCommunicator:case c.telephone:case c.smtp:case c.connect:switch(e){case i.MessageType.textMessage:return!0}}return!1},_clearVersion:function(){this._version=null},_getVersionFromString:function(e){if(o.isNullOrEmpty(e))return null;var t=e.split(".");if(t.length<2||t.length>4)return null;for(var n=new Array(t.length),r=0;r<n.length;r++){var a=s.ConvertHelper.tryParseInt(t[r]);if(0>a)return null;n[r]=a}switch(n.length){case 2:return new i.Version(n[0],n[1],0,0);case 3:return new i.Version(n[0],n[1],n[2],0)}return new i.Version(n[0],n[1],n[2],n[3])},_getVersionFromFlags:function(e){var t=0,n=0;if(e!==r.none){var s=28;switch(e>>>s){case r.appVersion60>>>s:t=6;break;case r.appVersion61>>>s:t=6,n=1;break;case r.appVersion62>>>s:t=6,n=2;break;case r.appVersion70>>>s:t=7;break;case r.appVersion75>>>s:t=7,n=5;break;case r.appVersion80>>>s:t=8;break;case r.appVersion81>>>s:t=8,n=1;break;case r.appVersion85>>>s:t=8,n=5;break;case r.appVersion90>>>s:t=9;break;case r.appVersion2009>>>s:t=14}}return new i.Version(t,n,0,0)},_onPropertyChanged:function(t){e(this).triggerHandler("propertyChanged",[this,new i.PropertyChangedEventArgs(t)])}}}(window.originaljQuery||jQuery)}),define("endpointcapabilities",["capabilities"],function(){!function(){var e=window,t=e.MC,n=e.Microsoft.Live.Messenger,i=e.MSH,s=e.ss,o=t.CapabilitiesFlags,r=t.ServiceType,a=t.IMServiceEndpointDataProperties,c=n.Capabilities,l=n._endpointCapabilities=function(e,t){c.call(this,e),this._endpoint$1=t,this._imEndpointData$1=this._endpoint$1.get__serviceEndpointDataSet().imEndpointData,this._peEndpointData$1=this._endpoint$1.get__serviceEndpointDataSet().peEndpointData},u=l.prototype=new c;u.constructor=l,u._endpoint$1=null,u._imEndpointData$1=null,u._peEndpointData$1=null,u._imCapabilitiesToUpdate$1=null,u.get_isOnlineViaMobileDevice=function(){return this._imEndpointData$1.get_isOnlineViaMobileDevice()},u.get_isOnlineViaWeb=function(){return this._imEndpointData$1.get_isOnlineViaWeb()},u.get_videoCallSupports16By9AspectRatio=function(){return this._imEndpointData$1.get_videoCallSupports16By9AspectRatio()},u.set_videoCallSupports16By9AspectRatio=function(e){if(!this._endpoint$1.get__isLocal())throw n._exceptionHelper.createInvalidOperationException(n._exceptions.objectNotBelongToUser);return e?this._addIMCapability$1(1,o.videoCallSupports16By9AspectRatio):this._removeIMCapability$1(1,o.videoCallSupports16By9AspectRatio),e},u.get__supportsMultipartyConversationsInternal=function(){return this._imEndpointData$1.get_supportsMultipartyConversations()},u.get__supportsTunneledSip=function(){return this._imEndpointData$1.get_supportsTunneledSip()},u.set__supportsTunneledSip=function(e){return e?this._addIMCapability$1(0,o.supportsTunneledSip):this._removeIMCapability$1(0,o.supportsTunneledSip),e},u.get__rtcVideoEnabled=function(){return this._imEndpointData$1.get_rtcVideoEnabled()},u.set__rtcVideoEnabled=function(e){return e?this._addIMCapability$1(1,o.rtcVideoEnabled):this._removeIMCapability$1(1,o.rtcVideoEnabled),e},u.get__sipTunnelVersion2=function(){return this._imEndpointData$1.get_sipTunnelVersion2()},u.set__sipTunnelVersion2=function(e){return e?this._addIMCapability$1(1,o.sipTunnelVersion2):this._removeIMCapability$1(1,o.sipTunnelVersion2),e},u.get__fTurnCapable=function(){return this._imEndpointData$1.get_fTurnCapable()},u.set__fTurnCapable=function(e){return e?this._addIMCapability$1(1,o.fTurnCapable):this._removeIMCapability$1(1,o.fTurnCapable),e},u._onServiceDataChanged=function(e){var t=!1;switch(e.service){case r.IM:t=this._setChangesIM$1(e);break;case r.PE:t=this._setChangesPE$1(e)}return t},u._getVersion=function(){var e=this._getVersionFromString(this._peEndpointData$1.get_clientVersion());return null==e&&(e=this._getVersionFromFlags(this._imEndpointData$1.get_version())),e},u._addIMCapability$1=function(e,t){var n=this._imCapabilitiesToUpdate$1||this._imEndpointData$1.get_capabilities();(n[e]&t)!==t&&(n[e]|=t,null==this._imCapabilitiesToUpdate$1&&(this._imCapabilitiesToUpdate$1=n,i.Scheduler.defer(s.Delegate.create(this,this._updateIMCapabilities$1))))},u._removeIMCapability$1=function(e,t){var n=this._imCapabilitiesToUpdate$1||this._imEndpointData$1.get_capabilities();0!==(n[e]&t)&&(n[e]&=~t,null==this._imCapabilitiesToUpdate$1&&(this._imCapabilitiesToUpdate$1=n,i.Scheduler.defer(s.Delegate.create(this,this._updateIMCapabilities$1))))},u._updateIMCapabilities$1=function(){var e=t.ServiceData.createEmpty(r.IM),n=t.ServiceEndpointData.createEmpty(r.IM,this._imEndpointData$1.get_endpointId());e.addEndpoint(n),n.set_capabilities(this._imCapabilitiesToUpdate$1),this._imCapabilitiesToUpdate$1=null,this._endpoint$1.get_imAddress().get__user()._updateServiceData(e)},u._setChangesIM$1=function(e){for(var t=!1,n=e.updatedProperties,i=n.length,s=0;i>s;s++){var o=n[s];switch(o){case a.isOnlineViaMobileDevice:t=!0,this._onPropertyChanged("IsOnlineViaMobileDevice");break;case a.isOnlineViaWeb:t=!0,this._onPropertyChanged("IsOnlineViaWeb");break;case a.videoCallSupports16By9AspectRatio:t=!0,this._onPropertyChanged("VideoCallSupports16By9AspectRatio");break;case a.supportsMultipartyConversations:t=!0,this._onPropertyChanged("SupportsMultipartyConversations");break;case a.version:t=!0,this._clearVersion(),this._onPropertyChanged("Version")}}return t},u._setChangesPE$1=function(e){for(var n=!1,i=e.updatedProperties,s=i.length,o=0;s>o;o++){var r=i[o];switch(r){case t.PEServiceEndpointDataProperties.clientVersion:n=!0,this._clearVersion(),this._onPropertyChanged("Version")}}return n}}()}),define("imaddresscapabilities",["endpointcapabilities"],function(){!function(){var e=window,t=e.MC,n=e.Microsoft.Live.Messenger,i=t.IMServiceDataProperties,s=n.Capabilities,o=n._imAddressCapabilities=function(e){s.call(this,e),this._serviceData$1=e.get__serviceDataSet().imServiceData},r=o.prototype=new s;r.constructor=o,r._serviceData$1=null,r.get_isOnlineViaMobileDevice=function(){return this._serviceData$1.get_isOnlineViaMobileDevice()},r.get_isOnlineViaWeb=function(){return this._serviceData$1.get_isOnlineViaWeb()},r.get_videoCallSupports16By9AspectRatio=function(){return this._serviceData$1.get_videoCallSupports16By9AspectRatio()},r.get__supportsMultipartyConversationsInternal=function(){return this._serviceData$1.get_supportsMultipartyConversations()},r.get__supportsTunneledSip=function(){return this._serviceData$1.get_supportsTunneledSip()},r.get__sipTunnelVersion2=function(){return this._serviceData$1.get_sipTunnelVersion2()},r.get__fTurnCapable=function(){return this._serviceData$1.get_fTurnCapable()},r._onServiceDataChanged=function(e){if(e.service!==t.ServiceType.IM)return!1;for(var n=!1,s=e.updatedProperties,o=s.length,r=0;o>r;r++){var a=s[r];switch(a){case i.isOnlineViaMobileDevice:n=!0,this._onPropertyChanged("IsOnlineViaMobileDevice");break;case i.isOnlineViaWeb:n=!0,this._onPropertyChanged("IsOnlineViaWeb");break;case i.videoCallSupports16By9AspectRatio:n=!0,this._onPropertyChanged("VideoCallSupports16By9AspectRatio");break;case i.supportsMultipartyConversations:n=!0,this._onPropertyChanged("SupportsMultipartyConversations");break;case i.version:n=!0,this._clearVersion(),this._onPropertyChanged("Version")}}return n},r._getVersion=function(){return this._getVersionFromFlags(this._serviceData$1.get_version())}}()}),define("endpointcollection",["imaddresscapabilities"],function(){!function(){var e=window,t=e.MC,n=e.Microsoft.Live.Messenger,i=n.Collection,s=e.ss,o=n.EndpointCollection=function(e){i.call(this),this._address$1=e,this._hiddenEndpoints$1=[],this._allEndpoints$1=[]},r=o.prototype=new i;r.constructor=o,r._address$1=null,r._hiddenEndpoints$1=null,r._allEndpoints$1=null,r.get__allEndpoints=function(){return this._allEndpoints$1},r._onServiceDataChanged=function(e){var t=!1,i=e.updatedEndpoints;for(var o in i){var r={key:o,value:i[o]},a=r.key,c=this._findEndpoint$1(a);if(null!=c){var l=s.keyExists(e.newEndpoints,a);t=1===(t|c._onEndpointSetChanged(l,e)),l||(t=1===(t|c._onServiceDataChanged(e))),t=1===(t|this._hideOrUnhideEndpoint$1(c))}else c=new n.Endpoint(this._address$1,this._address$1.get__serviceDataSet().getEndpointSet(a)),t=1===(t|this._addEndpoint$1(c))}return t},r._onServiceDataDeleted=function(e){var t=!1,n=e.deletedEndpoints;for(var i in n){var s={key:i,value:n[i]},o=s.key,r=this._findEndpoint$1(o);null!=r&&(r._onEndpointSetChanged(!1,e),r.get__isEndpointDataSetEmpty()?t=1===(t|this._removeEndpoint$1(r)):(t=1===(t|r._onServiceDataChanged(e)),t=1===(t|this._hideOrUnhideEndpoint$1(r))))}return t},r._clearAllExceptLocal=function(){for(var e=t.ServiceDataSet.create(),n=s.IEnumerator.getEnumerator(this._allEndpoints$1);n.moveNext();){var i=n.get_current();if(!i.get__isLocal())for(var o=i.get__serviceEndpointDataSet().toServiceDataArray(),r=0;r<o.length;r++)e.addEndpoint(o[r])}this._address$1.get__user()._onServiceDataDeleted(this._address$1.get__info(),e.toArray())},r._clearAll=function(){for(var e=t.ServiceDataSet.create(),n=s.IEnumerator.getEnumerator(this._allEndpoints$1);n.moveNext();)for(var i=n.get_current(),o=i.get__serviceEndpointDataSet().toServiceDataArray(),r=0;r<o.length;r++)e.addEndpoint(o[r]);this._address$1._onServiceDataDeleted(e.toArray())},r._findEndpoint$1=function(e){for(var t=0;t<this._allEndpoints$1.length;t++){var n=this._allEndpoints$1[t];if(n.get__serviceEndpointDataSet().id===e)return n}return null},r._endpointShouldBeHidden$1=function(e){return e.get__isIMEndpoint()?0===this._allEndpoints$1.length||1===this._allEndpoints$1.length&&e===this._allEndpoints$1[0]?!1:!e.get__isLocal()&&e.get_isInstance():!0},r._hideOrUnhideEndpoint$1=function(e){var t=this._endpointShouldBeHidden$1(e);if(this._hiddenEndpoints$1.contains(e)){if(!t)return this._hiddenEndpoints$1.remove(e),this._addInternal(e),!0}else if(t)return this._removeInternal(e),this._hiddenEndpoints$1.push(e),!0;return!1},r._addEndpoint$1=function(e){var t;return this._endpointShouldBeHidden$1(e)?(this._hiddenEndpoints$1.push(e),t=!1):(this._addInternal(e),t=!0),this._allEndpoints$1.push(e),t},r._removeEndpoint$1=function(e){return this._allEndpoints$1.remove(e),this._hiddenEndpoints$1.contains(e)?(this._hiddenEndpoints$1.remove(e),!1):(this._removeInternal(e),!0)},r.get_item=function(e){if(0>e||e>=this.get_count())throw n._exceptionHelper.createArgumentOutOfRangeException("index");return this.get__items()[e]}}()}),define("endpointpresence",["endpointcollection"],function(){!function(e){var t=window,n=t.Microsoft.Live.Messenger;n.EndpointPresence=function(e){this._endpoint=e;var t=this._endpoint.get__serviceEndpointDataSet();this._properties=new n.PresencePropertyCollection(new Array(0),[t.imEndpointData,t.pdEndpointData,t.peEndpointData,t.cmEndpointData,t.skpEndpointData])},n.EndpointPresence.prototype={_endpoint:null,_properties:null,get_properties:function(){return this._properties},_onServiceDataChanged:function(e){var t=!1;return this._properties._onEndpointServiceDataChanged(e,this._endpoint.get_id().toString())&&(t=!0,this._onPropertyChanged("Properties")),t},_reloadServiceData:function(e){this._properties._loadServiceData(new Array(0),[e.imEndpointData,e.pdEndpointData,e.peEndpointData,e.cmEndpointData])},_onPropertyChanged:function(t){e(this).triggerHandler("propertyChanged",[this,new n.PropertyChangedEventArgs(t)])}}}(window.originaljQuery||jQuery)}),define("message",["endpointpresence"],function(){!function(){var e=window,t=e.MC,n=e.Microsoft.Live.Messenger,i=e.ss,s=t.MessageInfoType,o=n.InviteMessageType,r=n.Message=function(e){this._messageType=e,this._timestamp=new Date,this._reloaded=!1};r._fromMessageInfo=function(e,t,i,o){var r;switch(i.type){case s.textMessage:var a=i.info,c=new n.TextMessage(a.text,n.TextMessageFormat._fromFormatInfo(a.format));c.set__safeUrl(a.safeUrl),r=c;break;case s.threadActivityMessage:r=new n.ThreadActivityMessage(e,i.info);break;default:return null}return r._sender=t,r._timestamp=new Date(i.timestamp.utcMilliseconds),r._isOfflineMessage=i.isOfflineMessage,r._isHistoryMessage=i.isHistoryMessage,r._isLastHistoryMessage=i.isLastHistoryMessage,r._id=i.id,r._networkId=o.get_network().get_id(),r._networkName=o.get_network().get_name(),r._conversationId=o.get_id(),r},r._findSenderEndpoint=function(e,t){for(var n=i.IEnumerator.getEnumerator(e.get_endpoints());n.moveNext();){var s=n.get_current();if(s.get_id().toString()===t)return s}return null},r.prototype={_messageType:n.MessageType.textMessage,_sender:null,_timestamp:null,_isOfflineMessage:!1,_isHistoryMessage:!1,_isLastHistoryMessage:!1,_reloaded:!1,_networkName:null,_id:null,_clientId:null,_networkId:null,_conversationId:null,_isInviteMessage:!1,_inviteMessageType:o.historyInvite,get_sender:function(){return this._sender},set_sender:function(e){return this._sender=e,e},get_type:function(){return this._messageType},get_timestamp:function(){return this._timestamp},set_timestamp:function(e){return this._timestamp=e,e},get_reloaded:function(){return this._isHistoryMessage?!0:this._isInviteMessage?this._inviteMessageType===o.historyInvite:this._reloaded},get_isOfflineMessage:function(){return this._isOfflineMessage},get_isHistoryMessage:function(){return this._isHistoryMessage},get_isLastHistoryMessage:function(){return this._isLastHistoryMessage},get_inviteMessage:function(){return this._isInviteMessage},set_inviteMessage:function(e){return this._isInviteMessage=e,e},get_inviteMessageType:function(){return this._inviteMessageType},set_inviteMessageType:function(e){return this._inviteMessageType=e,e},get_networkName:function(){return this._networkName},set_networkName:function(e){return this._networkName=e,e},get_receivedMessageId:function(){return this._id},set_receivedMessageId:function(e){return this._id=e,e},get_clientMessageId:function(){return this._clientId},set_clientMessageId:function(e){return this._clientId=e,e},get_networkId:function(){return this._networkId},set_networkId:function(e){return this._networkId=e,e},get_conversationId:function(){return this._conversationId},set_conversationId:function(e){return this._conversationId=e,e},get__supportsOffline:function(){return!1},_setReloaded:function(e){this._reloaded=e},_buildMessageInfo:function(e){this._sender=e;var n=new t.MessageInfo(this._messageType,null);return n.sender=this._sender.get__info(),n.timestamp=new t.DateInfo(this._timestamp),n.isOfflineMessage=this._isOfflineMessage,n.isHistoryMessage=this._isHistoryMessage,n}}}()}),define("calleventmessage",["message"],function(){!function(){var e=window,t=e.MC,n=e.Microsoft.Live.Messenger,i=n.Message,s=n.CallEventMessage=function(e){if(i.call(this,n.MessageType.callEventMessage),!(e>=0))throw n._exceptionHelper.createArgumentOutOfRangeException("duration");this._duration$1=e},o=s.prototype=new i;o.constructor=s,o._duration$1=0,o.get_duration=function(){return this._duration$1},o.get__supportsOffline=function(){return!1},o._buildMessageInfo=function(e){this.set_sender(e);var n=new t.CallEventMessageInfo(this._duration$1),i=new t.MessageInfo(t.MessageInfoType.callEventMessage,n);return i.sender=e.get__info(),i.isOfflineMessage=this.get_isOfflineMessage(),i}}()}),define("threadactivitymessage",["calleventmessage"],function(){!function(){var e=window,t=e.Microsoft.Live.Messenger,n=t.Message,i=t.ThreadActivityMessage=function(e,i){n.call(this,t.MessageType.threadActivityMessage),this._user$1=e,this._info$1=i},s=i.prototype=new n;s.constructor=i,s._user$1=null,s._info$1=null,s.get_activityType=function(){return this._info$1.type},s.get_initiator=function(){return this._user$1._findOrCreateAddress(this._info$1.initiator)},s.get_targets=function(){if(null!=this._info$1.targets){for(var e=new Array(this._info$1.targets.length),t=0;t<e.length;t++)e[t]=this._user$1._findOrCreateAddress(this._info$1.targets[t]);return e}return null},s.get_otherInfo=function(){return this._info$1.otherInfo}}()}),define("textmessagecolor",["threadactivitymessage"],function(){!function(){var e=window,t=e.Microsoft.Live.Messenger,n=t.TextMessageColor=function(){};n.fromRgb=function(e,i,s){if(0>e||e>255)throw t._exceptionHelper.createArgumentOutOfRangeException("r");if(0>i||i>255)throw t._exceptionHelper.createArgumentOutOfRangeException("g");if(0>s||s>255)throw t._exceptionHelper.createArgumentOutOfRangeException("b");var o=new n;return o._r=e,o._g=i,o._b=s,o},n.prototype={_r:0,_g:0,_b:0,get_r:function(){return this._r},get_g:function(){return this._g},get_b:function(){return this._b}}}()}),define("textmessageformat",["textmessagecolor"],function(){!function(){var e=window,t=e.ss,n=e.MC,i=e.Microsoft.Live.Messenger,s=i._textMessageStyle=function(){};
s.regular=0,s.bold=1,s.italic=2,s.strikeout=4,s.underline=8;var o=i._textMessageDirection=function(){};o.leftToRight=0,o.rightToLeft=1;var r=i.TextMessageFormat=function(e,n,s,r){if(null==e)throw i._exceptionHelper.createArgumentNullException("fontColor");if(t.isNullOrEmpty(n))throw i._exceptionHelper.createArgumentNullException("fontFamily");this._fontColor=e,this._fontFamily=n,this._fontStyle=s,this._flowDirection=r||o.leftToRight};r.get_defaultFormat=function(){return i.TextMessageFormat._defaultFormat},r._fromFormatInfo=function(e){return null==e?i.TextMessageFormat.get_defaultFormat():new i.TextMessageFormat(i.TextMessageColor.fromRgb(255&e.fontColor,e.fontColor>>>8&255,e.fontColor>>>16&255),t.isNullOrEmpty(e.fontFamily)?i.TextMessageFormat.get_defaultFormat().get_fontFamily():e.fontFamily,e.fontStyle,e.rightToLeft?o.rightToLeft:o.leftToRight)},r.prototype={_fontColor:null,_fontFamily:null,_fontStyle:s.regular,_flowDirection:o.leftToRight,get_fontColor:function(){return this._fontColor},get_fontFamily:function(){return this._fontFamily},get_fontStyle:function(){return this._fontStyle},get_flowDirection:function(){return this._flowDirection},applyToElement:function(e){if(null==e)throw i._exceptionHelper.createArgumentNullException("element");var t=e.style;this.get_fontStyle()!==s.regular&&((this.get_fontStyle()&s.bold)===s.bold&&(t.fontWeight="bold"),(this.get_fontStyle()&s.italic)===s.italic&&(t.fontStyle="italic"),(this.get_fontStyle()&s.underline)===s.underline&&(t.textDecoration="underline"),(this.get_fontStyle()&s.strikeout)===s.strikeout&&(t.textDecoration+=" line-through")),t.fontFamily="'"+this.get_fontFamily()+"'",t.color="rgb("+this.get_fontColor().get_r()+","+this.get_fontColor().get_g()+","+this.get_fontColor().get_b()+")",t.direction=this.get_flowDirection()===o.rightToLeft?"rtl":"ltr";try{t.whiteSpace="pre-wrap"}catch(n){}},_toInfo:function(){return new n.TextMessageFormatInfo(this._fontColor.get_b()<<16|this._fontColor.get_g()<<8|this._fontColor.get_r(),this._fontFamily,this._fontStyle,this._flowDirection===o.rightToLeft)}},r._defaultFormat=new r(i.TextMessageColor.fromRgb(0,0,0),i._localization.defaultFontFamily,s.regular,o.leftToRight)}()}),define("textmessage",["textmessageformat"],function(){!function(){function e(e,t){if(null==e)throw s._exceptionHelper.createArgumentNullException("conversation");if(null==t)throw s._exceptionHelper.createArgumentNullException("textMessage");var n=0;if(!e.get_closed())if(e.get__isOffline())n=400;else for(var i=o.IEnumerator.getEnumerator(e.get_roster());i.moveNext();){var a=i.get_current();if(!a.get_isUser())switch(a.get_type()){case r.windowsLive:case r.skype:case r.shortCircuit:n=2e3;break;case r.officeCommunicator:case r.connect:n=1e3;break;case r.telephone:n=140;break;case r.smtp:n=600}}return n-t.length}var t=Math.pow(2,32),n=window,i=n.MC,s=n.Microsoft.Live.Messenger,o=n.ss,r=s.IMAddressType,a=s.Message,c=s.TextMessage=function(e,t){a.call(this,s.MessageType.textMessage),null==t&&(t=s.TextMessageFormat.get_defaultFormat()),this._text$1=e,this._format$1=t};c.isValid=function(t,n){if(null==t)throw s._exceptionHelper.createArgumentNullException("conversation");return t.get_closed()?!1:null!=n&&0===n.length?!1:e(t,n)>=0};var l=c.prototype=new a;l.constructor=c,l._text$1=null,l._format$1=null,l._safeUrl$1=null,l.get_format=function(){return this._format$1},l.get_text=function(){return this._text$1},l.createTextElement=function(e,t){var n=s.MessengerUtility._replaceEmoticonsAndUrls(this._text$1,this._safeUrl$1,t);return e||this._format$1.applyToElement(n),n},l.createTextElementNoUrls=function(e,t){var n=s.MessengerUtility.replaceEmoticons(this._text$1,t);return e||this._format$1.applyToElement(n),n},l.get__supportsOffline=function(){return!0},l.get__safeUrl=function(){return this._safeUrl$1},l.set__safeUrl=function(e){return this._safeUrl$1=e,e},l._buildMessageInfo=function(e,t){if(!t.isTextMessageValid(this.get_text()))throw s._exceptionHelper.createArgumentException(s._exceptions.textMessageInvalid,"message");this.set_sender(e);var n=this._getRandom32$1()+""+this._getRandom32$1();this.set_clientMessageId(n.substr(0,n.length-1));var o=new i.TextMessageInfo(this._text$1,this._format$1._toInfo()),r=new i.MessageInfo(i.MessageInfoType.textMessage,o);return r.sender=e.get__info(),r.isOfflineMessage=this.get_isOfflineMessage(),r.clientId=this.get_clientMessageId(),r},l._getRandom32$1=function(){return Math.abs((new Date).getTime()^Math.random()*t)}}()}),define("webimcontact",["textmessage"],function(){!function(e){var t=window,n=t.MC,i=t.Microsoft.Live.Messenger,s=t.MSH,o=t.ss,r=n.RoleLists,a=n.IMAddressInfoType,c=i.IMAddressType,l=i.PresenceStatus,u=i._iimAddressCollectionOwner,d=i.Contact=function(t,n,s,r){u.call(this),this._isTempContact=r,this._contactMap=t,this._user=n,this._pwcPerson=s,this._linkedContacts=new i.LinkedContactCollection,this._addresses=new i.IMAddressCollection(this),this._isRemoteOnlyContact=!0;for(var a=0;a<s.getContacts().length;a++){var c=new i.LinkedContact(this._contactMap,this,s.getContacts()[a]);this._linkedContacts._addInternal(c),c.get_network().get__isRemoteNetwork()||(this._isRemoteOnlyContact=!1)}for(a=0;a<this._linkedContacts.get_count();a++)for(var l=this._linkedContacts.get_item(a).get__addresses(),d=0;d<l.get_count();d++){var _=l.get_item(d);this._roleLists|=_.get__info().roleLists,this._addresses._addInternal(_)}this._addresses._sort(),e(this._addresses).bind("collectionChanged",o.Delegate.create(this,this._addressesCollectionChanged)),this._currentAddress=this._findCurrentAddress(),this._cleanRoleLists(!1),this._displayName="",this._isIdentityVerified=!0,this._setIdentityVerifiedChanges(),this._updateCollections(this._roleLists)};d._isAppearOfflineRoleLists=function(e){return(e&r.hide)===r.hide||(e&r.hideCompat)===r.hideCompat};var _=d.prototype=new u;_.constructor=d,_._user=null,_._contactMap=null,_._pwcPerson=null,_._linkedContacts=null,_._addresses=null,_._displayName=null,_._currentAddress=null,_._presence=null,_._roleLists=0,_._isTempContact=!1,_._isRemoteOnlyContact=!1,_._isIdentityVerified=!1,_.get_id=function(){return this._linkedContacts.get_item(0).get_id()},_.get_cid=function(){return o.isNullOrEmpty(this._pwcPerson.getCid())?null:this._pwcPerson.getCid().toString()},_.get_skypeName=function(){for(var e=o.IEnumerator.getEnumerator(this._addresses);e.moveNext();){var t=e.get_current();if(t.get_type()===c.skype||t.get_type()===c.shortCircuit||t.get_network().get_isWindowsLive()&&!o.isNullOrEmpty(t.get_skypeName()))return t.get_skypeName()}return null},_.get_profileUrl=function(){return this._pwcPerson.getProfileUrl()},_.get_isEmailOnlyContact=function(){return 0===this._addresses.get_count()},_.get_isIdentityVerified=function(){return this._isIdentityVerified},_.get_isOnline=function(){return null==this.get_currentAddress()?!1:this.get_currentAddress().get_isOnline()},_.get_emailAddress=function(){if(this._user.get_identity().get__authenticationInfo().authType!==n.AuthenticationType.rpsAuth)return null;for(var e=0;e<this._linkedContacts.get_count();e++){var t=this._linkedContacts.get_item(e);if(null!=t.get_emailAddress())return t.get_emailAddress()}return null},_.get_displayName=function(){return o.isNullOrEmpty(this._displayName)?this._pwcPerson.getDisplayNameWithFallback():this._displayName},_.get_firstName=function(){return this._pwcPerson.getFirstName()},_.get_lastName=function(){return this._pwcPerson.getLastName()},_.get_fullName=function(){return this._pwcPerson.getFullName()},_.get_linkedContacts=function(){return this._linkedContacts},_.get_addresses=function(){return this._addresses},_.get_presence=function(){return null==this._presence&&(this._presence=new i.ContactPresence(this)),this._presence},_.get_currentAddress=function(){return this._currentAddress},_.set_currentAddress=function(e){if(e!==this._currentAddress){this._onCurrentAddressChanging(this._currentAddress,e);var t=this._currentAddress;this._currentAddress=e,t&&t._updateMessagingAddress(),this._currentAddress&&this._currentAddress._updateMessagingAddress(),this._onPropertyChanged("CurrentAddress"),null!=this._currentAddress&&this.get_presence()._onPresenceChanged(),this._setIdentityVerifiedChanges()}return e},_.get_shortCircuitAddress=function(){for(var e=0;e<this._addresses.get_count();++e)if(this._addresses.get_item(e).get_type()===c.shortCircuit)return this._addresses.get_item(e);return null},_.get_skypeAddress=function(){for(var e=0;e<this._addresses.get_count();++e)if(this._addresses.get_item(e).get_type()===c.skype)return this._addresses.get_item(e);return null},_.get_windowsLiveAddress=function(){for(var e=0;e<this._addresses.get_count();++e)if(this._addresses.get_item(e).get_network().get_isWindowsLive())return this._addresses.get_item(e);return null},_.get_isContact=function(){return 0!==(this._roleLists&r.forward)},_.get_isTemporaryContact=function(){return this._isTempContact},_.get_isFavorite=function(){return this._pwcPerson.getIsFavorite()},_.get_isAllowed=function(){return 0!==(this._roleLists&r.allow)},_.get_isAppearOfflineTo=function(){return this._user.get_presence().get_status()===l.appearOffline?!0:this.get_isAppearOfflineToExplicit()},_.get_isAudioVideoCapable=function(){if(null!=this.get_cid()&&t.self.location.search.indexOf("avcid="+this.get_cid().toString())>-1)return!0;for(var e=o.IEnumerator.getEnumerator(this._addresses);e.moveNext();){var n=e.get_current();if(n.get_isAudioVideoCapable())return!0}return!1},_.get_isAppearOfflineToExplicit=function(){return i.Contact._isAppearOfflineRoleLists(this._roleLists)},_.get_pwcPerson=function(){return this._pwcPerson},_.get__user=function(){return this._user},_.get__isCidContact=function(){return null!=this.get_currentAddress()&&this.get_currentAddress().get__info().type===a.cid},_.get__isRemoteOnlyContact=function(){return this._isRemoteOnlyContact},_.get__isWindowsLiveContact=function(){for(var e=o.IEnumerator.getEnumerator(this._addresses);e.moveNext();){var t=e.get_current();if(t.get_type()===c.windowsLive)return!0}return!1},_.get__firstLocalNetworkContact=function(){for(var e=0;e<this._linkedContacts.get_count();e++){var t=this._linkedContacts.get_item(e);if(!t.get_network().get__isRemoteNetwork())return t}return null},_.get__windowsLiveLinkedContact=function(){for(var e=o.IEnumerator.getEnumerator(this._linkedContacts);e.moveNext();){var t=e.get_current();if(t.get_network().get_isWindowsLive())return t}return null},_._onIMAddressIsOnlineChanged=function(){this._onPropertyChanged("IsOnline")},_._onIMAddressStatusChanged=function(){this.set_currentAddress(this._findCurrentAddress())},_._onIMAddressIdentityVerifiedChanged=function(){this._setIdentityVerifiedChanges()},_._onUserAppearOfflineStatusChanged=function(){this._onPropertyChanged("IsAppearOfflineTo");for(var e=0;e<this.get_addresses().get_count();e++)this.get_addresses().get_item(e)._onUserAppearOfflineStatusChanged()},_._hasAddressType=function(e){for(var t=o.IEnumerator.getEnumerator(this._addresses);t.moveNext();){var n=t.get_current();if(n.get_type()===e)return!0}return!1},_._setPresenceChanges=function(){this.get_presence()._onPresenceChanged()},_._setIdentityVerifiedChanges=function(){var e=!0;null!=this._currentAddress&&(e=this._currentAddress.get_isIdentityVerified()),e!==this._isIdentityVerified&&(this._isIdentityVerified=e,this._onPropertyChanged("IsIdentityVerified"))},_._setDisplayNameChanges=function(e){this._displayName!=e&&(this._displayName=e,this._onPropertyChanged("DisplayName"))},_._setRoleListChanges=function(e,t){var n=this._roleLists,i=(n^e)&e;return n|=e,i|=n&t,n&=~t,i!==r.none?(this._roleLists=n,this._updateCollections(i),!0):!1},_._update=function(e){for(var t=o.IEnumerator.getEnumerator(e.getContacts());t.moveNext();){var n=t.get_current(),i=this._findLinkedContact(n);null!=i&&i._update(n)}},_._findLinkedContact=function(e){for(var t=o.IEnumerator.getEnumerator(this._linkedContacts);t.moveNext();){var n=t.get_current();if(n.get_id()==e.getId())return n}return null},_._attachAddress=function(e){var t=this._findLinkedContactByAddress(e.get__info());null!=t&&(t.get__addresses()._addInternal(e),this._addresses._addInternal(e),e._setLinkedContact(t))},_._toPersonInfo=function(){for(var e=new Array(this._linkedContacts.get_count()),t=0;t<this._linkedContacts.get_count();++t)e[t]=this._linkedContacts.get_item(t).get__info();return new n.PersonInfo(this.get_id(),e)},_._cleanRoleLists=function(e){var t=this._roleLists,n=r.none,i=r.allow|r.block,s=r.forward|r.pending;if((t&i)===i&&(t&=~r.allow,n|=r.allow),(t&s)===s&&(t&=~r.pending,n|=r.pending),this._roleLists!==t){this._roleLists=t;for(var o=0;o<this._addresses.get_count();o++)this._addresses.get_item(o).get__info().roleLists=t}e&&this._updateCollections(n)},_._updateCollections=function(e){this._updateUserCollections(e)},_._updateUserCollections=function(e){this._updateContactCollection(this._user.get_contacts(),r.forward,e,"IsContact")},_._updateContactCollection=function(e,t,n,i){0!==(n&t)&&(0!==(this._roleLists&t)?e._addInternal(this):e._removeInternal(this),this._onPropertyChanged(i))},_._findLinkedContactByAddress=function(e){for(var t=0;t<this._addresses.get_count();t++){var n=this._addresses.get_item(t);if(s.ContactHelper.areIMAddressesEqual(n.get__info(),e))return n.get_linkedContact()}return null},_._findCurrentAddress=function(){if(0===this._addresses.get_count())return null;for(var e=this._addresses.get_item(0).get_rank(),t=this._addresses.get_item(0),n=1;n<this._addresses.get_count();n++){var i=this._addresses.get_item(n);i.get_rank()<e&&(e=i.get_rank(),t=i)}return t},_._addressesCollectionChanged=function(){this.set_currentAddress(this._findCurrentAddress())},_._onPropertyChanged=function(t){e(this).triggerHandler("propertyChanged",[this,new i.PropertyChangedEventArgs(t)])},_._onCurrentAddressChanging=function(t,n){e(this).triggerHandler("currentAddressChanging",[this,new i.AddressChangingEventArgs(t,n)])},_.addAddress=function(e,t){if(this._hasAddressType(t.get_type()))throw i._exceptionHelper.createArgumentException(i._exceptions.sameTypeAddressExists,"address");var n=this.get__firstLocalNetworkContact();if(null==n||t.get__info().type===a.connect)throw i._exceptionHelper.createInvalidOperationException(i._exceptions.contactAddressOperationUnsupported);n.get__addresses().add(t),e._addInternal(t),e._sort()},_.removeAddress=function(e,t){var n=this.get__firstLocalNetworkContact();if(null==n||t.get__info().type===a.connect)throw i._exceptionHelper.createInvalidOperationException(i._exceptions.contactAddressOperationUnsupported);n.get__addresses().remove(t),e._removeInternal(t)}}(window.originaljQuery||jQuery)}),define("contactpresence",["webimcontact"],function(){!function(e){var t=window,n=t.Microsoft.Live.Messenger,i=t.ss;n.ContactPresence=function(e){this._contact=e;var t=e.get_currentAddress();if(null!=t){var i=e.get_currentAddress().get_presence();this._status=i.get_status(),this._personalMessage=i.get_personalMessage(),this._displayPictureUrl=i.get_displayPictureUrl(),this._isAudioVideoCapable=t.get_isAudioVideoCapable(),this._type=t.get_type(),this._isFacebookMobileEnabled=t.get__info().isFacebookMobileEnabled}else this._status=n.PresenceStatus.offline,this._isAudioVideoCapable=!1,this._personalMessage="",this._displayPictureUrl=null},n.ContactPresence.prototype={_contact:null,_status:n.PresenceStatus.offline,_personalMessage:null,_displayPictureUrl:null,_type:0,_isFacebookMobileEnabled:!1,get_contact:function(){return this._contact},get_status:function(){return this._status},get_statusText:function(){return n.IMAddressPresence._getLocalizedStatusText(this._status,this._type,this._isFacebookMobileEnabled,!1)},get_personalMessage:function(){return this._personalMessage},get_displayPictureUrl:function(){return this._displayPictureUrl},createPersonalMessageElement:function(){var e=this.get_contact().get_currentAddress();if(null!=e)return e.get_presence().createPersonalMessageElement();var t=this._personalMessage||"";return t=t.replace(new RegExp("(\\r?\\n)+","g")," "),n.MessengerUtility.emoticonEncode(t)},_onPropertyChanged:function(t){e(this).triggerHandler("propertyChanged",[this,new n.PropertyChangedEventArgs(t)])},_onPresenceChanged:function(){var e=this._contact.get_currentAddress(),t=e.get_presence();this.get_status()!==t.get_status()&&(this._status=t.get_status(),this._onPropertyChanged("Status"));var n=this._getPersonalMessage();this.get_personalMessage()!==n&&(this._personalMessage=n,this._onPropertyChanged("PersonalMessage"));var i=this._getDisplayPictureUrl();this._displayPictureUrl!==i&&(this._displayPictureUrl=i,this._onPropertyChanged("DisplayPictureUrl")),this._isAudioVideoCapable!==e.get_isAudioVideoCapable()&&(this._isAudioVideoCapable=e.get_isAudioVideoCapable(),this._onPropertyChanged("AudioVideoCapability")),this._type=e.get_type(),this._isFacebookMobileEnabled=e.get__info().isFacebookMobileEnabled},_getPersonalMessage:function(){for(var e=null,t=0;t<this._contact.get_addresses().get_count()&&(e=this._contact.get_addresses().get_item(t).get_presence().get_personalMessage(),i.isNullOrEmpty(e));t++);return e},_getDisplayPictureUrl:function(){for(var e=null,t=0;t<this._contact.get_linkedContacts().get_count()&&(e=this._contact.get_linkedContacts().get_item(t).get_displayPictureUrl(),null==e);t++);return e}}}(window.originaljQuery||jQuery)}),define("contactcollection",["contactpresence"],function(){!function(){var e=window,t=e.ss,n=e.MC,i=e.Microsoft.Live.Messenger,s=i.Collection,o=i.ContactCollection=function(e,t){s.call(this),this._owner$1=t,this._user$1=e,this._owner$1.setCollection(this)},r=o.prototype=new s;r.constructor=o,r._owner$1=null,r._user$1=null,r.get_capacity=function(){return this._owner$1.get_capacity()},r.add=function(e){if(null==e)throw i._exceptionHelper.createArgumentNullException("contact");if(this._contains(e))throw i._exceptionHelper.createArgumentException(i._exceptions.collectionItemDuplicate,"contact");if(!this._owner$1.canAddContact(e))throw i._exceptionHelper.createInvalidOperationException(i._exceptions.unsupportedContactOperation);this._owner$1.addContact(this,e)},r.remove=function(e){if(null==e)throw i._exceptionHelper.createArgumentNullException("contact");if(!this._contains(e))throw i._exceptionHelper.createArgumentException(i._exceptions.collectionItemNotFound,"contact");if(!this._owner$1.canRemoveContact(e))throw i._exceptionHelper.createInvalidOperationException(i._exceptions.unsupportedContactOperation);this._owner$1.removeContact(this,e)},r.findByAddress=function(e){if(null==e)throw i._exceptionHelper.createArgumentNullException("address");if(e.get__user()!==this._user$1)throw i._exceptionHelper.createArgumentException(i._exceptions.objectNotBelongToUser,"address");return this.get__items().contains(e.get_contact())?e.get_contact():null},r.findByCid=function(e){if(t.isNullOrEmpty(e))throw i._exceptionHelper.createArgumentNullException("cid");var s=new n.IMAddressInfo(e,n.IMAddressInfoType.cid,n.RoleLists.none),o=this._user$1._findAddress(s);return null!=o?this.findByAddress(o):null},r.findByIdWithoutRoleCheck=function(e){if(t.isNullOrEmpty(e))throw i._exceptionHelper.createArgumentNullOrEmptyException("id",e);return this._user$1.findContactById(e)},r.findById=function(e){if(t.isNullOrEmpty(e))throw i._exceptionHelper.createArgumentNullOrEmptyException("id",e);var n=this._user$1.findContactById(e);return null!=n&&this._owner$1.containsContact(n)?n:null},r.find=function(e,n){if(t.isNullOrEmpty(e))throw i._exceptionHelper.createArgumentNullException("address");for(var s=0;s<this.get_count();s++)for(var o=this.get__items()[s],r=0;r<o.get_addresses().get_count();r++){var a=o.get_addresses().get_item(r);if(a._equalsByAddressAndType(e,n))return o}return null},r.get_item=function(e){return this.getItem(e)}}()}),define("contactdictionary",["contactcollection"],function(){!function(){function e(e){if(e.startsWith("13:")){var t=e.indexOf(";");return e.substr(0,t)+e.substr(t).toLowerCase()}return e.toLowerCase()}function t(e){return a.isNullOrEmpty(e)||"00000000-0000-0000-0000-000000000000"===e||"{00000000-0000-0000-0000-000000000000}"===e}function n(e){for(var t=new Array(e.length),n=null,i=0;i<e.length;i++){var s=e[i];a.isNullOrEmpty(n)&&(n=s.cid);var c=r.ContactHelper.getIMAddressInfoKey(s),l=new Array(1);l[0]=c;var u={0:o.Guid.newGuid().toString(),3:[l],4:s.network,5:s.address,7:s.id};t[i]=u}var d={0:o.Guid.newGuid().toString(),1:t,2:e[0].id,6:n};return new wLive.People.Person(d,new wLive.People.Names)}var i=window,s=i.MC,o=i.Microsoft.Live.Messenger,r=i.MSH,a=i.ss,c=s.IMAddressInfoType;o._contactDictionary=function(e){this._addressMap={},this._contactMap={},this._allContacts=[],this._user=e},o._contactDictionary.prototype={_contactMap:null,_addressMap:null,_allContacts:null,_user:null,_markOffline:function(e,t){var n=s.ServiceData.createEmpty(s.ServiceType.IM);n.set_status(s.PresenceInfoStatus.offline);var i=[n.get_info()],o=this._addressMap;for(var r in o){var a={key:r,value:o[r]},c=a.value;!c.get_isOnline()||e&&c.get_isUser()||null!=t&&c.get_network().get_id()!==t||c._onServiceDataChanged(i)}},_createAddress:function(e){var t=new o.IMAddress(this._user,e);return this._storeIMAddressMapping(t),t},_storeIMAddressMapping:function(e){if(this._addressMap[e.get_id()]=e,e.get__info().type===c.windowsLive&&!a.isNullOrEmpty(e.get__info().cid)&&!a.isNullOrEmpty(e.get__info().address)){var t=r.ContactHelper.getIMAddressInfoKey(e.get__info());this._addressMap[t]=e}},_findAddress:function(e){var t=null,n=r.ContactHelper.computeIMAddressId(e);return a.keyExists(this._addressMap,n)&&(t=this._addressMap[n]),null!=t&&t.get__info().type===c.cid&&e.type===c.windowsLive&&this._storeIMAddressMapping(t),t},_findOrCreateAddressForContact:function(e,t){var n=this._findAddress(t);return null==n&&(n=this._createAddress(t)),n._setLinkedContact(e),n},_createUserContact:function(e){return this._createContact(n(e),!1)},_findOrCreateAddress:function(e){var t=this._findAddress(e);if(null==t&&(t=this._createAddress(e)),null==t.get_contact()){var i=n([e]),s=this._findContact(i.getContacts()[0]);null!=s?s._attachAddress(t):this._createContact(i,!0)}return t},_findContactById:function(n){if(!t(n)){var i=e(n);if(a.keyExists(this._contactMap,i))return this._contactMap[i];if(a.keyExists(this._addressMap,i)){var s=this._addressMap[i];return s.get_contact()}}return null},_findContactBySkypeId:function(e,t){var n=this._contactMap;for(var i in n)for(var s={key:i,value:n[i]},o=s.value,r=a.IEnumerator.getEnumerator(o.get_addresses());r.moveNext();){var c=r.get_current();if(c.get_skypeName()!==e);else{if(a.isNullOrEmpty(t))return o;if(t===c.get_network().get_id())return o}}return null},_findContactByAddress:function(e){var t=null,n=this._findAddress(e);return null!=n&&(t=n.get_contact()),null==t&&e.type===c.connect&&(t=this._contactMap[r.ContactHelper.computeIMAddressId(e)]),t},_findContactByAddresses:function(e){for(var t=a.IEnumerator.getEnumerator(e);t.moveNext();){var n=t.get_current(),i=r.ContactHelper.createAddressInfoFromMessagingAddress(n,null);if(i){var s=this._findContactByAddress(i);if(null!=s)return s}}return null},_findContact:function(e){var t=this._findContactById(e.getId());return null==t&&e.getMessagingAddresses().length>0&&(t=this._findContactByAddresses(e.getMessagingAddresses())),t},_createOrUpdateContact:function(e){var t=this._findContactByPwcPerson(e);return null==t?t=this._createContactAndLinkedContacts(e,!1):t._update(e),t},_deleteContact:function(e){for(var t=a.IEnumerator.getEnumerator(e.getContacts());t.moveNext();){var n=t.get_current(),i=this._findContact(n);if(null!=i){this._allContacts.remove(i);for(var s=a.IEnumerator.getEnumerator(i.get_linkedContacts());s.moveNext();){var o=s.get_current();delete this._contactMap[o.get_id()]}for(var c=a.IEnumerator.getEnumerator(i.get_addresses());c.moveNext();){var l=c.get_current();delete this._addressMap[r.ContactHelper.getIMAddressInfoKey(l.get__info())]}this._user.get_contacts()._removeInternal(i)}}},_findContactByPwcPerson:function(e){for(var t=a.IEnumerator.getEnumerator(e.getContacts());t.moveNext();){var n=t.get_current(),i=this._findContact(n);if(null!=i)return i}return null},_createContact:function(e,t){return this._createContactAndLinkedContacts(e,t)},_createContactAndLinkedContacts:function(e,n){var i=new o.Contact(this,this._user,e,n);this._allContacts.push(i);for(var s=0;s<i.get_linkedContacts().get_count();s++)if(linkedContact=i.get_linkedContacts().get_item(s),t(linkedContact.get_id())||(this._contactMap[linkedContact.get_id()]=i),null!=linkedContact.get__addresses())for(var l=a.IEnumerator.getEnumerator(linkedContact.get__addresses());l.moveNext();){var u=l.get_current().get__info();u.type===c.connect&&(this._contactMap[r.ContactHelper.computeIMAddressId(u)]=i)}return i}}}(window.originaljQuery||jQuery)}),define("messagecollection",["contactdictionary"],function(){!function(){var e=window,t=e.Microsoft.Live.Messenger,n=e.MSH,i=t.Collection,s=t.MessageCollection=function(){i.call(this),this._lastReceived$1=n.DateTimeHelper.minValue},o=s.prototype=new i;o.constructor=s,o._lastReceived$1=null,o._addOutbound=function(e){var t=new Date;e.set_timestamp(t),this._add(e)},o._add=function(e){this._addInternal(e),e.get_sender().get_isUser()||(this._lastReceived$1=e.get_timestamp(),this.onPropertyChanged(new t.PropertyChangedEventArgs("LastReceived")))},o._remove=function(e){this._removeInternal(e)},o._insert=function(e,t){this._insertInternal(e,t,!0)},o._insertRange=function(e,t){this._insertRangeInternal(e,t)},o.get_lastReceived=function(){return this._lastReceived$1},o.get_item=function(e){return this.getItem(e)}}()}),define("messagereceivedeventargs",["messagecollection"],function(){!function(){var e=window,t=e.Microsoft.Live.Messenger;t.MessageReceivedEventArgs=function(e){this._message$1=e},t.MessageReceivedEventArgs.prototype={get_message:function(){return this._message$1}}}()}),define("sendmessagefailedeventargs",["messagereceivedeventargs"],function(){!function(){var e=window,t=e.Microsoft.Live.Messenger;t.SendMessageFailedEventArgs=function(e,t,n){this._resultCode$1=e,this._message$1=t,this._userState$1=n},t.SendMessageFailedEventArgs.prototype={_resultCode$1:t.SendMessageResultCode.success,_message$1:null,_userState$1:null,get_resultCode:function(){return this._resultCode$1},get_message:function(){return this._message$1},get_userState:function(){return this._userState$1}}}()}),define("signedouteventargs",["sendmessagefailedeventargs"],function(){!function(){var e=window,t=e.Microsoft.Live.Messenger;t.SignedOutEventArgs=function(e){this._reason$1=e},t.SignedOutEventArgs.prototype={get_reason:function(){return this._reason$1}}}()}),define("signedoutremotelyeventargs",["signedouteventargs"],function(){!function(){var e=window,t=e.Microsoft.Live.Messenger;t.SignedOutRemotelyEventArgs=function(){}}()}),define("signincompletedeventargs",["signedoutremotelyeventargs"],function(){!function(){var e=window,t=e.Microsoft.Live.Messenger;t.SignInCompletedEventArgs=function(e,t,n){this._resultCode$1=e,this._error$1=t,this._userState$1=n},t.SignInCompletedEventArgs.prototype={_resultCode$1:t.SignInResultCode.success,_userState$1:null,_error$1:null,_serverName$1:null,get_resultCode:function(){return this._resultCode$1},get_error:function(){return this._error$1},get_userState:function(){return this._userState$1},get_serverName:function(){return this._serverName$1},set_serverName:function(e){return this._serverName$1=e,e}}}()}),define("signoutcompletedeventargs",["signincompletedeventargs"],function(){!function(){var e=window,t=e.Microsoft.Live.Messenger;t.SignOutCompletedEventArgs=function(e,t,n,i){this._resultCode$1=e,this._locations$1=t,this._signoutEndpoint$1=n,this._userState$1=i},t.SignOutCompletedEventArgs.prototype={_locations$1:t.SignOutLocations.local,_resultCode$1:t.SignOutResultCode.success,_signoutEndpoint$1:null,_userState$1:null,get_endpoint:function(){return this._signoutEndpoint$1},get_locations:function(){return this._locations$1},get_resultCode:function(){return this._resultCode$1},get_userState:function(){return this._userState$1}}}()}),define("conversation2",["signoutcompletedeventargs"],function(){!function(e){function t(e,t,n){return t.getTime()-e.getTime()>n}var n=1e4,i=window,s=i.MC,o=i.Microsoft.Live.Messenger,r=i.MSH,a=i.ss,c=o.MessageType,l=o._iimAddressCollectionOwner,u=o.Conversation=function(t,i,s){if(l.call(this),t){var c=null;if(i instanceof o.IMAddress)c=i;else{if(!(i instanceof o.Contact))throw o._exceptionHelper.createArgumentOutOfRangeException("entity");var u=i;c=u.get_currentAddress()}if(c.get__user()!==t)throw o._exceptionHelper.createArgumentException(o._exceptions.objectNotBelongToUser,"address");if(c.get_isUser()&&!s)throw o._exceptionHelper.createArgumentException(o._exceptions.cantConvSelf,"address");c.get_type()===o.IMAddressType.shortCircuit&&(this._hasMoreHistoryOnServer=!1),a.isNullOrEmpty(t.get_conversations().get__currentConversationId())?this._id=c.get__chatKey():(this._id=t.get_conversations().get__currentConversationId(),t.get_conversations().set__currentConversationId("")),this._user=t,this._network=c.get_network(),null!=t.get_conversations().get__currentConversationCreator()?(this._creator=t.get_conversations().get__currentConversationCreator(),t.get_conversations().set__currentConversationCreator(null)):this._creator=t.get_address(),this._messageIdMap={},this._history=new o.MessageCollection,e(this._history).bind("collectionChanged",a.Delegate.create(this,this._onHistoryCollectionChanged)),this._invitedContacts={},this._roster=new o.IMAddressCollection(this),e(this._roster).bind("collectionChanged",a.Delegate.create(this,this._onRosterCollectionChanged)),s||(this._roster._addInternal(c),this._roster._addInternal(t.get_address())),this._typingaddresses=new o.TypingIMAddressCollection(n),this._lastTypedTime=r.DateTimeHelper.minValue,this._reloaded=t.get_conversations().get__currentConversationReloaded(),t.get_conversations()._addInternal(this),s||this._createInternally()}};u._createFromIncoming=function(e,t,n,i){for(var s,o,r=a.IEnumerator.getEnumerator(e.get_conversations());r.moveNext();)if(o=r.get_current(),o._id===t){s=o;break}if(!s){if(null==n)s=e._createConversationFromIncoming(i[0],t);else{if(!e.get_skypeAddress())return null;s=e._createGroupConversation(n)}if(null!=i)for(var c=1;c<i.length;c++)s._roster._addInternal(i[c])}return $WLXIM.wacReady()&&s.idMatches($WLXIM.wacThreadId)&&s.getHistory(),s};var d=u.prototype=new l;d.constructor=u,d._user=null,d._creator=null,d._id=null,d._consumptionHorizon=null,d._buddyAddress=null,d._roster=null,d._typingaddresses=null,d._history=null,d._messageIdMap=null,d._closed=!1,d._invitedContacts=null,d._lastTypedTime=null,d._reloaded=!1,d._recentMessage=null,d._hasMoreHistoryOnServer=!0,d._network=null,d._onAddMembersCompleted=null,d._onRemoveMembersCompleted=null,d._onConversationUpdated=null,d.get_user=function(){return this._user},d.get_network=function(){return this._network},d.get_roster=function(){return this._roster},d.get_buddyAddress=function(){if(null==this._buddyAddress)for(var e=a.IEnumerator.getEnumerator(this.get_roster());e.moveNext();){var t=e.get_current();t!==this.get_user().get_address()&&(this._buddyAddress=t)}return this._buddyAddress},d.get_buddyContact=function(){return null==this.get_buddyAddress()?null:this.get_buddyAddress().get_contact()},d.get_creator=function(){return this._creator},d.get_typingAddresses=function(){return this._typingaddresses},d.get_history=function(){return this._history},d.get_mostRecentMessage=function(){if(this._history.get_count()>0)for(var e=this._history.get_count()-1;e>=0;e--){var t=this._history.get_item(e);if(t instanceof o.TextMessage||t instanceof o.ThreadActivityMessage)return t}return this._recentMessage},d.get_lastHistoryMessage=function(){return this._history.get_count()>0&&this._history.get_item(0).get_isHistoryMessage()?this._history.get_item(0):this.get_mostRecentMessage()
},d.get_closed=function(){return this._closed},d.get_reloaded=function(){return this._reloaded},d._setReloaded=function(e){this._reloaded=e},d.get__isOffline=function(){if(this._closed||2!==this._roster.get_count())return!1;for(var e=a.IEnumerator.getEnumerator(this._roster);e.moveNext();){var t=e.get_current();if(!t.get_isUser()){if(r.ContactHelper.getIMAddressInfoKey(t.get__info())!==this._id)return!1;if(!t.get_isOnline()&&!t.get__isMobile()&&t.get_type()!==o.IMAddressType.shortCircuit&&t.get_isContact())return!0}}return!1},d.get__supportsTypingIndicators=function(){for(var e=a.IEnumerator.getEnumerator(this._roster);e.moveNext();){var t=e.get_current();if(!t.get_capabilities().get__supportsTypingIndicators())return!1}return!0},d.get_id=function(){return this._id},d.get_supportsMultiparty=function(){if(this._closed)return!1;for(var e=a.IEnumerator.getEnumerator(this._roster);e.moveNext();){var t=e.get_current();if(!t.get_capabilities().get_supportsMultipartyConversations())return!1}return!0},d.get_supportsOfflineMessages=function(){if(this._closed||2!==this._roster.get_count())return!1;for(var e=a.IEnumerator.getEnumerator(this._roster);e.moveNext();){var t=e.get_current();if(!(t.get_isUser()||t.get_capabilities().get_supportsOfflineMessages()&&t.get__info().type!==s.IMAddressInfoType.cid))return!1}return!0},d.get_hasUnreadMessages=function(){var e=this.get_mostRecentMessage();if(e&&!e.get_sender().get_isUser()){if(!this._consumptionHorizon)return!0;var t=this._consumptionHorizon.lastReadMessageTimestamp;if(this._consumptionHorizon.lastReadMessageId){var n=this._messageIdMap[this._consumptionHorizon.lastReadMessageId];n&&(t=n.get_timestamp())}if(e.get_timestamp()>t)return!0}return!1},d.get_consumptionHorizon=function(){return this._consumptionHorizon},d.get_hasMoreHistoryOnServer=function(){return this._hasMoreHistoryOnServer},d.set_hasMoreHistoryOnServer=function(e){return this._hasMoreHistoryOnServer!==e&&(this._hasMoreHistoryOnServer=e,this.onPropertyChanged(new o.PropertyChangedEventArgs("HasMoreHistory"))),e},d.notifyUserTyped=function(){if(this._assertNotDisposed(),this.get__supportsTypingIndicators()&&!this.get__isOffline()){var e=new Date;if(t(this._lastTypedTime,e,n)){this._lastTypedTime=e;var i=new s.MessageInfo(s.MessageInfoType.typingUserMessage,null);i.sender=this._user.get_address().get__info(),this._user._conversationSendMessage(this._id,i,null)}}},d.getHistory=function(){this._hasMoreHistoryOnServer&&this._user._conversationGetHistory(this._id)},d.idMatches=function(e){return this.get_id().split(":")[1].toLowerCase()===e},d.removeInviteRequest=function(){for(var e=a.IEnumerator.getEnumerator(this._history.get__items());e.moveNext();){var t=e.get_current();t.get_inviteMessage()&&this._history._remove(t)}},d.sendMessage=function(e,t){this.sendMessageToEndpoint(e,null,t)},d.sendMessageToEndpoint=function(e,t,n){if(this._assertNotDisposed(),null==e)throw o._exceptionHelper.createArgumentNullException("message");if(null!=t&&2!==this._roster.get_count())throw o._exceptionHelper.createInvalidOperationException(o._exceptions.targetEndpointRosterCountInvalid);if(!this.get__isOffline()||!this.get_supportsOfflineMessages()||e.get__supportsOffline()){e.set_networkId(this.get_network().get_id()),e.set_networkName(this.get_network().get_name()),e.set_conversationId(this._id);var i=e._buildMessageInfo(this._user.get_address(),this);if(null!=t){for(var s=a.IEnumerator.getEnumerator(this._roster);s.moveNext();){var r=s.get_current();if(!r.get_isUser()&&!r.get_endpoints()._contains(t))throw o._exceptionHelper.createArgumentOutOfRangeException("targetEndpoint")}i.targetEndpointId=t.get_id().toString()}this.get__isOffline()&&this.get_supportsOfflineMessages()&&(i.isOfflineMessage=!0),this._user._conversationSendMessage(this._id,i,n),this._history._addOutbound(e)}},d.close=function(){this._closed||(this._user._conversationClose(this._id),this._markConversationAsClosed())},d.supportsMessageType=function(e){if(this._closed)return!1;if(e===c.callEventMessage&&2!==this._roster.get_count())return!1;for(var t=a.IEnumerator.getEnumerator(this._roster);t.moveNext();){var n=t.get_current();if(!n.get_capabilities().supportsMessageType(e))return!1}return!0},d.isTextMessageValid=function(e){return o.TextMessage.isValid(this,e)},d.rosterContainsAddress=function(e){for(var t=a.IEnumerator.getEnumerator(this._roster);t.moveNext();){var n=t.get_current();if(n&&n.equals(e))return!0}return!1},d.markAsRead=function(){var e=this.get_mostRecentMessage();if(e&&(!this.get_consumptionHorizon()||e.get_timestamp()>this.get_consumptionHorizon().lastReadMessageTimestamp)){var t=null!=e.get_clientMessageId()?e.get_clientMessageId():e.get_receivedMessageId(),n=new s.ConsumptionHorizonInfo(t,e.get_timestamp());this._setConsumptionHorizon(n),this._user._conversationUpdateConsumptionHorizon(this._id,n)}},d.createEmptyConsumptionHorizon=function(){var e=new s.ConsumptionHorizonInfo(null,new Date("1970-01-01"));this._setConsumptionHorizon(e),this._user._conversationUpdateConsumptionHorizon(this._id,e)},d.onMessageReceived=function(t){e(this).triggerHandler("messageReceived",[this,t]),this._history._add(t.get_message());var n=t.get_message().get_receivedMessageId();n&&(this._messageIdMap[n]=t.get_message())},d.onHistoryMessagesReceived=function(e,t){if(this.set_hasMoreHistoryOnServer(t),null!=e){for(var n=[],i=a.IEnumerator.getEnumerator(e);i.moveNext();){var s=i.get_current(),o=s.get_receivedMessageId();o&&!this._messageIdMap[o]&&(n.push(s),this._messageIdMap[o]=s)}n.length>1?this._history._insertRange(0,n):1===n.length?this._history._insert(0,n[0]):t&&this.getHistory()}},d.onRecentMessageReceived=function(t){this._recentMessage=t.get_message(),e(this).triggerHandler("recentMessageReceived",[this,t])},d.onSendMessageFailed=function(t){e(this).triggerHandler("sendMessageFailed",[this,t])},d.onPropertyChanged=function(t){e(this).triggerHandler("propertyChanged",[this,t])},d.dispose=function(){this.close()},d.addAddress=function(e,t){if(!(this instanceof o.GroupConversation))throw new Error(o._exceptions.collectionReadOnly);e._addInternal(t)},d.removeAddress=function(e,t){if(!(this instanceof o.GroupConversation))throw new Error(o._exceptions.collectionReadOnly);e._removeInternal(t)},d._createInternally=function(){var e=this._roster.get_item(0);e.get_isUser()&&(e=this._roster.get_item(1)),this._user._conversationCreate(this._id,e)},d._onHistoryCollectionChanged=function(){this.onPropertyChanged(new o.PropertyChangedEventArgs("History"))},d._onRosterCollectionChanged=function(){this.onPropertyChanged(new o.PropertyChangedEventArgs("Roster"))},d._onClosed=function(){this._closed||this._markConversationAsClosed()},d._setConsumptionHorizon=function(e){this._consumptionHorizon&&this._consumptionHorizon.lastReadMessageId===e.lastReadMessageId&&this._consumptionHorizon.lastReadMessageTimestamp===e.lastReadMessageTimestamp||(this._consumptionHorizon=e,this.onPropertyChanged(new o.PropertyChangedEventArgs("ConsumptionHorizon")))},d._setConversationId=function(e){this._id!==e&&(this._id=e,this.onPropertyChanged(new o.PropertyChangedEventArgs("Id")))},d._markConversationAsClosed=function(){this._closed=!0,this.onPropertyChanged(new o.PropertyChangedEventArgs("Closed")),this._user.get_conversations()._removeInternal(this)},d._assertNotDisposed=function(){if(this._closed)throw o._exceptionHelper.createObjectDisposedException("Conversation")}}(window.originaljQuery||jQuery)}),define("groupconversation",["conversation2"],function(){!function(e){var t=window,n=t.MC,i=t.Microsoft.Live.Messenger,s=t.ss,o=n.GroupConversationOperationResult,r=i.Conversation,a=i.GroupConversation=function(e,t,n){r.call(this,e,t,!0),this._onConversationUpdated(n)};a._getThreadMemberInfo=function(e){for(var t=new Array(e.length),o=0,r=s.IEnumerator.getEnumerator(e);r.moveNext();){var a=r.get_current(),c=a.get_type()===i.IMAddressType.skype?a.get_contact().get_windowsLiveAddress():a.get_contact().get_skypeAddress();t[o++]=new n.GroupConversationMemberInfo(a.get__info(),null==c?null:c.get__info())}return t};var c=a.prototype=new r;c.constructor=a,c._threadInfo$1=null,c._groupContact$1=null,c._userInitiated$1=!1,c.get_title=function(){return!s.isNullOrUndefined(this._threadInfo$1)&&s.isNullOrEmpty(this._threadInfo$1.title)?this._threadInfo$1.title:""},c.get_version=function(){return this._threadInfo$1.version},c.get_userInitiated=function(){return this._userInitiated$1},c.set_userInitiated=function(e){return this._userInitiated$1=e,e},c.get_buddyAddress=function(){return this.get_buddyContact().get_addresses().get_item(0)},c.get_buddyContact=function(){if(null==this._groupContact$1){var e=new n.IMAddressInfo(this.get_id().split(":")[1],n.IMAddressInfoType.temporaryGroup,n.RoleLists.none);this._groupContact$1=this.get_user()._findOrCreateAddress(e).get_contact()}return this._groupContact$1},c.addMembers=function(e){this.get_user()._conversationAddMembers(this.get_id(),i.GroupConversation._getThreadMemberInfo(e),null)},c.removeMembers=function(e){this.get_user()._conversationRemoveMembers(this.get_id(),i.GroupConversation._getThreadMemberInfo(e),null)},c.leaveGroup=function(){var e,t=this.get_user().get_contact();this.rosterContainsAddress(t.get_windowsLiveAddress())?e=[t.get_windowsLiveAddress()]:this.rosterContainsAddress(t.get_skypeAddress())&&(e=[t.get_skypeAddress()]),e&&this.removeMembers(e)},c._onAddMembersCompleted=function(t,n){if(t!==o.success){for(var s=new Array(n.length),r=0;r<n.length;r++)s[r]=this.get_user()._findOrCreateAddress(n[r].address);e(this).triggerHandler("operationFailed",[i.GroupConversationOperationType.addMembers,s])}},c._onRemoveMembersCompleted=function(t,n){if(t!==o.success){for(var s=new Array(n.length),r=0;r<n.length;r++)s[r]=this.get_user()._findOrCreateAddress(n[r].address);e(this).triggerHandler("operationFailed",[i.GroupConversationOperationType.removeMembers,s])}},c._onConversationUpdated=function(t){if(this._threadInfo$1=t,this._threadInfo$1.userInitiated&&(this._userInitiated$1=!0,this.get_user().get_presence().get_status()===i.PresenceStatus.appearOffline&&this.getHistory()),this.get_roster()._beginReset(),this.get_roster().get__items().length=0,null!=t.members)for(var n=s.IEnumerator.getEnumerator(t.members);n.moveNext();){var o,r=n.get_current();if(null==r.linkedAddress)o=this.get_user()._findOrCreateAddress(r.address);else{o=this.get_user()._findAddress(r.address);var a=this.get_user()._findAddress(r.linkedAddress);null!=o?null==a&&(a=this.get_user()._findOrCreateAddress(r.linkedAddress),a.get_contact()._setDisplayNameChanges(o.get_contact().get_displayName())):null!=a?(o=this.get_user()._findOrCreateAddress(r.address),a.get_contact().get_isTemporaryContact()?a.get_contact()._setDisplayNameChanges(o.get_contact().get_displayName()):o.get_contact()._setDisplayNameChanges(a.get_contact().get_displayName())):(o=this.get_user()._findOrCreateAddress(r.address),a=this.get_user()._findOrCreateAddress(r.linkedAddress),a.get_contact()._setDisplayNameChanges(o.get_contact().get_displayName()))}this.get_roster().add(o)}this.get_roster().get__items().sort(function(e,t){return s.compare(e.get_contact().get_displayName(),t.get_contact().get_displayName(),!0)}),this.get_roster()._endReset(),this._updateDisplayName$1(),e(this).triggerHandler("infoUpdated")},c._updateDisplayName$1=function(){var e="";if(s.isNullOrEmpty(this._threadInfo$1.title)){for(var t=s.IEnumerator.getEnumerator(this.get_roster());t.moveNext();){var n=t.get_current();n.get_isUser()||(e+=n.get_contact().get_displayName()+", ")}s.isNullOrEmpty(e)||(e=e.substr(0,e.length-2))}else e=this._threadInfo$1.title;e!==this.get_buddyContact().get_displayName()&&this.get_buddyContact()._setDisplayNameChanges(e)}}(window.originaljQuery||jQuery)}),define("conversationcollection",["groupconversation"],function(){!function(e){var t=window,n=t.Microsoft.Live.Messenger,i=t.ss,s=n.Collection,o=n.ConversationCollection=function(e){s.call(this),this._user$1=e,this._currentConversationCreator$1=null,this._currentConversationId$1="",this._currentConversationReloaded$1=!1},r=o.prototype=new s;r.constructor=o,r._user$1=null,r._currentConversationId$1=null,r._currentConversationReloaded$1=!1,r._hasMoreConversationsOnServer$1=!0,r.get__currentConversationCreator=function(){return this._currentConversationCreator$1},r.set__currentConversationCreator=function(e){return this._currentConversationCreator$1=e,e},r.get__currentConversationId=function(){return this._currentConversationId$1},r.set__currentConversationId=function(e){return this._currentConversationId$1=e,e},r.get__currentConversationReloaded=function(){return this._currentConversationReloaded$1},r.create=function(e){if(null==e)throw n._exceptionHelper.createArgumentNullException("address");this._user$1._ensureServicesRichOperation();var t;if(e instanceof n.IMAddress)t=e;else{if(!(e instanceof n.Contact))throw n._exceptionHelper.createArgumentOutOfRangeException("entity");var i=e;if(i.get_isEmailOnlyContact())throw n._exceptionHelper.createInvalidOperationException(n._exceptions.conversationEmailOnly);t=i.get_currentAddress()}if(t.get_isUser())throw n._exceptionHelper.createInvalidOperationException(n._exceptions.cantConvSelf);var s=this._getConversationByAddress$1(t);return null==s&&(s=this._user$1._createConversation(t)),s},r.createByCid=function(e){if(i.isNullOrEmpty(e))throw n._exceptionHelper.createArgumentNullOrEmptyException("cid",e);var t=this._user$1.get_contacts().findByCid(e);return null!=t?this.create(t):null},r.createGroup=function(e){var t=n.GroupConversation._getThreadMemberInfo(e);this._user$1._conversationCreateGroup(t)},r.getMoreRecentConversations=function(){this._user$1._conversationGetRecentList()},r.get_hasMoreConversationsOnServer=function(){return this._hasMoreConversationsOnServer$1},r._clear=function(){for(this._beginReset();this.get_count()>0;)this.get_item(0)._onClosed();this._endReset()},r.removeConversation=function(e){this._removeInternal(e)},r._onAddMembersCompleted=function(e,t,i,s){var o=this._getConversationById$1(e);null!=o&&o instanceof n.GroupConversation&&o._onAddMembersCompleted(t,i,s)},r._onRemoveMembersCompleted=function(e,t,i,s){var o=this._getConversationById$1(e);null!=o&&o instanceof n.GroupConversation&&o._onRemoveMembersCompleted(t,i,s)},r.onConversationClearedAtUpdated=function(t,n){var i=this._getConversationById$1(t);if(null!=i){var s=i.get_mostRecentMessage();if(null!=s&&s.get_timestamp()<new Date(parseInt(n))){var o=this;o._user$1.remove_conversation(i,n,function(){e(o).triggerHandler("conversationDeleted",i)})}}},r._onAddressJoined=function(e,t){var n=this._getConversationById$1(e);if(null!=n){var i=this._user$1._findOrCreateAddress(t);n.get_roster()._addInternal(i)}},r._onAddressLeft=function(e,t){var n=this._getConversationById$1(e);if(null!=n&&n.get_roster().get_count()>=3){var i=this._user$1._findOrCreateAddress(t);n.get_roster()._removeInternal(i)}},r._onConversationClosed=function(e){var t=this._getConversationById$1(e);null!=t&&t._onClosed()},r._onConsumptionHorizonUpdated=function(e,t){var n=this._getConversationById$1(e);null!=n&&n._setConsumptionHorizon(t)},r._onGetRecentConversationsCompleted=function(t,n){this._hasMoreConversationsOnServer$1=t,e(this).triggerHandler("getRecentConversationsCompleted",{callFailed:n})},r._onMessageReceived=function(e,t){var s=this._getConversationById$1(e);if(null!=s){var o=this._user$1._findOrCreateAddress(t.sender);i.isNullOrEmpty(t.displayNameOverride)||(o.get_isAnonymous()||!o.get_contact().get_isContact())&&o.get_contact()._setDisplayNameChanges(t.displayNameOverride);var r=n.Message._fromMessageInfo(this._user$1,o,t,s);null!=r&&(t.isRecentMessage?s.onRecentMessageReceived(new n.MessageReceivedEventArgs(r)):(this._currentConversationReloaded$1&&r._setReloaded(!0),s.onMessageReceived(new n.MessageReceivedEventArgs(r)),null!=o&&r.get_type()===n.MessageType.textMessage&&s.get_typingAddresses()._remove(o)))}},r._onConversationHistoryMessagesReceived=function(e,t,i){var s=this._getConversationById$1(e);if(null!=t){for(var o=new Array(t.length),r=0;r<t.length;r++){var a=t[r];o[r]=n.Message._fromMessageInfo(this._user$1,this._user$1._findOrCreateAddress(a.sender),a,s)}s.onHistoryMessagesReceived(o,i)}else s.onHistoryMessagesReceived(null,i)},r._onBuddyTypedNotification=function(e,t){var n=this._getConversationById$1(e);if(null!=n){var i=this._user$1._findOrCreateAddress(t);i!==n.get_user().get_address()&&i!==n.get_user().get_skypeAddress()&&n.get_typingAddresses()._add(i)}},r._onSendMessageFailed=function(e,t,i,s){var o=this._getConversationById$1(e);if(null!=o){var r=n.Message._fromMessageInfo(this._user$1,this._user$1.get_address(),i,o);null!=r&&o.onSendMessageFailed(new n.SendMessageFailedEventArgs(t,r,s))}},r._onConversationUpdated=function(e,t){var n=this._getConversationById$1(e);null!=n&&n._onConversationUpdated(t)},r._onUpdatedId=function(e,t){var n=this._getConversationById$1(e);n._setConversationId(t)},r._getConversationByAddress$1=function(e){return this._getConversationById$1(e.get__chatKey())},r._getConversationById$1=function(e){for(var t=i.IEnumerator.getEnumerator(this);t.moveNext();){var n=t.get_current();if(n.get_id()===e)return n}return null},r.get_item=function(e){if(0>e||e>=this.get_count())throw n._exceptionHelper.createArgumentOutOfRangeException("index");return this.get__items()[e]}}(window.originaljQuery||jQuery)}),define("searchresult",["conversationcollection"],function(){!function(){var e=window,t=e.Microsoft.Live.Messenger;t._searchResult=function(){},t._searchResult.prototype={found:!1,index:0}}()}),define("sortedcollection",["searchresult"],function(){!function(){var e=600,t=window,n=t.Microsoft.Live.Messenger,i=t.ss,s=n.Collection,o=n.SortedCollection=function(e,t){s.call(this),this._compareItems$1=e,this._sortCallback$1=t,this._sortCallback$1||(this._sortCallback$1=i.Delegate.create(this,this._defaultSort$1))},r=o.prototype=new s;r.constructor=o,r._compareItems$1=null,r._sortCallback$1=null,r._endReset=function(){this._sortCallback$1.invoke(this.get__items()),s.prototype._endReset.call(this)},r._loadItems=function(e){this._beginReset(),this.get__items().length=0,null!=e&&this._insertRangeInternal(0,e),this._endReset()},r._addItem=function(e){var t;if(this.get__isResetting())t=this.get_count();else{var i=new n._searchResult;this._binarySearch$1(e,i),i.found&&!this.onInsertEqual(this.get__items()[i.index],e),t=i.index}this._insertInternal(t,e,!0)},r._removeItem=function(e){var t=this._findItem(e);t>=0&&this._removeAtInternal(t,!0)},r._updateItem=function(e){var t=this.get__items().indexOf(e);if(-1!==t){var i=new n._searchResult;this.get__items().splice(t,1),this._binarySearch$1(e,i),this.get__items().insert(t,e),t!==i.index&&this._moveInternal(i.index,t)}},r._findItem=function(t){var i=new n._searchResult;return this.get_count()>e&&!this.get__isResetting()?(this._binarySearch$1(t,i),i.found?i.index:-1):this.get__items().indexOf(t)},r.onInsertEqual=function(){return!0},r._defaultSort$1=function(e){e.sort(this._compareItems$1)},r._binarySearch$1=function(e,t){if(t.index=0,t.found=!1,0!==this.get_count()){for(var n,i,s=this.get_count()-1,o=0;s>=o;)if(n=Math.floor((s+o)/2),i=this._compareItems$1.invoke(this.get__items()[n],e),0>i)o=n+1;else if(i>0)s=n-1;else if(0===i){for(;n>0&&0===this._compareItems$1.invoke(this.get__items()[n-1],e);)n--;for(;n<this.get_count()-1&&this.get__items()[n]!==e&&0===this._compareItems$1.invoke(this.get__items()[n+1],e);)n++;return t.index=n,void(t.found=this.get__items()[n]===e)}t.index=o}}}()}),define("aggregatedconversation",["sortedcollection"],function(){!function(e){var t=window,n=t.Microsoft.Live.Messenger,i=t.MSH,s=t.ss;n.AggregatedConversation=function(e){this._getHistoryPending="",this._user=e,this._conversations=[],this._history=new n.MessageCollection,this._pendingHistoryMessages=[],this._stagingHistoryMessages=[]},n.AggregatedConversation.prototype={_conversations:null,_currentConversation:null,_user:null,_buddyContact:null,_history:null,_hasMoreHistoryOnServer:!0,_markedReadTimestamp:null,_firstHistoryRequest:!0,_pageSize:20,_pendingHistoryMessages:null,_stagingHistoryMessages:null,get_user:function(){return this._user},get_buddyContact:function(){if(null==this._buddyContact&&null!=this._conversations&&this._conversations.length>0){var e=this._conversations[0];this._buddyContact=e.get_buddyContact()}return this._buddyContact},get_conversations:function(){return this._conversations},get_currentConversation:function(){if(null==this._currentConversation){var e=this.getMostRecentMessage();if(null!=e)for(var t=s.IEnumerator.getEnumerator(this._conversations);t.moveNext();){var n=t.get_current();if(e.get_conversationId()===n.get_id())return n}if(this._conversations.length>0)return this._conversations[0]}return this._currentConversation},set_currentConversation:function(t){this._currentConversation=t,this.get_buddyContact().set_currentAddress(this._currentConversation.get_buddyAddress());var n={};return n.conversation=this._currentConversation,e(this).triggerHandler("currentConversationChanged",[this,n]),t},get_history:function(){return this._history},get_hasMoreHistoryOnServer:function(){return this._hasMoreHistoryOnServer},get_hasUnreadMessages:function(){for(var e=0;e<this._conversations.length;e++)if(this._conversations[e].get_hasUnreadMessages())return!0;return!1},get_consumptionHorizon:function(){for(var e=null,t=0;t<this._conversations.length;t++)if(this._conversations[t].get_hasUnreadMessages()){var n=this._conversations[t],i=null;n.get_consumptionHorizon()&&(i=n.get_consumptionHorizon().lastReadMessageTimestamp),i||(i=n.get_history().get_count()>0?n.get_history().getItem(0).get_timestamp()-1:n.get_mostRecentMessage().get_timestamp()-1),(!e||e>i)&&(e=i)}return e||(e=this.getMostRecentMessage()&&this.getMostRecentMessage().get_timestamp()||new Date),e},add:function(t){for(var n=s.IEnumerator.getEnumerator(this._conversations);n.moveNext();){var i=n.get_current();if(i.get_id()===t.get_id())return}this._conversations.push(t),e(t.get_history()).bind("collectionChanged",s.Delegate.create(this,this._onConversationHistoryChanged)),e(t).bind("recentMessageReceived",s.Delegate.create(this,this._onConversationRecentMessageReceived)),e(t).bind("propertyChanged",s.Delegate.create(this,this._onConversationPropertyChanged)),e(t).bind("sendMessageFailed",s.Delegate.create(this,this._onConversationSendMessageFailed)),this._updateHasMoreHistory()},remove:function(t){for(var n=new Array(this._history.get_count()),i=s.IEnumerator.getEnumerator(this._history);i.moveNext();){var o=i.get_current();o.get_conversationId()==t.get_id()&&n.push(o)}for(var r=0;r<n.length;r++)null!=n[r]&&this._history._remove(n[r]);for(i=s.IEnumerator.getEnumerator(this._conversations);i.moveNext();){var a=i.get_current();if(a.get_id()===t.get_id()){this._conversations.remove(a),e(a.get_history()).unbind("collectionChanged"),e(a).unbind("recentMessageReceived"),e(a).unbind("propertyChanged"),e(a).unbind("sendMessageFailed");break}}},getMoreHistory:function(){if(this._firstHistoryRequest){this._firstHistoryRequest=!1;for(var e=s.IEnumerator.getEnumerator(this.get_buddyContact().get_addresses());e.moveNext();){var t=e.get_current();this._user.get_conversations().create(t)}}this._processPendingHistoryMessages()},getMostRecentMessage:function(){for(var e=null,t=new Date(0),i=s.IEnumerator.getEnumerator(this._conversations);i.moveNext();){var o=i.get_current(),r=o.get_mostRecentMessage();null!=r&&(r instanceof n.TextMessage||r instanceof n.ThreadActivityMessage)&&r.get_timestamp()>t&&(e=r,t=r.get_timestamp())}return e},markAllConversationsAsRead:function(){for(var e=s.IEnumerator.getEnumerator(this._conversations);e.moveNext();){var t=e.get_current();t.markAsRead()}},getConversationByNetworkName:function(e){for(var t=s.IEnumerator.getEnumerator(this._conversations);t.moveNext();){var n=t.get_current();if(n.get_network().get_name()===e)return n}return null},_getConversationByLastHistoryMessage:function(){for(var e=null,t=i.DateTimeHelper.minValue,n=s.IEnumerator.getEnumerator(this.get_conversations());n.moveNext();){var o=n.get_current();if(o.get_hasMoreHistoryOnServer()){var r=o.get_lastHistoryMessage();null!=r&&r.get_timestamp()>t&&(t=r.get_timestamp(),e=o)}}return e},_onConversationRecentMessageReceived:function(t,n,i){this._processPendingHistoryMessages(),e(this).triggerHandler("recentMessageReceived",[this,i])},_onConversationHistoryChanged:function(e,t,i){var s;i.get_action()===n.NotifyCollectionChangedAction.add?(s=i.get_newItems()[0],s.get_isHistoryMessage()?(this._getHistoryPending="",this._pendingHistoryMessages.addRange(i.get_newItems()),this._processPendingHistoryMessages()):(s.get_networkName()!==this.get_currentConversation().get_network().get_name()&&this.set_currentConversation(this.getConversationByNetworkName(s.get_networkName())),this._history._add(s))):i.get_action()===n.NotifyCollectionChangedAction.remove&&(s=i.get_oldItems()[0],this._history._remove(s))},_processPendingHistoryMessages:function(){if(!this._firstHistoryRequest){var e=this._getConversationByLastHistoryMessage(),t=this._pendingHistoryMessages;if(t.length>0)if(t.sort(s.Delegate.create(this,this._compareMessagesCallback)),null!=e)for(var n=e.get_lastHistoryMessage().get_timestamp(),i=t.length-1;i>=0&&t[i].get_timestamp()>=n;i--)this._stagingHistoryMessages.insert(0,t[i]),t.splice(i,1);else{if(this._history.get_count()>0&&this._history.get_item(0).get_timestamp()<this._pendingHistoryMessages[this._pendingHistoryMessages.length-1].get_timestamp()){this._history._beginReset(),this._history._items=[],this._history._endReset(),this._stagingHistoryMessages=[],t=[];for(var o=s.IEnumerator.getEnumerator(this.get_conversations());o.moveNext();){var r=o.get_current();t=t.concat(r.get_history().get__items())}t.sort(s.Delegate.create(this,this._compareMessagesCallback))}this._stagingHistoryMessages=t.concat(this._stagingHistoryMessages),this._pendingHistoryMessages=[]}var a=this._stagingHistoryMessages.length;a>=this._pageSize||!this._hasMoreHistoryOnServer&&a>0?this._addToHistory():""===this._getHistoryPending&&null!=e&&(this._getHistoryPending=e.get_id(),e.getHistory())}},_addToHistory:function(){var e=this._stagingHistoryMessages.length-this._pageSize>0?this._stagingHistoryMessages.length-this._pageSize:0,t=this._stagingHistoryMessages.splice(e,this._pageSize);t.length>1?this._history._insertRange(0,t):this._history._insert(0,t[0])},_onConversationPropertyChanged:function(t,i,s){switch(s.get_propertyNamePascal()){case"HasMoreHistory":""!==this._getHistoryPending&&this._getHistoryPending===i.get_id()&&(this._getHistoryPending=""),this._updateHasMoreHistory();break;case"ConsumptionHorizon":e(this).triggerHandler("propertyChanged",[this,new n.PropertyChangedEventArgs("ConsumptionHorizon")])}},_updateHasMoreHistory:function(){for(var t=!1,i=s.IEnumerator.getEnumerator(this._conversations);i.moveNext();){var o=i.get_current();o.get_hasMoreHistoryOnServer()&&(t=!0)}this._hasMoreHistoryOnServer!==t&&(this._hasMoreHistoryOnServer=t,this._processPendingHistoryMessages(),e(this).triggerHandler("propertyChanged",[this,new n.PropertyChangedEventArgs("HasMoreHistory")]))},_onConversationSendMessageFailed:function(t,n,i){e(this).triggerHandler("sendMessageFailed",[this,i])},_compareMessagesCallback:function(e,t){return e.get_timestamp()-t.get_timestamp()}}}(window.originaljQuery||jQuery)}),define("aggregatedconversationcollection",["aggregatedconversation"],function(){!function(e){function t(e,t){var n=e.getMostRecentMessage(),i=t.getMostRecentMessage(),s=n?n.get_timestamp():0,o=i?i.get_timestamp():0;return o-s}function n(e){var t,n=[];e.forEach(function(e){t=e.get_mostRecentMessage(),n.push([t?t.get_timestamp():0,e])}),n.sort(function(e,t){return t[0]-e[0]}),e.length=0,n.forEach(function(t){e.push(t[1])})}var i=window,s=i.Microsoft.Live.Messenger,o=s.SortedCollection,r=i.ss,a=s.AggregatedConversationCollection=function(i){o.call(this,t,n),this._user=i,e(this._user.get_conversations()).bind("collectionChanged",r.Delegate.create(this,this._onConversationsCollectionChanged)),e(this._user.get_conversations()).bind("getRecentConversationsCompleted",r.Delegate.create(this,this._onGetRecentConversationsCompleted))},c=a.prototype=new o;c.constructor=a,c._user=null,c._hasMoreConversationsOnServer=!0,c._aggregatedConversationContactMap={},c._aggregatedConversationIdMap={},c.getMoreConversationsFromServer=function(){this._user._conversationGetRecentList()},c.get_hasMoreConversationsOnServer=function(){return this._hasMoreConversationsOnServer},c.get_items=function(){return this._items},c.findItemByThreadId=function(e){var t,n,i,s=this._items,o=s.length;for(n=0;o>n;n++)if(i=s[n],i.get_currentConversation().idMatches(e)){t=i;break}return t},c.getAggregatedConversationByContact=function(e){return e.get_id()?this._aggregatedConversationContactMap[e.get_id()]:null},c._onGetRecentConversationsCompleted=function(t,n){this._hasMoreConversationsOnServer=this._user.get_conversations().get_hasMoreConversationsOnServer(),e(this).triggerHandler("getMoreConversationsCompleted",{callFailed:n.callFailed})},c._onConversationsCollectionChanged=function(t,n,i){switch(i.get_action()){case s.NotifyCollectionChangedAction.add:for(var o=r.IEnumerator.getEnumerator(i.get_newItems());o.moveNext();){var a=o.get_current(),c=a.get_buddyContact();if(null!=c&&null!=c.get_id()){var l=c.get_id();if(null==this._aggregatedConversationContactMap[l]){var u=new s.AggregatedConversation(this._user);u.add(a),this._aggregatedConversationContactMap[l]=u,this._aggregatedConversationIdMap[a.get_id()]=u,e(u).bind("recentMessageReceived",r.Delegate.create(this,this._onAggregatedConversationRecentMessageReceived)),e(u.get_history()).bind("collectionChanged",r.Delegate.create(this,this._onAggregatedConversationCollectionChanged)),this._addItem(u)}else u=this._aggregatedConversationContactMap[l],u.add(a),this._aggregatedConversationIdMap[a.get_id()]=u}}break;case s.NotifyCollectionChangedAction.remove:for(var d=r.IEnumerator.getEnumerator(i.get_oldItems());d.moveNext();)a=d.get_current(),c=a.get_buddyContact(),null!=c&&null!=c.get_id()&&(u=this._aggregatedConversationContactMap[c.get_id()],null!=u&&(u.remove(a),this.removeAggregatedConversationIfEmpty(u,a.get_id())))}},c._onAggregatedConversationRecentMessageReceived=function(e,t){this._sortConversation(t)},c._onAggregatedConversationCollectionChanged=function(e,t,n){var i;if(n.get_action()==s.NotifyCollectionChangedAction.add&&n.get_newItems())i=n.get_newItems()[0],this._sortConversation(this.getAggregatedConversationByContact(this._user.get_conversations()._getConversationById$1(i.get_conversationId()).get_buddyContact()));else if(n.get_action()==s.NotifyCollectionChangedAction.remove&&n.get_oldItems()){i=n.get_oldItems()[0];var o=this._aggregatedConversationIdMap[i.get_conversationId()];this.removeAggregatedConversationIfEmpty(o,i.get_conversationId())}},c._sortConversation=function(e){this._updateItem(e)},c.removeAggregatedConversationIfEmpty=function(e,t){null!=e&&0==e.get_history().get_count()&&(this._removeItem(e),this._aggregatedConversationIdMap[t]=null,this._aggregatedConversationContactMap[e.get_buddyContact().get_id()]=null)}}(window.originaljQuery||jQuery)}),define("imaddresscollection",["aggregatedconversationcollection"],function(){!function(){var e=window,t=e.Microsoft.Live.Messenger,n=e.ss,i=t.Collection,s=t.IMAddressCollection=function(e){i.call(this),this._owner$1=e},o=s.prototype=new i;o.constructor=s,o._owner$1=null,o.add=function(e){if(null==e)throw t._exceptionHelper.createArgumentNullException("address");if(this._contains(e))throw t._exceptionHelper.createArgumentException(t._exceptions.collectionItemDuplicate,"address");this._owner$1.addAddress(this,e)},o.remove=function(e){if(null==e)throw t._exceptionHelper.createArgumentNullException("address");if(!this._contains(e))throw t._exceptionHelper.createArgumentException(t._exceptions.collectionItemNotFound,"address");
this._owner$1.removeAddress(this,e)},o._toArray=function(){for(var e=this.get__items(),t=new Array(e.length),n=0;n<e.length;n++)t[n]=e[n];return t},o._sort=function(){this.get__items().sort(n.Delegate.create(this,this._compareByRank$1))},o._compareByRank$1=function(e,t){return e.get_network().get__rank()-t.get_network().get__rank()},o.get_item=function(e){if(0>e||e>=this.get_count())throw t._exceptionHelper.createArgumentOutOfRangeException("index");return this.get__items()[e]}}()}),define("linkedcontact",["imaddresscollection"],function(){!function(e){function t(e){var t=a.BigInt.parseDecInt(a.BigInt.hexRadix,e);return null==t?null:t.toString()}var n=window,i=n.$WLXIM,s=n.MC,o=n.Microsoft.Live.Messenger,r=o.Services,a=n.MSH,c=n.ss,l=s.RoleLists,u=s.IMAddressInfoType,d=o._iimAddressCollectionOwner,_=o.LinkedContact=function(e,t,n){d.call(this),this._roleLists=l.none,this._contactMap=e,this._contact=t,this._pwcContact=n,this._addresses=new o.IMAddressCollection(this);for(var s=a.ContactHelper.createAddressInfos(n),c=0;c<s.length;c++){var _=s[c];if((_.type!==u.skype||r.SkyJSHelper.skypeEnabled)&&(_.type!==u.shortCircuit||i.isSkypeInvitesEnabled())){if(_.type===u.connect){var g=this._contact.get__user().get_networks().get_item(_.network);if(null==g||!g.get_supportsIM())continue}address=this._contactMap._findOrCreateAddressForContact(this,_),this._roleLists|=_.roleLists,this._addresses._addInternal(address)}}this._network=this._addresses.get_count()>0?this._addresses.get_item(0).get_network():o.Network.get__windowsLive(),this._network.get_isSkype()?this._isBlocked=this._pwcContact.getIsBlocked()?!0:!1:this._network.get_isWindowsLive()&&(this._isBlocked=0!==(this._roleLists&l.hide))},g=_.prototype=new d;g.constructor=_,g._contactMap=null,g._contact=null,g._addresses=null,g._network=null,g._skypeInviteSent=!1,g._isBlocked=!1,g.get_displayPictureUrl=function(){return this._pwcContact.getUserTile()||""},g.get_emailAddress=function(){return this._pwcContact.getPrimaryEmail()},g.get_firstName=function(){return this._pwcContact.getFirstName()},g.get_lastName=function(){return this._pwcContact.getLastName()},g.get_fullName=function(){return this._pwcContact.getFullName()},g.get_id=function(){return null!=this._pwcContact.getId()?this._pwcContact.getId().toLowerCase():null},g.get_isAllowed=function(){return 0!==(this._roleLists&l.allow)},g.get_isBlocked=function(){return this._isBlocked},g.set_isBlocked=function(e){this.get_isBlockable()&&(this._isBlocked=e,this._onPropertyChanged("Block"))},g.get_isBlockable=function(){return 0==this._addresses.get_count()?!1:this._addresses.get_item(0).get_type()===o.IMAddressType.shortCircuit?!1:this._network.get_isWindowsLive()?!0:this._network.get_isSkype()&&r.SkyJSHelper.initCompleted&&r.SkyJSHelper.getInstance().Outlook.isUserLinkStatusActive()?!0:!1},g.get_network=function(){return this._network},g.get_profileUrl=function(){var e=this._getUrlId(!1),t=this._network.get_pwcService().getProfileUrl();return c.isNullOrEmpty(e)||c.isNullOrEmpty(t)?null:a.UriHelper.updateUrlProtocol(c.format(t,encodeURIComponent(e)))},g.get_sendMessageUrl=function(){var e=this._getUrlId(!0),t=this._network.get_pwcService().getSendMessageUrl();return c.isNullOrEmpty(e)||c.isNullOrEmpty(t)?null:a.UriHelper.updateUrlProtocol(c.format(t,encodeURIComponent(e)))},g.get_skypePendingOutbound=function(){return this._pwcContact.getSkypePendingOutbound()?!0:!1},g.get_skypeInviteSent=function(){return this._skypeInviteSent},g.set_skypeInviteSent=function(e){return this._skypeInviteSent=e,e},g.get_pwcContact=function(){return this._pwcContact},g.get__info=function(){var e=new s.ContactInfo(this._pwcContact.getId(),this._pwcContact.getFullName(),new Array(0));e.cid=this._pwcContact.getPerson().getCid()||"",e.firstName=this._pwcContact.getFirstName(),e.lastName=this._pwcContact.getLastName(),e.fullName=this._pwcContact.getFullName(),e.pictureUrl=this._pwcContact.getUserTile(),e.favoritesOrder=this._pwcContact.getFavoriteOrder()||"",e.isBlocked=this._pwcContact.getIsBlocked()?!0:!1,e.skypePendingOutbound=this._pwcContact.getSkypePendingOutbound()?!0:!1;for(var t=a.ContactHelper.createAddressInfos(this._pwcContact),n=0;n<t.length;n++)t[n].messagingAddress=null;return e.addresses=t,e},g.get__isContact=function(){return 0!==(this._roleLists&l.forward)},g.get__contact=function(){return this._contact},g.get__addresses=function(){return this._addresses},g._update=function(e){if(!this._network.get__isRemoteNetwork()){var t=this._isBlocked,n=this._pwcContact.getSkypePendingOutbound();this._pwcContact=e;for(var i=c.IEnumerator.getEnumerator(e.getMessagingAddresses());i.moveNext();){var s=i.get_current();if(s)for(var o=0;o<this._addresses.get_count();o++){var r=this._addresses.get_item(o);if(null!=r._messagingAddress&&r._messagingAddress._getMri()==s._getMri()){r._messagingAddress=s,r._updateMessagingAddress();break}}}var a=l.allow|l.forward,u=e.getPerson();(u.getOnHideList()||3===u.getTrustLevel())&&(a|=l.hide),this._roleLists=a,this._network.get_isSkype()?this._isBlocked=this._pwcContact.getIsBlocked()?!0:!1:this._network.get_isWindowsLive()&&(this._isBlocked=0!==(this._roleLists&l.hide)),this._isBlocked!==t&&this._onPropertyChanged("Block"),this._pwcContact.getSkypePendingOutbound()!==n&&this._onPropertyChanged("SkypePendingOutbound")}},g._setRoleListChanges=function(e,t){var n=this._roleLists,i=(n^e)&e;if(n|=e,i|=n&t,n&=~t,i!==l.none){this._roleLists=n;for(var s=0;s<this._addresses.get_count();s++)this._addresses.get_item(s).get__info().roleLists=n;for(this._contact._setRoleListChanges(e,t),s=0;s<this._addresses.get_count();s++)this._addresses.get_item(s)._setRoleListChanges(n,i);return!0}return!1},g._getUrlId=function(e){var n;return this._network.get__isRemoteNetwork()?n=this._pwcContact.getObjectId():e?n=this.get_emailAddress():(n=t(this._pwcContact.getPerson().getCid()),c.isNullOrEmpty(n)||(n=c.padLeft(n,16,"0"))),n},g._onPropertyChanged=function(t){e(this).triggerHandler("propertyChanged",[this,new o.PropertyChangedEventArgs(t)])},g.addAddress=function(e,t){var n=t.get_contact();null!=n&&n.get_addresses().remove(t),t._setRoleListChanges(this._roleLists,this._roleLists^t.get__info().roleLists),t._setLinkedContact(this),e._addInternal(t)},g.removeAddress=function(e,t){1===this._addresses.get_count()&&this._contact.get__user()._updateContactRoles(this,l.none,this._roleLists),e._removeInternal(t)}}(window.originaljQuery||jQuery)}),define("linkedcontactcollection",["linkedcontact"],function(){!function(){var e=window,t=e.Microsoft.Live.Messenger,n=t.Collection,i=t.LinkedContactCollection=function(){n.call(this)},s=i.prototype=new n;s.constructor=i,s.get_item=function(e){return this.getItem(e)}}()}),define("networkcollection",["linkedcontactcollection"],function(){!function(e){var t=["SKYPE","WL"],n=window,i=n.MC,s=n.Microsoft.Live.Messenger,o=n.ss,r=s.NotifyCollectionChangedAction,a=s.Collection,c=s.NetworkCollection=function(t){a.call(this),this._user$1=t,this._networks$1={},e(this).bind("collectionChanged",o.Delegate.create(this,this._onCollectionChanged$1)),s.Services.SkyJSHelper.skypeEnabled&&this._addSkype(),this._addInternal(s.Network.get__windowsLive())},l=c.prototype=new a;l.constructor=c,l._networks$1=null,l._hasOfficeCommunicator$1=!1,l._hasSkype$1=!1,l._hasTelephone=!1,l._user$1=null,l._updateNetworks=function(e,t,n){var i;if(this._beginReset(),null!=e)for(var s=o.IEnumerator.getEnumerator(e);s.moveNext();)i=s.get_current(),this._updateNetwork$1(i);if(null!=t)for(var r=o.IEnumerator.getEnumerator(t);r.moveNext();)i=r.get_current(),this._updateNetwork$1(i);if(null!=n)for(var a=o.IEnumerator.getEnumerator(n);a.moveNext();){var c=a.get_current(),l=this.get_item(c.getId());null!=l&&l.get__isRemoteNetwork()&&this._removeInternal(l)}this._sort$1(),this._endReset()},l._addSkype=function(){this._hasSkype$1||(this._addInternal(s.Network.get__skype()),this._hasSkype$1=!0,this._sort$1())},l._addOfficeCommunicator=function(){this._hasOfficeCommunicator$1||(this._addInternal(s.Network.get__officeCommunicator()),this._hasOfficeCommunicator$1=!0,this._sort$1())},l._addTelephone=function(){this._hasTelephone||(this._addInternal(s.Network.get_telephone()),this._hasTelephone=!0,this._sort$1())},l._markNetworksOffline=function(){for(var e=o.IEnumerator.getEnumerator(this);e.moveNext();){var t=e.get_current();t.get__isRemoteNetwork()&&t._setStatus(i.NetworkInfoStatus.signedOut)}},l._updateNetwork$1=function(e){if(!t.contains(e.getId().toUpperCase())&&e.getSupportsIm()){var n=this.get_item(e.getId());null==n?(n=new s.Network(e,i.NetworkConnectionType.connect),n.set__user(this._user$1),this._addInternal(n)):n._setNetworkChanges(e)}},l._onCollectionChanged$1=function(e,t,n){var i,s;switch(n.get_action()){case r.add:for(i=0;i<n.get_newItems().length;i++)s=n.get_newItems()[i],s.set__user(this._user$1),this._networks$1[s.get_id()]=s;break;case r.remove:for(i=0;i<n.get_oldItems().length;i++)s=n.get_oldItems()[i],delete this._networks$1[s.get_id()];break;case r.reset:for(o.clearKeys(this._networks$1),i=0;i<this.get__items().length;i++)s=this.get__items()[i],s.set__user(this._user$1),this._networks$1[s.get_id()]=s}},l._sort$1=function(){this.get__items().sort(o.Delegate.create(this,this._compareNetworkByRank$1))},l._compareNetworkByRank$1=function(e,t){return e.get__rank()-t.get__rank()},l.get_item=function(e){if(null==e)throw s._exceptionHelper.createArgumentNullException("key");if(Object.isString(e)){var t=e;if(o.isNullOrEmpty(t))throw s._exceptionHelper.createArgumentNullOrEmptyException("id",t);return this._networks$1[t.toUpperCase()]}if(Object.isNumber(e))return this.getItem(e);throw s._exceptionHelper.createArgumentOutOfRangeException("key")}}(window.originaljQuery||jQuery)}),define("signedineventargs",["networkcollection"],function(){!function(){var e=window,t=e.Microsoft.Live.Messenger;t.SignedInEventArgs=function(e){this._serverName$1=e},t.SignedInEventArgs.prototype={_serverName$1:null,get_serverName:function(){return this._serverName$1}}}()}),define("signinstate",["signedineventargs"],function(){!function(){var e=window,t=e.Microsoft.Live.Messenger;t._signInState=function(e,t){this.userState=e,this.raiseSignInCompleted=t},t._signInState.prototype={userState:null,raiseSignInCompleted:!1}}()}),define("signoutstate",["signinstate"],function(){!function(){var e=window,t=e.Microsoft.Live.Messenger;t._signOutState=function(e,t,n){this.signedOutEndpoint=e,this.locations=t,this.userState=n},t._signOutState.prototype={signedOutEndpoint:null,locations:0,userState:null}}()}),define("typingimaddress",["signoutstate"],function(){!function(){var e=window,t=e.Microsoft.Live.Messenger;t._typingIMAddress=function(e){this._address=e,this._addTime=new Date},t._typingIMAddress.prototype={_address:null,_addTime:null,get_address:function(){return this._address},get_addTime:function(){return this._addTime},set_addTime:function(e){return this._addTime=e,e}}}()}),define("typingimaddresscollection",["typingimaddress"],function(){!function(){var e=window,t=e.Microsoft.Live.Messenger,n=e.MSH,i=e.ss,s=t.Collection,o=t.TypingIMAddressCollection=function(e){s.call(this),this._timeout$1=e,this._timeoutItems$1=[]},r=o.prototype=new s;r.constructor=o,r._timeout$1=0,r._timeoutItems$1=null,r._timer$1=null,r._add=function(e){this._contains(e)||this._addInternal(e),this._updateTimeoutItem$1(e),null==this._timer$1&&this._startTimer$1(this._timeout$1)},r._remove=function(e){this._removeInternal(e)},r._timerExpired$1=function(){for(var e=!1;this._timeoutItems$1.length>0;){var t=this._getOldestExpirationItem$1(),i=this._timeout$1-n.DateTimeHelper.subtract(new Date,t.get_addTime());if(!(100>=i)){this._startTimer$1(i),e=!0;break}this._expireItem$1(t)}e||(this._timer$1=null)},r._updateTimeoutItem$1=function(e){for(var n=!1,s=i.IEnumerator.getEnumerator(this._timeoutItems$1);s.moveNext();){var o=s.get_current();if(o.get_address().equals(e)){o.set_addTime(new Date),n=!0;break}}n||this._timeoutItems$1.push(new t._typingIMAddress(e))},r._expireItem$1=function(e){this._removeInternal(e.get_address()),this._timeoutItems$1.remove(e)},r._getOldestExpirationItem$1=function(){for(var e=this._timeoutItems$1[0],t=i.IEnumerator.getEnumerator(this._timeoutItems$1);t.moveNext();){var n=t.get_current();n.get_addTime()<e.get_addTime()&&(e=n)}return e},r._startTimer$1=function(e){this._timer$1=new n.Timer(i.Delegate.create(this,this._timerExpired$1),null,e,n.Timeout.infinite)},r.get_item=function(e){return this.getItem(e)}}()}),define("rolelistowner",["typingimaddresscollection"],function(){!function(){var e=window,t=e.MC,n=e.Microsoft.Live.Messenger,i=e.MSCo,s=t.RoleLists,o=n.SessionServices,r=n._iContactCollectionOwner,a=n._roleListOwner=function(e,t){r.call(this),this._user=e,this._addedLists=t,t===s.allow&&(this._removedLists=s.block),t===s.block&&(this._removedLists=s.allow)},c=a.prototype=new r;c.constructor=a,c._user=null,c._addedLists=0,c._removedLists=0,c._collection=null,c.canAddContact=function(e){var t=this._user.get_services();switch(this._addedLists){case s.allow:case s.block:case s.hide:if(e.get__isCidContact())return!1;if(t===o.contactPresence||t===o.notifications)return!1;break;case s.forward:if(t===o.notifications)return!1}return!0},c.canRemoveContact=function(){var e=this._user.get_services();switch(this._removedLists){case s.allow:case s.block:case s.hide:if(e===o.contactPresence||e===o.notifications)return!1;break;case s.forward:if(e===o.notifications)return!1}return!0},c.addContact=function(e,t){if(!t.get_isEmailOnlyContact()&&!t.get__isRemoteOnlyContact()&&!t.get__isCidContact())for(var n=0;n<t.get_linkedContacts().get_count();n++){var i=t.get_linkedContacts().get_item(n);i.get_network().get__isRemoteNetwork()||this._user._updateContactRoles(i,this._addedLists,this._removedLists)}},c.removeContact=function(e,t){if(t.get__isCidContact())throw n._exceptionHelper.createInvalidOperationException(n._exceptions.contactMustMemberUserContact);for(var i=0;i<t.get_linkedContacts().get_count();i++){var s=t.get_linkedContacts().get_item(i);s.get_network().get__isRemoteNetwork()||this._user._updateContactRoles(s,this._removedLists,this._addedLists)}},c.containsContact=function(e){switch(this._addedLists){case s.forward:return e.get_isContact();case s.allow:return e.get_isAllowed();case s.hide:return e.get_isAppearOfflineTo();default:return this._collection._contains(e)}},c.setCollection=function(e){this._collection=e},c.get_capacity=function(){switch(this._addedLists){case s.allow:return i.Configuration.maximumAllowedContactCount;case s.block:return i.Configuration.maximumBlockedContactCount;case s.forward:return i.Configuration.maximumContactCount;case s.hide:return i.Configuration.maximumContactCount;default:return 0}}}()}),define("emailreceivedeventargs",["rolelistowner"],function(){!function(){var e=window,t=e.Microsoft.Live.Messenger;t.EmailReceivedEventArgs=function(e,t,n,i,s){this._subject$1=e,this._sender$1=t,this._senderAddress$1=n,this._messageUrl$1=i,this._folder$1=s},t.EmailReceivedEventArgs.prototype={_subject$1:null,_sender$1:null,_senderAddress$1:null,_messageUrl$1:null,_folder$1:0,get_subject:function(){return this._subject$1},get_sender:function(){return this._sender$1},get_senderAddress:function(){return this._senderAddress$1},get_messageUrl:function(){return this._messageUrl$1},get_folder:function(){return this._folder$1}}}()}),define("mailbox",["emailreceivedeventargs"],function(){!function(e){var t=window,n=t.MC,i=t.Microsoft.Live.Messenger,s=t.MSCo,o=t.ss,r=n.MailNotificationInfoType,a=n.MailNotificationFolderType;i.Mailbox=function(e){if(null==e)throw i._exceptionHelper.createArgumentNullException("user");this._user=e},i.Mailbox.prototype={_user:null,_inboxInitialCount:0,_inboxUnreadCount:0,_otherInitialCount:0,_otherUnreadCount:0,get_inboxInitialCount:function(){return this._inboxInitialCount},set_inboxInitialCount:function(e){return e!==this._inboxInitialCount&&(this._inboxInitialCount=e,this._onPropertyChangedEvent("InboxInitialCount")),e},get_inboxUnreadCount:function(){return this._inboxUnreadCount},set_inboxUnreadCount:function(e){return e!==this._inboxUnreadCount&&(this._inboxUnreadCount=e,this._onPropertyChangedEvent("InboxUnreadCount")),e},get_otherInitialCount:function(){return this._otherInitialCount},set_otherInitialCount:function(e){return e!==this._otherInitialCount&&(this._otherInitialCount=e,this._onPropertyChangedEvent("OtherInitialCount")),e},get_otherUnreadCount:function(){return this._otherUnreadCount},set_otherUnreadCount:function(e){return 0>e&&(e=0),e!==this._otherUnreadCount&&(this._otherUnreadCount=e,this._onPropertyChangedEvent("OtherUnreadCount")),e},get__user:function(){return this._user},_onMailNotification:function(e){switch(e.type){case r.initial:var t=e.notification;this.set_inboxInitialCount(t.inboxTotal),this.set_inboxUnreadCount(t.inboxUnread),this.set_otherInitialCount(t.foldersTotal),this.set_otherUnreadCount(t.foldersUnread);break;case r.incoming:var n=e.notification;n.folder!==a.hidden&&this.onEmailReceived(new i.EmailReceivedEventArgs(n.subject,n.from,n.fromAddress,o.format(s.Configuration.get_messageUrlFormat(),n.messageUrl),n.folder));break;case r.activity:var c=e.notification;c.source===a.inbox?(this.set_inboxUnreadCount(this.get_inboxUnreadCount()-c.delta),c.destination!==a.inbox&&c.destination!==a.hidden&&this.set_otherUnreadCount(this.get_otherUnreadCount()+c.delta)):c.source!==a.hidden?(this.set_otherUnreadCount(this.get_otherUnreadCount()-c.delta),c.destination===a.inbox&&this.set_inboxUnreadCount(this.get_inboxUnreadCount()+c.delta)):c.destination===a.inbox?this.set_inboxUnreadCount(this.get_inboxUnreadCount()+c.delta):c.destination!==a.hidden&&this.set_otherUnreadCount(this.get_otherUnreadCount()+c.delta)}},onEmailReceived:function(t){e(this).triggerHandler("emailReceived",[this,t])},onPropertyChanged:function(t){e(this).triggerHandler("propertyChanged",[this,t])},_onPropertyChangedEvent:function(e){this.onPropertyChanged(new i.PropertyChangedEventArgs(e))}}}(window.originaljQuery||jQuery)}),define("userautoreconnect",["mailbox"],function(){!function(){var e=120,t=30,n=window,i=n.MC,s=n.Microsoft.Live.Messenger,o=n.MSH,r=n.ss;s._userAutoReconnect=function(e){this._waitTime=-1,this._user=e},s._userAutoReconnect.prototype={_waitTime:0,_autoReconnectWaitTimer:null,_targetReconnectTime:null,_reconnectStatus:i.PresenceInfoStatus.none,get_reconnectStatus:function(){return this._reconnectStatus},dispose:function(){this._clearAutoReconnectTimers()},onSignIn:function(){this._clearAutoReconnectTimers()},onSignedIn:function(){this._clearAutoReconnectTimers(),this._waitTime=-1},onSignOut:function(){this._clearAutoReconnectTimers(),this._waitTime=-1,this._user.set__state(s._userState.signedOut),this._user.onSignedOut(new s.SignedOutEventArgs(s.SignedOutReason.signedOutByLocalEndpoint))},trigger:function(e){this._user.get__state()===s._userState.signedIn&&(this._reconnectStatus=this._user.get_address().get__serviceDataSet().imServiceData.get_status()),this._startAutoReconnectWaitTimer(e),this._user.set__state(s._userState.autoReconnectWaiting)},_clearAutoReconnectTimers:function(){this._updateAutoReconnectWaitTime(-1),null!=this._autoReconnectWaitTimer&&(this._autoReconnectWaitTimer.dispose(),this._autoReconnectWaitTimer=null)},_updateAutoReconnectWaitTime:function(e){this._user._setAutoReconnectWaitTime(e)},_startAutoReconnectWaitTimer:function(n){if(null==this._autoReconnectWaitTimer&&(this._autoReconnectWaitTimer=new o.Timer(r.Delegate.create(this,this._onAutoReconnectWaitTimerElapsed),null,o.Timeout.infinite,o.Timeout.infinite)),n>=0)this._waitTime=n;else if(-1===this._waitTime){var i=2,a=60;this._waitTime=Math.floor(i+Math.random()*(a-i))}else this._waitTime=Math.min(this._waitTime+t,e);this._targetReconnectTime=o.DateTimeHelper.addMilliseconds(new Date,1e3*this._waitTime),this._updateAutoReconnectWaitTime(this._waitTime),this._user.set__state(s._userState.autoReconnectWaiting),this._autoReconnectWaitTimer.change(1e3,1e3)},_onAutoReconnectWaitTimerElapsed:function(){var e=Math.round(o.DateTimeHelper.subtract(this._targetReconnectTime,new Date)/1e3);e>0?this._updateAutoReconnectWaitTime(e):(this._autoReconnectWaitTimer.change(o.Timeout.infinite,o.Timeout.infinite),this._updateAutoReconnectWaitTime(-1),this._user._signInInternal(null,!1))}}}()}),define("user",["userautoreconnect"],function(){!function(e){var t=window,n=t.$Config,i=t.$WLXIM,s=t.MC,o=t.Microsoft.Live.Messenger,r=o.Services,a=(t.MSCo,t.MSH),c=t.ss,l=s.CapabilitiesFlags,u=s.IMAddressInfoType,d=s.MessengerServiceResultCode,_=s.PresenceInfoStatus,g=s.RoleLists,h=s.SessionServiceOptions,p=s.SignOutLocationFlags,f=(s.UpdateIMAvailabilityOperationCode,o.PresenceStatus),m=o.SessionServices,v=o.SignOutLocations,C=o._userState;o.User=function(t,n){if(this._lastDisplayNameValue="",this._autoReconnectWaitTime=-1,this._pendingServiceDataChanges=[],this._inboundInvites={},this._pendingStartGroupChatThreadId=null,null==t)throw o._exceptionHelper.createArgumentNullException("identity");if(!t.get_isAuthenticated())throw o._exceptionHelper.createInvalidOperationException(o._exceptions.identityNotAuthenticated);if(c.isNullOrUndefined(n))throw o._exceptionHelper.createArgumentException(o._exceptions.argumentNull,"contactsReader");this._identity=t,this._identity.set__user(this),this._service=this._identity.get__userService(),this._events=this._identity.get__userEvents(),this._events.set__user(this),this._settings=new s.Settings,this._sessionServices=this._identity.get__initialServices(),this._contactMap=new o._contactDictionary(this),this._contacts=new o.ContactCollection(this,new o._roleListOwner(this,g.forward)),this._conversations=new o.ConversationCollection(this),this._aggregatedConversations=new o.AggregatedConversationCollection(this),this._addContactEvents=[],this._networks=new o.NetworkCollection(this);var i=this._initializeServiceData(),a=new s.IMAddressInfo(t.get_liveId().toLowerCase(),u.windowsLive,g.none);a.cid=t.get_cid();var l=new s.IMAddressInfo(t.get_cid(),u.shortCircuit,g.none),d=[a,l];r.SkyJSHelper.skypeEnabled&&(d=[a,l,new s.IMAddressInfo(null,u.skype,g.none)]),this._contact=this._contactMap._createUserContact(d),this._shortCircuitAddress=this._contact.get_shortCircuitAddress(),this._address=this._contact.get_windowsLiveAddress(),this._address._onServiceDataChanged(i.toArray()),e(this._address.get_presence()).bind("propertyChanged",c.Delegate.create(this,this._onUserPresencePropertyChanged)),e(this._contact).bind("propertyChanged",c.Delegate.create(this,this._onUserContactPropertyChanged)),this._localEndpoint=this._address.get_endpoints().get_item(0),this._createMailbox(),this._userAutoReconnect=new o._userAutoReconnect(this),this._contactsReader=n,this._contactsReader.initialize(c.Delegate.create(this,this._onContactsReaderInitialized)),s.WebmainHelper.qoSResetTime(s.WebmainHelper.qoSScenarioSignin),e(this._contactsReader).bind("networksChanged",c.Delegate.create(this,this._onNetworksChanged)),e(this.get_networks()).bind("collectionChanged",c.Delegate.create(this,this._networkCollectionChanged))},o.User.prototype={_settings:null,_events:null,_identity:null,_address:null,_shortCircuitAddress:null,_contact:null,_localEndpoint:null,_contacts:null,_contactMap:null,_conversations:null,_aggregatedConversations:null,_networks:null,_service:null,_skypeAddress:null,_mailbox:null,_state:C.initialized,_addContactEvents:null,_signInStartTime:null,_sessionServices:h.normal,_userAutoReconnect:null,_hasSignedIn:!1,_invitationsRequireNotification:!1,_pendingIMAvailabilityState:null,_contactsReader:null,_peopleDataPopulated:!1,_peopleDataReadyCallback:null,_pendingInviteCount:0,_getInvitationsQoSScenario:null,_onNetworksChanged:function(e,t,n){this._networks._updateNetworks(n.added,n.changed,n.removed)},_networkCollectionChanged:function(e,t,n){if(n.get_action()===o.NotifyCollectionChangedAction.remove){var i=n.get_oldItems();if(null==i)return;for(var r=c.IEnumerator.getEnumerator(i);r.moveNext();){var a=r.get_current();a.get_isFacebook()&&a.get_imEnabled()&&this._updateNetwork(a.get_id(),s.NetworkOperationType.disableIM,!1);break}}},_initializeServiceData:function(){var e=l.appVersion2009,t=l.supportsOfflineIM,n=l.supportsMissedConversations,i=l.none,a=l.none;e|=l.onlineViaWebIM,r.SkyJSHelper.skypeEnabled&&(n|=l.supportsShortCircuit);var c=s.ServiceEndpointData.createEmpty(s.ServiceType.PD,this._identity.get__endpointId());c.set_name(o._globalConfiguration.get__domainName()),c.set_clientType(s.ClientType.website);var u=s.ServiceEndpointData.createEmpty(s.ServiceType.IM,this._identity.get__endpointId());u.set_capabilities([e,t,n]);var d=s.ServiceEndpointData.createEmpty(s.ServiceType.PE,this._identity.get__endpointId());d.set_capabilities([i,a]);var g=s.ServiceEndpointData.createEmpty(s.ServiceType.SKP,this._identity.get__endpointId());d.set_clientType(s.ClientType.website);var h=s.ServiceDataSet.create();return h.imServiceData.set_status(_.offline),h.imServiceData.addEndpoint(u),h.pdServiceData.addEndpoint(c),h.peServiceData.addEndpoint(d),h.skpServiceData.addEndpoint(g),h},get_contactMap:function(){return this._contactMap},get__userServiceEvents:function(){return this._events},get__contactsReader:function(){return this._contactsReader},get_settings:function(){return this._settings},get_autoReconnectWaitTime:function(){return this._autoReconnectWaitTime},get_identity:function(){return this._identity},get_displayName:function(){this.get_contact();return c.isNullOrEmpty(this.get_presence().get_displayName())?this.get_identity().get_liveId():this.get_presence().get_displayName()},get_address:function(){return this._address},get_skypeAddress:function(){return this._skypeAddress},get_shortCircuitAddress:function(){return this._shortCircuitAddress},get_contact:function(){return this._contact},get_presence:function(){return this._address.get_presence()},get_endpoints:function(){return this._address.get_endpoints()},get_localEndpoint:function(){return this._localEndpoint},get_conversations:function(){return this._conversations},get_aggregatedConversations:function(){return this._aggregatedConversations},get_contacts:function(){return this._contacts},get_services:function(){switch(this._sessionServices){case h.contactPresence:return m.contactPresence;case h.normal:return m.normal;case h.full:return m.full;case h.notifications:return m.notifications;default:return m.normal}},set_services:function(e){if(this._ensureStatusChangeAllowed(),e!==this.get_services()){switch(e){case m.contactPresence:this._onServicesChanged(h.contactPresence);break;case m.full:this._onServicesChanged(h.full);break;case m.normal:this._onServicesChanged(h.normal);break;case m.notifications:this._onServicesChanged(h.notifications);break;default:throw o._exceptionHelper.createArgumentOutOfRangeException("Services")}this._state===C.signedIn&&this._updateServices(this._sessionServices)}return e},get_status:function(){switch(this.get__state()){case C.signedIn:return o.UserStatus.signedIn;case C.disposed:case C.initialized:case C.signedOut:return o.UserStatus.signedOut;case C.signingIn:return o.UserStatus.signingIn;case C.signingOut:return o.UserStatus.signingOut;case C.autoReconnectWaiting:return o.UserStatus.autoReconnectWaiting;default:return o.UserStatus.signedOut}},get_mailbox:function(){return this._mailbox},get_networks:function(){return this._networks},get__disposed:function(){return this.get__state()===C.disposed},get__state:function(){return this._state},set__state:function(e){if(e!==this._state){s.Logger.logDetails("UserState",{userState:s.enumToString(C,e)});var t=this.get_status();if(this._state=e,t!==this.get_status()&&this.onPropertyChanged("Status"),this._state===C.signedIn)this._events.processPendingConversations();else if(this._state===C.signedOut){var n=s.ServiceData.createEmpty(s.ServiceType.IM);n.set_status(_.offline),this._address._onServiceDataChanged([n.get_info()])}}return e},add_signedOut:function(t){e(this).bind("signedOut",c.Delegate.create(this,t))},remove_signedOut:function(t){e(this).unbind("signedOut",c.Delegate.create(this,t))},remove_conversation:function(e,t,n){var o=this,r=i.getTestFlags();return(r&s.TestFlags.DeleteConversationPartialFailure)==s.TestFlags.DeleteConversationPartialFailure?(i.setTestFlags(r&~s.TestFlags.DeleteConversationPartialFailure),void n.invoke(!1)):(r&s.TestFlags.DeleteConversationFailure)==s.TestFlags.DeleteConversationFailure?void n.invoke(!1):void o._service.conversationDelete(e.get_id(),t,function(t){t==s.ConnectionServiceResultCode.success?o.get_conversations().removeConversation(e):s.Logger.logResult("RemoveConversationFailed",t),n.invoke(t==s.ConnectionServiceResultCode.success)})},findContactById:function(e){if(c.isNullOrEmpty(e))throw o._exceptionHelper.createArgumentNullOrEmptyException("id",e);return this._contactMap._findContactById(e)},findContactBySkypeId:function(e,t){if(c.isNullOrEmpty(e))throw o._exceptionHelper.createArgumentNullOrEmptyException("skypeId",e);return this._contactMap._findContactBySkypeId(e,t)},findContactByThreadId:function(e){if(c.isNullOrEmpty(e))throw o._exceptionHelper.createArgumentNullOrEmptyException("threadId",e);var t=c.format("{0}:{1}",s.IMAddressInfoType.temporaryGroup,e),n=this.get_contactMap()._addressMap[t];return n?n.get_contact():void 0},addToStartGroupChatPendingList:function(e){if(c.isNullOrEmpty(e))throw o._exceptionHelper.createArgumentNullOrEmptyException("threadId",e);this._pendingStartGroupChatThreadId=c.format("{0}:{1}",s.IMAddressInfoType.temporaryGroup,e)},reportAbuse:function(e,t){var n;if(null!=e){if(!e.get_supportsReportAbuse())throw o._exceptionHelper.createInvalidOperationException(c.format("Report Abuse not supported for {0} imaddress type",s.enumToString(o.IMAddressType,e.get_type())));n=e.get__info()}else{if(c.isNullOrEmpty(t))throw o._exceptionHelper.createArgumentNullException("Either imaddress or skypeid needs to be non-null");n=new s.IMAddressInfo(t,s.IMAddressInfoType.skype,s.RoleLists.none)}this._service.reportAbuse(n,c.Delegate.create(this,this._onReportAbuseCompleted))},signIn:function(e){s.WebmainHelper.qoSResetTime(s.WebmainHelper.qoSScenarioSignin),this._signInInternal(e,!0)},_signInInternal:function(e,t){this._ensureNotDisposed();var n=this,i=function(){if(n._signInStartTime=new Date,n.get__state()!==C.autoReconnectWaiting&&n.get__state()!==C.initialized)throw o._exceptionHelper.createInvalidOperationException(o._exceptions.userAlreadySignedIn);var i=new o._signInState(e,t);if(n.get__state()===C.autoReconnectWaiting&&(n._userAutoReconnect.onSignIn(),n._hasSignedIn))return void n._reconnect(i);if(n._address.get_presence().get_status()===f.offline&&n._sessionServices!==h.notifications&&n._sessionServices!==h.contactPresence){var a=s.ServiceData.createEmpty(s.ServiceType.IM);if(a.get_status()===_.none||a.get_status()===_.offline){var c=n.get_settings().get_userPresencePreference();a.set_status(null!=c&&c==f.appearOffline?_.appearOffline:_.online)}n._address._onServiceDataChanged([a.get_info()])}n.set__state(C.signingIn),s.Logger.logAction("UserSignIn");var l=r.SkyJSHelper.skypeEnabled;n._service.signIn(n._identity._getIdentityInfo(),n._address.get__serviceDataSet().toArray(),n._sessionServices,null,i,l)};this._peopleDataPopulated?i.invoke(null,{}):this._peopleDataReadyCallback=i},triggerFakeAutoReconnect:function(){},signOut:function(e,t){if(0===arguments.length&&(e=v.sameDomain),this.get__state()===C.autoReconnectWaiting&&(e===v.all||e===v.local))return void this._userAutoReconnect.onSignOut();this._ensureSignedIn();var n,i=null;switch(e){case v.all:n=p.allEndpoints;break;case v.remote:n=p.remoteEndpoints;break;case v.local:n=p.localEndpoint;break;case v.sameDomain:i=[];for(var s=c.IEnumerator.getEnumerator(this.get_endpoints().get__allEndpoints());s.moveNext();){var r=s.get_current();r!==this._localEndpoint&&r.get_isInstance()&&r.get__isIMEndpoint()&&i.push(r.get_id().toString())}0===i.length?(i=null,n=p.localEndpoint):n=p.specificEndpoints|p.localEndpoint;
break;default:throw o._exceptionHelper.createArgumentOutOfRangeException("locations")}(n&p.localEndpoint)===p.localEndpoint&&this.set__state(C.signingOut),this._service.signOut(n,i,!0,new o._signOutState(null,e,t))},signOutEndpoint:function(e,t){if(null==e)throw o._exceptionHelper.createArgumentNullException("endpoint");if(!this._address.get_endpoints()._contains(e))throw o._exceptionHelper.createArgumentException(o._exceptions.objectNotBelongToUser,"endpoint");if(this.get__state()===C.autoReconnectWaiting&&this._localEndpoint===e)return void this._userAutoReconnect.onSignOut();this._ensureSignedIn();var n,i,s;this._localEndpoint===e?(s=null,n=p.localEndpoint,i=v.local,this.set__state(C.signingOut)):(s=[e.get_id().toString()],n=p.specificEndpoints,i=v.remote),this._service.signOut(n,s,!0,new o._signOutState(e,i,t))},createSkypeInitializationInfo:function(e){if(this._identity.get__authenticationInfo().authType!==s.AuthenticationType.rpsAuth)throw o._exceptionHelper.createInvalidOperationException("User must be using RPS auth.");if(this.get__state()!==C.signedIn)throw o._exceptionHelper.createInvalidOperationException("User must be signed in.");for(var t=new Array(this.get_networks().get_count()),n=0;n<this._networks.get_count();++n)t[n]=this._networks.get_item(n).get__info();return s.JSON.serialize(new s.SkypeInitializationInfo(this._identity.get_liveId(),this._identity.get_cid(),e._toPersonInfo(),t))},findOrCreateShortCircuitContact:function(e,t){var n=new s.IMAddressInfo(e,u.shortCircuit,g.none),i=this._findOrCreateAddress(n).get_contact();return i._setDisplayNameChanges(t),i},_onReportAbuseCompleted:function(){},_reconnect:function(e){this._identity.set_reconnectScenarioQoSObject(s.WebmainHelper.startQoS(s.WebmainHelper.qoSScenarioReconnect)),s.WebmainHelper.qoSResetTime(s.WebmainHelper.qoSScenarioReconnect),this.set__state(C.signingIn);var t=this._address.get__serviceDataSet();this._sessionServices!==h.full&&this._sessionServices!==h.normal||this._userAutoReconnect.get_reconnectStatus()===t.imServiceData.get_status()||(t=t.clone(),t.imServiceData.set_status(this._userAutoReconnect.get_reconnectStatus())),this._service.reconnect(t.toArray(),this._sessionServices,this._getEnabledConnectNetworks(),e)},_onUserPresencePropertyChanged:function(e,t,n){"DisplayName"===n.get_propertyNamePascal()&&this.onPropertyChanged(n.get_propertyNamePascal())},_onUserContactPropertyChanged:function(e,t,n){"DisplayName"===n.get_propertyNamePascal()&&this.onPropertyChanged(n.get_propertyNamePascal())},_onContactsChanged:function(e,t,n){var i;if(null!=n.changed&&n.changed.length>0)for(var s=c.IEnumerator.getEnumerator(n.changed);s.moveNext();)i=s.get_current(),i.isMe()?this._updateUserMessagingAddress(i):this._contactMap._createOrUpdateContact(i);if(null!=n.added&&n.added.length>0)for(var o=c.IEnumerator.getEnumerator(n.added);o.moveNext();)i=o.get_current(),this._contactMap._createOrUpdateContact(i)},_onServicesChanged:function(e){this._sessionServices!==e&&((e===h.notifications||e===h.contactPresence)&&(this._conversations._clear(),this.get_presence().get_status()!==f.offline&&this._markUserAsOffline()),this._sessionServices=e,this.onPropertyChanged("Services"))},_onServiceDataChanged:function(e,t){var n=this._findAddress(e);null!=n?n._onServiceDataChanged(t):this.get__state()===C.signingIn&&this._pendingServiceDataChanges.push([e,t])},_onServiceDataDeleted:function(e,t){var n=this._findAddress(e);null!=n&&n._onServiceDataDeleted(t)},_onConversationCreated:function(e,t,n){return o.Conversation._createFromIncoming(this,e,t,n)},_findAddress:function(e){return this._contactMap._findAddress(e)},_findOrCreateAddress:function(e){return this._contactMap._findOrCreateAddress(e)},_beginPopulate:function(){this._beginResetCollections(),this._populateBatch(c.IEnumerator.getEnumerator(this._contactsReader.get_persons()),o._globalConfiguration.get__userPopulationBatchSize())},_populateBatch:function(e,t){for(var n=t,i=!1;(t===o._globalConfiguration._disablePopulateBatching||n>0)&&(i=e.moveNext());){var s=e.get_current();this._populateContact(s),n-=s.getContacts().length}if(i){var r=this;new a.Timer(function(){r._populateBatch(e,t)},null,1,a.Timeout.infinite)}else this._endPopulate()},_endPopulate:function(){this._endResetCollections(),e(this._contactsReader).bind("personsChanged",c.Delegate.create(this,this._onContactsChanged)),this._peopleDataPopulated=!0,null!=this._peopleDataReadyCallback&&this._peopleDataReadyCallback.invoke(this,{})},_populateContact:function(e){e.isMe()?this._updateUserMessagingAddress(e):this._contactMap._createContactAndLinkedContacts(e,!1)},_updateUserMessagingAddress:function(e){for(var t=e.getMessagingAddresses()[0],n=c.IEnumerator.getEnumerator(this.get_contact().get_addresses());n.moveNext();){var i=n.get_current();t._setProperty(i._messagingAddress.isActiveAddress(),i._messagingAddress.getPresence(),i._messagingAddress.canCall(),i._messagingAddress.canChat(),i._messagingAddress.canGroupChat()),i._messagingAddress=t}},_beginResetCollections:function(){this._contacts._beginReset()},_endResetCollections:function(){this._contacts._endReset()},_onIMAvailabilityUpdated:function(e){null!=e&&(e===this._pendingIMAvailabilityState&&this.get_presence().get_status()===f.appearOffline&&this.get_presence().set_status(f.online),this._pendingIMAvailabilityState=null)},onSignInCompleted:function(t){e(this).triggerHandler("signInCompleted",[this,t])},onSignOutCompleted:function(t){e(this).triggerHandler("signOutCompleted",[this,t])},onSignOutEndpointCompleted:function(t){e(this).triggerHandler("signOutEndpointCompleted",[this,t])},onSignedOutRemotely:function(t){e(this).triggerHandler("signedOutRemotely",[this,t])},onSignedOut:function(t){e(this).triggerHandler("signedOut",[this,t])},onSignedIn:function(t){e(this).triggerHandler("signedIn",[this,t])},onPropertyChanged:function(t){if("DisplayName"===t){if(this._lastDisplayNameValue===this.get_displayName())return;this._lastDisplayNameValue=this.get_displayName()}e(this).triggerHandler("propertyChanged",[this,new o.PropertyChangedEventArgs(t)])},_updateServices:function(e){this._ensureSignedIn(),this._service.updateServices(e,!0,this._getEnabledConnectNetworks())},_updateNetwork:function(e,t,n){this._ensureSignedIn(),this._service.updateNetwork(e,t,n)},_updateServiceData:function(e){var t=(this.get_presence().get__currentServiceData().imServiceData.get_status(),[e.get_info()]);this.get__state()===C.signedIn&&this._service.updateServiceData(t,null),this._address._onServiceDataChanged(t)},_updateContactRoles:function(e,t,n){this._ensureSignedIn(),e._setRoleListChanges(t,n)},onCreateMailbox:function(){return new o.Mailbox(this)},onCreateConversation:function(e){return new o.Conversation(this,e)},_createMailbox:function(){var e=this.onCreateMailbox();if(null==e||e.get__user()!==this)throw o._exceptionHelper.createArgumentException(o._exceptions.objRetOnCreateMailboxInvalid,"mailbox");this._mailbox=e},_createConversation:function(e){var t=this.onCreateConversation(e);if(null==t||t.get_user()!==this)throw o._exceptionHelper.createInvalidOperationException(o._exceptions.onCreateConvRetInvalidConv);return t},_createConversationFromIncoming:function(e,t){this.get_conversations().set__currentConversationCreator(e),this.get_conversations().set__currentConversationId(t);try{return this._createConversation(e)}catch(n){throw n}finally{this.get_conversations().set__currentConversationCreator(null)}},_createGroupConversation:function(e){var t=e.creator?this._findOrCreateAddress(e.creator):this.get_address();this.get_conversations().set__currentConversationCreator(t),this.get_conversations().set__currentConversationId(e.id),null!=this._pendingStartGroupChatThreadId&&this._pendingStartGroupChatThreadId==e.id.toLowerCase()&&(e.userInitiated=!0,this._pendingStartGroupChatThreadId=null);var n=new o.GroupConversation(this,t,e);return n.get_user()!==this&&this.get_conversations().set__currentConversationCreator(null),n},_ensureNotDisposed:function(){if(this.get__state()===C.disposed)throw o._exceptionHelper.createObjectDisposedException("User")},_ensureSignedIn:function(){if(this._ensureNotDisposed(),this.get__state()!==C.signedIn)throw o._exceptionHelper.createInvalidOperationException(o._exceptions.userMustBeSignedInForOperation)},_ensureServicesRichOperation:function(){if(this._sessionServices!==h.full&&this._sessionServices!==h.normal)throw o._exceptionHelper.createInvalidOperationException(o._exceptions.userInvalidServices)},_ensureServicesModifyContactList:function(){if(this._sessionServices!==h.contactPresence&&this._sessionServices!==h.normal&&this._sessionServices!==h.full)throw o._exceptionHelper.createInvalidOperationException(o._exceptions.userInvalidServices)},_ensureAuthenticationType:function(e){if(this._identity.get__authenticationInfo().authType!==e)throw o._exceptionHelper.createInvalidOperationException(o._exceptions.invalidOperationForCurrentAuthMode)},_ensureStatusChangeAllowed:function(){if(this._ensureNotDisposed(),this.get__state()!==C.initialized&&this.get__state()!==C.signedIn)throw o._exceptionHelper.createInvalidOperationException(o._exceptions.userMustBeSignedInForOperation)},dispose:function(){if(this.get__state()!==C.disposed){var e=this.get__state();if(this.set__state(C.disposed),e===C.signingIn||e===C.signedIn){var t=p.localEndpoint;this._service.signOut(t,null,!0,new o._signOutState(null,v.local,null))}this._userAutoReconnect.dispose()}},_conversationCreate:function(e,t){this._service.conversationCreate(e,t.get__info())},_conversationCreateGroup:function(e){var t=this._contact.get_windowsLiveAddress(),n=this._contact.get_skypeAddress(),i=n?n.get__info():t.get__info(),o=n?t.get__info():null,r=new s.GroupConversationMemberInfo(i,o);r.isAdmin=!0,e[e.length]=e[0],e[0]=r,this._service.conversationCreateGroup(e)},_conversationAddMembers:function(e,t,n){this._service.conversationAddMembers(e,t,n)},_conversationRemoveMembers:function(e,t,n){this._service.conversationRemoveMembers(e,t,n)},_conversationSendMessage:function(e,t,n){this._service.conversationSendMessage(e,t,n)},_conversationGetRecentList:function(){this._service.conversationGetRecentList()},_conversationGetHistory:function(e){this._service.conversationGetHistory(e)},_conversationUpdateConsumptionHorizon:function(e,t){this._service.conversationUpdateConsumptionHorizon(e,t)},_conversationClose:function(e){this._service.conversationClose(e)},_completeSignIn:function(t,n,r,a,l,u){if(!this.get__disposed()){null==u&&(u=new o._signInState(null,!0));var _=o.SignInResultCode.success;if(t!==d.success){if(_=o.SignInResultCode.failure,t!==d.unauthenticated?this._userAutoReconnect.trigger(-1):this.set__state(C.signedOut),u.raiseSignInCompleted){t===d.unauthenticated&&(_=o.SignInResultCode.authenticationFailure);var g=new o.SignInCompletedEventArgs(_,n,u.userState);g.set_serverName(a),this.onSignInCompleted(g)}}else{if(this._userAutoReconnect.onSignedIn(),this._service.onSignInPopulateCompleted(),!c.isNullOrEmpty(l)){this._identity._setSkypeId(l);for(var h=c.IEnumerator.getEnumerator(this._contact.get_addresses());h.moveNext();){var p=h.get_current();if(p.get_type()===o.IMAddressType.skype){p.get__info().address=l,p.get__info().id=l,this._skypeAddress=p;break}}}if(this.set__state(C.signedIn),this._hasSignedIn=!0,this.onSignedIn(new o.SignedInEventArgs(a)),u.raiseSignInCompleted){var f=new o.SignInCompletedEventArgs(_,n,u.userState);f.set_serverName(a),this.onSignInCompleted(f)}for(;this._pendingServiceDataChanges.length>0;){var m=this._pendingServiceDataChanges.shift();this._onServiceDataChanged(m[0],m[1])}for(var v=this._getEnabledConnectNetworks(),y=c.IEnumerator.getEnumerator(this.get_networks());y.moveNext();){var S=y.get_current();if(S.get_imEnabled()&&!S.get_isWindowsLive()&&S.get__isRemoteNetwork())for(var $=c.IEnumerator.getEnumerator(v);$.moveNext();){var w=$.get_current();if(S.get_id()===w){this._updateNetwork(S.get_id(),s.NetworkOperationType.enableIM,!1);break}}}i.isSkypeInvitesEnabled()&&(this._retrieveInboundInvitations(),e(this._contactsReader).bind("settingsChanged",c.Delegate.create(this,this._onContactsSettingsChanged)))}if(null!=this._identity.get_signinScenarioQoSObject()){if(t===d.success)s.WebmainHelper.addQoSStats(s.WebmainHelper.qoSApiConnectMessenger,null,s.WebmainHelper.qoSSigninApiStartTime,this._identity.get_signinScenarioQoSObject(),!1),s.WebmainHelper.stopQoS(this._identity.get_signinScenarioQoSObject(),!0,null);else{var I=t===d.unauthenticated||t===d.transferred;s.WebmainHelper.addQoSStats(s.WebmainHelper.qoSApiConnectMessenger,n,s.WebmainHelper.qoSSigninApiStartTime,this._identity.get_signinScenarioQoSObject(),I),s.WebmainHelper.stopQoS(this._identity.get_signinScenarioQoSObject(),!1,n,I)}this._identity.set_signinScenarioQoSObject(null)}else if(null!=this._identity.get_reconnectScenarioQoSObject()){if(t===d.success)s.WebmainHelper.addQoSStats(s.WebmainHelper.qoSApiReconnect,null,s.WebmainHelper.qoSReconnectApiStartTime,this._identity.get_reconnectScenarioQoSObject(),!1),s.WebmainHelper.stopQoS(this._identity.get_reconnectScenarioQoSObject(),!0,null);else{var b=t===d.unauthenticated||t===d.transferred;s.WebmainHelper.addQoSStats(s.WebmainHelper.qoSApiReconnect,n,s.WebmainHelper.qoSReconnectApiStartTime,this._identity.get_reconnectScenarioQoSObject(),b),s.WebmainHelper.stopQoS(this._identity.get_reconnectScenarioQoSObject(),!1,n,b)}this._identity.set_reconnectScenarioQoSObject(null)}}},_onContactsSettingsChanged:function(){this._invitationsRequireNotification=!0,this._retrieveInboundInvitations()},_retrieveInboundInvitations:function(){if(r.SkyJSHelper.skypeEnabled){var e=this._contactsReader.get_settings().getSkypePendingInboundCount();if(e>this._pendingInviteCount){this._pendingInviteCount=e,this._getInvitationsQoSScenario=s.WebmainHelper.startQoS(s.WebmainHelper.qoSScenarioGetInvitations),s.WebmainHelper.qoSResetTime(s.WebmainHelper.qoSScenarioGetInvitations);var t={},n={};n.userId=this.get_skypeAddress().get_address(),t.data=n,t.success=c.Delegate.create(this,this._onSkyJSInviteSuccessCallback),t.error=c.Delegate.create(this,this._onSkyJSInviteErrorCallback),r.SkyJSHelper.getInstance().Outlook.getList(t)}}},_onSkyJSInviteSuccessCallback:function(e){function i(){var e=new t.XMLHttpRequest;e.open("POST",c.format("{0}//{1}/Handlers/PeopleApi/ResetSkypePendingInboundCount.mvc",t.location.protocol,t.location.host),!0),e.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");var i=s.WebmainHelper.startQoS(s.WebmainHelper.qoSScenarioResetSkypePendingInboundCount);s.WebmainHelper.qoSResetTime(s.WebmainHelper.qoSScenarioResetSkypePendingInboundCount),e.send(c.format("canary={0}",encodeURIComponent(n.ContactCache.canary))),e.onreadystatechange=function(){if(4===e.readyState)if(200===e.status)s.WebmainHelper.addQoSStats(s.WebmainHelper.qoSApiResetSkypePendingInboundCount,null,s.WebmainHelper.qoSResetSkypePendingInboundCountApiStartTime,i,!1),s.WebmainHelper.stopQoS(i,!0,null);else{var t;t=500!==e.status||c.isNullOrEmpty(e.statusText)?e.status.toString():c.format("500, {0}",e.statusText),s.WebmainHelper.addQoSStats(s.WebmainHelper.qoSApiResetSkypePendingInboundCount,t,s.WebmainHelper.qoSResetSkypePendingInboundCountApiStartTime,i,!1),s.WebmainHelper.stopQoS(i,!1,t)}}}var o=e;if(null!=o&&o.length>0)for(var r=c.IEnumerator.getEnumerator(o);r.moveNext();){var l=r.get_current(),u=l.sender,d=l.greeting,_=l.event_time,g=null;if(!c.isNullOrEmpty(_)){var h=_.split(" ");2===h.length&&(g=a.DateTimeHelper.parseTimeStamp(c.format("{0}T{1}Z",h[0],h[1])))}c.isNullOrEmpty(u)||c.isNullOrEmpty(d)||null==g||c.keyExists(this._inboundInvites,u)||(this._createInviteMessage(u,d,g,this._invitationsRequireNotification),this._inboundInvites[u]=!0)}else i();s.WebmainHelper.addQoSStats(s.WebmainHelper.qoSApiGetInvitations,null,s.WebmainHelper.qoSGetInvitationsApiStartTime,this._getInvitationsQoSScenario,!1),s.WebmainHelper.stopQoS(this._getInvitationsQoSScenario,!0,null)},_onSkyJSInviteErrorCallback:function(e){var t=e,n="";n=null!=t?c.format("{0}:{1}",t.code,t.text):"Unknown",s.WebmainHelper.addQoSStats(s.WebmainHelper.qoSApiGetInvitations,n,s.WebmainHelper.qoSGetInvitationsApiStartTime,this._getInvitationsQoSScenario,!1),s.WebmainHelper.stopQoS(this._getInvitationsQoSScenario,!1,n)},_createInviteMessage:function(e,t,n,i){var r=null,a=this.findContactBySkypeId(e,null);if(null!=a)for(var l=c.IEnumerator.getEnumerator(a.get_addresses());l.moveNext();){var d=l.get_current();if(d.get_skypeName()===e){if(d.get_type()===o.IMAddressType.shortCircuit){r=d;break}return}}else{var _=new s.IMAddressInfo(e,u.shortCircuit,g.none);_.skypeId=e,r=this._findOrCreateAddress(_),r.get_contact()._setDisplayNameChanges(e),r.set_isPendingInbound(!0)}var h=this._conversations.create(r),p=new s.MessageInfo(s.MessageInfoType.textMessage,new s.TextMessageInfo(t,null)),f=o.Message._fromMessageInfo(this,r,p,h);f.set_timestamp(n),f.set_inviteMessage(!0),f.set_clientMessageId("0"),f.set_inviteMessageType(i?o.InviteMessageType.newInvite:o.InviteMessageType.historyInvite),h.onMessageReceived(new o.MessageReceivedEventArgs(f))},_markUserAsSignedOut:function(e,t){e?this._userAutoReconnect.trigger(t):this.get__state()!==C.disposed&&this.set__state(C.signedOut),this._markUserAsOffline(),this._address.get_endpoints()._clearAllExceptLocal()},_markUserAsOffline:function(){var e=s.ServiceData.createEmpty(s.ServiceType.IM);e.set_status(_.offline),this._address._onServiceDataChanged([e.get_info()])},_markContactsAsOffline:function(){this._contactMap._markOffline(!1,null)},_setAutoReconnectWaitTime:function(e){e!==this._autoReconnectWaitTime&&(this._autoReconnectWaitTime=e,this.onPropertyChanged("AutoReconnectWaitTime"))},_isExistingOfficeCommunicatorContact:function(e){var t=new s.IMAddressInfo(e,u.officeCommunicator,g.forward),n=this._findAddress(t);return null!=n},_getEnabledConnectNetworks:function(){for(var e=[],t=0;t<this.get_networks().get_count();t++){var n=this.get_networks().get_item(t);n.get_imEnabled()&&!n.get_isWindowsLive()&&n.get__isRemoteNetwork()&&e.push(n.get_id())}return e.length>0?e:null},_onContactsReaderInitialized:function(e){if(e===d.success)s.WebmainHelper.addQoSStats(s.WebmainHelper.qoSApiContactsReady,null,s.WebmainHelper.qoSSigninApiStartTime,this._identity.get_signinScenarioQoSObject(),!1),o._globalConfiguration._initialize(),this.get_networks()._updateNetworks(this._contactsReader.get_networks(),null,null),this._beginPopulate();else{var t="PwcFailed";s.WebmainHelper.addQoSStats(s.WebmainHelper.qoSApiContactsReady,t,s.WebmainHelper.qoSSigninApiStartTime,this._identity.get_signinScenarioQoSObject(),!1),s.WebmainHelper.stopQoS(this._identity.get_signinScenarioQoSObject(),!1,t,!1)}}}}(window.originaljQuery||jQuery)}),define("userevents",["user"],function(){!function(){var e=window,t=e.$Config,n=e.$pwc,i=e.MC,s=e.Microsoft.Live.Messenger,o=e.ss,r=i.IUserServiceEvents,a=i.MessengerServiceResultCode,c=i.SignOutLocationFlags,l=i.SignOutReasonCode,u=s.SignedOutReason,d=s.SignOutResultCode,_=s._userEvents=function(e){r.call(this),this._identity=e},g=_.prototype=new r;g.constructor=_,g._queuedConversations=null,g._queuedConversationMessages=null,g._user=null,g.get__user=function(){return this._user},g.set__user=function(e){return this._user=e,e},g.onServicesChanged=function(e){this._user._onServicesChanged(e)},g.onABChangeNotificationReceived=function(e){this._user.get__contactsReader().notifyAddressBookChange(e)},g.onUpdateNetworkCompleted=function(s,r,c,l){var u=this._user.get_networks().get_item(r);if(null!=u&&u._onUpdateNetworkCompleted(s,c),l&&s===a.success){var d;d=c===i.NetworkOperationType.disableIM?"HideNetwork.mvc":"UnHideNetwork.mvc";var _=new e.XMLHttpRequest;_.open("POST",o.format("{0}//{1}/Handlers/PeopleApi/{2}",window.location.protocol,window.location.host,d),!0),_.setRequestHeader("X-Requested-With","XMLHttpRequest"),_.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");var g=i.WebmainHelper.startQoS(i.WebmainHelper.qoSScenarioOnOffThirdPartyChat);i.WebmainHelper.qoSResetTime(i.WebmainHelper.qoSScenarioOnOffThirdPartyChat),_.onreadystatechange=function(){if(4===_.readyState)if(200===_.status)n.client.deltaSync(),i.WebmainHelper.addQoSStats(c===i.NetworkOperationType.disableIM?i.WebmainHelper.qoSApiOffThirdPartyChat:i.WebmainHelper.qoSApiOnThirdPartyChat,null,i.WebmainHelper.qoSOnOffThirdPartyChatApiStartTime,g,!1),i.WebmainHelper.stopQoS(g,!0,null);else{var e=o.format("{0}:{1}",_.status.toString(),_.statusText);i.WebmainHelper.addQoSStats(c===i.NetworkOperationType.disableIM?i.WebmainHelper.qoSApiOffThirdPartyChat:i.WebmainHelper.qoSApiOnThirdPartyChat,e,i.WebmainHelper.qoSOnOffThirdPartyChatApiStartTime,g,!1),i.WebmainHelper.stopQoS(g,!1,e)}},_.send(o.format("canary={0}&sourceId={1}",encodeURIComponent(t.ContactCache.canary),r))}},g.onNetworkStatusChanged=function(e,t){var n=this._user.get_networks().get_item(e);null!=n&&n._setStatus(t)},g.onSignedIn=function(e,t,n,i,s,o){this._user._completeSignIn(e,t,n,i,s,o)},g.processPendingConversations=function(){this._createReloadedQueuedConversations(),this._processReloadedQueuedConversationMessages()},g.onSignedOut=function(e,t,n){var i=d.success;e!==a.success&&(i=d.failure);var o=n,r=o.locations,l=o.signedOutEndpoint;(t&c.localEndpoint)===c.localEndpoint&&this._user._markUserAsSignedOut(!1,0);var _=new s.SignOutCompletedEventArgs(i,r,l,o.userState);this._user.get__disposed()||(null!=l?this._user.onSignOutEndpointCompleted(_):this._user.onSignOutCompleted(_),(t&c.localEndpoint)===c.localEndpoint&&(this._user.get__state()!==s._userState.autoReconnectWaiting&&this._user.onSignedOut(new s.SignedOutEventArgs(u.signedOutByLocalEndpoint)),this._user._markContactsAsOffline(),this._user.get_networks()._markNetworksOffline()))},g.onUserServicesUpdated=function(){},g.onUserServiceDataUpdated=function(){},g.onMailNotification=function(e){this._user.get_mailbox()._onMailNotification(e)},g.onServiceDataChanged=function(e,t){this._user._onServiceDataChanged(e,t)},g.onServiceDataDeleted=function(e,t){this._user._onServiceDataDeleted(e,t)},g.onSignedOutRemotely=function(e,t){var n,i=!1;switch(e){case l.connectionLost:n=u.connectionLost,i=!0;break;case l.serverError:n=u.serverError,i=!0;break;case l.endpointLimitExceeded:n=u.endpointLimitExceeded;break;case l.signedOutByRemoteEndpoint:n=u.signedOutByRemoteEndpoint;break;case l.userTransferred:case l.signedOutForReconnect:i=!0,n=u.signedOutByServer;break;default:return}this._user._markUserAsSignedOut(i,t),this._user.onSignedOutRemotely(new s.SignedOutRemotelyEventArgs),this._user.onSignedOut(new s.SignedOutEventArgs(n)),this._user._markContactsAsOffline()},g.onNotifyWebSignInPendingEventsCompleted=function(){this.processPendingConversations()},g._onConversationCreatedHandler=function(e,t,n,i,o,r){var a=null;if(null!=n){a=new Array(n.length-1);for(var c=0,l=0;l<n.length;l++){var u=e._findOrCreateAddress(n[l]);if(!u.get_isUser()){if(null==u.get_contact()||null!=u.get_contact()&&u.get_contact().get_isTemporaryContact()&&u.get_type()==s.IMAddressType.connect)return;a[c++]=u}}}r?this._queueReloadedConversation(e,t,i,o,a):this._createConversation(e,t,i,o,a)},g.onConversationCreated=function(e,t,n){var i=this._user.get__state()!==s._userState.signedIn;this._onConversationCreatedHandler(this._user,e,t,null,n,i)},g.onConversationGroupCreated=function(e,t){var n=this._user.get__state()!==s._userState.signedIn;this._onConversationCreatedHandler(this._user,e.id,null,e,t,n)},g.onConversationGroupUpdated=function(e){this._user.get_conversations()._onConversationUpdated(e.id,e)},g.onConversationAddMembersCompleted=function(e,t,n,i){this._user.get_conversations()._onAddMembersCompleted(e,t,n,i)},g.onConversationRemoveMembersCompleted=function(e,t,n,i){this._user.get_conversations()._onRemoveMembersCompleted(e,t,n,i)},g.onConversationAddressJoined=function(e,t){this._user.get_conversations()._onAddressJoined(e,t)},g.onConversationAddressLeft=function(e,t){this._user.get_conversations()._onAddressLeft(e,t)},g.onConversationGetRecentListCompleted=function(e,t){this._user.get_conversations()._onGetRecentConversationsCompleted(e,t)},g.onConversationMessageReceived=function(e,t){var n=this._user.get__state()!==s._userState.signedIn;this._onConversationMessageReceivedHandler(e,t,n)},g.onConversationHistoryMessagesReceived=function(e,t,n){this._user.get_conversations()._onConversationHistoryMessagesReceived(e,t,n)},g.onConversationConsumptionHorizonUpdated=function(e,t){this._user.get_conversations()._onConsumptionHorizonUpdated(e,t)},g.onConversationClearedAtUpdated=function(e,t){this._user.get_conversations().onConversationClearedAtUpdated(e,t)},g.onConversationClosed=function(e){this._user.get_conversations()._onConversationClosed(e)},g._onConversationMessageReceivedHandler=function(e,t,n){if(n){var s={};return s.id=e,s.messageInfo=t,null==this._queuedConversationMessages&&(this._queuedConversationMessages=[]),void this._queuedConversationMessages.push(s)}t.type===i.MessageInfoType.typingUserMessage?this._user.get_conversations()._onBuddyTypedNotification(e,t.sender):this._user.get_conversations()._onMessageReceived(e,t)},g.onConversationSendMessageFailed=function(e,t,n,i){var o=s.SendMessageResultCode.failure;switch(t){case a.messageTooLong:o=s.SendMessageResultCode.messageTooLong;break;case a.messageRecipientDisabled:o=s.SendMessageResultCode.recipientDisabled;break;case a.messageRecipientInvalid:o=s.SendMessageResultCode.recipientInvalid}this._user.get_conversations()._onSendMessageFailed(e,o,n,i)},g.onConversationUpdatedId=function(e,t){this._user.get_conversations()._onUpdatedId(e,t)},g._createConversation=function(e,t,n,i,s){var o=e._onConversationCreated(t,n,s);o&&o._setConsumptionHorizon(i)},g._createReloadedQueuedConversations=function(){if(null!=this._queuedConversations)for(;this._queuedConversations.length>0;){var e=this._queuedConversations.shift();this._createConversation(this._user,e.id.toString(),e.threadInfo,e.consumptionHorizon,e.addresses)}},g._processReloadedQueuedConversationMessages=function(){if(null!=this._queuedConversationMessages)for(;this._queuedConversationMessages.length>0;){var e=this._queuedConversationMessages.shift();this._onConversationMessageReceivedHandler(e.id.toString(),e.messageInfo,!1)}},g._queueReloadedConversation=function(e,t,n,i,s){null==this._queuedConversations&&(this._queuedConversations=[]);var o={};o.id=t,o.threadInfo=n,o.addresses=s,o.consumptionHorizon=i,this._queuedConversations.push(o)}}()}),define("identityinitializer",["userevents"],function(){!function(){var e=window,t=e.Microsoft.Live.Messenger;t._identityInitializer=function(){},t._identityInitializer.prototype={_identity:null,initialize:function(e){this._identity=e,this._identity._setUserService(t.Services.UserServiceFactory.create(this._identity,this._identity.get__userEvents())),this._identity.get__userService().updateTicket(this._identity._getIdentityInfo()),this._identity._onInitialized()},dispose:function(){}}}()}),define("rpsauthidentity",["identityinitializer"],function(){!function(){var e=window,t=e.$Config,n=e.MC,i=e.Microsoft.Live.Messenger,s=i.Services,o=e.MSH,r=e.ss,a=i.Identity,c=a.prototype,l=i.RpsAuthIdentity=function(e,c){var l=this;if(a.call(this),l._setIsAuthenticated(l),l._setLiveId(e),l._setCid(c),l.set__authenticationInfo(new n.AuthenticationInfo(n.AuthenticationType.rpsAuth,"")),l._initializer$1=new i._identityInitializer,o.Scheduler.defer(r.Delegate.create(l,function(){l._initializer$1.initialize(l)})),n.WebmainHelper.isQoS()&&(l.set_signinScenarioQoSObject(n.WebmainHelper.startQoS(n.WebmainHelper.qoSScenarioSignin)),n.WebmainHelper.qoSResetTime(n.WebmainHelper.qoSScenarioSignin)),n.WebmainHelper.isConfig()&&1!==t.WebIM.si)l._onGetMappingContainerCompleted();else{var u=n.WebmainHelper.getQueryParameterByName("uicTicket");t.WebIM.eso&&!r.isNullOrEmpty(u)?this._setUicTicket(u):null!=s.SkyJSHelper.getInstance()&&null!=s.SkyJSHelper.getInstance().Outlook?l._initializeSkyJS():l._onGetMappingContainerCompleted()}},u=l.prototype=new a;u.constructor=l,u._experienceId$1=null,u.get_experienceId=function(){return this._experienceId$1},u.set_experienceId=function(e){return this._experienceId$1!==e&&(this._experienceId$1=e,this.onPropertyChanged(new i.PropertyChangedEventArgs("ExperienceId"))),e},u.get_uicTicket=function(){return this.get__authenticationInfo().uicTicket},u.set_uicTicket=function(e){return this._setUicTicket(e),e},u._getIdentityInfo=function(){var e=c._getIdentityInfo.call(this);return e.experienceId=this._experienceId$1,e},u.dispose=function(){this.get__isDisposed()||(this._initializer$1.dispose(),c.dispose.call(this))}}()}),define("skypeinitializer",["rpsauthidentity"],function(){!function(e){var t=window,n=t.MC,i=t.Microsoft.Live.Messenger,s=t.ss,o=i.SkypeInitializer=function(){};o.initialize=function(t,r,a){var c=n.JSON.deserialize(t);if(null==c)throw i._exceptionHelper.createArgumentNullException("json");if(s.isNullOrEmpty(c.liveId)||s.isNullOrEmpty(c.cid)||s.isNullOrUndefined(c.buddy))throw i._exceptionHelper.createArgumentException("Invalid JSON; Missing fields.","json");if(null==a)throw i._exceptionHelper.createArgumentNullException("callback");var l=new i.RpsAuthIdentity(c.liveId,c.cid);l._setUicTicket(r),e(l).bind("authenticationCompleted",function(e,t,n){o._onAuthenticationCompleted(l,n,c,a)})},o._onAuthenticationCompleted=function(t,n,s,o){if(n.get_resultCode()===i.AuthenticationResultCode.success){var r=new i.User(t,new i.Services._personInfoReader([s.buddy],s.networks));e(r).bind("signInCompleted",function(e,t,n){o.invoke(n.get_resultCode(),r)}),r.signIn()}else o.invoke(i.SignInResultCode.failure,null)}}(window.originaljQuery||jQuery)}),define("webimshared",["skypeinitializer"],function(){!function(){function e(e){return t(c,e)}function t(e,t){var n="";return o.GetString&&(n=o.GetString(e+t)),n}function n(t){var n=t?t.get_name():"";return"SMS"==n&&(n=e(a)),n}function i(e,t){var i=o.$Config||{},s=i.WebIM||{},r=e.get_displayName();if(!r){var a=t&&t.get_network()||e.get_linkedContacts().get_item(0).get_network(),c=s.so3||"";r=c.format(n(a))}return r}function s(e){return 10>e&&(e="0"+e),e}var o=window,r=o.$WLXIM,a="Sms",c="live.shared.strings.webim.client.";r.getDisplayName=i,r.getReconnectingTime=function(){var e=r.user.get_autoReconnectWaitTime(),t=s(Math.floor(e/60));return e=s(e%60),{min:t,sec:e}}}()}),define("webimpophelper",["webimshared"],function(){!function(e){function t(e,t,n){for(var i=e.get_addresses(),o=0,r=i.get_count();r>o;o++){var a=i.get_item(o),c=a.get_type();if(c==t&&(c!=s.MLM.IMAddressType.connect||!n||n==a.get_network()))return a}return null}function n(e,n,i){var o=null;if(n&&(o=t(e,n,i)),!o&&(o=e.get_currentAddress(),o.get_type()==s.MLM.IMAddressType.telephone))for(var r=e.get_addresses(),a=0,c=r.get_count();c>a;a++){var l=r.get_item(a);if(l.get_capabilities().get_supportsOfflineMessages()){o=l;break}}return o}var i=window,s=i.$WLXIM,o=i.$Do,r=i.$BSI;o.register("$WLXIM.ConversationStarted"),s.startConversation=function(t,n,i,a,c){i=i||"Other",r.reportEvent("ClickedSelected.Messaging.IMConversation",{StartLocation:i}),o.when("wlxim_startconversation",0,t,n,a,c,i),e(s).trigger("ConversationStarted",!1)},s.getConversationAddress=n}(window.originaljQuery||jQuery)}),define("webimheader",["webimpophelper"],function(){!function(e){function t(){e(z).bind("stateChange",f),f(),R=!0,e(W).bind(U,et.dispose)}function n(){W.$Utility.isHighContrast()&&(i(w),i(I),i(D),i(A))}function i(t){var n=e(t);e("span.is_hc",n).replaceWith($menu.createChevron($menu.chevronTypes.LargeDotLight,!0))}function s(e){var t=null;if(null!=e){var n=e.parentNode;t=null!=n&&X.has(n,"c_ld")?n.nextSibling:e.nextSibling}return t}function o(e,t){null!=e&&(e=e.parentNode,X.has(e,"c_ld")&&(e=e.parentNode),e.style.display=t,X.has(e,"c_sml")&&(e=e.parentNode,e.style.display=t))}function r(e){o(e,"block")}function a(e){o(e,"none")
}function c(){for(var e=0;e<k.length;e++)a(k[e])}function l(t,n){var i=t.get_id(),s=T.parentNode.cloneNode(!0),o=D.parentNode.cloneNode(!0),r=A.parentNode.cloneNode(!0),a=s.getElementsByTagName("span")[0],c=j.rtl?"rtl":"ltr",l=q.createTextNode(t.get_name());a.id="c_wimnet_"+i,a.setAttribute("dir",c),a.replaceChild(l,a.childNodes[0]),J(a,"$Sutra.Shared.ThirdPartyNetwork");var _=o.getElementsByTagName("a")[0],g=r.getElementsByTagName("a")[0];_.id="c_wimneton_"+i,g.id="c_wimnetoff_"+i;var h=e(_),p=e(g);h.click(function(e){$HeaderWebIM.toggle(e,i,!0)}),p.click(function(e){$HeaderWebIM.toggle(e,i,!1)});var f="<span style='display: none; visibility: hidden;'>&nbsp;{0}&nbsp;</span>".format(t.get_name());if(h.find(".is_c").after(f),p.find(".is_c").after(f),window.$header&&(window.$header.reportBSIMenu(h,_.id),window.$header.reportBSIMenu(p,g.id)),s.style.display="block",n){var m=X.getCN("c_ms","span",r),v=m[0];v.parentNode.removeChild(v)}e(t).bind("propertyChanged",d),at&&at.push(t),u(s,o,r),d(null,t)}function u(e,t,n){var i=T.parentNode,s=i.parentNode;s.insertBefore(e,i),s.insertBefore(t,i),s.insertBefore(n,i)}function d(e,t){if(!t.get_supportsIM())return p(),void g();var n=t.get_id(),i=Y("c_wimnet_"+n);if(i){var s=Y("c_wimneton_"+n),r=Y("c_wimnetoff_"+n),a=i.childNodes[0],c=" "+y("MeMenu.Chat"),l=t.get_name(),u=t.get_status(),d=z.MLM.NetworkStatus;u==d.signedOut?(_(s,0),_(r,1),o(s,"block"),o(r,"block"),a.nodeValue=t.get_name()+c):u==d.signedIn?(_(s,1),_(r,0),o(s,"block"),o(r,"block"),a.nodeValue=l+c):u==d.signingIn||u==d.autoReconnectWaiting?(o(s,"none"),o(r,"none"),a.nodeValue=l+" "+y("MeMenu.Enabling")):(o(s,"none"),o(r,"none"),a.nodeValue=l+" "+y("MeMenu.CannotConnect")),M&&M.binding&&M.binding.update()}}function _(t,n){var i=e(t).children("span"),s=e(i[0]);n?s.css("visibility","inherit"):s.css("visibility","hidden")}function g(){var e=Y("c_melink").menu;e&&e.isOpen()&&!rt?(rt=1,e.addStateListener(h)):h()}function h(){rt&&(Y("c_melink").menu.removeStateListener(h),rt=0);var t=$.get_networks().get_count();if(t){var n,i=[],o=[],a=0;for(n=0;t>n;n++){var c=$.get_networks().get_item(n),u=c.get_id();"WL"!=u&&c.get_supportsIM()&&c.get_supportsRemoteSignIn()&&!Y("c_wimnet_"+u)&&-1==o.indexOf(u)&&(o.push(u),i[a]=c,a++)}for(n=0;a>n;n++)l(i[n],n==a-1);if(a>0){r(b);var d=s(I);d&&(d.style.display="none")}}ot||(e($.get_networks()).bind("collectionChanged",g),ot=1),E.binding&&E.binding.update()}function p(){ot&&(e($.get_networks()).unbind("collectionChanged",g),ot=0);var t=Y("c_memenu"),n=X.getCN("c_wimnw","a",t);n=n.concat(X.getCN("c_wimnw","span",t));for(var i=0;i<n.length;i++){var o=n[i].id;if("c_wimnet"!=o&&"c_wimneton"!=o&&"c_wimnetoff"!=o){var r=n[i].parentNode;r.parentNode.removeChild(r)}}a(b);var c=s(I);c&&(c.style.display="block")}function f(){var t=z.hasPresence(),n=z.hasNotify(),i=!1,s=!1,l=!1,u=!1;if(st||!n&&!t||($=z.user,e(z).bind("contactsCountChanged",m),e(z.user.get_mailbox()).bind("propertyChanged",C),e(z.user.get_address()).bind("propertyChanged",v),m(!0),C(0,!0),st=1),t?(i=!0,s=!0):(n&&(s=!0),i&&(u=1)),!n&&s&&(l=!0),(z.isError()||z.isWaitingToReconnect()||z.isOff())&&(n||(l=!0),u=!0),N&&l&&(N[G][F]=V),x&&u&&(x[G][F]=V),L){var d,_;if(t){for(g(),d=0;d<k.length;d++)_=k[d],"none"==_.style.display&&K.e(_.parentNode,"block"),o(_,"block");if($){var h=$.get_presence().get_status();h&&et.setPresenceRadioButton(h)}}else if(p(),z.isLoading())for(et.setPresenceRadioButton(0),d=0;d<k.length;d++)_=k[d],K.d(_),o(_,"block");else c();z.isError()?r(Y("c_wims")):a(Y("c_wims"));var S=Y("c_wimr");if(z.isWaitingToReconnect()){if(S){var w=y("InfoBar.Reconnecting"),I=z.getReconnectingTime();S[B]=w.format(I.min,I.sec),r(S),P=W.setTimeout(f,1e3)}}else S&&a(S);z.isOff()?r(Y("c_wimn")):a(Y("c_wimn")),E.binding&&E.binding.update()}}function m(e){window.$HeaderCookie&&(!z.hasPresence()||e&&0==z.count||W.$HeaderCookie.updateContactsCount(z.onlineCount))}function v(){z._inform()}function C(e,t){var n=0;null!=z&&null!=z.user&&(n=Math.max(0,parseInt(z.user.get_mailbox().get_inboxUnreadCount()))),t&&0==n||(window.$HeaderCookie?W.$HeaderCookie.updateUnreadCount(n,N):N&&(N.style.display="inline",n>999&&(n="99+"),N.innerHTML="&nbsp;"+n))}function y(e){return S(H,e)}function S(e,t){var n="";return W.GetString&&(n=W.GetString(e+t)),n}var $,w,I,b,M,k,E,T,D,A,x,N,P,R,O,L,H="live.shared.strings.webim.client.",U="unload",B="innerHTML",F="display",V="none",G="style",W=window,q=W.document,z=W.$WLXIM,j=W.$B,Q=W.$Do,X=W.$css,K=W.$edh,J=W.sutra,Y=W._ge,Z=W.Microsoft.Live.Messenger,et=W.$HeaderWebIM={},tt=0,nt="c_himla",it="c_himld",st=0,ot=0,rt=0,at=[];Q.when("wlximuiouter",0,t),et.init=function(){var e=Y("c_memenu");e&&(w=Y(nt),I=Y(it),b=Y("c_wimnetsub"),M=Y("c_wimnetsub_m"),k=[w,I],E=Y("c_memenu"),T=Y("c_wimnet"),D=Y("c_wimneton"),A=Y("c_wimnetoff"),x=Y("c_mocc"),N=Y("c_murc"),n(),L=!0,R&&f(),J(w,"$Sutra.Shared.Available"),J(I,"$Sutra.Shared.Invisible"),J(b,"$Sutra.Shared.AvailabilityDetails"),J(Y("c_wimnetsub_m"),"$Sutra.Shared.ThirdPartyNetworks"))},Q.register("$HeaderWebIM.Initialize",et.init),et.dispose=function ct(){if(!O){if(Q.remove("wlximuiinner",0,t),R&&e(z).unbind("stateChange",f),st&&(e(z.user.get_mailbox()).unbind("propertyChanged",C),e(z).unbind("contactsCountChanged",m),e(z.user.get_address()).unbind("propertyChanged",v)),rt&&Y("c_melink").menu.removeStateListener(h),P&&W.clearTimeout(P),ot){var n=$.get_networks();e(n).unbind("collectionChanged",g)}for(var i=at.length,s=0;i>s;s++){var o=at[s];e(o).unbind("propertyChanged",d)}if(at=null,window.$WLXIMCL){var r=window.$WLXIMCL.getListById(tt);r&&r.dispose()}e(W).unbind(U,ct),O=!0}},et.SP=function(e){W.$menu.closeCurrent(),z.switchPresence(e),$HeaderWebIM.setPresenceRadioButton(e)},et.setUnreadCountEl=function(t){t!=N&&(N&&e(N).hide(),N=t,C(0,!0))},et.setPresenceRadioButton=function(e){var t="";switch(e){case 0:break;case 2:t=it;break;default:t=nt}for(var n=0;n<k.length;n++){var i=k[n];if(i){var o=i.firstChild;o&&(i.id==t?(o.style.visibility="inherit",i.setAttribute("aria-checked","true")):(o.style.visibility="hidden",i.setAttribute("aria-checked","false")))}}var r=s(I);r&&"none"==r.style.display&&(e==Z.PresenceStatus.appearOffline?K.d(b):"none"==b.style.display&&K.e(b.parentNode,"block"))},et.toggle=function(e,t,n){e.preventDefault(),W.$menu.closeAll();for(var i=$.get_networks().get_count(),s=0;i>s;s++){var o=$.get_networks().get_item(s);if(o.get_id()==t){if(!o.get_supportsIM()){p(),g();break}o.set_imEnabled(n),d(null,o)}}}}(window.originaljQuery||jQuery)}),define("uimodernenums",["webimheader"],function(){!function(){var e=window;e.MsgrUI=e.MsgrUI||{};var t=e.MsgrUI,n=t.EventType=function(){};n.blur=0,n.click=1,n.focus=2,n.keyPress=3,n.keyDown=4,n.mouseDown=5,n.mouseUp=6,n.mouseOut=7,n.scroll=8;var i=t.PeopleFilter=function(){};i.all=0,i.available=1,i.skype=2,i.facebook=3,i.google=4}()}),define("templates",["uimodernenums"],function(){!function(){var e=window,t=e.Microsoft.Live.Messenger,n=e.$B,i=e.$Utility,s=e.MsgrUI,o=s._templates=function(){};o.anchorFormat='<a resourceid="anchor" sutra= "infobarlink" href="#" onclick="return false;">{0}</a>',o._recentConversationsControl='\r\n<div resourceid="RecentConversationsControl" class="RecentConversationsControl"><div resourceid="Container" class="RecentConversationsControl_Container"><div resourceid="Items" class="RecentConversationsControl_Items" sutra="recentconversations"><h1 resourceid="Title" class="Title" sutra="recentconversationstitle"></h1><ul resourceid="ItemsContainer" class="RecentConversationsContainer" sutra="recentconversationscontainer"></ul>\r\n<a resourceid="ShowMore" class="ShowMore" sutra="showmore"></a><div resourceid="ErrorMessage" class="ErrorMessage" sutra="recenterror"></div><img resourceid="Spinner" class="Spinner" sutra="recentconversationsloading"></img>\r\n        </div><div resourceid="Favorites"></div><div resourceid="People" id="WebIMPeople" sutra="peoplecontrol"></div></div><div resourceid="Upsell" class="RecentConversationsControl_Upsell" sutra="webimupsellbody">\r\n            <div class="WhiteLineBreak"></div>\r\n            <div resourceid="UpsellHeader" class="Header"></div>\r\n            <div class="Container">\r\n                <ul resourceid="UpsellContainer"></ul>\r\n            </div>\r\n            <a href="#" onclick="return false;" resourceid="UpsellClose" class="Close" sutra="nothanks"></a>\r\n        </div>\r\n<div class="BelowRecentItems"><div resourceid="ConnectedTo" class="RecentConversationsControl_ConnectedTo" sutra="connectedtowidget"></div>\r\n    </div>\r\n</div>',o._recentConversationsItem='<li><a href="#" onclick="return false;" resourceid="RecentConversationsItem" class="RecentConversationsControl_Item" sutra="recentconversation"><div resourceid="UserTile" class="RecentConversationsControl_UserTile" sutra="recentconversationusertile"></div><div class="RecentConversationsControl_RightGroup"><div resourceid="DisplayName" class="RecentConversationsControl_ContactDisplayName" sutra="recentconversationsendername"></div><div resourceid="LastMessage" class="RecentConversationsControl_LastMessage"><div resourceid="MessageText" class="RecentConversationsControl_MessageText" sutra="recentconversationlastmessage"></div><div resourceid="Timestamp" class="RecentConversationsControl_Time" sutra="recentconversationlastmessagetimestamp"></div></div></div></a></li>',o._modernConversationControl="<div resourceid='ModernConversationControl' class='ModernConversationControl'><div resourceid='Header' class='ModernConversationControl_Header' sutra='chatviewheader'><div resourceid='CommandBar' class='CommandBar' sutra='chatviewcommandbar'><a href='#' onclick='return false;' resourceid='BackButton' class='BackButton' sutra='chatviewbackbutton' role='button'><img src='{0}'/></a><div class='RightGroup'><div resourceid='CallButtons' class='ModernConversationControl_CallButtons'><img resourceid='SpinningWheel' class='ModernConversationControl_SpinningWheel' sutra='spinningwheel'></img><a href='#' onclick='return false;' resourceid='VideoCallButton' class='ModernConversationControl_VideoCallButton' sutra='videocallbutton' role='button'><img src='{0}'/></a><a href='#' onclick='return false;' resourceid='AudioCallButton' class='ModernConversationControl_AudioCallButton' sutra='audiocallbutton' role='button'><img src='{0}'/></a><a resourceid='DisableVideoCallButton' class='ModernConversationControl_DisableVideoCallButton' sutra='disablevideocallbutton'><img src='{0}'/></a><a resourceid='DisableAudioCallButton' class='ModernConversationControl_DisableAudioCallButton' sutra='disableaudiocallbutton'><img src='{0}'/></a></div><a href='#' onclick='return false;' resourceid='AddMembersButton' class='AddMembersButton' sutra='addmembersbutton' style='display:none;' role='button'><img src='{0}'/></a><a href='#' onclick='return false;' resourceid='CommandMenu' class='CommandMenu' sutra='chatviewcommandmenu' role='menu'><img src='{0}'/></a><div resourceid='ContextMenuContainer' class='ContextMenuContainer'></div><div resourceid='ConfirmationDialogContainer' class='ConfirmationDialogContainer' sutra='chatviewconfirmationdialog'></div></div></div><div class='ModernConversationControl_ContactDetails' sutra='chatviewcontactdetails'><div resourceid='UserTile' class='UserTile' sutra='chatviewusertile'></div><div resourceid='TitleAndNetwork' class='TitleAndNetwork'><h1 class='Title'><a href='#' onclick='return false;' resourceid='Title' sutra='chatviewdisplayname'></a></h1><div resourceid='Status' sutra='chatviewstatus'><div resourceid='Presence' class='Presence' sutra='chatviewbuddypresence'></div><a class='NetworkSwitcher' resourceid='NetworkSwitcher' href='#' onclick='return false;'><div resourceid='Network' class='Network' sutra='chatviewcurrentnetwork'></div><div resourceid='NetworkChevron' class='NetworkChevron'><img src='{0}' /></div></a></div><div resourceid='NetworkMenuContainer' class='NetworkMenuContainer'></div><div resourceid='Roster' class='ModernConversationRosterControl' sutra='chatviewroster' style='display:none;'><a href='#' onclick='return false;' resourceid='RosterCount' class='RosterCount' sutra='chatviewrostercount' role='menu'><span resourceid='Count'></span><span class='RosterChevron'><img src='{0}'/></span></a><ul resourceid='RosterContainer' class='RosterContainer' style='display:none;' sutra='chatviewrostercontainer'></ul></div></div><div resourceid='InviteRequest' sutra='inviterequest' class='InviteRequest'><ul resourceid='InviteGreeting' class='InviteGreeting' sutra='invitegreeting'></ul><button resourceid='InviteAccept' sutra='inviteaccept' class='default InviteAccept' type='button'></button><button resourceid='InviteDecline' class='InviteDecline' type='button' sutra='invitedecline'></button></div></div></div><div resourceid='Container' class='ModernConversationControl_Container'><div sutra='messagehistorylist'><div resourceid='History' class='ModernConversationHistoryControl' sutra='messages'><img resourceid='Spinner' class='Spinner' sutra='messagesloading' style='display: none;'></img><ul aria-live='polite' aria-relevant='additions' resourceid='ItemsContainer' sutra='messagescontainer'></ul></div></div><div resourceid='HistoryBottom' class='ModernConversationControlBottom'><div><div resourceid='InfoBar' sutra='infobar' class='InfoBar'></div><div resourceid='Typing' class='ModernConversationTypingControl'><div resourceid='TypingText' class='TypingText'></div></div><a href='#' onclick='return false;' resourceid='EmoticonLaunch' class='EmoticonLaunchImage' sutra='emoticonlaunch'></a><div resourceid='EmoticonPanel' class='ModernConversationControl_EmoticonPanel' style='display: none; visibility: hidden;' sutra='emoticonpanel'><ul resourceid='MessengerEmoticons' style='border-style:none'></ul><ul resourceid='FacebookEmoticons' style='border-style:none'></ul><ul resourceid='GoogleEmoticons' style='border-style:none'></ul></div></div><div resourceid='Input' class='ModernConversationInputControl'><textarea resourceid='TextBox' class='ModernConversationInputControl_TextBox' sutra='sendmessagebox' tabindex='0'></textarea></div><div resourceid='SkypeUpsell' class='SkypeUpsell' sutra='skypeconvupsell'><span resourceid='Text'></span><a resourceid='Link'><img /><span resourceid='LinkText'></span></a></div></div></div></div>",o._modernConversationHistoryItem='\r\n<li>    \r\n    <div resourceid="ModernConversationHistoryItem" class="ModernConversationHistoryItem" sutra="message">\r\n        <div resourceid="Sender" class="ModernConversationHistoryItemNode_Sender" sutra="chatviewsendername" style="display: none;"></div>\r\n        <div resourceid="Text" class="ModernConversationHistoryItemNode_Text" sutra="chatviewmessagetext"></div>\r\n        <div resourceid="Timestamp" class="ModernConversationHistoryItemNode_Timestamp" sutra="chatviewMessagetimestamp"></div>\r\n        <div resourceid="Pointer"></div>\r\n    </div>\r\n    <label resourceid="Label" style="display:none"></label>\r\n</li>\r\n',o._modernConversationNetworkMenuItem='\r\n<div resourceid="NetworkAttributeMenuItem" class="NetworkAttributeMenuItem" sutra="network">\r\n    <span resourceid="SelectedIndicator" class="NetworkAttributeMenuItem_SelectedIndicator" style="visibility:hidden;"></span>\r\n    <span resourceid="NetworkAttributeName" class="NetworkAttributeMenuItem_Name"></span>\r\n</div>\r\n',o._modernConversationRosterItem='\r\n<li class="RosterItem" sutra="chatviewrosteritem">\r\n    <div resourceid="StatusBarContainer" class="StatusBarContainer">\r\n        <div resourceid="StatusBar" class="StatusBar" sutra="rosterstatusbar">\r\n            <span resourceid="Label"></span>\r\n        </div>\r\n    </div>\r\n    <div resourceid="DisplayName" class="ContactDisplayName" sutra="rosterdisplayname"></div>\r\n</li>\r\n',o._contactPickerControl='\r\n<div resourceid="ContactPickerControl" class="ContactPickerControl" sutra="webimcontactpicker">\r\n    <h1 resourceid="Title" class="Title"></h1>\r\n    <div resourceid="Container" class="Container">\r\n        <textarea class="cp_textarea"></textarea>\r\n    </div>    \r\n    <div class="BottomGroup">\r\n        <div resourceid="Infobar" class="Infobar"></div>\r\n        <button resourceid="AddButton" class="AddButton default" sutra="cpacceptbutton"></button>\r\n        <button resourceid="CancelButton" class="CancelButton" sutra="cpcancelbutton"></button>\r\n    </div>\r\n</div>',o._confirmationDialog='\r\n<div class="ConfirmationDialog" sutra="confirmationdialog" style="display: none;" role="dialog">\r\n    <span resourceid="DialogText" sutra="dialogtext" class="DialogText"></span>\r\n    <button resourceid="AcceptButton" sutra="dialogacceptbutton" class="AcceptButton default"></button>\r\n</div>\r\n',o._contextMenu='\r\n<div class="ContextMenu" style="display:none;">\r\n    <ul resourceid="MenuItemList"></ul>\r\n</div>';var r="MessagingImageStrip";n.ltr||(r+="RTL"),i.isHighContrast()&&(r+="White"),r+="4.png",o.messagingImageStrip=t.MessengerUtility.getImagePath()+r}()}),define("localization",["templates"],function(){!function(){var e=window,t=e.MsgrUI;t._getLocString=function(t){var n="";return e.GetString&&(n=e.GetString("live.webim.strings."+t)),n},t._getLocStringNS=function(t){var n="";return e.GetString&&(n=e.GetString(t)),n}}()}),define("webimutility",["localization"],function(){!function(){var e=window,t=e.document,n=e.MC,i=n.ThreadActivityMessageType,s=e.ss,o=e.MsgrUI,r=e.Microsoft.Live.Messenger,a=r.PresenceStatus,c=null,l=o.Utility=function(){};l.backgroundThemeClassName="t_cbr",l.backgroundLightThemeClassName="t_cbs",l.fontColorThemeClassName="t_rc",l.borderTopThemeClassName="t_cbpr",l.borderTopLightThemeClassName="t_cbps",l.isElementPositionStatic=function(e){var t=l.getCurrentStyleProperty(e,"position");return""===t||"static"===t},l.getCurrentStyleProperty=function(e,n){var i=e.currentStyle;if(null==i){var s=t.defaultView.getComputedStyle(e,null);return s.getPropertyValue(n)}return i[n]},l.getLocalizedStatusText=function(e){var t=e.get_presence().get_status();switch(t){case a.appearOffline:return o._getLocString("statusAppearOffline");case a.offline:var n;return n=o._getLocString(e.get_type()===r.IMAddressType.connect&&e.get_isFacebookMobileEnabled()&&!e.get_isUser()?"facebookMobile":"statusOffline");case a.away:case a.idle:case a.beRightBack:case a.outToLunch:return o._getLocString("statusAway");case a.busy:case a.inACall:return o._getLocString("statusBusy");case a.online:return o._getLocString("statusOnline");default:return""}},l.getNetworkIconsPath=function(){return r.MessengerUtility.getImagePath()+"NetworkIcons/"},l.getNetworkLabel=function(e){return e.get_isWindowsLive()?o._getLocString("networkMessenger"):e.get_name()},l.getActivityMessageElement=function(e){var n=t.createElement("span");return n.innerText=l.getActivityMessageString(e),n},l.getActivityMessageString=function(e){var t="",n=e.get_initiator().get_isUser()?o._getLocString("you"):e.get_initiator().get_contact().get_displayName(),r="";switch(e.get_activityType()){case i.addMember:r=l._getTargetNames(e.get_targets(),e.get_initiator()),r?t=s.format(o._getLocString("activityMessageAddMembers"),n,r):null!=e.get_targets()&&e.get_targets().length>0&&(t=e.get_initiator().get_isUser()?o._getLocString("activityMessageSelfAddYou"):s.format(o._getLocString("activityMessageSelfAddMembers"),n));break;case i.deleteMember:1===e.get_targets().length&&e.get_initiator().equals(e.get_targets()[0])?t=e.get_initiator().get_isUser()?o._getLocString("activityMessageUserLeftGroup"):s.format(o._getLocString("activityMessageMemberLeftGroup"),e.get_initiator().get_contact().get_displayName()):(r=l._getTargetNames(e.get_targets(),e.get_initiator()),r&&(t=s.format(o._getLocString("activityMessageRemoveMembers"),n,r)));break;case i.topicUpdate:t=s.format(o._getLocString("activityMessageTopicUpdate"),n,e.get_otherInfo());break;case i.pictureUpdate:t=s.format(o._getLocString("activityMessagePictureUpdate"),n);break;case i.fileShared:t=e.get_initiator().get_isUser()?o._getLocString("activityMessageUserSharedFile"):s.format(o._getLocString("activityMessageMemberSharedFile"),e.get_initiator().get_contact().get_displayName());break;case i.contactShared:t=e.get_initiator().get_isUser()?o._getLocString("activityMessageUserSharedContact"):s.format(o._getLocString("activityMessageMemberSharedContact"),e.get_initiator().get_contact().get_displayName())}return t},l.isChatViewVisible=function(){return null==c&&(c=t.getElementById("chat_view")),"none"!==c.style.display},l._getTargetNames=function(e,t){var n=[];if(null!=e&&e.length>0)for(var i=s.IEnumerator.getEnumerator(e);i.moveNext();){var o=i.get_current();o!==t&&n.push(o.get_contact().get_displayName())}return n.join(", ")},l._getTimeFormat=function(e){var t=o._getLocStringNS("live.shared.marketinfo.webim.client.TimeReceivedFormat"),n=e.getHours(),i=e.getMinutes();return t.format("","","",n>12?n-12:n,n,10>i?"0"+i:i,o._getLocStringNS(12>n?"live.shared.strings.webim.client.Am":"live.shared.strings.webim.client.Pm"))}}()}),define("uielement",["webimutility"],function(){!function(e){function t(e){var t=e._template,n=i.createElement("div");return c.isNullOrEmpty(t)?n:(n.innerHTML=t,n.children[0])}var n=window,i=n.document,s=n.MC,o=n.Microsoft.Live.Messenger,r=n.MsgrUI,a=r.EventType,c=n.ss,l="attachEvent",u="detachEvent",d="addEventListener",_="removeEventListener",g=r.UIElement=function(e){var t=this;t._element=e,t._internetExplorerEventNames={},t._otherEventNames={},t._internetExplorerEventNames[s.enumToString(a,a.blur)]="onblur",t._internetExplorerEventNames[s.enumToString(a,a.click)]="onclick",t._internetExplorerEventNames[s.enumToString(a,a.focus)]="onfocus",t._internetExplorerEventNames[s.enumToString(a,a.keyPress)]="onkeypress",t._internetExplorerEventNames[s.enumToString(a,a.keyDown)]="onkeydown",t._internetExplorerEventNames[s.enumToString(a,a.mouseDown)]="onmousedown",t._internetExplorerEventNames[s.enumToString(a,a.mouseUp)]="onmouseup",t._internetExplorerEventNames[s.enumToString(a,a.mouseOut)]="onmouseout",t._internetExplorerEventNames[s.enumToString(a,a.scroll)]="onscroll",t._otherEventNames[s.enumToString(a,a.blur)]="blur",t._otherEventNames[s.enumToString(a,a.click)]="click",t._otherEventNames[s.enumToString(a,a.focus)]="focus",t._otherEventNames[s.enumToString(a,a.keyPress)]="keypress",t._otherEventNames[s.enumToString(a,a.keyDown)]="keydown",t._otherEventNames[s.enumToString(a,a.mouseDown)]="mousedown",t._otherEventNames[s.enumToString(a,a.mouseUp)]="mouseup",t._otherEventNames[s.enumToString(a,a.mouseOut)]="mouseout",t._otherEventNames[s.enumToString(a,a.scroll)]="scroll"};g.prototype={_template:null,get_element:function(){return this._element},set_element:function(e){return null!=e&&(this._element=e),e},get_isVisible:function(){return"hidden"!==this._element.style.visibility&&"none"!==this._element.style.display},set_isVisible:function(t){var n=this._element.style;return("hidden"!==n.visibility&&"none"!==n.display)!==t&&(n.visibility=t?"":"hidden",n.display=t?"":"none"),e(this).triggerHandler("propertyChanged",[this,new o.PropertyChangedEventArgs("IsVisible")]),t},get_text:function(){return this._element.innerText},set_text:function(e){return null==e&&(e=""),this._element.innerText=e,e},get_innerHtml:function(){return this._element.innerHTML},set_innerHtml:function(e){return this._element.innerHTML=e,e},onVisualInitialized:function(){},attachEvent:function(e,t){null!=this.get_element()[d]?this.get_element()[d](this._otherEventNames[s.enumToString(a,e)],t,!1):this.get_element()[l](this._internetExplorerEventNames[s.enumToString(a,e)],t)},detachEvent:function(e,t){var n=this;null!=n.get_element()[_]?n.get_element()[_](n._otherEventNames[s.enumToString(a,e)],t,!1):n.get_element()[u](n._internetExplorerEventNames[s.enumToString(a,e)])},addCssClass:function(e,t){var n=this._element.className.split(" ");if(!t)return void(n.contains(e)||(this._element.className=this._element.className+" "+e));var i="_"+e,s=[];n.contains(e)||s.push(e);for(var o=c.IEnumerator.getEnumerator(n);o.moveNext();){var r=o.get_current();r.endsWith(i)||(s.push(r),s.push(r+i))}this._element.className="";for(var a=c.IEnumerator.getEnumerator(s);a.moveNext();){var l=a.get_current();c.isNullOrEmpty(l)||(this._element.className=this._element.className+" "+l)}},removeCssClass:function(e,t){for(var n=this,i="_"+e,s=n._element.className.split(" "),o=[],r=c.IEnumerator.getEnumerator(s);r.moveNext();){var a=r.get_current();t?a===e||a.endsWith(i)||o.push(a):a!==e&&o.push(a)}n._element.className="";for(var l=c.IEnumerator.getEnumerator(o);l.moveNext();){var u=l.get_current();c.isNullOrEmpty(u)||(n._element.className=n._element.className+" "+u)}},addAttribute:function(e,t){c.isNullOrEmpty(e)||c.isNullOrUndefined(t)||this._element.setAttribute(e,t)},removeAttribute:function(e){c.isNullOrEmpty(e)||this._element.removeAttribute(e)},addChild:function(e){null==e.get_element()&&e.set_element(t(e)),this._element.appendChild(e.get_element()),this.addLogicalChild(e)},removeChild:function(e){this._element.removeChild(e.get_element())},insertAt:function(e,n){var i=this;null==n.get_element()&&n.set_element(t(n)),i.get_element().children.length>e?i.get_element().insertBefore(n.get_element(),i.get_element().children[e]):i._element.appendChild(n.get_element()),i.addLogicalChild(n)},addLogicalChild:function(e){e.onVisualInitialized()},clearChildren:function(){this._element.innerHTML=""},findElementById:function(e){if(this._getResourceId()===e)return this._element;for(var t=0;t<this._element.children.length;t++){var n=new g(this._element.children[t]).findElementById(e);if(null!=n)return n}return null},_getResourceId:function(){var e=this._element.wlc_resourceid;if(null==e){var t=null!=this._element.attributes?this._element.attributes.getNamedItem("resourceid"):null;e=null!=t?t.value:"",this._element.wlc_resourceid=e}return e}}}(window.originaljQuery||jQuery)}),define("webimflyout",["uielement"],function(){!function(e){var t=window,n=t.document,i=t.MsgrUI,s=t.ss,o=i.UIElement,r=o.prototype,a=i._flyout=function(e){o.call(this,e)},c=a.prototype=new o;c.constructor=a,c._documentElement$1=null,c._globalClickHandler$1=null,c._globalKeydownHandler=null,c._focusOutTimer$1=-1,c.get_isActivated=function(){return this.get_isVisible()},c.set_isActivated=function(e){return e!==this.get_isVisible()&&(this.get_element().style.visibility=e?"":"hidden",this.get_element().style.display=e?"":"none",e?(this._setCapture$1(),this.get_element().focus()):this._releaseCapture$1()),e},c.onVisualInitialized=function(){r.onVisualInitialized.call(this),this.addCssClass("WebIMFlyout",!1),e(this.get_element()).bind("focusout",s.Delegate.create(this,this._onFocusOut$1))},c._onFocusOut$1=function(){var e=this;-1!==e._focusOutTimer$1&&window.clearTimeout(this._focusOutTimer$1),e._focusOutTimer$1=window.setTimeout(s.Delegate.create(e,function(){e._focusOutTimer$1=-1;for(var t=n.activeElement;e.get_element()!==t&&!s.isNullOrUndefined(t.parentNode);)if(t=t.parentNode,t.parentNode===n.body)return void e.set_isActivated(!1)}),500)},c._setCapture$1=function(){this._documentElement$1=new o(n.documentElement),this._globalClickHandler$1=s.Delegate.create(this,this._onDocumentClick$1),this._globalKeydownHandler=s.Delegate.create(this,this._onDocumentKeydown),this._documentElement$1.attachEvent(i.EventType.mouseUp,this._globalClickHandler$1),this._documentElement$1.attachEvent(i.EventType.keyDown,this._globalKeydownHandler);var e=window.event;s.isNullOrUndefined(e)||(e.cancelBubble=!0,e.returnValue=!1)},c._releaseCapture$1=function(){null!=this._documentElement$1&&(this._documentElement$1.detachEvent(i.EventType.mouseUp,this._globalClickHandler$1),this._documentElement$1.detachEvent(i.EventType.keyDown,this._globalKeydownHandler),this._globalClickHandler$1=null,this._globalKeydownHandler=null,this._documentElement$1=null)},c._onDocumentClick$1=function(){this.get_isActivated()&&this.set_isActivated(!1)},c._onDocumentKeydown=function(n){if(27==n.keyCode&&this.get_isActivated()){this.set_isActivated(!1);for(var i=e(this.get_element()),s=null;(!s||0==s.length)&&i.length>0;){for(;0==i.next().length&&i[0]!=t.document;)i=i.parent();i=i.nextAll(),s=i.find("a, textarea, button").filter(":visible")}s.length>0&&s[0].focus()}}}(window.originaljQuery||jQuery)}),define("keyboardaccessible",["webimflyout"],function(){!function(){var e=window,t=e.document,n=e.MsgrUI,i=e.ss,s=n.UIElement,o=s.prototype,r=n.KeyboardAccessible=function(e){s.call(this,e)},a=r.prototype=new s;a.constructor=r,a.dispose=function(){},a.onVisualInitialized=function(){o.onVisualInitialized.call(this),this.attachEvent(n.EventType.keyDown,i.Delegate.create(this,this._onKeyDown$1))},a._onMoveUp$1=function(e){if(this.get_element().children.length>1){var n=t.activeElement.parentNode;do if(n=n.previousSibling,i.isNullOrUndefined(n))n=this.get_element().children[this.get_element().children.length-1];else if(n===e.srcElement)break;while(1!==n.nodeType||"hidden"===n.style.visibility||"none"===n.style.display);n.children[0].focus()}},a._onMoveDown$1=function(e){if(this.get_element().children.length>1){var n=t.activeElement.parentNode;do if(n=n.nextSibling,i.isNullOrUndefined(n))n=this.get_element().children[0];else if(n===e.srcElement)break;while(1!==n.nodeType||"hidden"===n.style.visibility||"none"===n.style.display);n.children[0].focus()}},a._onKeyDown$1=function(e){if(9===e.keyCode)return e.returnValue;if(38===e.keyCode)this._onMoveUp$1(e);else{if(40!==e.keyCode)return e.returnValue;this._onMoveDown$1(e)}return e.cancelBubble=!0,e.returnValue=!1,!1}}()}),define("confirmationdialog",["keyboardaccessible"],function(){!function(){var e=window,t=e.MsgrUI,n=e.ss,i=t._flyout,s=i.prototype,o=t._confirmationDialog=function(){i.call(this)},r=o.prototype=new i;r.constructor=o,r._confirmationText$2=null,r._acceptButtonText$2=null,r._onAccept$2=null,r._dialogText$2=null,r._acceptButton$2=null,r._template=t._templates._confirmationDialog,r.get_isActivated=function(){return s.get_isActivated.call(this)},r.set_isActivated=function(e){return this._dialogText$2.set_text(this._confirmationText$2),this._acceptButton$2.set_text(this._acceptButtonText$2),s.set_isActivated.call(this,e),e},r.onVisualInitialized=function(){s.onVisualInitialized.call(this),this._dialogText$2=new t.UIElement(this.findElementById("DialogText")),this._acceptButton$2=new t.UIElement(this.findElementById("AcceptButton")),this._acceptButton$2.attachEvent(t.EventType.click,n.Delegate.create(this,this._onAcceptButtonClicked$2))},r.setContent=function(e,t,n){this._confirmationText$2=e,this._acceptButtonText$2=t,this._onAccept$2=n},r._onAcceptButtonClicked$2=function(){this.set_isActivated(!1),null!=this._onAccept$2&&this._onAccept$2.invoke()}}()}),define("webimcontextmenu",["confirmationdialog"],function(){!function(){var e="t_cbr",t='<a href="#" onclick="return false;" class="ContextMenuItem" role="menuitem">{0}</a>',n='\r\n<a href="#" onclick="return false;" class="ContextMenuItem" role="menu" submenu>\r\n    <span class="ContextMenuText">{0}</span>\r\n    <span class="ContextMenuChevron">\r\n        <img src="{1}"/>\r\n    </span>\r\n</a>',i=window,s=i.document,o=i.MsgrUI,r=o.EventType,a=i.ss,c=o.UIElement,l=o._flyout,u=l.prototype,d=o._contextMenu=function(e){l.call(this,e)},_=d.prototype=new l;_.constructor=d,_._menuItemList$2=null,_._template=o._templates._contextMenu,_.dispose=function(){this.clearMenuItems()},_.onVisualInitialized=function(){u.onVisualInitialized.call(this),this._menuItemList$2=new c(this.findElementById("MenuItemList"))},_.addMenuItem=function(e,i,l,u){var d=new c(s.createElement("li"));this._menuItemList$2.addChild(d),u?(d.set_innerHtml(a.format(n,e,o._templates.messagingImageStrip)),d.get_element().children[0].setAttribute("aria-label",e)):d.set_innerHtml(a.format(t,e));var _=new c(d.get_element().children[0]),g=this,h=function(e){u||g.set_isActivated(!1),a.isNullOrUndefined(i)||i.invoke(e)};return _.attachEvent(r.click,h),_.attachEvent(r.mouseDown,a.Delegate.create(this,this._onMenuItemMouseDown$2)),_.attachEvent(r.mouseUp,a.Delegate.create(this,this._onMenuItemMouseUp$2)),_.attachEvent(r.mouseOut,a.Delegate.create(this,this._onMenuItemMouseUp$2)),a.isNullOrEmpty(l)||_.addAttribute("sutra",l),_
},_.clearMenuItems=function(){this._menuItemList$2.clearChildren()},_._onMenuItemMouseDown$2=function(t){var n;if(null!=t.currentTarget)n=new c(t.currentTarget);else{if(null==t.srcElement)return;n=new c(t.srcElement)}n.addCssClass(e,!1)},_._onMenuItemMouseUp$2=function(t){var n;if(null!=t.currentTarget)n=new c(t.currentTarget);else{if(null==t.srcElement)return;n=new c(t.srcElement)}n.removeCssClass(e,!1)}}()}),define("modernconversationtextbox",["webimcontextmenu"],function(){!function(){var e=window,t=e.MsgrUI,n=t.UIElement,i=t.ModernConversationTextBox=function(e){n.call(this,e)},s=i.prototype=new n;s.constructor=i,s.get_text=function(){return this.get_element().value},s.set_text=function(e){return null==e&&(e=""),this.get_element().value=e,e},s.dispose=function(){},s.onVisualInitialized=function(){}}()}),define("modernconversationinputcontrol",["modernconversationtextbox"],function(){!function(e){var t=window,n=t.document,i=t.MsgrUI,s=t.Microsoft.Live.Messenger,o=t.ss,r=i.UIElement,a=i._modernConversationInputControl=function(e,t){r.call(this,t),this._aggregatedConversation$1=e,this._conversation$1=this._aggregatedConversation$1.get_currentConversation(),this._buddyContact$1=this._conversation$1.get_buddyContact(),this._defaultText$1=i._getLocString("sendMessage")},c=a.prototype=new r;c.constructor=a,c._conversation$1=null,c._aggregatedConversation$1=null,c._buddyContact$1=null,c._defaultText$1=null,c._defaultTextVisible$1=!1,c._maxCharLength$1=400,c._textbox$1=null,c.get_textBox=function(){return this._textbox$1},c.get_disabled=function(){return this._textbox$1.get_element().getAttribute("disabled")},c.set_disabled=function(e){return this.get_disabled()!==e&&(e?this._textbox$1.addAttribute("disabled","true"):this._textbox$1.removeAttribute("disabled")),e},c.addText=function(e){this._defaultTextVisible$1?(this._hideDefaultText$1(),this._textbox$1.set_text(e)):this._textbox$1.set_text(this._textbox$1.get_text()+e)},c.dispose=function(){e(this._aggregatedConversation$1).unbind("currentConversationChanged",o.Delegate.create(this,this._onCurrentConversationChanged$1)),this._textbox$1.detachEvent(i.EventType.blur,o.Delegate.create(this,this._onBlur$1)),this._textbox$1.detachEvent(i.EventType.focus,o.Delegate.create(this,this._onFocus$1)),this._textbox$1.detachEvent(i.EventType.keyDown,o.Delegate.create(this,this._onKeyDown$1))},c.onVisualInitialized=function(){e(this._aggregatedConversation$1).bind("currentConversationChanged",o.Delegate.create(this,this._onCurrentConversationChanged$1)),this._textbox$1=new i.ModernConversationTextBox(this.findElementById("TextBox")),this._textbox$1.addAttribute("aria-label",this._defaultText$1),this._textbox$1.attachEvent(i.EventType.blur,o.Delegate.create(this,this._onBlur$1)),this._textbox$1.attachEvent(i.EventType.focus,o.Delegate.create(this,this._onFocus$1)),this._textbox$1.attachEvent(i.EventType.keyDown,o.Delegate.create(this,this._onKeyDown$1))},c._checkForOverflow$1=function(){this._textbox$1.get_text().length>this._maxCharLength$1&&this._textbox$1.set_text(this._textbox$1.get_text().substring(0,this._maxCharLength$1-1))},c._showDefaultText$1=function(){this._textbox$1.set_text(this._defaultText$1),this._defaultTextVisible$1=!0,this.addCssClass("DefaultText",!0)},c._hideDefaultText$1=function(){this._textbox$1.set_text(""),this._defaultTextVisible$1=!1,this.removeCssClass("DefaultText",!0)},c._onBlur$1=function(){this._defaultTextVisible$1||""!==this._textbox$1.get_text()||this._showDefaultText$1()},c._onFocus$1=function(){this._defaultTextVisible$1&&this._hideDefaultText$1()},c._onKeyDown$1=function(e){this._checkForOverflow$1();var i=null;if(null!=n.parentWindow&&(i=n.parentWindow.event),13!==e.keyCode||e.shiftKey)this._conversation$1.notifyUserTyped(),86===e.keyCode&&e.ctrlKey&&t.setTimeout(o.Delegate.create(this,this._checkForOverflow$1),100);else{var r=this._textbox$1.get_text();""!==r&&(this._conversation$1.sendMessage(new s.TextMessage(r)),this._textbox$1.set_text("")),e.returnValue=!1,null!=i&&(i.returnValue=!1),e.preventDefault&&e.preventDefault()}return e.returnValue},c._onCurrentConversationChanged$1=function(){this._conversation$1=this._aggregatedConversation$1.get_currentConversation()}}(window.originaljQuery||jQuery)}),define("modernconversationtypingcontrol",["modernconversationinputcontrol"],function(){!function(e){var t="Typing.png",n=window,i=n.document,s=n.MsgrUI,o=n.Microsoft.Live.Messenger,r=n.ss,a=s.UIElement,c=s._modernConversationTypingControl=function(e,t){a.call(this,t),this._aggregatedConversation$1=e,this._conversation$1=this._aggregatedConversation$1.get_currentConversation(),this._buddyContact$1=this._conversation$1.get_buddyContact()},l=c.prototype=new a;l.constructor=c,l._conversation$1=null,l._buddyContact$1=null,l._aggregatedConversation$1=null,l._typingText$1=null,l.dispose=function(){e(this._aggregatedConversation$1).unbind("currentConversationChanged",r.Delegate.create(this,this._onCurrentConversationChanged$1)),e(this._conversation$1.get_typingAddresses()).unbind("collectionChanged",r.Delegate.create(this,this._onTypingAddressesChanged$1))},l.onVisualInitialized=function(){e(this._aggregatedConversation$1).bind("currentConversationChanged",r.Delegate.create(this,this._onCurrentConversationChanged$1)),e(this._conversation$1.get_typingAddresses()).bind("collectionChanged",r.Delegate.create(this,this._onTypingAddressesChanged$1));var n=i.createElement("img");n.src=o.MessengerUtility.getImagePath()+t,n.className="TypingControlImage",this.insertAt(0,new a(n)),this._typingText$1=new a(this.findElementById("TypingText")),this.get_element().style.visibility="hidden"},l._onTypingAddressesChanged$1=function(){var e=this._conversation$1.get_typingAddresses().get_count();0===e||1===e&&this._conversation$1.get_typingAddresses().get_item(0).get_isUser()?this.get_element().style.visibility="hidden":(this.get_element().style.visibility="visible",this._typingText$1.set_text(1===e?r.format(s._getLocString("typingIndicator"),this._conversation$1.get_typingAddresses().get_item(0).get_contact().get_displayName()):r.format(s._getLocString("typingIndicatorMultiple"),e)))},l._onCurrentConversationChanged$1=function(){this.get_element().style.visibility="hidden",e(this._conversation$1.get_typingAddresses()).unbind("collectionChanged",r.Delegate.create(this,this._onTypingAddressesChanged$1)),this._conversation$1=this._aggregatedConversation$1.get_currentConversation(),e(this._conversation$1.get_typingAddresses()).bind("collectionChanged",r.Delegate.create(this,this._onTypingAddressesChanged$1))}}(window.originaljQuery||jQuery)}),define("modernconversationemoticonpanel",["modernconversationtypingcontrol"],function(){!function(){var e=window,t=e.$B,n=e.document,i=e.MsgrUI,s=e.Microsoft.Live.Messenger,o=e.ss,r=i._flyout,a="Facebook",c="Google",l="emoji_strip_messenger.png",u="emoji_strip_facebook.png",d="emoji_strip_google.png",_="EmoticonImage",g="EmoticonAnchor",h=35,p=[[":)",":(",":d","(cool)",":o",";)"],[";(",":|",":*",":P",":$","|-)"],["|(","(inlove)","(yawn)","(doh)",":@","(wasntme)"],["(party)","(worry)","(mm)","(nerd)",":x","(hi)"],["(devil)","(angel)","(envy)","(wait)","(wonder)","(giggle)"],["(clap)","(think)","(bow)","(rofl)","(smirk)","(nod)"],["(yes)","(no)","(love)","(flower)","(rain)","(sun)"],["(music)","(bandit)","(tmi)","(coffee)","(pi)","(cash)"],["(flex)","(cake)","(beer)","(drink)","(dance)","(star)"]],f=[[":)",":(",":D",":o",":p",";("],[";)","(love)"]],m=[[":)",":(",":D",":p",";(",";)"],["(love)"]],v=i._modernConversationEmoticonPanel=function(e,t){r.call(this,e),this._inputControl$2=t},C=v.prototype=new r;C.constructor=v,C._messengerEmoticonPicker$2=null,C._facebookEmoticonPicker$2=null,C._googleEmoticonPicker$2=null,C._inputControl$2=null,C.dispose=function(){this._messengerEmoticonPicker$2=null,this._facebookEmoticonPicker$2=null,this._googleEmoticonPicker$2=null},C.onVisualInitialized=function(){var e=this;e._messengerEmoticonPicker$2=new i.KeyboardAccessible(e.findElementById("MessengerEmoticons")),e._facebookEmoticonPicker$2=new i.KeyboardAccessible(e.findElementById("FacebookEmoticons")),e._googleEmoticonPicker$2=new i.KeyboardAccessible(e.findElementById("GoogleEmoticons")),e.addLogicalChild(e._messengerEmoticonPicker$2),e.addLogicalChild(e._facebookEmoticonPicker$2),e.addLogicalChild(e._googleEmoticonPicker$2),e._addEmoticons$2(p,e._messengerEmoticonPicker$2,s.MessengerUtility.getEmoticonUrlPath()+l),e._addEmoticons$2(f,e._facebookEmoticonPicker$2,s.MessengerUtility.getEmoticonUrlPath()+u),e._addEmoticons$2(m,e._googleEmoticonPicker$2,s.MessengerUtility.getEmoticonUrlPath()+d)},C.show=function(e){var t=this;t.set_isActivated(!0),e===a?(t._messengerEmoticonPicker$2.set_isVisible(!1),t._googleEmoticonPicker$2.set_isVisible(!1),t._facebookEmoticonPicker$2.set_isVisible(!0),t._facebookEmoticonPicker$2.get_element().focus()):e===c?(t._messengerEmoticonPicker$2.set_isVisible(!1),t._facebookEmoticonPicker$2.set_isVisible(!1),t._googleEmoticonPicker$2.set_isVisible(!0),t._googleEmoticonPicker$2.get_element().focus()):(t._facebookEmoticonPicker$2.set_isVisible(!1),t._googleEmoticonPicker$2.set_isVisible(!1),t._messengerEmoticonPicker$2.set_isVisible(!0),t._messengerEmoticonPicker$2.get_element().focus())},C._onEmoticonClicked$2=function(e){var t=e.srcElement,n="a"===t.nodeName.toLowerCase()?t.children[0].attributes.getNamedItem("alt").value:t.attributes.getNamedItem("alt").value;this._inputControl$2.get_disabled()||(this._inputControl$2.get_textBox().get_element().focus(),this._inputControl$2.addText(n)),this.set_isActivated(!1)},C._addEmoticons$2=function(e,s,r){for(var a=e[0].length*h,c=0,l=o.IEnumerator.getEnumerator(e);l.moveNext();){for(var u=l.get_current(),d=0,p=o.IEnumerator.getEnumerator(u);p.moveNext();){var f=p.get_current(),m=n.createElement("img");m.className=_,m.src=r,m.alt=f,m.title=f,m.style.marginTop=-(c*h)+"px",t.ltr?m.style.marginLeft=-(d*h)+"px":m.style.marginRight=-(a-(d+1)*h)+"px";var v=n.createElement("a");v.href="#",v.className=g,v.setAttribute("onclick","return false;"),v.appendChild(m);var C=new i.UIElement(v);C.attachEvent(i.EventType.click,o.Delegate.create(this,this._onEmoticonClicked$2));var y=new i.UIElement(n.createElement("li"));y.addChild(C),s.addChild(y),d++}c++}}}()}),define("groupchatpersonfactory",["modernconversationemoticonpanel","contactpickerv2"],function(){!function(){var e=window,t=e.$Do,n=e.wLive,i=e.$WLXIM,s=e.MsgrUI,o=e.ss;t.when("WLXContactPickerV2",0,function(){var e=n.ContactList.ViewModels.PersonFactory,t=s.GroupChatPersonFactory=function(t){e.call(this,t)},r=t.prototype=new e;r.constructor=t,r.createContacts=function(e){for(var t=[],n=o.IEnumerator.getEnumerator(e.getContacts());n.moveNext();){var s=n.get_current(),r=i.user.findContactById(s.getId());if(!o.isNullOrUndefined(r)&&(null!=r.get_skypeAddress()||null!=r.get_windowsLiveAddress())){var a=this._createCommonModelFromPerson(e),c=e.getContactEmails();t.push(!o.isNullOrUndefined(c)&&c.length>0?this._createContactFromCommonModel(a,c[0]):this._createContactFromCommonModel(a,r.get_skypeAddress()?r.get_skypeAddress().get_skypeName():""));break}}return t}})}()}),define("contactpickercontrol",["groupchatpersonfactory","contactpickerv2"],function(){!function(){var e='<textarea class="cp_textarea"></textarea>',t=300,n=80,i=window,s=i.$WLXIM,o=i.$Config,r=i.$Network,a=i.$Do,c=(i.$ic,i.wLive),l=i.document,u=i.MsgrUI,d=i.ss,_=i.Microsoft.Live.Messenger,g=u.UIElement,h=g.prototype,p=u._contactPickerControl=function(){g.call(this),new g(l.getElementById("sidebar")).addChild(this),this._rosterContacts$1=[]},f=null,m=p.prototype=new g(null);m.constructor=p,m._dataModelOptions$1=null,m._dataModel$1=null,m._pickerModelOptions$1=null,m._contactPickerModel$1=null,m._pickerControlOptions$1=null,m._contactPicker$1=null,m._conversation$1=null,m._groupVersion$1=0,m._rosterContacts$1=null,m._callback$1=null,m._container$1=null,m._addButton$1=null,m._infobar$1=null,m._resetDataModel$1=!1,m._template=u._templates._contactPickerControl,p.get_instance=function(){return null==f&&(f=new p),f},m.get_conversation=function(){return this._conversation$1},m.onVisualInitialized=function(){h.onVisualInitialized.call(this),this.set_isVisible(!1),this.findElementById("Title").innerText=u._getLocString("addToConversation"),this._addButton$1=new g(this.findElementById("AddButton")),this._addButton$1.set_text(u._getLocString("add")),this._addButton$1.attachEvent(u.EventType.click,d.Delegate.create(this,this._onAddButtonClicked$1));var e=new g(this.findElementById("CancelButton"));e.set_text(u._getLocString("cancel")),e.attachEvent(u.EventType.click,d.Delegate.create(this,this._onCancelButtonClicked$1)),this._infobar$1=new g(this.findElementById("Infobar")),this._infobar$1.set_text(u._getLocString("contactPickerMaxLimit")),this._infobar$1.set_isVisible(!1)},m.show=function(n,i){var s=this,o=s._conversation$1 instanceof _.GroupConversation?s._conversation$1.get_version():0,r=null==s._conversation$1||s._conversation$1.get_id()!==n.get_id()||s._groupVersion$1!==o;if(s._conversation$1=n,s._groupVersion$1=o,s._callback$1=i,s.set_isVisible(!0),s._populateRosterContacts$1(),null==s._contactPicker$1)s._initialize$1();else if(r||s._resetDataModel$1){var a=c.ContactPickerV2,l=a.ViewModels.ContactPickerModel;s._resetDataModel$1=!1,s._contactPicker$1.dispose(),s._contactPickerModel$1.dispose(),s._dataModel$1.dispose(),s._container$1.clearChildren(),s._container$1.get_element().innerHTML=e,s._pickerModelOptions$1.selectionMaximum=t-s._conversation$1.get_roster().get_count(),s._dataModel$1=new c.ContactList.ViewModels.FlatContactsDataModel(s._dataModelOptions$1),s._contactPickerModel$1=new l(s._dataModel$1,s._pickerModelOptions$1),s._contactPickerModel$1.$.bind(l.Events.selectedContacts,d.Delegate.create(s,s._onContactSelected$1)),s._contactPickerModel$1.$.bind(l.Events.deselectedContacts,d.Delegate.create(s,s._onContactDeselected$1)),s._contactPicker$1=new a.Controls.ContactPicker(s._container$1.get_element(),s._contactPickerModel$1,s._pickerControlOptions$1),s._contactPicker$1.setFocus(),s._showOrHideInfobar$1(!1)}else s._removeSelectedContacts$1(),s._contactPicker$1.setFocus(),s._showOrHideInfobar$1(!1);s._addButton$1.get_element().disabled=!0},m._initialize$1=function(){var e=this;return e._isContactPickerLoaded$1()?(e._dataModelOptions$1={},e._dataModelOptions$1.personFactory=u.GroupChatPersonFactory,e._dataModelOptions$1.personFilterFn=d.Delegate.create(e,e._personFilter$1),e._dataModelOptions$1.includeCategories=!1,e._dataModelOptions$1.includeGroups=!1,e._dataModelOptions$1.includeMeContact=!1,e._pickerModelOptions$1={},e._pickerModelOptions$1.allowDuplicateSelection=!1,e._pickerModelOptions$1.allowFreeformEntry=!1,e._pickerModelOptions$1.selectionMaximum=t-e._conversation$1.get_roster().get_count(),e._pickerControlOptions$1={},e._pickerControlOptions$1.maxHeight=6e3,e._pickerControlOptions$1.contactListBottomMargin=n,e._pickerControlOptions$1.maxLinesInAddressWell=3,e._pickerControlOptions$1.ariaLabel=u._getLocString("contactSearchDefaultText"),e._dataModel$1=new c.ContactList.ViewModels.FlatContactsDataModel(e._dataModelOptions$1),e._contactPickerModel$1=new c.ContactPickerV2.ViewModels.ContactPickerModel(e._dataModel$1,e._pickerModelOptions$1),e._contactPickerModel$1.$.bind(c.ContactPickerV2.ViewModels.ContactPickerModel.Events.selectedContacts,d.Delegate.create(e,e._onContactSelected$1)),e._contactPickerModel$1.$.bind(c.ContactPickerV2.ViewModels.ContactPickerModel.Events.deselectedContacts,d.Delegate.create(e,e._onContactDeselected$1)),e._container$1=new g(e.findElementById("Container")),e._contactPicker$1=new c.ContactPickerV2.Controls.ContactPicker(e._container$1.get_element(),e._contactPickerModel$1,e._pickerControlOptions$1),e._contactPicker$1.setFocus(),void e._showOrHideInfobar$1(!1)):void e._loadContactPicker$1()},m._populateRosterContacts$1=function(){if(this._rosterContacts$1.length=0,null!=this._conversation$1&&this._conversation$1.get_roster().get_count()>0)for(var e=d.IEnumerator.getEnumerator(this._conversation$1.get_roster());e.moveNext();){var t=e.get_current();this._rosterContacts$1.push(t.get_contact().get_id())}},m._personFilter$1=function(e){var t=this._getMwtContact$1(e);return null==t||null==t.get_skypeAddress()&&null==t.get_windowsLiveAddress()||this._rosterContacts$1.contains(t.get_id())?!1:!0},m._onAddButtonClicked$1=function(){this.set_isVisible(!1);var e=this._contactPickerModel$1.selectedContacts();if(e.length>0){for(var t=new Array(e.length),n=0;n<e.length;n++){this._contactPickerModel$1.deselectContactBySelectedContactId(e[n].id());var i=e[n].contact().pwcObject(),s=this._getMwtContact$1(i);t[n]=null!=s.get_skypeAddress()?s.get_skypeAddress():s.get_windowsLiveAddress()}this._resetDataModel$1=!0,this._callback$1.invoke(t)}else this._callback$1.invoke(null)},m._onCancelButtonClicked$1=function(){this.set_isVisible(!1),this._removeSelectedContacts$1(),this._callback$1.invoke(null)},m._removeSelectedContacts$1=function(){var e=this._contactPickerModel$1.selectedContacts();if(e.length>0)for(var t=d.IEnumerator.getEnumerator(e);t.moveNext();){var n=t.get_current();this._contactPickerModel$1.deselectContactBySelectedContactId(n.id())}},m._getMwtContact$1=function(e){for(var t=d.IEnumerator.getEnumerator(e.getContacts());t.moveNext();){var n=t.get_current(),i=s.user.findContactById(n.getId());if(!d.isNullOrUndefined(i)&&(null!=i.get_skypeAddress()||null!=i.get_windowsLiveAddress()))return i}return null},m._showOrHideInfobar$1=function(e){e?(this._infobar$1.set_isVisible(!0),this._pickerControlOptions$1.contactListBottomMargin=n+this._infobar$1.get_element().clientHeight+20,this._contactPicker$1.resetSettings(this._pickerControlOptions$1)):(this._infobar$1.set_isVisible(!1),this._pickerControlOptions$1.contactListBottomMargin=n,this._contactPicker$1.resetSettings(this._pickerControlOptions$1))},m._onContactSelected$1=function(e,n){for(var i=d.IEnumerator.getEnumerator(n.contacts);i.moveNext();){var s=i.get_current();s.error()&&s.error(!1)}this._addButton$1.get_element().disabled=!1,this._conversation$1.get_roster().get_count()+this._contactPickerModel$1.selectedContacts().length>=t&&this._showOrHideInfobar$1(!0)},m._onContactDeselected$1=function(){var e=this._contactPickerModel$1.selectedContacts().length;0===e&&(this._addButton$1.get_element().disabled=!0),this._conversation$1.get_roster().get_count()+e<t&&this._showOrHideInfobar$1(!1)},m._isContactPickerLoaded$1=function(){try{if(d.isNullOrUndefined(c.ContactPickerV2.Controls.ContactPicker)||d.isNullOrUndefined(l.getElementById("cp_inputTemplate")))return!1}catch(e){return!1}return!0},m._loadContactPicker$1=function(){var e=d.format("{0}//{1}/handlers/loadcontactpicker.mvc",window.location.protocol,window.location.hostname);r.fetchXML(e,d.Delegate.create(this,this._onRequestComplete$1),"GET")},m._onRequestComplete$1=function(e){if(!this._isContactPickerLoaded$1()&&200===e.status&&4===e.readyState){d.isNullOrUndefined(o.ContactPickerV2)&&(o.ContactPickerV2={}),d.isNullOrUndefined(o.ContactPickerV2.DefaultAriaLabel)&&(o.ContactPickerV2.DefaultAriaLabel="");var t=l.createElement("div");for(t.innerHTML=e.responseText;t.children.length>0;){var n=t.children[0];if(t.removeChild(n),!d.isNullOrEmpty(n.tagName)&&"script"===n.tagName.toLowerCase()&&"text/javascript"===n.type){var i=l.createElement("script");if(i.type=n.type,n.src)i.src=n.src;else try{i.appendChild(l.createTextNode(n.innerHTML))}catch(s){i.text=n.innerHTML}n=i}l.body.appendChild(n)}$icm.addTemplates(window.icPwcData),a.when("WLXContactPickerV2",0,d.Delegate.create(this,this._initialize$1))}}}()}),define("contacttile",["contactpickercontrol"],function(){!function(e){var t=window,n=window.document,i=t.MsgrUI,s=t.Microsoft.Live.Messenger.PresenceStatus,o="<li><a class='ContactTile' sutra='contacttile' href='#' onclick='return false;'><div class='Chiclet' resourceid='Chiclet' sutra='contacttilechiclet'></div><div class='Name' resourceid='Name' sutra='contacttiledisplayname'></div><div resourceid='AVGlyphs' class='AVGlyphs' sutra='contacttileavglyphs'><div class='VideoGlyph'><img /></div><div class='AudioGlyph'><img /></div></div></a></li>",r=null;i._contactTile=function(t,a){var c=this,l=null,u=null,d=null;c.get_element=function(){return l.get(0)},c.get_contact=function(){return t},c.render=function(){if(!l){if(!r){var t=e(o);t.find("img").attr("src",i._templates.messagingImageStrip),r=n.createDocumentFragment(),r.appendChild(t.get(0))}l=e(r.cloneNode(!0).childNodes[0]),u=l.find("[resourceid='Chiclet']"),d=l.find("[resourceid='AVGlyphs']")}return _(),g(),l.get(0)},c.activate=function(){l.click(h),e(t).bind("propertyChanged",p),e(t.get_presence()).bind("propertyChanged",g)},c.deactivate=function(){l.unbind("click"),e(t).unbind("propertyChanged",p),e(t.get_presence()).unbind("propertyChanged",g)};var _=function(){l.find("[resourceid='Name']").text(t.get_displayName())},g=function(){t.get_presence().get_status()==s.online?u.addClass("Online"):u.removeClass("Online"),t.get_isAudioVideoCapable()?d.show():d.hide(),a&&a.presenceChangedEventHandler(c,t.get_presence().get_status())},h=function(e){!e.isPropagationStopped()&&a&&a.clickEventHandler(c),e.stopPropagation()},p=function(e,t,n){switch(n.get_propertyNamePascal()){case"DisplayName":case"FullName":case"IsIdentityVerified":_();break;case"CurrentAddress":case"IsAppearOfflineTo":g()}}}}(window.originaljQuery||jQuery)}),define("contacttileeventshandler",["contacttile"],function(){!function(){var e=window,t=e.MsgrUI;t._contactTileEventsHandler=function(){var e=this,t=function(){},n=function(){};e.clickEventHandler=t,e.presenceChangedEventHandler=n,e.set_clickEventHandler=function(n){e.clickEventHandler=n&&n instanceof Function?n:t},e.set_presenceChangedEventHandler=function(t){e.presenceChangedEventHandler=t&&t instanceof Function?t:n}}}()}),define("picturegridcontrol",["contacttileeventshandler"],function(){!function(e){var t=window,n=t.$icm,i=t.MsgrUI,s="<div class='PictureGrid GridView'></div>";i._pictureGridControl=function(t,i){var o=this,r=null,a=[];o.get_element=function(){return r.get(0)},o.render=function(){return r||(r=e(s)),e.each(t,function(e,t){var i=n.createICForPerson("icTmMessagingUserTileGridTemplate",t.getId(),{toolTipType:"name"});a.push(i),r.append(i.render())}),r.get(0)},o.activate=function(){e.each(a,function(t,n){n.activate(),e("#"+n.id).click({person:n.person},c)})},o.deactivate=function(){e.each(a,function(t,n){e("#"+n.id).unbind("click",c),n.deactivate()})},o.showAsListView=function(e){e?r.removeClass("GridView"):r.addClass("GridView")};var c=function(e){i&&i instanceof Function&&i(e.data.person,e.srcElement)}}}(window.originaljQuery||jQuery)}),define("contactsearchindexer",["picturegridcontrol"],function(){!function(){var e=window,t=e.MsgrUI;t._contactSearchIndexer=function(){var e=this;e.matchField=function(e){return e.get_displayName()},e.getKeysAndWeights=function(e){var t=e.get_displayName(),n=wLive.Search.Helpers.getSuffixStringsFor(t),i=[];n[0]&&i.push(new wLive.Search.RankSearchKeyWeight(n[0],1.5,1));for(var s=1,o=n.length;o>s;s++)i.push(new wLive.Search.RankSearchKeyWeight(n[s],1,s+1));var r=e.get_emailAddress();if(r){r=r.toLowerCase(),i.push(new wLive.Search.RankSearchKeyWeight(r,.75,1));var a=r.split("@");a.length>1&&a[1]&&i.push(new wLive.Search.RankSearchKeyWeight(a[1],.5,1))}var c=e.get_skypeName();return c&&c.length>0&&(c=c.toLowerCase(),i.push(new wLive.Search.RankSearchKeyWeight(c,.75,1))),i},e.autoComplete=function(e){return e.get_displayName()},e.isValid=function(){return!0},e.compareParents=null,e.comparer=function(e,t){var n=e.get_id(),i=t.get_id(),s=0;return n>i?s=1:i>n&&(s=-1),s}}}()}),define("contactsearchcontrol",["contactsearchindexer"],function(){!function(e){var t=window,n=e(t.document),i=t.$B,s=t.$Do,o=t.MsgrUI,r="<div resourceid='ContactSearch' class='WebIMContactSearch'><div class='ContactSearchBox'><input resourceid='ContactSearchInput' class='ContactSearchInput' type='search' disabled='true' maxlength='50' sutra='contactsearchbox'></input><div class='ContactSearchGlyph' sutra='contactsearchglyph'><img /></div></div><div resourceid='ContactSearchResult' class='ContactSearchResult' sutra='contactsearchresult'><div resourceid='InfoBar' class='ContactSearchInfoBar' sutra='contactsearchinfobar'></div><ul resourceid='ContactSearchList' class='ContactSearchList' sutra='contactsearchlist'></ul></div></div>",a=9,c=13,l=27,u=38,d=40;o._contactSearchControl=function(_){var g=this,h=null,p=null,f=null,m=null,v=null,C=null,y=null,S=_.get_contact().get_id(),$=o._getLocString("contactSearchLoading"),w=!(i.IE&&i.V<=9),I=30;g.get_element=function(){return h.get(0)},g.render=function(){if(!h){h=e(r),p=h.find("[resourceid='ContactSearchInput']"),f=h.find("[resourceid='ContactSearchResult']"),m=h.find("[resourceid='InfoBar']"),v=h.find("[resourceid='ContactSearchList']");var n;t.$Utility.isHighContrast()?n="sb/search":(n="h/command2",h.find("img").addClass("ImageStrip")),n+=i.rtl?"_rtl.png":".png",h.find("img").attr("src",t.$Config.imgsBase+n),m.text(o._getLocString("contactSearchNoResults"))}return b(),h.get(0)},g.activate=function(){s.when("wlxsearchshared",0,x)},g.deactivate=function(){s.remove("wlxsearchshared",0,x),p.unbind("focus",P),p.unbind("keyup",O),p.unbind("keydown",L),n.unbind("click",R)};var b=function(){w?(p.val(""),p.attr("placeholder",$)):p.val($),p.attr("aria-label",$),f.hide(),y=null,n.unbind("click",R)},M=function(){for(var e=_.get_contacts(),n=[],i=0;i<e.get_count();i++)e.get_item(i).get_isEmailOnlyContact()||n.push(e.get_item(i));n=n.sort(A),C=new t.wLive.Search.Indexer(new o._contactSearchIndexer),C.initialize(n)},k=function(t){C||M();for(var n=[],i=[],s=C.getMatches(t,100).result,o=0;o<s.length;o++){var r=s[o];if(r.get_id()!=S){var a=r.get_presence();a&&1==a.get_status()?n.push(r):i.push(r)}}v.empty();var c=t.toLowerCase().split(" ");n=n.sort(A),e.each(n,function(e,t){T(t,c)}),i=i.sort(A),e.each(i,function(e,t){T(t,c)}),n.length+i.length==0?(v.hide(),m.show()):(m.hide(),v.show()),f.show()},E=function(t){var n=v.find("li");if(0!=n.length){if(null==y)y=e(n[0]);else{var i;if(y.removeClass("Hover"),t==d)i=y.next();else{i=y.prev();var s=p.val();p.val(s)}i.length>0&&(y=i)}e(y).addClass("Hover");var o=f.get(0);if(o.scrollHeight>o.clientHeight){var r=n.index(y.get(0));if(o.scrollTop<=r*I&&o.clientHeight+o.scrollTop>=(r+1)*I)return;o.scrollTop=t==d?(r+1)*I-o.clientHeight:r*I}}},T=function(t,n){var i=new o._contactTile(t),s=i.render();e(s).attr("contactid",t.get_id()),D(s,n,t),v.append(s),e(s).click(N)},D=function(t,n,i){for(var s=i.get_displayName(),o=e("<span/>"),r=s.split(" "),a=0;a<r.length;a++){for(var c=r[a],l=!1,u=0;u<n.length;u++){var d=n[u];if(0!=d.length&&c.length>0&&c.toLowerCase().startsWith(d)){l=!0;var _=e("<span class='t_elnk' sutra='contactsearchmatch'/>").text(c.substring(0,d.length)),g=e("<span/>").text(c.substring(d.length));o.append(_).append(g);break}}l||e("<span/>").text(c).appendTo(o),a<r.length-1&&e("<span/>").text(" ").appendTo(o)}e(t).find("[resourceid='Name']").empty().append(o)},A=function(e,t){e.get_displayName().toLowerCase().localeCompare(t.get_displayName().toLowerCase())},x=function(){p.removeAttr("disabled"),p.focus(P),p.keyup(O),p.keydown(L),$=o._getLocString("contactSearchDefaultText"),b()},N=function(n){b();var i=e(n.currentTarget).attr("contactid");t.$WLXIM.startConversationWithContactId(i,"contactList",!0)},P=function(){p.val()==$&&p.val(""),n.click(R)},R=function(e){e.srcElement!=p.get(0)&&e.srcElement!=v.get(0)&&e.srcElement!=m.get(0)&&b()},O=function(t){if(t.keyCode==l)return b(),f.hide(),void p.blur();if(t.keyCode==u||t.keyCode==d)return void E(t.keyCode);if(t.keyCode==c&&y)return void e(y).click();var n=p.val().trim();n?k(n):f.hide()},L=function(e){1==p.is(":focus")&&e.keyCode==a&&b()}}}(window.originaljQuery||jQuery)}),define("peoplecontrol",["contactsearchcontrol"],function(){!function(e){var t=window,n=t.document,i=t.$pwc,s=t.ss,o=t.MsgrUI,r=o.PeopleFilter,a=t.wLive.People,c=a.NetworkID,l=a.SortOrder,u=t.Microsoft.Live.Messenger,d=u.PresenceStatus,_=u.Services.SkyJSHelper,g="<div class='WebIMPeople' sutra='peoplecontrol'><div class='Header' sutra='peoplecontrolheader'><h1 resourceid='Title' class='Title' sutra='peoplecontroltitle'></h1><a resourceid='Filter' class='Filter' sutra='peoplecontrolfilter' href='#' onclick='return false;'><div resourceid='FilterText' class='FilterText'></div><div class='Chevron'><img /></div></a><div resourceid='FilterMenuContainer' class='FilterMenuContainer' sutra='peoplecontrolfilterflyout'></div></div><div resourceid='Status' sutra='peoplecontrolstatus' style='clear: both;'></div><ul resourceid='ContactList' class='ContactList' sutra='peoplecontrollist'></ul></div>",h=20,p="renderComplete";o._peopleControl=function(a){var u=this,f=null,m=null,v=null,C=null,y=null,S=null,$=[],w=new o._contactTileEventsHandler,I=a.get_settings().get_peopleFilter()||r.all,b=0,M=null,k=!1,E={};u.get_element=function(){return f.get(0)},u.render=function(n){if(!f)if(f=e(g),f.find("img").attr("src",o._templates.messagingImageStrip),m=f.find("[resourceid='Filter']"),v=f.find("[resourceid='FilterText']"),C=f.find("[resourceid='FilterMenuContainer']"),y=f.find("[resourceid='Status']"),S=f.find("[resourceid='ContactList']"),f.find("[resourceid='Title']").text(o._getLocString("peopleControlTitle")),y.text(o._getLocString("noOnlineContacts")),n){t.setTimeout(function(){T(!0)},10);var i=function(){k=!0,e(E).unbind(p,i),e(u).triggerHandler(p)};e(E).bind(p,i)}else T();return n&&k&&e(u).triggerHandler(p),f.get(0)},u.activate=function(){i.$persons.bind("changed",V),m.click(R),w.set_clickEventHandler(B),w.set_presenceChangedEventHandler(F),e.each($,function(e,t){t.activate()})},u.deactivate=function(){i.$persons.unbind("changed",V),m.unbind("click"),w.set_clickEventHandler(null),w.set_presenceChangedEventHandler(null),e.each($,function(e,t){t.deactivate()})};var T=function(n){y.hide(),S.empty(),$=[];var i=x();if(0!=i.length||I==r.all&&I==r.available||(I=r.all,a.get_settings().set_peopleFilter(I),i=x()),P(),n){var s=0,o=function(n){var a=i.slice(n,n+h);a.length>0&&(D(a),s+=N($.slice(n,n+h))),a.length<h?t.setTimeout(function(){I==r.available&&0==s&&y.show(),$.length>0?f.show():f.hide(),e(E).triggerHandler(p)},10):t.setTimeout(function(){o(n+h)},10)};t.setTimeout(function(){o(0)},10)}else D(i),I==r.available&&0==N($)&&y.show(),$.length>0?f.show():f.hide()},D=function(t){var i=n.createDocumentFragment();e.each(t,function(e,t){var n=new o._contactTile(t,w);$.push(n),i.appendChild(n.render())}),S.append(i)},A=function(e){var t=[];switch(e){case r.all:case r.available:t.push(c.windowsLive),t.push(c.skype),t.push(c.facebook),t.push(c.google);break;case r.skype:t.push(c.windowsLive),t.push(c.skype);break;case r.facebook:t.push(c.facebook);break;case r.google:t.push(c.google)}return t},x=function(){var t={};t.networks=A(I),t.isIMCapable=!0;var n=i.getPersons(t,l.displayName),s=[],o=a.get_contact();return e.each(n,function(e,t){for(var n=t.getContacts(),i=0;i<n.length;i++){var r=a.findContactById(n[i].getId());if(r&&r.get_currentAddress()&&r!==o){s.push(r);break}}}),s},N=function(t){if(I==r.all)y.hide(),e.each(t,function(t,n){e(n.get_element()).show()});else if(I==r.available)return b=t.length,e.each(t,function(t,n){n.get_contact().get_presence().get_status()!=d.online&&(e(n.get_element()).hide(),b--)}),b;return 0},P=function(){switch(I){case r.all:v.text(o._getLocString("peopleFilterAll"));break;case r.available:v.text(o._getLocString("statusOnline"));break;case r.skype:v.text("Skype");break;case r.facebook:v.text("Facebook");break;case r.google:v.text("Google")}},R=function(e){e.isPropagationStopped()||(M||(M=new o._contextMenu(null),new o.UIElement(C[0]).addChild(M),O()),M.set_isActivated(!0))},O=function(){M.clearMenuItems(),M.addMenuItem(o._getLocString("peopleFilterAll"),U,"flyoutoptionall").addAttribute("filterValue",r.all),M.addMenuItem(o._getLocString("statusOnline"),U,"flyoutoptionavailable").addAttribute("filterValue",r.available);
var e={};e.isIMCapable=!0,e.networks=A(r.skype),_.skypeEnabled&&i.getPersons(e).length>1&&M.addMenuItem("Skype",U,"flyoutoptionskype").addAttribute("filterValue",r.skype);for(var t=s.IEnumerator.getEnumerator(a.get_networks());t.moveNext();){var n=t.get_current();n.get_isFacebook()&&n.get_supportsIM()&&(e.networks=A(r.facebook),i.getPersons(e).length>0&&M.addMenuItem("Facebook",U,"flyoutoptionfacebook").addAttribute("filterValue",r.facebook)),n.get_isGoogle()&&n.get_supportsIM()&&(e.networks=A(r.google),i.getPersons(e).length>0&&M.addMenuItem("Google",U,"flyoutoptiongoogle").addAttribute("filterValue",r.google))}},L=function(e){var t="";switch(e){case r.all:t="AllContacts";break;case r.available:t="Available";break;case r.skype:t="Skype";break;case r.facebook:t="Facebook";break;case r.google:t="Google"}return t},H=function(e){var n={};n.filterChangedFrom=L(I),n.filterChangedTo=L(e),t.$BSI.reportEvent("WebIM.PeopleFilterChanged",n)},U=function(n){if(n){var i=n.currentTarget||n.target;if(i&&i.getAttribute){var s=i.getAttribute("filterValue");if(s&&(s=parseInt(s),s!=I)){if(H(s),I==r.all&&s==r.available||I==r.available&&s==r.all){I=s,P();var o=0,c=function(e){var n=$.slice(e,e+h);o+=N(n),n.length<h?I==r.available&&0==o&&y.show():t.setTimeout(function(){c(e+h)},10)};t.setTimeout(function(){c(0)},10)}else{I=s,u.deactivate();var l=function(){e(E).unbind(p,l),u.activate()};e(E).bind(p,l),T(!0)}a.get_settings().set_peopleFilter(I)}}}},B=function(e){var n,i,s,o=e.get_contact(),a=o.get_currentAddress();switch(I){case r.skype:o.get_skypeAddress()?a=o.get_skypeAddress():o.get_windowsLiveAddress()&&(a=o.get_windowsLiveAddress());break;case r.facebook:for(n=o.get_addresses(),i=0,s=n.get_count();s>i;i++)if(n.getItem(i).get_network().get_isFacebook()){a=n.getItem(i);break}break;case r.google:for(n=o.get_addresses(),i=0,s=n.get_count();s>i;i++)if(n.getItem(i).get_network().get_isGoogle()){a=n.getItem(i);break}}t.$WLXIM.startConversationWithIMAddress(o,a,"webIMPeopleList",null)},F=function(t,n){if(I==r.available){var i=e(t.get_element());n==d.online?i.is(":visible")||(b++,y.hide(),e(t.get_element()).show()):i.is(":visible")&&(i.hide(),0==--b&&y.show())}},V=function(t,n){var i=n.added,s=n.removed;if(i&&i.length>0||s&&s.length>0){null!=M&&M.dispose(),M=null,C.empty(),u.deactivate();var o=function(){e(E).unbind(p,o),u.activate()};e(E).bind(p,o),T(!0)}}}}(window.originaljQuery||jQuery)}),define("messagingmodulecontrol",["peoplecontrol"],function(){!function(e){var t=window,n=t.$pwc,i=t.ss,s=t.MsgrUI,o=t.Microsoft.Live.Messenger,r=t.wLive.People.SortOrder,a=t.Microsoft.Live.Messenger.GroupConversation,c="<div class='WebIMMessagingModule' sutra='messagingmodule'><h1 resourceid='Title' class='Title t_qtc' sutra='messagingmoduletitle'></h1><div resourceid='Pictures'><div resourceid='PictureGridContainer' class='PictureGridContainer' sutra='picturegrid'></div><div resourceid='ViewAllLink' class='ViewAllLink'><a href='#' onclick='$WLXIM.showSidebar(); $WLXIM.onChatViewBack();' sutra='viewalllink'></a></div></div><div resourceid='Upsell' class='Upsell' sutra='messagingmoduleupsell'><div resourceid='Text' class='Text' sutra='messagingmoduleinfomessage'></div><a resourceid='Link' class='Link Anchor' onclick='$WLXIM.showSidebar(); $WLXIM.onChatViewBack();'><div resourceid='MessagingIcon' class='MessagingIcon t_cbr' sutra='messagingicon'><img /></div><div resourceid='LinkText' class='LinkText' sutra='startnowmessage'></div></a></div><div resourceid='Status' class='Status' sutra='messagingmodulestatus'><div resourceid='Message' class='Message'></div><a resourceid='Link' class='Link'></a></div><div resourceid='StyleOverrideContainer'></div></div>",l=35,u=99,d=35,_=20,g=105,h="<style type='text/css'>.WebIMMessagingModule .c_ic_h_mm_t {{ width: {0}px; }} .WebIMMessagingModule .c_ic_text_h {{ width: {1}px; }} .WebIMMessagingModule .c_ic_text_h .c_ic_name_mm {{ max-width: {1}px; }}</style>";s.MessagingModuleControl=function(p,f){var m=this,v=null,C=null,y=null,S=null,$=null,w=null,I=null,b=null,M=null,k=null,E=null,T=[];m.get_element=function(){return v.get(0)},m.render=function(){return v=e(c),v.find("[resourceid='Title']").text(s._getLocString("messagingTitle")),C=v.find("[resourceid='Pictures']"),y=C.find("[resourceid='PictureGridContainer']"),S=C.find("[resourceid='ViewAllLink']"),S.find("a").text(s._getLocString("messagingModuleViewAll")),$=v.find("[resourceid='Upsell']"),$.find("[resourceid='Text']").text(s._getLocString("MessagingModuleUpsellText")),w=$.find("[resourceid='Link']"),w.find("[resourceid='LinkText']").text(s._getLocString("messagingModuleStartNow")),w.find("img").attr("src",s._templates.messagingImageStrip),I=v.find("[resourceid='Status']"),b=I.find("[resourceid='Message']"),M=I.find("[resourceid='Link']"),k=v.find("[resourceid='StyleOverrideContainer']"),!f||!f.tabIndex&&0!=f.tabIndex||isNaN(f.tabIndex)||v.find("a").attr("tabindex",f.tabIndex),D(!1),v.get(0)},m.activate=function(){e(p).bind("propertyChanged",H),e(p.get_aggregatedConversations()).bind("getMoreConversationsCompleted",U),n.$persons.bind("changed",O),e(t.$WLXIM.sidebar).bind("landingPageControlVisible",R),v.bind("resize",B),E&&(E.activate(),F())},m.deactivate=function(){e(p).unbind("propertyChanged",H),e(p.get_aggregatedConversations()).unbind("getMoreConversationsCompleted",U),n.$persons.unbind("changed",O),e(t.$WLXIM.sidebar).unbind("landingPageControlVisible",R),v.unbind("resize",B),E&&E.deactivate()};var D=function(e){var t=p.get_aggregatedConversations();p.get_status()!==o.UserStatus.signedIn||n.getPersons({isIMCapable:!0}).length>1&&0==t.get_count()&&t.get_hasMoreConversationsOnServer()?A(e):E?($.hide(),I.hide(),C.show()):(T=P(),T.length>0?x():N())},A=function(e){C.hide(),$.hide(),I.show();var n=s._getLocString("messagingPaneSignIn"),i="",r="return false;";e&&(p.get_status()===o.UserStatus.autoReconnectWaiting?(n=s._getLocString("messagingPaneReconnect").format(t.$WLXIM.getReconnectingTime().min+":"+t.$WLXIM.getReconnectingTime().sec),i=s._getLocString("messagingPaneReconnectNow"),r="$WLXIM.reconnect();",t.setTimeout(function(){D(e)},1e3)):p.get_status()===o.UserStatus.signedOut&&(n=s._getLocString("messagingPaneSignOut"),i=s._getLocString("messagingPaneSigninButton"),r="location.reload()")),b.text(n),M.text(i),M.attr("onclick",r),V()},x=function(){$.hide(),I.hide(),C.show(),y.html(""),E=new s._pictureGridControl(T,L),y.append(E.render()),!f||!f.tabIndex&&0!=f.tabIndex||isNaN(f.tabIndex)||y.find(".c_ic a").attr("tabindex",f.tabIndex),F()},N=function(){C.hide(),I.hide(),$.show(),V()},P=function(){var e=12;if(f&&f.containerWidth&&!isNaN(f.containerWidth)){var t=3*Math.floor((f.containerWidth-l)/34);t>e&&(e=t)}var i=n.getPersons({isIMCapable:!0},r.messagingRelevance);if(i.remove(n.getMe()),i.length<=e)return i;var s=p.get_aggregatedConversations().get_items();if(0==s.length)return i.slice(0,2*e);for(var o=[],c=Math.ceil(e/2),u=0;u<s.length&&o.length<c;u++)if(!(s[u].get_currentConversation()instanceof a)){var d=n.getPerson(s[u].get_buddyContact().get_id());d&&o.push(d)}for(u=0;u<i.length&&o.length<e;u++)o.contains(i[u])||o.push(i[u]);return o.sort(function(e,t){return t.getMessagingRelevance()-e.getMessagingRelevance()}),o=o.concat(i.slice(u,u+e))},R=function(e,t){t?S.hide():S.show()},O=function(e,t){var n,i=!1,s=t.added;if(s&&s.length>0){var o=T.length>0?T[T.length-1].getMessagingRelevance():-1;for(n=0;n<s.length;n++)if(s[n].getMessagingAddresses().length>0&&s[n].getMessagingRelevance()>o){i=!0;break}}var r=t.removed;if(!i&&r&&r.length>0)for(n=0;n<r.length;n++)if(T.contains(r[n])){i=!0;break}i&&(E&&(E.deactivate(),E=null),D(!1),E&&E.activate())},L=function(e,n){for(var i=e.getContacts(),s=0;s<i.length;s++){var o=p.findContactById(i[s].getId());if(o&&o.get_currentAddress()){t.$WLXIM.startConversation(o,0,"messagingModule",null,n);break}}},H=function(e,t,n){"Status"==n.get_propertyName()&&D(!0)},U=function(){E||(D(!1),E&&E.activate())},B=function(){C.is(":visible")?F():V()},F=function(){if(E){var t=v.parent().height()-u;t-=(t+5)%d,E.showAsListView(t>=135),y.css("max-height",t+"px"),t>=135&&(k.html(""),k.append(e(i.format(h,v.width(),v.width()-40))))}},V=function(){var e=v.parent().height()-g;e=Math.floor(e/_)*_,$.find("[resourceid='Text']").css("max-height",e),b.css("max-height",e)}}}(window.originaljQuery||jQuery)}),define("favoritescontrol",["messagingmodulecontrol"],function(){!function(e){var t=window,n=t.document,i=t.$pwc,s=t.MsgrUI,o="<div class='WebIMFavorites' sutra='favoritescontrol'><h1 resourceid='Title' class='Title' sutra='favoritestitle' /><ul resourceid='FavoritesList' class='FavoritesList' sutra='favoriteslist'></ul></div>",r="<li><a class='FavoritesItem' sutra='favoritesitem' href='#' onclick='return false;'><div resourceid='UserTile' class='UserTile' sutra='favoritesitemusertile'></div><div class='Name' resourceid='Name' sutra='favoritesitemdisplayname'></div><div resourceid='AVGlyphs' class='AVGlyphs' sutra='favoritesitemavglyphs'><div class='VideoGlyph'><img /></div><div class='AudioGlyph'><img /></div></div></a></li>",a=null;s._favoritesControl=function(c){var l=this,u=null,d=null,_=[],g={};l.get_element=function(){return u.get(0)},l.render=function(){if(!u){u=e(o),d=u.find("[resourceid='FavoritesList']");var t=e(r);t.find("img").attr("src",s._templates.messagingImageStrip),a=n.createDocumentFragment(),a.appendChild(t.get(0))}return u.find("[resourceid='Title']").text(s._getLocString("favoritesTitle")),h(),u.get(0)},l.activate=function(){var t,n;for(t=0,n=_.length;n>t;t++)_[t].activate();var s=u.find("li");for(t=0,n=s.length;n>t;t++)e(s[t]).click(p);e.each(g,function(t){var n=c.findContactById(t);e(n.get_presence()).bind("propertyChanged",f)}),i.$persons.bind("changed",m)},l.deactivate=function(){var t,n;for(t=0,n=_.length;n>t;t++)_[t].deactivate(),_[t].dispose();_=[];var s=u.find("li");for(t=0,n=s.length;n>t;t++)e(s[t]).unbind("click",p);e.each(g,function(t){var n=c.findContactById(t);e(n.get_presence()).unbind("propertyChanged",f)}),i.$persons.unbind("changed",m)};var h=function(){d.empty(),g={};var n=i.getFavorites();n.sort(function(e,t){return e.getDisplayNameWithFallback().localeCompare(t.getDisplayNameWithFallback())});for(var s=0,o=n.length;o>s;s++){var r=n[s];if(r.getMessagingAddresses().length>0){var l=e(a.cloneNode(!0).childNodes[0]),h=t.$icm.createICForPerson("icTmUserTileTemplate",r.getId(),{toolTipType:"name"});_.push(h),l.attr("personid",r.getId()),l.find("[resourceid='UserTile']").append(h.render()),l.find("a.c_ic_frame_clip").attr("tabindex","-1"),l.find("[resourceid='Name']").text(r.getDisplayNameWithFallback()),r.canCall()||l.find("[resourceid='AVGlyphs']").hide(),d.append(l);for(var p=r.getContacts(),f=0;f<p.length;f++){var m=c.findContactById(p[f].getId());if(m){g[m.get_id()]=l;break}}}}0==d.find("li").length?u.hide():u.show()},p=function(n){for(var s=i.getPerson(e(n.currentTarget).attr("personid")),o=s.getContacts(),r=0,a=o.length;a>r;r++)if(c.findContactById(o[r].getId()))return void t.$WLXIM.startConversationWithContactId(o[r].getId(),"favorites",!0)},f=function(e,t){var n=t.get_contact(),i=g[n.get_id()];n.get_isAudioVideoCapable()?i.find("[resourceid='AVGlyphs']").show():i.find("[resourceid='AVGlyphs']").hide()},m=function(e,t){(t.added&&t.added.length>0||t.changed&&t.changed.length>0||t.removed&&t.removed.length>0)&&(l.deactivate(),h(),l.activate())}}}(window.originaljQuery||jQuery)}),define("modernconversationrosteritem",["favoritescontrol"],function(){!function(){var e=window,t=e.MsgrUI,n=e.Microsoft.Live.Messenger,i=t.UIElement,s=t._modernConversationRosterItem=function(e){i.call(this),this._address$1=e},o=s.prototype=new i(null);o.constructor=s,o._address$1=null,o._template=t._templates._modernConversationRosterItem,o.onVisualInitialized=function(){var e=new i(this.findElementById("DisplayName"));e.set_text(this._address$1.get_contact().get_displayName());var t=new i(this.findElementById("StatusBar"));t.set_isVisible(this._address$1.get_presence().get_status()===n.PresenceStatus.online)}}()}),define("modernconversationrostercontrol",["modernconversationrosteritem"],function(){!function(){var e=window,t=e.document,n=e.$WLXIM,i=(e.MC,e.MsgrUI),s=e.Microsoft.Live.Messenger,o=s.Services.SkyJSHelper,r=e.ss,a=i._flyout,c=a.prototype,l=i._modernConversationRosterControl=function(e,t,n){a.call(this,n),this._aggregatedConversation$2=e,this._confirmationDialog$2=t},u=l.prototype=new a;u.prototype=l,u._aggregatedConversation$2=null,u._confirmationDialog$2=null,u.get_isActivated=function(){return c.get_isActivated.call(this)},u.set_isActivated=function(e){return c.set_isActivated.call(this,e),e&&(this.clearChildren(),this._populateChildren$2()),e},u._populateChildren$2=function(){this.get_element().style.bottom="";for(var e=r.IEnumerator.getEnumerator(this._aggregatedConversation$2.get_currentConversation().get_roster());e.moveNext();){var n=e.get_current();if(!n.get_isUser()){var s=new i._modernConversationRosterItem(n);this.addChild(s),s.addAttribute("ctid",n.get_contact().get_id())}}var o=t.documentElement.clientHeight-this.get_element().offsetTop-this.get_element().offsetHeight;this.get_element().style.bottom=90>o?"90px":""},u._onRosterItemClicked$2=function(e){this.set_isActivated(!1);var t=this._aggregatedConversation$2.get_user().findContactById(e.currentTarget.getAttribute("ctid"));if(t.get_isTemporaryContact()){var s=this,a=function(){var e={};e.greeting=r.format(i._getLocString("flyoutsSendInviteGreeting"),t.get_displayName()),e.userId=s._aggregatedConversation$2.get_user().get_skypeAddress().get_address(),e.contactId=t.get_skypeAddress().get_address(),o.getInstance().Outlook.sendRequest(e)};this._confirmationDialog$2.setContent(i._getLocString("flyoutsAddToSkypeText"),i._getLocString("flyoutsAddToSkypeButton"),a),this._confirmationDialog$2.set_isActivated(!0)}else n.startConversation(t)}}()}),define("modernconversationhistoryitem",["modernconversationrostercontrol"],function(){!function(){var e=window,t=e.ss,n=e.MsgrUI,i=e.Microsoft.Live.Messenger,s=n.UIElement,o=n._modernConversationHistoryItem=function(e,t,n){s.call(this),this._message$1=e,this._sent$1=t,this._senderAttribution$1=n},r=o.prototype=new s;r.constructor=o,r._message$1=null,r._sent$1=!1,r._senderAttribution$1=!1,r._template=n._templates._modernConversationHistoryItem,r.onVisualInitialized=function(){var e,o=this._message$1.get_timestamp().getTime().toString(),r=new s(this.findElementById("ModernConversationHistoryItem"));r.addAttribute("aria-labelledby",o),this._sent$1?(r.addCssClass("t_sent",!1),r.addCssClass(n.Utility.backgroundLightThemeClassName,!1),e=new s(this.findElementById("Pointer")),e.addCssClass("t_sent_pointer",!1),e.addCssClass(n.Utility.borderTopLightThemeClassName,!1),this.get_element().scrollIntoView()):(r.addCssClass("t_received",!1),r.addCssClass(n.Utility.backgroundThemeClassName,!1),e=new s(this.findElementById("Pointer")),e.addCssClass("t_received_pointer",!1),e.addCssClass(n.Utility.borderTopThemeClassName,!1));var a=new s(this._message$1.createTextElement(!0,i.EmoticonSize.medium)),c=new s(this.findElementById("Text"));if(c.addChild(a),!this._message$1.get_inviteMessage()){var l=new s(this.findElementById("Timestamp"));l.set_text(n.Utility._getTimeFormat(this._message$1.get_timestamp()));var u=new s(this.findElementById("Label"));if(u.get_element().id=o,this._senderAttribution$1){var d=new s(this.findElementById("Sender"));d.set_text(this._message$1.get_sender().get_contact().get_displayName()),d.set_isVisible(!0),u.set_text(t.format(n._getLocString("receivedMessageLabelWithSender"),d.get_text(),l.get_text(),a.get_text()))}else u.set_text(this._sent$1?t.format(n._getLocString("sentMessageLabel"),l.get_text(),a.get_text()):t.format(n._getLocString("receivedMessageLabel"),l.get_text(),a.get_text()))}}}()}),define("modernconversationhistorycontrol",["modernconversationhistoryitem"],function(){!function(e){function t(e,t,n,i){function o(e){var t=null,n=!1,o=e;if(o.code>=300)t=u.format("{0}:{1}",o.code,o.text),r.Logger.logDetails("InviteAcceptCallbackFailure",{errorDetails:t}),n=!0;else{var a=i.get_buddyAddress();a.set_isPendingInbound(!1),a.changeToSkypeAddress(),s.startConversationWithContactId(i.get_buddyContact().get_id(),null,!0)}r.WebmainHelper.addQoSStats(r.WebmainHelper.qoSApiSkypeAcceptRequest,t,r.WebmainHelper.qoSSkypeAcceptRequestApiStartTime,l,!1),r.WebmainHelper.stopQoS(l,!n,t)}function a(){e._showOrHideInvite$1(!1),i.removeInviteRequest()}a();var l=r.WebmainHelper.startQoS(r.WebmainHelper.qoSScenarioSkypeAcceptRequest);r.WebmainHelper.qoSResetTime(r.WebmainHelper.qoSScenarioSkypeAcceptRequest);var d={},_={};d.userId=t,d.contactId=n,_.data=d,_.success=o,_.error=o,c.Services.SkyJSHelper.getInstance().Outlook.acceptRequest(_)}var n=window,i=n.document,s=n.$WLXIM,o=n.$Config,r=n.MC,a=n.MsgrUI,c=n.Microsoft.Live.Messenger,l=c.MessageType,u=n.ss,d=a.UIElement,_=d.prototype,g="common/spinner_grey_40_transparent.gif",h=a._modernConversationHistoryControl=function(e,t,n,i){d.call(this,t),this._aggregatedConversation$1=e,this._inviteRequestElement$1=new d(n),this._inviteRequestElement$1.set_isVisible(!1),this._modernConversationControl$1=i,this._dayOfWeek$1=a._getLocString("dayOfWeek").split(",")},p=h.prototype=new d;p.constructor=h,p._aggregatedConversation$1=null,p._modernConversationControl$1=null,p._previousMessage$1=null,p._previousTopMessage$1=null,p._itemsContainer$1=null,p._historyLoadingIndicator$1=null,p._inviteRequestElement$1=null,p._dayOfWeek$1=null,p._consumptionHorizonSet$1=!1,p._consumptionHorizonTimeout=-1,p._acceptButton$1=null,p._declineButton$1=null,p._scrollByUserAction=!1,p.dispose=function(){this._consumptionHorizonTimeout>-1&&(n.clearTimeout(this._consumptionHorizonTimeout),this._consumptionHorizonTimeout=-1),e(this._aggregatedConversation$1.get_history()).unbind("collectionChanged",u.Delegate.create(this,this._onConversationHistoryChanged$1)),e(this._aggregatedConversation$1).unbind("propertyChanged",u.Delegate.create(this,this._onConversationPropertyChanged$1)),e(this._aggregatedConversation$1).unbind("sendMessageFailed",u.Delegate.create(this,this._onSendMessageFailed$1))},p.onVisualInitialized=function(){_.onVisualInitialized.call(this),e(this._aggregatedConversation$1.get_history()).bind("collectionChanged",u.Delegate.create(this,this._onConversationHistoryChanged$1)),e(this._aggregatedConversation$1).bind("propertyChanged",u.Delegate.create(this,this._onConversationPropertyChanged$1)),e(this._aggregatedConversation$1).bind("sendMessageFailed",u.Delegate.create(this,this._onSendMessageFailed$1)),this._itemsContainer$1=new a.UIElement(this.findElementById("ItemsContainer")),this.addLogicalChild(this._itemsContainer$1),this._historyLoadingIndicator$1=new d(this.findElementById("Spinner")),this._historyLoadingIndicator$1.get_element().src=o.WebIM.imgBase+g,this._batchInitialRender$1(0)},p._batchInitialRender$1=function(e){var t;t=s.isWac?this._aggregatedConversation$1.get_currentConversation().get_history():this._aggregatedConversation$1.get_history();for(var i=e;i<t.get_count();i++){var o=t.get_item(i);if((o.get_type()===l.textMessage||o.get_type()===l.threadActivityMessage)&&this._addMessage$1(o),i%10===0&&0!==i){var r=this;return void n.setTimeout(function(){r._batchInitialRender$1(i+1)},10)}}this._callAfterRepaint$1(this._aggregatedConversation$1.get_hasMoreHistoryOnServer()?u.Delegate.create(this,this._prefetchHistory$1):u.Delegate.create(this,this._setConsumptionHorizon$1))},p._addMessage$1=function(e,n){var o,r=this;if(e.get_inviteMessage()){if(r._inviteRequestElement$1.get_isVisible())return;o=new a._modernConversationHistoryItem(e instanceof c.TextMessage?e:null,!1,!1),new d(r._inviteRequestElement$1.findElementById("InviteGreeting")).addChild(o);var l=null,_=r._aggregatedConversation$1.get_conversations();for(var g in _)if(_[g].get_id()==e.get_conversationId()){l=_[g];break}return r._acceptButton$1=new d(r._inviteRequestElement$1.findElementById("InviteAccept")),r._acceptButton$1.set_text(a._getLocString("flyoutsAcceptButton")),r._acceptButton$1.attachEvent(a.EventType.click,function(){var n=r._aggregatedConversation$1.get_user().get_skypeAddress().get_address(),i=e.get_sender().get_skypeName();t(r,n,i,l)}),r._declineButton$1=new d(r._inviteRequestElement$1.findElementById("InviteDecline")),r._declineButton$1.set_text(a._getLocString("flyoutsDeclineButton")),r._declineButton$1.attachEvent(a.EventType.click,function(){function t(e){e&&(r._showOrHideInvite$1(!1),l.removeInviteRequest(),l.get_buddyAddress().set_isPendingInbound(!1))}s.showDeclineInviteFlyout(r._declineButton$1.get_element(),r._aggregatedConversation$1.get_buddyContact().get_id(),e.get_sender().get_skypeName(),t,t)}),r._showOrHideInvite$1(!0),void e.set_inviteMessageType(c.InviteMessageType.inviteSeen)}e instanceof c.TextMessage&&u.isNullOrEmpty(e.get_text())||(r._addConversationDivider$1(e,n),e instanceof c.TextMessage?o=e.get_sender().get_isUser()?new a._modernConversationHistoryItem(e instanceof c.TextMessage?e:null,!0,!1):new a._modernConversationHistoryItem(e instanceof c.TextMessage?e:null,!1,r._aggregatedConversation$1.get_currentConversation()instanceof c.GroupConversation):(o=new d(i.createElement("li")),o.addCssClass("ModernConversationHistory_ActivityMessage",!1),o.addAttribute("sutra","activitymessage"),o.set_text(a.Utility.getActivityMessageString(e instanceof c.ThreadActivityMessage?e:null))),n?(r._itemsContainer$1.insertAt(1,o),r._previousTopMessage$1=e):(r._itemsContainer$1.addChild(o),r._previousMessage$1=e),o.addAttribute("ts",e.get_timestamp().getTime().toString()))},p._prefetchHistory$1=function(){this._aggregatedConversation$1.get_hasMoreHistoryOnServer()&&(this.get_element().scrollTop<this.get_element().clientHeight||0===this._aggregatedConversation$1.get_history().get_count())?(this.get_element().scrollTop<=20&&this._historyLoadingIndicator$1.set_isVisible(!0),this._aggregatedConversation$1.getMoreHistory()):this._setConsumptionHorizon$1()},p._addFailedMessage$1=function(){var e=new d(null);this._itemsContainer$1.addChild(e),e.set_text(a._getLocString("failedMessage")),e.addCssClass("ModernConversationControl_TextFailed",!0)},p._addConversationDivider$1=function(e,t){var n=t?this._previousTopMessage$1:this._previousMessage$1,s=this._aggregatedConversation$1.get_currentConversation()instanceof c.GroupConversation;if(u.isNullOrUndefined(n)||e.get_networkName()!==n.get_networkName()||e.get_timestamp().getDate()!==n.get_timestamp().getDate()){var o=new d(i.createElement("li"));t?this._itemsContainer$1.insertAt(0,o):this._itemsContainer$1.addChild(o),o.addCssClass("ModernConversationHistory_ConversationDivider",!1);var r=s?c.Network.get__skype().get_name():"WL"===e.get_networkId()?a._getLocString("networkMessenger"):e.get_networkName();o.set_text(u.format(a._getLocString("conversationDivider"),this._getTimeToDisplay$1(e.get_timestamp()),r))}},p._getTimeToDisplay$1=function(e){var t=new Date;if(e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate())return a._getLocString("today");if(new Date-e<6048e5)return this._dayOfWeek$1[e.getDay()];var n=a._getLocStringNS("live.shared.marketinfo.webim.client.DateReceivedFormat");return n.format(e.getMonth()+1,e.getDate(),e.getFullYear().toString().substr(2),"","","","")},p._setConsumptionHorizon$1=function(){if(!this._consumptionHorizonSet$1){this._consumptionHorizonSet$1=!0;var e,t=this._aggregatedConversation$1.get_consumptionHorizon(),i=0;for(e=s.isWac?this._aggregatedConversation$1.get_currentConversation().get_history():this._aggregatedConversation$1.get_history();i<e.get_count()&&!(e.get_item(i).get_timestamp()>t);i++);if(i>2){for(var o=e.get_item(i-2).get_timestamp().getTime().toString(),r=this._itemsContainer$1.get_element().children,c=0;c<r.length;c++)if(r[c].getAttribute("ts")===o){var l=this;l._consumptionHorizonTimeout=n.setTimeout(function(){l.get_element().scrollTop=r[c].offsetTop,l._consumptionHorizonTimeout=-1},1e3);break}}else this.get_element().scrollTop=0;this.attachEvent(a.EventType.scroll,u.Delegate.create(this,this._onScroll)),this._aggregatedConversation$1.markAllConversationsAsRead()}},p._showOrHideInvite$1=function(e){e?this._inviteRequestElement$1.get_isVisible()||(this._inviteRequestElement$1.set_isVisible(!0),this.get_element().style.top="240px"):this._inviteRequestElement$1.get_isVisible()&&(this.get_element().style.top="130px",this._inviteRequestElement$1.set_isVisible(!1))},p._onScroll=function(){this._scrollByUserAction=!0,this._prefetchHistory$1()},p._onConversationHistoryChanged$1=function(e,t,n){if(this.detachEvent(a.EventType.scroll,u.Delegate.create(this,this._onScroll)),n.get_action()===c.NotifyCollectionChangedAction.add){var i;if(n.get_newItems()[0].get_isHistoryMessage()){for(var s=this.get_element().scrollHeight-this.get_element().scrollTop,o=n.get_newItems().length-1;o>=0;o--)i=n.get_newItems()[o],(i.get_type()===l.textMessage||i.get_type()===l.threadActivityMessage)&&this._addMessage$1(i,!0);this.get_element().scrollTop=this.get_element().scrollHeight-s,this._historyLoadingIndicator$1.set_isVisible(!1),this._callAfterRepaint$1(u.Delegate.create(this,this._prefetchHistory$1))}else{var r=this.get_element().scrollTop,d=!1;this._scrollByUserAction&&this.get_element().scrollHeight-this.get_element().scrollTop>this.get_element().clientHeight&&(d=!0);for(var _=u.IEnumerator.getEnumerator(n.get_newItems());_.moveNext();)i=_.get_current(),(i.get_type()===l.textMessage||i.get_type()===l.threadActivityMessage)&&this._addMessage$1(i);this.get_element().scrollTop=d?r:this.get_element().scrollHeight,a.Utility.isChatViewVisible()&&this.get_isVisible()&&this._aggregatedConversation$1.markAllConversationsAsRead()}}else n.get_action()===c.NotifyCollectionChangedAction.reset&&this._itemsContainer$1.clearChildren();this._consumptionHorizonSet$1&&this.attachEvent(a.EventType.scroll,u.Delegate.create(this,this._onScroll))},p._onConversationPropertyChanged$1=function(e,t,n){"HasMoreHistory"!==n.get_propertyNamePascal()||this._aggregatedConversation$1.get_hasMoreHistoryOnServer()||this._historyLoadingIndicator$1.set_isVisible(!1)},p._onSendMessageFailed$1=function(e,t,n){if(n.get_message().get_type()===l.textMessage){var i=n.get_message();this._addFailedMessage$1(i instanceof c.TextMessage?i:null)}},p._callAfterRepaint$1=function(e){var t=this._itemsContainer$1.get_element().children,i=t.length>0?t[t.length-1]:this._itemsContainer$1.get_element(),s=null;s=function(){0===i.clientWidth?n.setTimeout(s,100):e.invoke()},n.setTimeout(s,100)}}(window.originaljQuery||jQuery)}),define("modernconversationinfobarcontrol",["modernconversationhistorycontrol"],function(){!function(e){var t=window,n=t.$WLXIM,i=t.MsgrUI,s=t.Microsoft.Live.Messenger,o=s.IMAddressType,r=s.NetworkStatus,a=s.PresenceStatus,c=s.UserStatus,l=t.ss,u=i.UIElement,d="anchor",_=i._modernConversationInfoBarControl=function(e,t,n,i,s,o){u.call(this,o),this._aggregatedConversation$1=i,this._user$1=this._aggregatedConversation$1.get_user(),this._contact$1=this._aggregatedConversation$1.get_currentConversation().get_buddyContact(),this._currentContactIMAddress$1=this._aggregatedConversation$1.get_currentConversation().get_buddyAddress(),this._inputControl$1=e,this._emoticonLaunchElement$1=t,this._historyControl$1=n,this._bottomElement$1=s;for(var r=l.IEnumerator.getEnumerator(this._user$1.get_networks());r.moveNext();){var a=r.get_current();a.get_isFacebook()&&(this._facebookNetwork$1=a),a.get_isGoogle()&&(this._googleNetwork$1=a)}},g=_.prototype=new u;g.constructor=_,g._inputControl$1=null,g._currentContactIMAddress$1=null,g._emoticonLaunchElement$1=null,g._historyControl$1=null,g._aggregatedConversation$1=null,g._user$1=null,g._contact$1=null,g._facebookNetwork$1=null,g._googleNetwork$1=null,g._bottomElement$1=null,g._networkOnClicked$1=null,g._groupChatError$1=null,g.onVisualInitialized=function(){var t=this;e(t._aggregatedConversation$1).bind("currentConversationChanged",l.Delegate.create(t,t._onCurrentConversationChanged$1)),e(t._aggregatedConversation$1.get_history()).bind("collectionChanged",l.Delegate.create(t,t._onHistoryCollectionChanged$1)),e(t._user$1).bind("propertyChanged",l.Delegate.create(t,t._onPropertyChanged$1)),e(t._user$1.get_presence()).bind("propertyChanged",l.Delegate.create(t,t._onPropertyChanged$1)),e(t._contact$1).bind("propertyChanged",l.Delegate.create(t,t._onPropertyChanged$1)),e(t._currentContactIMAddress$1).bind("propertyChanged",l.Delegate.create(t,t._onPropertyChanged$1)),e(t._currentContactIMAddress$1.get_linkedContact()).bind("propertyChanged",l.Delegate.create(t,t._onPropertyChanged$1)),null!=t._facebookNetwork$1&&e(t._facebookNetwork$1).bind("propertyChanged",l.Delegate.create(t,t._onPropertyChanged$1)),null!=t._googleNetwork$1&&e(t._googleNetwork$1).bind("propertyChanged",l.Delegate.create(t,t._onPropertyChanged$1)),t._aggregatedConversation$1.get_currentConversation()instanceof s.GroupConversation&&(e(t._aggregatedConversation$1.get_currentConversation()).bind("infoUpdated",l.Delegate.create(t,t._updateInfoBar$1)),e(t._aggregatedConversation$1.get_currentConversation()).bind("operationFailed",l.Delegate.create(t,t._onGroupConversationOperationFailed$1))),t._updateInfoBar$1()},g.dispose=function(){var t=this;e(t._aggregatedConversation$1).unbind("currentConversationChanged",l.Delegate.create(t,t._onCurrentConversationChanged$1)),e(t._aggregatedConversation$1.get_history()).unbind("collectionChanged",l.Delegate.create(t,t._onHistoryCollectionChanged$1)),e(t._user$1).unbind("propertyChanged",l.Delegate.create(t,t._onPropertyChanged$1)),e(t._user$1.get_presence()).unbind("propertyChanged",l.Delegate.create(t,t._onPropertyChanged$1)),e(t._contact$1).unbind("propertyChanged",l.Delegate.create(t,t._onPropertyChanged$1)),e(t._currentContactIMAddress$1).unbind("propertyChanged",l.Delegate.create(t,t._onPropertyChanged$1)),e(t._currentContactIMAddress$1.get_linkedContact()).unbind("propertyChanged",l.Delegate.create(t,t._onPropertyChanged$1)),null!=t._facebookNetwork$1&&e(t._facebookNetwork$1).unbind("propertyChanged",l.Delegate.create(t,t._onPropertyChanged$1)),null!=t._googleNetwork$1&&e(t._googleNetwork$1).unbind("propertyChanged",l.Delegate.create(t,t._onPropertyChanged$1)),t._aggregatedConversation$1.get_currentConversation()instanceof s.GroupConversation&&(e(t._aggregatedConversation$1.get_currentConversation()).unbind("infoUpdated",l.Delegate.create(t,t._updateInfoBar$1)),e(t._aggregatedConversation$1.get_currentConversation()).unbind("operationFailed",l.Delegate.create(t,t._onGroupConversationOperationFailed$1)))},g.setInviteInfo=function(){if(n.isSkypeInvitesEnabled()){var t=this;if(t.set_innerHtml(""),t._currentContactIMAddress$1.get_linkedContact().get_skypeInviteSent())t.set_text(i._getLocString("addContactSent"));else{var s;t._currentContactIMAddress$1.get_linkedContact().get_skypePendingOutbound()?s=l.format(i._getLocString("addContactSentWithResend"),l.format(i._templates.anchorFormat,i._getLocString("addContactResend"))):t._currentContactIMAddress$1.get_type()!==o.shortCircuit||t._currentContactIMAddress$1.get_isPendingInbound()||(s=l.format(i._templates.anchorFormat,i._getLocString("addContact"))),s&&(t.set_innerHtml(s),t._attachAnchorClickEvent$1(t.findElementById(d),function(){e(t).triggerHandler("sendSkypeInvite")}))}}},g.setBlockContactInfo=function(){var e=l.format(i._templates.anchorFormat,i._getLocString("appearOfflineUnblockLink")),t=n.isSkypeBlockEnabled();this.set_innerHtml(l.format(i._getLocString("appearOfflineDefaultText"),t?e:"")),t&&this._attachAnchorClickEvent$1(this.findElementById(d),l.Delegate.create(this,this._onUnblockClicked$1)),this._inputControl$1.set_disabled(!0),this._emoticonLaunchElement$1.get_element().style.visibility="hidden"},g.setUnblockContactInfo=function(){n.unblockPerson(this._aggregatedConversation$1.get_currentConversation().get_buddyContact().get_id(),null,null),this._aggregatedConversation$1.get_currentConversation().get_buddyAddress().get_type()!==o.shortCircuit&&(this._inputControl$1.set_disabled(!1),this.set_innerHtml(""),this._emoticonLaunchElement$1.get_element().style.visibility="visible",e(this).triggerHandler("infobarUpdated"));
for(var t=l.IEnumerator.getEnumerator(this._contact$1.get_linkedContacts());t.moveNext();){var i=t.get_current();i.set_isBlocked(!1)}},g._deleteConversations=function(){var e=this,t=l.IEnumerator.getEnumerator(e._aggregatedConversation$1.get_conversations()),i=e._aggregatedConversation$1.get_conversations().length,s=0;for(e.setDeleteConversationInfo(!1);t.moveNext();){var o=t.get_current();n.user.remove_conversation(o,(new Date).getTime(),function(t){t?(s++,s==i&&e._contact$1.get_id()==o.get_buddyContact().get_id()&&n.onChatViewBack()):e.setDeleteConversationInfo(!0)})}},g.setDeleteConversationInfo=function(t){if(t){var n=l.format(i._templates.anchorFormat,i._getLocString("InfobarDeleteFailedTryAgainText"));this.set_innerHtml(l.format(i._getLocString("InfobarDeleteFailedText"),n)),this._attachAnchorClickEvent$1(this.findElementById(d),l.Delegate.create(this,this._deleteConversations))}else this.set_innerHtml(i._getLocString("InfobarDeleteText"));e(this).triggerHandler("infobarUpdated")},g._updateInfoBar$1=function(){this._update$1(),e(this).triggerHandler("infobarUpdated")},g._update$1=function(){var e=this._contact$1.get_displayName(),t=this._aggregatedConversation$1.get_currentConversation().get_network();if(!l.isNullOrEmpty(this._groupChatError$1))return this.set_text(this._groupChatError$1),void(this._groupChatError$1="");if(this.set_innerHtml(""),this.setInviteInfo(),""!=this.get_innerHtml())return this._inputControl$1.set_disabled(!0),void(this._emoticonLaunchElement$1.get_element().style.visibility="hidden");if(this._aggregatedConversation$1.get_currentConversation().get_buddyAddress().get_linkedContact().get_isBlocked())return this.set_innerHtml(""),void this.setBlockContactInfo();if(null!=this._aggregatedConversation$1.get_currentConversation().get_mostRecentMessage()&&this._aggregatedConversation$1.get_currentConversation().get_mostRecentMessage().get_inviteMessage())return this.set_innerHtml(""),this._inputControl$1.set_disabled(!0),void(this._emoticonLaunchElement$1.get_element().style.visibility="hidden");if(this._aggregatedConversation$1.get_currentConversation().get_buddyAddress().get_type()===o.shortCircuit||this._aggregatedConversation$1.get_currentConversation().get_buddyAddress().get_linkedContact().get_skypePendingOutbound())return this.set_innerHtml(""),this._inputControl$1.set_disabled(!0),void(this._emoticonLaunchElement$1.get_element().style.visibility="hidden");if((t.get_isFacebook()||t.get_isGoogle())&&this._user$1.get_presence().get_status()===a.appearOffline){var n=l.format(i._templates.anchorFormat,i._getLocString("becomeAvailableInfo"));return this.set_innerHtml(l.format(i._getLocString("networkAppearOfflineInfo"),t.get_name(),n)),this._attachAnchorClickEvent$1(this.findElementById(d),l.Delegate.create(this,this._onBecomeAvailableClicked$1)),this._inputControl$1.set_disabled(!0),void(this._emoticonLaunchElement$1.get_element().style.visibility="hidden")}if((t.get_isFacebook()||t.get_isGoogle())&&t.get_status()===r.signedOut){var u=l.format(i._templates.anchorFormat,l.format(i._getLocString("networkTurnOnInfo"),t.get_name()));return this.set_innerHtml(l.format(i._getLocString("networkUserOfflineInfo"),u)),this._networkOnClicked$1=t.get_id(),this._attachAnchorClickEvent$1(this.findElementById(d),l.Delegate.create(this,this._onTurnOnConnectNetworkClicked$1)),this._inputControl$1.set_disabled(!0),void(this._emoticonLaunchElement$1.get_element().style.visibility="hidden")}if((t.get_isFacebook()||t.get_isGoogle())&&t.get_status()===r.signingIn||this._user$1.get_status()===c.signingIn)return this.set_innerHtml(i._getLocString("signingInInfo")),this._inputControl$1.set_disabled(!0),void(this._emoticonLaunchElement$1.get_element().style.visibility="hidden");if((t.get_isFacebook()||t.get_isGoogle())&&t.get_status()===r.signingOut||this._user$1.get_status()===c.signingOut)return this.set_innerHtml(i._getLocString("signingOutInfo")),this._inputControl$1.set_disabled(!0),void(this._emoticonLaunchElement$1.get_element().style.visibility="hidden");if((t.get_isFacebook()||t.get_isGoogle())&&t.get_status()===r.autoReconnectWaiting||this._user$1.get_status()===c.autoReconnectWaiting)return this.set_innerHtml(l.format(i._getLocString("signingInInfo"),30)),this._inputControl$1.set_disabled(!0),void(this._emoticonLaunchElement$1.get_element().style.visibility="hidden");var _=this._aggregatedConversation$1.get_currentConversation().get_buddyAddress();return t.get_isFacebook()&&_.get_presence().get_status()===a.offline&&!_.get_isFacebookMobileEnabled()||t.get_isGoogle()&&_.get_presence().get_status()===a.offline?(this.set_text(l.format(i._getLocString("networkOfflineImInfo"),e,t.get_name())),this._inputControl$1.set_disabled(!1),void(this._emoticonLaunchElement$1.get_element().style.visibility="visible")):_.get_presence().get_status()!==a.offline||this._aggregatedConversation$1.get_currentConversation()instanceof s.GroupConversation||this._aggregatedConversation$1.get_currentConversation().get_supportsOfflineMessages()?(this.set_innerHtml(""),this._inputControl$1.set_disabled(!1),void(this._emoticonLaunchElement$1.get_element().style.visibility="visible")):(this.set_text(l.format(i._getLocString("contactOfflineInfo"),e)),this._inputControl$1.set_disabled(!0),void(this._emoticonLaunchElement$1.get_element().style.visibility="hidden"))},g._attachAnchorClickEvent$1=function(e,t){var n=new u(e);n.attachEvent(i.EventType.click,t)},g._onUnblockClicked$1=function(){this.setUnblockContactInfo()},g._onCurrentConversationChanged$1=function(){e(this._currentContactIMAddress$1).unbind("propertyChanged",l.Delegate.create(this,this._onPropertyChanged$1)),this._currentContactIMAddress$1=this._aggregatedConversation$1.get_currentConversation().get_buddyAddress(),e(this._currentContactIMAddress$1).bind("propertyChanged",l.Delegate.create(this,this._onPropertyChanged$1)),this._updateInfoBar$1()},g._onPropertyChanged$1=function(e,t,n){("Status"===n.get_propertyNamePascal()||"IsOnline"===n.get_propertyNamePascal()||"Block"===n.get_propertyNamePascal()||"SkypePendingOutbound"===n.get_propertyNamePascal())&&this._updateInfoBar$1()},g._onHistoryCollectionChanged$1=function(e,t,n){var i=n.get_newItems();if(i)for(var s=l.IEnumerator.getEnumerator(i);s.moveNext();){var r=s.get_current();if(r.get_sender().get_type()===o.shortCircuit)return void this._updateInfoBar$1()}},g._onTurnOnConnectNetworkClicked$1=function(){var e=null;null!=this._facebookNetwork$1&&this._networkOnClicked$1===this._facebookNetwork$1.get_id()?e=this._facebookNetwork$1:null!=this._googleNetwork$1&&(e=this._googleNetwork$1),null!=e&&e.get_supportsIM()&&e.set_imEnabled(!0)},g._onBecomeAvailableClicked$1=function(){this._user$1.get_presence().get_status()===a.appearOffline?this._user$1.get_presence().set_status(a.online):this._user$1.get_presence().get_status()===a.offline&&this._user$1.signIn()},g._onGroupConversationOperationFailed$1=function(e,t,n){if(t===s.GroupConversationOperationType.addMembers&&n.length>0){for(var o="",r=l.IEnumerator.getEnumerator(n);r.moveNext();){var a=r.get_current();o+=""!==o?", ":"",o+=a.get_contact().get_displayName()}this._groupChatError$1=l.format(i._getLocString("addContactFailed"),o)}this._updateInfoBar$1()}}(window.originaljQuery||jQuery)}),define("modernconversationnetworkmenuitem",["modernconversationinfobarcontrol"],function(){!function(e){var t="●",n=window,i=n.MsgrUI,s=n.ss,o=i.UIElement,r=i._modernConversationNetworkMenuItem=function(){o.call(this)},a=r.prototype=new o;a.constructor=r,a._selectedIndicator$1=null,a._networkAttributionText$1=null,a._address$1=null,a._isSelected$1=!1,a._template=i._templates._modernConversationNetworkMenuItem,a.get_isSelected=function(){return this._isSelected$1},a.set_isSelected=function(e){return this._isSelected$1=e,this._isSelected$1?(this._selectedIndicator$1.get_element().style.visibility="",this._selectedIndicator$1.addAttribute("sutra","networkselected")):(this._selectedIndicator$1.get_element().style.visibility="hidden",this._selectedIndicator$1.removeAttribute("sutra")),e},a.get_address=function(){return this._address$1},a.set_address=function(e){return this._address$1=e,e},a.get_text=function(){return this._networkAttributionText$1.get_text()},a.set_text=function(e){return this._networkAttributionText$1.set_text(e),e},a.onVisualInitialized=function(){this.attachEvent(i.EventType.click,s.Delegate.create(this,this._onClicked$1)),this._selectedIndicator$1=new o(this.findElementById("SelectedIndicator")),this._selectedIndicator$1.set_text(t),this._networkAttributionText$1=new o(this.findElementById("NetworkAttributeName"))},a.dispose=function(){this._networkAttributionText$1=null,this._selectedIndicator$1=null},a._onClicked$1=function(){e(this).triggerHandler("selected",[this])}}(window.originaljQuery||jQuery)}),define("modernconversationnetworkcontrol",["modernconversationnetworkmenuitem"],function(){!function(e){var t=window,n=(t.$B,t.MsgrUI),i=t.ss,s=n.UIElement,o=s.prototype,r=n._modernConversationNetworkControl=function(e,t,i){s.call(this,t.get_element()),this._aggregatedConversation$1=e,this._conversation$1=this._aggregatedConversation$1.get_currentConversation(),this._contextMenu$1=new n._contextMenu(null),i.addChild(this._contextMenu$1),this._contextMenu$1.addAttribute("sutra","networks")},a=r.prototype=new s;a.constructor=r,a._conversation$1=null,a._buddyContact$1=null,a._contextMenu$1=null,a._currentSelectedMenuItem$1=null,a._aggregatedConversation$1=null,a.get_contextMenu=function(){return this._contextMenu$1},a.dispose=function(){this._detachEvents$1()},a.onVisualInitialized=function(){o.onVisualInitialized.call(this),this._attachEvents$1(),this._updateNetworkLabel$1()},a._updateNetworkLabel$1=function(){null!=this._buddyContact$1&&this._buddyContact$1.get_addresses().get_count()>1?(this.get_element().style.cursor="pointer",this.get_element().children[1].style.display=""):(this.get_element().style.cursor="default",this.get_element().children[1].style.display="none")},a._attachEvents$1=function(){e(this._aggregatedConversation$1).bind("currentConversationChanged",i.Delegate.create(this,this._onCurrentConversationChanged$1)),e(this._conversation$1.get_roster()).bind("collectionChanged",i.Delegate.create(this,this._onRosterCollectionChanged$1)),this.attachEvent(n.EventType.click,i.Delegate.create(this,this._onCurrentNetworkLabelClicked$1)),this._conversation$1.get_roster().get_count()<=2&&(this._buddyContact$1=this._conversation$1.get_buddyContact(),null!=this._buddyContact$1&&(e(this._buddyContact$1).bind("propertyChanged",i.Delegate.create(this,this._onContactPropertyChanged$1)),e(this._buddyContact$1.get_presence()).bind("propertyChanged",i.Delegate.create(this,this._onPresencePropertyChanged$1))))},a._detachEvents$1=function(){e(this._aggregatedConversation$1).unbind("currentConversationChanged",i.Delegate.create(this,this._onCurrentConversationChanged$1)),e(this._conversation$1.get_roster()).unbind("collectionChanged",i.Delegate.create(this,this._onRosterCollectionChanged$1)),this.detachEvent(n.EventType.click,i.Delegate.create(this,this._onCurrentNetworkLabelClicked$1)),null!=this._buddyContact$1&&(e(this._buddyContact$1).unbind("propertyChanged",i.Delegate.create(this,this._onContactPropertyChanged$1)),e(this._buddyContact$1.get_presence()).unbind("propertyChanged",i.Delegate.create(this,this._onPresencePropertyChanged$1)))},a._showAvailableNetworks$1=function(){var s=this;if(null!=s._buddyContact$1){var o=s._conversation$1.get_buddyAddress();s._contextMenu$1.clearMenuItems();for(var r=s._getDuplicateNetworksList$1(s._buddyContact$1.get_addresses()),a=i.IEnumerator.getEnumerator(s._buddyContact$1.get_addresses());a.moveNext();){var c=a.get_current(),l=new n._modernConversationNetworkMenuItem,u=s._contextMenu$1.addMenuItem("",null,"");u.addChild(l),l.set_address(c),e(l).bind("selected",i.Delegate.create(s,s._onMenuItemClicked$1)),u.attachEvent(n.EventType.click,i.Delegate.create(s,function(e){e.currentTarget.children[0].click()}));var d=n.Utility.getLocalizedStatusText(c);if(r.contains(c.get_network().get_name())){var _="";_=c.get_network().get_isGoogle()?c.get_linkedContact().get_emailAddress():c.get_linkedContact().get_fullName(),l.set_text(i.format(n._getLocString("networkNameAndStatus"),n.Utility.getNetworkLabel(c.get_network()),_,d))}else l.set_text(i.format(n._getLocString("networkAndStatus"),n.Utility.getNetworkLabel(c.get_network()),d));c.get_id()===o.get_id()&&(l.set_isSelected(!0),s._currentSelectedMenuItem$1=l)}t.setTimeout(i.Delegate.create(s,function(){s._contextMenu$1.set_isActivated(!0);var e=s._contextMenu$1.get_element(),n=e.offsetWidth>170?"30px":"auto";t.$B.ltr?e.style.right=n:e.style.left=n}),250)}},a._getDuplicateNetworksList$1=function(e){for(var t=[],n=[],s=i.IEnumerator.getEnumerator(e);s.moveNext();){var o=s.get_current(),r=o.get_network().get_name();t.contains(r)?n.push(r):t.push(r)}return n},a._onCurrentNetworkLabelClicked$1=function(e){null!=this._buddyContact$1&&this._buddyContact$1.get_addresses().get_count()>1&&this._showAvailableNetworks$1(),i.isNullOrUndefined(e.stopPropagation)?e.cancelBubble=!0:e.stopPropagation()},a._onPresencePropertyChanged$1=function(e,t,n){"Status"===n.get_propertyNamePascal()&&this._updateNetworkLabel$1()},a._onContactPropertyChanged$1=function(e,t,n){"IsContact"===n.get_propertyNamePascal()&&this._updateNetworkLabel$1()},a._onRosterCollectionChanged$1=function(){this._detachEvents$1(),this._conversation$1.get_roster().get_count()<=2&&this._attachEvents$1(),this._updateNetworkLabel$1()},a._onMenuItemClicked$1=function(t,n){this._currentSelectedMenuItem$1.set_isSelected(!1),this._currentSelectedMenuItem$1=n,this._currentSelectedMenuItem$1.set_isSelected(!0);var i=this._aggregatedConversation$1.get_user().get_conversations().create(this._currentSelectedMenuItem$1.get_address());i!==this._aggregatedConversation$1.get_currentConversation()&&this._aggregatedConversation$1.set_currentConversation(i),e(this).triggerHandler("networkMenuItemSelected")},a._onCurrentConversationChanged$1=function(){e(this._conversation$1.get_roster()).unbind("collectionChanged",i.Delegate.create(this,this._onRosterCollectionChanged$1)),this._detachEvents$1(),this._conversation$1=this._aggregatedConversation$1.get_currentConversation(),e(this._conversation$1.get_roster()).bind("collectionChanged",i.Delegate.create(this,this._onRosterCollectionChanged$1)),this._attachEvents$1(),this._updateNetworkLabel$1()}}(window.originaljQuery||jQuery)}),define("modernconversationcontrol",["modernconversationnetworkcontrol"],function(){!function(e){var t=window,n=t.$Utility,i=t.document,s=t.$Config,o=t.$WLXIM,r=t.MC,a=t.MsgrUI,c=t.Microsoft.Live.Messenger,l=c.IMAddressType,u=c.Services.SkyJSHelper,d=t.ss,_=a._templates,g=a.UIElement,h=g.prototype,p=n.isHighContrast()?"emoticon-menu-icon-white.png":"emoticon-menu-icon.png",f="common/spinner_grey_40_transparent.gif",m="webimChatView",v=!0,C=a.ModernConversationControl=function(t,n,i,s){g.call(this),s||(s=o.user),this._contactId$1=null==n?i.get_contact().get_id():n,this._buddyContact$1=s.get_contacts().findByIdWithoutRoleCheck(this._contactId$1),this._aggregatedConversation$1=s.get_aggregatedConversations().getAggregatedConversationByContact(this._buddyContact$1),this._aggregatedConversation$1||(s.get_conversations().create(this._buddyContact$1),this._aggregatedConversation$1=s.get_aggregatedConversations().getAggregatedConversationByContact(this._buddyContact$1)),this._aggregatedConversation$1.get_currentConversation()instanceof c.GroupConversation&&(this._isGroupConversation$1=!0),null==i||this._isGroupConversation$1||this._aggregatedConversation$1.set_currentConversation(s.get_conversations().create(i)),this._parentElement$1=new g(t),this._parentElement$1.addChild(this),null!=this._buddyContact$1&&e(this._buddyContact$1.get_presence()).bind("propertyChanged",d.Delegate.create(this,this._onPresenceChanged$1)),this._isGroupConversation$1&&e(this._aggregatedConversation$1.get_currentConversation()).bind("infoUpdated",d.Delegate.create(this,this._onGroupConversationInfoUpdated$1)),e(s.get_conversations()).bind("conversationDeleted",d.Delegate.create(this,S)),u.skypeAudioVideoEnabled&&(e(u).bind("callStarted",d.Delegate.create(this,this._onCallStarted$1)),e(u).bind("pluginLoaded",d.Delegate.create(this,this._onPluginLoaded$1)),e(u).bind("callFinished",d.Delegate.create(this,this._onCallFinished$1)))},y=C.prototype=new g;y.constructor=C,y._aggregatedConversation$1=null,y._isGroupConversation$1=!1,y._contactId$1=null,y._buddyContact$1=null,y._currentConversationLinkedContact$1=null,y._currentConversationBuddyAddress$1=null,y._parentElement$1=null,y._container$1=null,y._callButtonsElement$1=null,y._videoCallElement$1=null,y._audioCallElement$1=null,y._disableVideoCallElement$1=null,y._disableAudioCallElement$1=null,y._spinningWheelElement$1=null,y._addMembersElement$1=null,y._historyBottom$1=null,y._titleElement$1=null,y._presenceElement$1=null,y._networkElement$1=null,y._rosterCountElement$1=null,y._emoticonLaunchElement$1=null,y._commandMenuElement=null,y._commandContextMenu$1=null,y._confirmationDialog$1=null,y._blockMenu$1=null,y._deleteMenu$1=null,y._unblockMenu$1=null,y._blockAllMenu$1=null,y._unblockAllMenu$1=null,y._sendSkypeInviteElement=null,y._leaveGroupMenu$1=null,y._historyControl$1=null,y._typingControl$1=null,y._networkControl$1=null,y._inputControl$1=null,y._emoticonPanel$1=null,y._infoBarControl$1=null,y._rosterControl$1=null,y._userTileIC=null,y._skypeUpsell=null,y._emoticonPanelElement=null,y._template=d.format(_._modernConversationControl,_.messagingImageStrip),y.get_isVisible=function(){return h.get_isVisible.call(this)},y.set_isVisible=function(e){if(e&&a._contactPickerControl.get_instance().get_isVisible()){var t=a._contactPickerControl.get_instance().get_conversation();if(t&&t===this._aggregatedConversation$1.get_currentConversation())return!1;a._contactPickerControl.get_instance().set_isVisible(!1)}return h.set_isVisible.call(this,e),e},y.dispose=function(){var t=this;e(t).unbind("propertyChanged",d.Delegate.create(t,t._onPropertyChanged$1)),t._aggregatedConversation$1.get_currentConversation()instanceof c.GroupConversation&&e(t._aggregatedConversation$1.get_currentConversation()).unbind("infoUpdated",d.Delegate.create(t,t._onGroupConversationInfoUpdated$1)),e(o.user.get_conversations()).unbind("conversationDeleted",d.Delegate.create(t,S)),e(t._aggregatedConversation$1).unbind("currentConversationChanged",d.Delegate.create(t,t._onCurrentConversationChanged$1)),e(t._infoBarControl$1).unbind("infobarUpdated",d.Delegate.create(t,t._resizeHistoryControl$1)),e(t._infoBarControl$1).unbind("sendSkypeInvite",d.Delegate.create(t,t._sendSkypeInviteFromInfobar)),null!=t._buddyContact$1&&e(t._buddyContact$1.get_presence()).unbind("propertyChanged",d.Delegate.create(t,t._onPresenceChanged$1)),u.skypeAudioVideoEnabled&&(e(u).unbind("callStarted",d.Delegate.create(t,t._onCallStarted$1)),e(u).unbind("pluginLoaded",d.Delegate.create(t,t._onPluginLoaded$1)),e(u).unbind("callFinished",d.Delegate.create(t,t._onCallFinished$1))),t._userTileIC&&(t._userTileIC.deactivate(),t._userTileIC.dispose()),t._historyControl$1.dispose(),t._typingControl$1.dispose(),t._inputControl$1.dispose(),t._emoticonPanel$1.dispose(),t._infoBarControl$1.dispose(),t._historyControl$1=null,t._typingControl$1=null,t._inputControl$1=null,t._emoticonPanel$1=null,t._infoBarControl$1=null,t._historyBottom$1=null,t._container$1.clearChildren(),t._container$1=null,null!=t._networkControl$1&&(e(t._networkControl$1).unbind("networkMenuItemSelected",d.Delegate.create(t,t._onNetworkControlDismissed$1)),t._networkControl$1.dispose(),t._networkControl$1=null),t._emoticonLaunchElement$1.detachEvent(a.EventType.click,d.Delegate.create(t,t._onEmoticonLaunchElementClicked$1)),t._emoticonLaunchElement$1=null},y.onVisualInitialized=function(){var t=this;t.set_isVisible(!0),e(t).bind("propertyChanged",d.Delegate.create(t,t._onPropertyChanged$1)),t._initializeHeader$1(),t._container$1=new g(t.findElementById("Container")),t._historyBottom$1=new g(t.findElementById("HistoryBottom")),t._emoticonLaunchElement$1=new g(t.findElementById("EmoticonLaunch")),t._emoticonLaunchElement$1.addAttribute("aria-label",a._getLocString("addEmoticon")),t._inputControl$1=new a._modernConversationInputControl(t._aggregatedConversation$1,t.findElementById("Input")),t._historyControl$1=new a._modernConversationHistoryControl(t._aggregatedConversation$1,t.findElementById("History"),t.findElementById("InviteRequest"),t),t._typingControl$1=new a._modernConversationTypingControl(t._aggregatedConversation$1,t.findElementById("Typing")),t._emoticonPanelElement=e(t.findElementById("EmoticonPanel")),t._emoticonPanel$1=new a._modernConversationEmoticonPanel(t._emoticonPanelElement[0],t._inputControl$1),t._infoBarControl$1=new a._modernConversationInfoBarControl(t._inputControl$1,t._emoticonLaunchElement$1,t._historyControl$1,t._aggregatedConversation$1,t.findElementById("HistoryBottom"),t.findElementById("InfoBar")),e(t._infoBarControl$1).bind("infobarUpdated",d.Delegate.create(t,t._resizeHistoryControl$1)),e(t._infoBarControl$1).bind("sendSkypeInvite",d.Delegate.create(t,t._sendSkypeInviteFromInfobar)),t._container$1.addLogicalChild(t._inputControl$1),t._container$1.addLogicalChild(t._historyControl$1),t._container$1.addLogicalChild(t._typingControl$1),t._container$1.addLogicalChild(t._emoticonLaunchElement$1),t._container$1.addLogicalChild(t._emoticonPanel$1),t._container$1.addLogicalChild(t._infoBarControl$1),t.addLogicalChild(t._container$1),t._isGroupConversation$1&&t._inputControl$1.set_disabled(t._isGroupMessagingDisabled$1());var n=i.createElement("img");n.src=c.MessengerUtility.getEmoticonUrlPath()+p,t._emoticonLaunchElement$1.addChild(new g(n)),t._emoticonLaunchElement$1.attachEvent(a.EventType.click,d.Delegate.create(t,t._onEmoticonLaunchElementClicked$1)),t._setupSkypUpsell(),e(t._aggregatedConversation$1).bind("currentConversationChanged",d.Delegate.create(t,t._onCurrentConversationChanged$1)),null!=t._aggregatedConversation$1.get_currentConversation()&&(t._currentConversationBuddyAddress$1=t._aggregatedConversation$1.get_currentConversation().get_buddyAddress(),t._currentConversationLinkedContact$1=t._aggregatedConversation$1.get_currentConversation().get_buddyAddress().get_linkedContact(),e(t._currentConversationBuddyAddress$1).bind("propertyChanged",d.Delegate.create(t,t._onContactOrAddressPropertyChanged$1)),e(t._currentConversationLinkedContact$1).bind("propertyChanged",d.Delegate.create(t,t._onContactOrAddressPropertyChanged$1))),e(t._aggregatedConversation$1.get_history()).bind("collectionChanged",function(){t._showOrHideDeleteMenuButton(),t._showOrHideCommandMenuButton()}),t._resizeHistoryControl$1()},y.getContactStatusOnCurrentNetwork=function(){var e=this._aggregatedConversation$1.get_currentConversation().get_buddyAddress();return a.Utility.getLocalizedStatusText(e)},y.getCurrentNetwork=function(){return a.Utility.getNetworkLabel(this._aggregatedConversation$1.get_currentConversation().get_network())},y._enableInputBox=function(){this._inputControl$1.set_disabled(!1),this._emoticonLaunchElement$1.get_element().style.visibility="visible"},y._setupSkypUpsell=function(){var t=this;t._skypeUpsell=e(t._historyBottom$1.findElementById("SkypeUpsell"));var n=t._buddyContact$1.get_skypeAddress();if(n){var i=t._buddyContact$1.get_firstName()||t._buddyContact$1.get_lastName()||t._buddyContact$1.get_displayName(),s="<a href='#' onclick='return false;'>"+a._getLocString("chatViewUpsellSwitch")+"</a>",o="<img src='"+n.get_network().get_iconUrl()+"' />";t._skypeUpsell.html(d.format(a._getLocString("chatViewUpsell"),o,"<span></span>",s)),t._skypeUpsell.find("span").text(i),t._skypeUpsell.find("a").click(function(){var e=t._aggregatedConversation$1.get_user().get_conversations().create(t._buddyContact$1.get_skypeAddress());t._aggregatedConversation$1.set_currentConversation(e)})}t._showOrHideSkypeUpsell()},y._initializeHeader$1=function(){var n=this,i=new g(n.findElementById("Header")),r=new g(i.findElementById("CommandBar")),c=new g(r.findElementById("BackButton"));c.addAttribute("aria-label",a._getLocString("backButton")),c.attachEvent(a.EventType.click,o.onChatViewBack),r.addLogicalChild(c),n._callButtonsElement$1=new g(r.findElementById("CallButtons")),n._initializeCallButtons$1();var l=d.Delegate.create(n,function(){n._aggregatedConversation$1.get_currentConversation().get_roster().get_count()<300?(n.set_isVisible(!1),a._contactPickerControl.get_instance().show(n._aggregatedConversation$1.get_currentConversation(),d.Delegate.create(n,n._onAddContactsCompleted$1))):(n._confirmationDialog$1.setContent(a._getLocString("contactPickerMaxLimit"),a._getLocString("OK"),null),n._confirmationDialog$1.set_isActivated(!0))});n._addMembersElement$1=new g(r.findElementById("AddMembersButton")),n._addMembersElement$1.addAttribute("aria-label",a._getLocString("addButton")),n._addMembersElement$1.attachEvent(a.EventType.click,l),r.addLogicalChild(n._addMembersElement$1),n._showOrHideAddMembersButton$1(),n._commandMenuElement=new g(r.findElementById("CommandMenu")),n._commandMenuElement.attachEvent(a.EventType.click,d.Delegate.create(n,n._onCommandIconClicked$1)),r.addLogicalChild(n._commandMenuElement),n._initializeCommandMenu();var u=new g(r.findElementById("ConfirmationDialogContainer"));if(n._confirmationDialog$1=new a._confirmationDialog,u.addChild(n._confirmationDialog$1),n._titleElement$1=new g(i.findElementById("Title")),n._updateTitle$1(),n._isGroupConversation$1){n._userTileIC=t.$icm.createNonContactIC("icTmGroupTileXLTemplate",this._buddyContact$1.get_displayName());var _=new g(n.findElementById("Roster"));n._rosterCountElement$1=new g(_.findElementById("RosterCount")),_.set_isVisible(!0);var h=d.Delegate.create(n,function(){null==n._rosterControl$1&&(n._rosterControl$1=new a._modernConversationRosterControl(n._aggregatedConversation$1,n._confirmationDialog$1,_.findElementById("RosterContainer")),i.addLogicalChild(n._rosterControl$1));var e=n._aggregatedConversation$1.get_currentConversation().get_roster();0===e.get_count()||n._isUserInGroup$1()&&1===e.get_count()||n._rosterControl$1.set_isActivated(!0)});i.findElementById("Status").style.display="none",n._rosterCountElement$1.attachEvent(a.EventType.click,h),n._updateRosterCount$1()}else{n._userTileIC=t.$pwc.getPerson(this._buddyContact$1.get_id())?t.$icm.createICForPerson("icTmUserTileXLTemplate",this._buddyContact$1.get_id(),{useActiveMessagingAddress:!0,toolTipType:"name"}):t.$icm.createNonContactIC("icTmUserTileXLTemplate",this._buddyContact$1.get_displayName());var p=d.Delegate.create(n,function(){t.open(d.replaceAll(s.WebIM.cdv,"contact_id=","contact_id="+n._buddyContact$1.get_id()))});e(i.findElementById("UserTile")).click(p),n._titleElement$1.attachEvent(a.EventType.click,p),n._titleElement$1.addCssClass("Link",!1),n._presenceElement$1=new g(i.findElementById("Presence")),n._networkElement$1=new g(i.findElementById("Network")),n._networkControl$1=new a._modernConversationNetworkControl(n._aggregatedConversation$1,new g(i.findElementById("NetworkSwitcher")),new g(i.findElementById("NetworkMenuContainer"))),e(n._networkControl$1).bind("networkMenuItemSelected",d.Delegate.create(n,n._onNetworkControlDismissed$1)),n.addLogicalChild(n._networkControl$1),n._updateStatusText$1()}t.setTimeout(function(){var t=e(i.findElementById("UserTile"));t.append(n._userTileIC.render()),n._userTileIC.activate(),n._isGroupConversation$1&&(t.find(".c_ic_frame_clip").css("cursor","default"),n._titleElement$1.get_element().style.cursor="default")},500)},y._initializeCommandMenu=function(){var t=this;if(null==t._commandContextMenu$1){var n=new g(t.findElementById("ContextMenuContainer"));t._commandContextMenu$1=new a._contextMenu(null),n.addChild(t._commandContextMenu$1),t._commandContextMenu$1.addAttribute("sutra","chatviewcontextmenu"),t._deleteMenu$1=t._commandContextMenu$1.addMenuItem(a._getLocString("commandDelete"),d.Delegate.create(t,t._onDeleteClicked),"deleteconversation"),t._blockMenu$1=t._commandContextMenu$1.addMenuItem(a._getLocString("commandBlock"),d.Delegate.create(t,t._onBlockClicked$1),"blockuser"),t._unblockMenu$1=t._commandContextMenu$1.addMenuItem(a._getLocString("commandUnblock"),d.Delegate.create(t,t._onUnblockClicked$1),"unblockuser"),t._blockAllMenu$1=t._commandContextMenu$1.addMenuItem(a._getLocString("commandBlockAll"),d.Delegate.create(t,t._onBlockClicked$1),"blockall"),t._unblockAllMenu$1=t._commandContextMenu$1.addMenuItem(a._getLocString("commandUnblockAll"),d.Delegate.create(t,t._onUnblockClicked$1),"unblockall"),t._sendSkypeInviteElement=t._commandContextMenu$1.addMenuItem(a._getLocString("commandAddToSkype"),d.Delegate.create(t,t._sendSkypeInvite),"addskypecontact"),t._isGroupConversation$1&&(t._leaveGroupMenu$1=t._commandContextMenu$1.addMenuItem(a._getLocString("commandLeaveGroup"),d.Delegate.create(t,t._onLeaveGroupClicked$1),"chatviewleavegroup"))}if(t._updateSendSkypeInviteMenu$1(),t._updateBlockUnblockMenus$1(),t._isGroupConversation$1)t._leaveGroupMenu$1.set_isVisible(t._isUserInGroup$1());else for(var i=t._buddyContact$1.get_linkedContacts(),s=0,o=i.get_count();o>s;s++)e(i.get_item(s)).bind("propertyChanged",function(){t._updateSendSkypeInviteMenu$1(),t._updateBlockUnblockMenus$1(),t._showOrHideCommandMenuButton()});t._showOrHideDeleteMenuButton(),t._showOrHideCommandMenuButton()},y._onAddContactsCompleted$1=function(e){this.set_isVisible(!0),null==e||e.length<=0||(this._isGroupConversation$1?this._aggregatedConversation$1.get_currentConversation().addMembers(e):(e[e.length]=null!=this._aggregatedConversation$1.get_buddyContact().get_skypeAddress()?this._aggregatedConversation$1.get_buddyContact().get_skypeAddress():this._aggregatedConversation$1.get_buddyContact().get_windowsLiveAddress(),this._aggregatedConversation$1.get_user().get_conversations().createGroup(e)))},y._updateTitle$1=function(){var e=this._aggregatedConversation$1.get_currentConversation();this._isGroupConversation$1&&!d.isNullOrEmpty(e.get_title())?this._titleElement$1.set_text(e.get_title()):(this._titleElement$1.set_text(this._buddyContact$1.get_displayName()),this._updateTitleNarratorLabel$1())},y._updateStatusText$1=function(){var e=this._aggregatedConversation$1.get_currentConversation().get_roster().get_item(0);this._presenceElement$1.set_text(""),e.get_type()===l.shortCircuit||e.get_type()===l.skype&&e.get_linkedContact().get_skypePendingOutbound()||this._presenceElement$1.set_text(this.getContactStatusOnCurrentNetwork()+", "),this._networkElement$1.set_text(d.format("{0} ",this.getCurrentNetwork())),this._updateTitleNarratorLabel$1()},y._updateTitleNarratorLabel$1=function(){var e=this._titleElement$1.get_text();d.isNullOrUndefined(this._presenceElement$1)||(e+=" "+this._presenceElement$1.get_text()),d.isNullOrUndefined(this._networkElement$1)||(e+=" "+this._networkElement$1.get_text()),this._titleElement$1.addAttribute("aria-label",e)},y._attachAnchorClickEvent$1=function(e,t){var n=new g(e);n.attachEvent(a.EventType.click,t)},y._updateRosterCount$1=function(){var e=this._aggregatedConversation$1.get_currentConversation().get_roster().get_count();this._rosterCountElement$1.findElementById("Count").innerText=1===e?a._getLocString("rosterCountSingle"):d.format(a._getLocString("rosterCount"),e)},y._initializeCallButtons$1=function(){var e=this;e._videoCallElement$1=new g(e._callButtonsElement$1.findElementById("VideoCallButton")),e._videoCallElement$1.addAttribute("aria-label",a._getLocString("videoButton")),e._videoCallElement$1.attachEvent(a.EventType.click,d.Delegate.create(e,e._onVideoCallIconClicked$1)),e._callButtonsElement$1.addLogicalChild(e._videoCallElement$1),e._disableVideoCallElement$1=new g(e._callButtonsElement$1.findElementById("DisableVideoCallButton")),e._audioCallElement$1=new g(e._callButtonsElement$1.findElementById("AudioCallButton")),e._audioCallElement$1.addAttribute("aria-label",a._getLocString("audioButton")),e._audioCallElement$1.attachEvent(a.EventType.click,d.Delegate.create(e,e._onAudioCallIconClicked$1)),e._callButtonsElement$1.addLogicalChild(e._audioCallElement$1),e._disableAudioCallElement$1=new g(e._callButtonsElement$1.findElementById("DisableAudioCallButton")),u.isCallInProgress?e._disableCallButtons$1():e._enableCallButtons$1(),e._spinningWheelElement$1=new g(e.findElementById("SpinningWheel")),e._spinningWheelElement$1.get_element().src=s.WebIM.imgBase+f,e._spinningWheelElement$1.set_isVisible(!1),(e._isGroupConversation$1||!e._aggregatedConversation$1.get_currentConversation().get_roster().get_item(0).get_isAudioVideoCapable())&&e._callButtonsElement$1.set_isVisible(!1)
},y._setFocus$1=function(){null==this._inputControl$1||this._inputControl$1.get_textBox().get_element().disabled||this._inputControl$1.get_textBox().get_element().focus()},y._onCommandIconClicked$1=function(){var e=this;e._commandContextMenu$1.set_isActivated(!0),e._emoticonPanel$1.set_isActivated(!1)},y._updateSendSkypeInviteMenu$1=function(){if(this._sendSkypeInviteElement.set_isVisible(!1),!this._isGroupConversation$1)for(var e=d.IEnumerator.getEnumerator(this._buddyContact$1.get_addresses());e.moveNext();){var t=e.get_current();if(o.isSkypeInvitesEnabled()){t.get_linkedContact().get_skypeInviteSent()||t.get_isPendingInbound()||t.get_type()!==c.IMAddressType.shortCircuit&&!t.get_linkedContact().get_skypePendingOutbound()||this._sendSkypeInviteElement.set_isVisible(!0);break}}},y._updateBlockUnblockMenus$1=function(){this._blockMenu$1.set_isVisible(!1),this._unblockMenu$1.set_isVisible(!1),this._blockAllMenu$1.set_isVisible(!1),this._unblockAllMenu$1.set_isVisible(!1);var e=!1,t=!1;if(!this._isGroupConversation$1&&o.isSkypeBlockEnabled()){for(var n=0;n<this._buddyContact$1.get_addresses().get_count();n++){var i=this._buddyContact$1.get_addresses().get_item(n).get_linkedContact();if(i.get_isBlockable()){var s=i.get_isBlocked();e=e||s,t=t||!s}}e&&t?(this._blockAllMenu$1.set_isVisible(!0),this._unblockAllMenu$1.set_isVisible(!0)):e?this._unblockMenu$1.set_isVisible(!0):t&&this._blockMenu$1.set_isVisible(!0)}},y._onEmoticonLaunchElementClicked$1=function(){this._emoticonPanel$1.show(this._aggregatedConversation$1.get_currentConversation().get_network().get_name()),d.isNullOrUndefined(this._networkControl$1)||this._networkControl$1.get_contextMenu().set_isActivated(!1)},y._onCurrentConversationChanged$1=function(){this._callButtonsElement$1.set_isVisible(this._aggregatedConversation$1.get_currentConversation().get_roster().get_item(0).get_isAudioVideoCapable()),null!=this._currentConversationLinkedContact$1&&e(this._currentConversationLinkedContact$1).unbind("propertyChanged",d.Delegate.create(this,this._onContactOrAddressPropertyChanged$1)),null!=this._currentConversationBuddyAddress$1&&e(this._currentConversationBuddyAddress$1).unbind("propertyChanged",d.Delegate.create(this,this._onContactOrAddressPropertyChanged$1)),this._currentConversationBuddyAddress$1=this._aggregatedConversation$1.get_currentConversation().get_buddyAddress(),this._currentConversationLinkedContact$1=this._aggregatedConversation$1.get_currentConversation().get_buddyAddress().get_linkedContact(),e(this._currentConversationBuddyAddress$1).bind("propertyChanged",d.Delegate.create(this,this._onContactOrAddressPropertyChanged$1)),e(this._currentConversationLinkedContact$1).bind("propertyChanged",d.Delegate.create(this,this._onContactOrAddressPropertyChanged$1)),this._showOrHideSkypeUpsell(),this._showOrHideAddMembersButton$1(),this._updateStatusText$1(),this._resizeHistoryControl$1()},y._onContactOrAddressPropertyChanged$1=function(){this._updateStatusText$1()},y._onPresenceChanged$1=function(){this._callButtonsElement$1.set_isVisible(this._aggregatedConversation$1.get_currentConversation().get_roster().get_item(0).get_isAudioVideoCapable()),this._updateStatusText$1(),this._resizeHistoryControl$1()},y._onVideoCallIconClicked$1=function(){var e=this._aggregatedConversation$1.get_currentConversation().get_buddyContact();u.getInstance().Outlook.startCall(e.get_skypeName(),e.get_cid(),!0,this._aggregatedConversation$1.get_user().createSkypeInitializationInfo(e),this._aggregatedConversation$1.get_currentConversation().get_network().get_id()),u.reportAudioVideoStarted(!0)},y._onAudioCallIconClicked$1=function(){var e=this._aggregatedConversation$1.get_currentConversation().get_buddyContact();u.getInstance().Outlook.startCall(e.get_skypeName(),e.get_cid(),!1,this._aggregatedConversation$1.get_user().createSkypeInitializationInfo(e),this._aggregatedConversation$1.get_currentConversation().get_network().get_id()),u.reportAudioVideoStarted(!1)},y._resizeHistoryControl$1=function(){var e=this._historyBottom$1.get_element().clientHeight;if(e>0&&(this._historyControl$1.get_element().style.bottom=e+20+"px"),this._emoticonPanelElement&&this._skypeUpsell){var t=this._skypeUpsell.is(":visible")?this._skypeUpsell.height():0;this._emoticonPanelElement.css("bottom",100+t+"px")}},y._enableCallButtons$1=function(){this._disableAudioCallElement$1.set_isVisible(!1),this._disableVideoCallElement$1.set_isVisible(!1),this._audioCallElement$1.set_isVisible(!0),this._videoCallElement$1.set_isVisible(!0)},y._disableCallButtons$1=function(){this._audioCallElement$1.set_isVisible(!1),this._videoCallElement$1.set_isVisible(!1),this._disableAudioCallElement$1.set_isVisible(!0),this._disableVideoCallElement$1.set_isVisible(!0)},y._onPropertyChanged$1=function(e,t,n){"IsVisible"===n.get_propertyNamePascal()&&this._resizeHistoryControl$1()},y._onNetworkControlDismissed$1=function(){this._setFocus$1()},y._onCallStarted$1=function(){this._callButtonsElement$1.get_isVisible()&&this._spinningWheelElement$1.set_isVisible(!0),this._disableCallButtons$1()},y._onPluginLoaded$1=function(){this._spinningWheelElement$1.set_isVisible(!1)},y._onCallFinished$1=function(){this._spinningWheelElement$1.set_isVisible(!1),this._enableCallButtons$1()},y._onGroupConversationInfoUpdated$1=function(){this._updateTitle$1(),this._updateRosterCount$1(),this._addMembersElement$1.set_isVisible(this._isUserInGroup$1()),this._inputControl$1.set_disabled(this._isGroupMessagingDisabled$1()),this._leaveGroupMenu$1.set_isVisible(this._isUserInGroup$1()),this._showOrHideCommandMenuButton()},y._isUserInGroup$1=function(){var e=this._aggregatedConversation$1.get_currentConversation(),t=this._aggregatedConversation$1.get_user().get_contact();return e.rosterContainsAddress(t.get_skypeAddress())||e.rosterContainsAddress(t.get_windowsLiveAddress())},y._isGroupMessagingDisabled$1=function(){return!this._isUserInGroup$1()||1===this._aggregatedConversation$1.get_currentConversation().get_roster().get_count()},y._onLeaveGroupClicked$1=function(){this._confirmationDialog$1.setContent(a._getLocString("confirmationDialogLeaveText"),a._getLocString("confirmationDialogLeaveButton"),d.Delegate.create(this._aggregatedConversation$1.get_currentConversation(),this._aggregatedConversation$1.get_currentConversation().leaveGroup)),this._confirmationDialog$1.set_isActivated(!0)},y._onBlockClicked$1=function(){o.showBlockFlyout(this.get_element(),this._buddyContact$1.get_id(),d.Delegate.create(this,this._blockContactCallback$1),null)},y._onDeleteClicked=function(){var e=this,t={content:a._getLocString("CommandDeleteConfirmText"),anchor:e.get_element(),buttons:{action:a._getLocString("CommandDeleteConfirmButton")},sutra:{flyoutName:"DeleteConfirmationFlyout"},performAction:function(){e._infoBarControl$1._deleteConversations(e._aggregatedConversation$1.get_conversations())}};o.showFlyout(t)},y._onUnblockClicked$1=function(){this._infoBarControl$1.setUnblockContactInfo()},y._sendSkypeInviteFromInfobar=function(){this._sendSkypeInvite(m,!0)},y._sendSkypeInvite=function(e,t){var n=this._aggregatedConversation$1.get_currentConversation().get_buddyAddress();if(u.getInstance().Outlook.isUserLinkStatusActive()){e!=m&&(e="webimMenu"),o.sendSkypeInvite(this._buddyContact$1.get_id(),e,null,null);for(var i=d.IEnumerator.getEnumerator(this._buddyContact$1.get_addresses());i.moveNext();){var s=i.get_current();s.get_network().get_isSkype()&&s.get_linkedContact().set_skypeInviteSent(!0)}n.get_network().get_isSkype()&&this._infoBarControl$1.setInviteInfo()}else o.showConnectToSkypeFlyout(t===!0?this._infoBarControl$1.get_element():this.get_element())},y._showOrHideCommandMenuButton=function(){if(null!=this._commandContextMenu$1){var t=e(this._commandContextMenu$1.get_element()).find("a");this._commandMenuElement.set_isVisible(t.filter(function(){return"none"!=e(this).css("display")}).length>0)}},y._showOrHideDeleteMenuButton=function(){this._deleteMenu$1.set_isVisible(!v&&this._aggregatedConversation$1.get_history().get_count()>0?!0:!1)},y._showOrHideSkypeUpsell=function(){if(this._skypeUpsell.hide(),this._buddyContact$1.get_skypeAddress()){var e=this._aggregatedConversation$1.get_currentConversation().get_buddyAddress();e!=this._buddyContact$1.get_skypeAddress()&&e!=this._buddyContact$1.get_windowsLiveAddress()&&this._skypeUpsell.show()}},y._showOrHideAddMembersButton$1=function(){this._addMembersElement$1.set_isVisible(!1),(this._isGroupConversation$1||null!=this._aggregatedConversation$1.get_user().get_skypeAddress()&&r.GroupChatFeatures.phase===r.GroupChatPhase.creation&&(null!=this._buddyContact$1.get_skypeAddress()||null!=this._buddyContact$1.get_windowsLiveAddress())&&(this._aggregatedConversation$1.get_currentConversation().get_network().get_isSkype()||this._aggregatedConversation$1.get_currentConversation().get_network().get_isWindowsLive()))&&this._addMembersElement$1.set_isVisible(this._isUserInGroup$1())},y._blockContactCallback$1=function(e){if(e){this._inputControl$1.set_disabled(!0),this._infoBarControl$1.setBlockContactInfo(),this._emoticonLaunchElement$1.get_element().style.visibility="hidden",this._resizeHistoryControl$1();for(var t=d.IEnumerator.getEnumerator(this._buddyContact$1.get_linkedContacts());t.moveNext();){var n=t.get_current();n.set_isBlocked(!0)}}};var S=function(e,t){this._buddyContact$1.get_id()==t.get_buddyContact().get_id()&&o.onChatViewBack()}}(window.originaljQuery||jQuery)}),define("recentconversationsconnectedtocontrol",["modernconversationcontrol"],function(){!function(e){var t=window,n=t.document,i=t.MsgrUI,s=t.Microsoft.Live.Messenger.Services.SkyJSHelper,o=t.ss,r=i.UIElement,a=r.prototype,c="Accept",l="Error",u='<a href="#" onclick="return false;" class="RecentConversationsControl_ConnectedToAddLink">{0}</a>',d=i._recentConversationsConnectedToControl=function(e){r.call(this,e)},_=d.prototype=new r;_.constructor=d,_._connectedToText$1=null,_._connectedToAddLink$1=null,_._addLinkVisible$1=!1,_._manageUrlFormat$1=t.$Config.WebIM.pm,_._user$1=null,_.get_user=function(){return this._user$1},_.set_user=function(e){return null!=e&&this._user$1!==e&&(this.dispose(),this._user$1=e,this.onVisualInitialized()),e},_.get_addLinkVisible=function(){return o.isNullOrUndefined(this._connectedToAddLink$1)?!0:this._connectedToAddLink$1.get_isVisible()},_.set_addLinkVisible=function(e){return o.isNullOrUndefined(this._connectedToAddLink$1)||(this._connectedToAddLink$1.set_isVisible(e),this._setConnectedToWidth$1()),this._addLinkVisible$1=e,e},_.dispose=function(){o.isNullOrUndefined(this._user$1)||(e(this._user$1.get_networks()).unbind("propertyChanged",o.Delegate.create(this,this._onNetworksPropertyChanged$1)),this._user$1=null)},_.onVisualInitialized=function(){a.onVisualInitialized.call(this),o.isNullOrUndefined(this._user$1)||(e(this._user$1.get_networks()).bind("propertyChanged",o.Delegate.create(this,this._onNetworksPropertyChanged$1)),this._populateConnectedToBar$1())},_._populateConnectedToBar$1=function(){this.clearChildren();var e=n.createElement("span");e.className="RecentConversationsControl_ConnectedToText",this._connectedToText$1=new r(e),this._connectedToText$1.set_text(i._getLocString("connectedTo")),this.addChild(this._connectedToText$1);for(var t=o.IEnumerator.getEnumerator(this._user$1.get_networks());t.moveNext();){var a=t.get_current();if(s.skypeEnabled||"SKYPE"!==a.get_id()){var d=a.get_id(),_=a.get_tokenState(),g=_===l?a.get_iconErrorUrl():a.get_iconUrl(),h=a.get_supportsIM();if((_===c||_===l||"WL"===d||"SKYPE"===d)&&null!=d&&null!=g&&h){if("SKYPE"===d&&!s.getInstance().Outlook.isUserLinkStatusActive())continue;var p=null,f=n.createElement("img");f.src=g,f.alt=i.Utility.getNetworkLabel(a),f.style.border="0",f.style.padding="0px 5px 0px 5px",a.get_isWindowsLive()||a.get_isSkype()||(p=n.createElement("a"),o.isNullOrEmpty(this._manageUrlFormat$1)||(p.href=o.format(this._manageUrlFormat$1,d)),p.appendChild(f),p.setAttribute("aria-label",o.format(i._getLocString("manageNetwork"),i.Utility.getNetworkLabel(a))));var m=n.createElement("div");m.style.display="inline",m.setAttribute("sutra","connectedtonetworklink");var v=null!=p?p:f;m.appendChild(v),this.addChild(new r(m))}}}var C=n.createElement("div");C.innerHTML=o.format(u,i._getLocString("add")),this._connectedToAddLink$1=new r(C.children[0]),this._connectedToAddLink$1.addAttribute("sutra","connectedtoaddlink"),this._connectedToAddLink$1.addAttribute("aria-label",i._getLocString("addNetworks")),this._connectedToAddLink$1.attachEvent(i.EventType.click,o.Delegate.create(this,this._onConnectedToAddLinkClicked$1)),this.addChild(this._connectedToAddLink$1),this._connectedToAddLink$1.set_isVisible(this._addLinkVisible$1),this._setConnectedToWidth$1()},_._onNetworksPropertyChanged$1=function(){this._populateConnectedToBar$1()},_._onConnectedToAddLinkClicked$1=function(){e(this).triggerHandler("connectedToAddLinkClicked")},_._setConnectedToWidth$1=function(){var t=240;if(this.get_element().scrollWidth>t){var n=t,i=e(this.get_element()).find("img");n-=i.length*i.outerWidth(),this._connectedToAddLink$1.get_isVisible()&&(n-=e(this._connectedToAddLink$1.get_element()).outerWidth()),this._connectedToText$1.get_element().style.maxWidth=n+"px"}}}(window.originaljQuery||jQuery)}),define("recentconversationsitem",["recentconversationsconnectedtocontrol"],function(){!function(e){var t=window,n=t.MsgrUI,i=t.Microsoft.Live.Messenger,s=i.NotifyCollectionChangedAction,o=t.ss,r=n.UIElement,a="UserTile",c="DisplayName",l="MessageText",u="Timestamp",d=n._recentConversationsItem=function(e,t,i){this._lastMessageTimestamp$1=new Date(0),r.call(this,i),this._aggregatedConversation$1=e,this._buddyContact$1=t,this._dayOfWeek$1=n._getLocString("dayOfWeek").split(",")},_=d.prototype=new r;_.constructor=d,_._userTileElement=null,_._nameElement$1=null,_._messageElement$1=null,_._timeElement$1=null,_._aggregatedConversation$1=null,_._buddyContact$1=null,_._dayOfWeek$1=null,_._template=n._templates._recentConversationsItem,_.get_buddyContact=function(){return this._buddyContact$1},_.get_aggregatedConversation=function(){return this._aggregatedConversation$1},_.get_lastMessageTimestamp=function(){return this._lastMessageTimestamp$1},_.dispose=function(){e(this._aggregatedConversation$1).unbind("propertyChanged",o.Delegate.create(this,this._onConversationPropertyChanged$1)),e(this._aggregatedConversation$1).unbind("recentMessageReceived",o.Delegate.create(this,this._onConversationRecentMessageReceived$1)),e(this._aggregatedConversation$1.get_history()).unbind("collectionChanged",o.Delegate.create(this,this._onConversationHistoryChanged$1)),null!=this._buddyContact$1&&e(this._buddyContact$1).unbind("propertyChanged",o.Delegate.create(this,this._onContactPropertyChanged$1)),this.detachEvent(n.EventType.click,o.Delegate.create(this,this._onClicked$1))},_.onVisualInitialized=function(){e(this._aggregatedConversation$1).bind("propertyChanged",o.Delegate.create(this,this._onConversationPropertyChanged$1)),e(this._aggregatedConversation$1).bind("recentMessageReceived",o.Delegate.create(this,this._onConversationRecentMessageReceived$1)),e(this._aggregatedConversation$1.get_history()).bind("collectionChanged",o.Delegate.create(this,this._onConversationHistoryChanged$1)),null!=this._buddyContact$1&&e(this._buddyContact$1).bind("propertyChanged",o.Delegate.create(this,this._onContactPropertyChanged$1)),this.attachEvent(n.EventType.click,o.Delegate.create(this,this._onClicked$1)),this._userTileElement=new r(this.findElementById(a)),this._nameElement$1=new r(this.findElementById(c)),this._messageElement$1=new r(this.findElementById(l)),this._timeElement$1=new r(this.findElementById(u));var s;if(this._aggregatedConversation$1.get_currentConversation()instanceof i.GroupConversation)s=t.$icm.createNonContactIC("icTmGroupTileTemplate",this._buddyContact$1.get_displayName());else{var d=t.$pwc.getPerson(this._buddyContact$1.get_id());s=d?t.$icm.createICForPerson("icTmUserTileTemplate",d.getId(),{toolTipType:"name"}):t.$icm.createNonContactIC("icTmUserTileTemplate",this._buddyContact$1.get_displayName())}e(this._userTileElement.get_element()).append(s.render()),e(this._userTileElement.get_element()).find("a.c_ic_frame_clip").attr("tabindex","-1"),s.activate(),this._updateDisplayName$1();var _=this._aggregatedConversation$1.getMostRecentMessage();return null!=_?void this._updateLastMessage$1(_):(this._aggregatedConversation$1.get_currentConversation()instanceof i.GroupConversation&&e(this._aggregatedConversation$1.get_currentConversation()).bind("infoUpdated",o.Delegate.create(this,this._onGroupConversationInfoUpdated)),void this.set_isVisible(!1))},_.addConversation=function(){this._updateLastMessage$1()},_._updateLastMessage$1=function(t){if(null==t&&(t=this._aggregatedConversation$1.getMostRecentMessage()),null!=t&&this._lastMessageTimestamp$1<t.get_timestamp()){this._lastMessageTimestamp$1=t.get_timestamp();var s;t instanceof i.TextMessage?(s=t.createTextElementNoUrls(!0,i.EmoticonSize.small),e(s).find("br").remove()):s=n.Utility.getActivityMessageElement(t instanceof i.ThreadActivityMessage?t:null),this._messageElement$1.clearChildren(),this._messageElement$1.addChild(new r(s)),this._timeElement$1.set_text(this._getLabelTime$1(t.get_timestamp())),this.get_isVisible()||this.set_isVisible(!0),e(this).triggerHandler("itemAdded",[this]),this._highlightItem$1()}else null==t&&e(this).triggerHandler("itemDeleted",[this])},_._updateDisplayName$1=function(){if(null!=this._buddyContact$1){this._nameElement$1.clearChildren(),this._nameElement$1.set_text(this._buddyContact$1.get_displayName());var e;e=n._getLocString(this._aggregatedConversation$1.get_currentConversation()instanceof i.GroupConversation?o.isNullOrEmpty(this._aggregatedConversation$1.get_currentConversation().get_title())?"groupConversationWith":"groupConversationTitle":"conversationWith"),this.get_element().children[0].setAttribute("aria-label",o.format(e,this._buddyContact$1.get_displayName()))}},_._highlightItem$1=function(){var e="Highlight";this._aggregatedConversation$1.get_hasUnreadMessages()?(this._nameElement$1.addCssClass("TextSemiBold",!1),this._nameElement$1.addCssClass(e,!0),this._messageElement$1.addCssClass("TextSemiBold",!1),this._messageElement$1.addCssClass("t_highlight",!1),this._messageElement$1.addCssClass(n.Utility.fontColorThemeClassName,!1),this._timeElement$1.addCssClass(e,!0)):(this._nameElement$1.removeCssClass("TextSemiBold",!1),this._nameElement$1.removeCssClass(e,!0),this._messageElement$1.removeCssClass("TextSemiBold",!1),this._messageElement$1.removeCssClass("t_highlight",!1),this._messageElement$1.removeCssClass(n.Utility.fontColorThemeClassName,!1),this._timeElement$1.removeCssClass(e,!0)),n._recentConversationsListControl.updateUnreadConversationCount()},_._getLabelTime$1=function(e){var t=new Date,i=n._getLocStringNS("live.shared.marketinfo.webim.client.DateReceivedFormat");if(e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate())i=n._getLocStringNS("live.shared.marketinfo.webim.client.TimeReceivedFormat");else if(new Date-e<6048e5)return this._dayOfWeek$1[e.getDay()];var s=e.getHours(),o=e.getMinutes();return i.format(e.getMonth()+1,e.getDate(),e.getFullYear().toString().substr(2),s>12?s-12:s,s,10>o?"0"+o:o,n._getLocStringNS(12>s?"live.shared.strings.webim.client.Am":"live.shared.strings.webim.client.Pm"))},_._onConversationPropertyChanged$1=function(e,t,n){"ConsumptionHorizon"===n.get_propertyNamePascal()&&this._highlightItem$1()},_._onConversationRecentMessageReceived$1=function(e,t,n){this._updateLastMessage$1(n.get_message())},_._onConversationHistoryChanged$1=function(e,t,n){(n.get_action()===s.add||n.get_action()===s.remove)&&this._updateLastMessage$1()},_._onContactPropertyChanged$1=function(e,t,n){switch(n.get_propertyNamePascal()){case"DisplayName":case"FullName":case"IsIdentityVerified":this._updateDisplayName$1()}},_._onGroupConversationInfoUpdated=function(){var e=this._aggregatedConversation$1.get_currentConversation();e.get_userInitiated()&&this._aggregatedConversation$1.get_user().get_presence().get_status()===i.PresenceStatus.appearOffline&&(e.set_userInitiated(!1),this._onClicked$1())},_._onClicked$1=function(){e(this).triggerHandler("clicked",[this,null])}}(window.originaljQuery||jQuery)}),define("recentconversationslistcontrol",["recentconversationsitem"],function(){!function(e){var t="common/spinner_grey_40_transparent.gif",n=window,i=n.$Config,s=n.$WLXIM,o=n.MC,r=n.MsgrUI,a=n.Microsoft.Live.Messenger,c=a.NotifyCollectionChangedAction,l=n.ss,u=r.UIElement,d=u.prototype,_=-1,g=0,h=8,p=r._recentConversationsListControl=function(e){u.call(this,e)};$Do.when("WACChatThreadIdChanged",0,function(){var e=s.user.get_aggregatedConversations().findItemByThreadId(s.wacThreadId);e&&e.get_currentConversation().getHistory()}),$Do.when("WACUnreadCountNeedsRecompute",0,function(){r._recentConversationsListControl.updateUnreadConversationCount()});var f=p.prototype=new u;f.constructor=p,f._user$1=null,f._aggregatedConversations=null,f._itemsContainer$1=null,f._showMoreLink=null,f._errorMessage=null,f._loadingIndicator$1=null,f._getConversationsPending$1=!0,f._addPending=!0,f._initialRenderComplete=!1,f._contactListItemMap={},f._noVisibleItems=!0,p.updateUnreadConversationCount=function(){var t=0;if(s.user)if(s.isWac){if(!s.wacThreadId)return;var i=s.user.get_aggregatedConversations().findItemByThreadId(s.wacThreadId);if(!i)return;var o=i.get_currentConversation();if(i instanceof a.AggregatedConversation&&o.get_hasUnreadMessages()){var r=0,c=o.get_consumptionHorizon();c&&(r=c.lastReadMessageTimestamp),e.each(o.get_history().get__items(),function(e,n){n.get_timestamp()>r&&t++})}}else e.each(s.user.get_aggregatedConversations().get_items(),function(e,n){n instanceof a.AggregatedConversation&&n.get_hasUnreadMessages()&&t++});t!==g&&(g=t,s.updateMessagingCount&&(-1!==_&&n.clearTimeout(_),_=n.setTimeout(function(){s.updateMessagingCount(t),_=-1},200)))},f.get_user=function(){return this._user$1},f.set_user=function(e){return null!=e&&this._user$1!==e&&(this.dispose(),this._user$1=e,this._aggregatedConversations=this._user$1.get_aggregatedConversations(),this.onVisualInitialized()),e},f.get_visibleItemCount=function(){var e=0,t=this._contactListItemMap;for(var n in t){var i={key:n,value:t[n]},s=i.value;s&&s.get_isVisible()&&e++}return e},f.dispose=function(){l.isNullOrUndefined(this._user$1)||(e(this._aggregatedConversations).unbind("collectionChanged",l.Delegate.create(this,this._onConversationsCollectionChanged$1)),e(this._aggregatedConversations).unbind("getMoreConversationsCompleted",l.Delegate.create(this,this._onGetMoreConversationsCompleted)),this._removeConversations$1(),this._user$1=null,e(this).unbind())},f.onVisualInitialized=function(){d.onVisualInitialized.call(this),l.isNullOrUndefined(this._user$1)||(this.findElementById("Title").innerText=r._getLocString("recentConversationsTitle"),this._itemsContainer$1=new r.KeyboardAccessible(this.findElementById("ItemsContainer")),this.addLogicalChild(this._itemsContainer$1),this._showMoreLink=new u(this.findElementById("ShowMore")),this._showMoreLink.set_text(r._getLocString("showMore")),this._showMoreLink.set_isVisible(!1),this._showMoreLink.attachEvent(r.EventType.click,l.Delegate.create(this,this._onShowMoreLinkClicked)),this._errorMessage=new u(this.findElementById("ErrorMessage")),this._errorMessage.set_text(r._getLocString("recentListCallFailed")),this._errorMessage.set_isVisible(!1),this._loadingIndicator$1=new u(this.findElementById("Spinner")),this._loadingIndicator$1.get_element().src=i.WebIM.imgBase+t,this._updateUI(),e(this._aggregatedConversations).bind("collectionChanged",l.Delegate.create(this,this._onConversationsCollectionChanged$1)),e(this._aggregatedConversations).bind("getMoreConversationsCompleted",l.Delegate.create(this,this._onGetMoreConversationsCompleted)),e(s.sidebar).bind("onSidebarOpenCompletedEvent",l.Delegate.create(this,this._updateUI)))},f._updateUI=function(){if(this._addPending&&!this._getConversationsPending$1){var e=this._itemsContainer$1.get_element().children.length,t=this._aggregatedConversations.get_items();t.length>=e+h?(this._addListItems(t.slice(e,e+h)),this._onAddListItemsCompleted()):this._aggregatedConversations.get_hasMoreConversationsOnServer()?(this._getConversationsPending$1=!0,this._aggregatedConversations.getMoreConversationsFromServer()):(this._addListItems(t.slice(e,t.length)),this._onAddListItemsCompleted())}},f._addListItems=function(t){o.Logger.logAction("RecentConversationsControl.AddConversations. Count="+t.length);var n=this;e.each(t,function(t,i){var s=i.get_buddyContact();if(s&&s.get_id()&&!n._contactListItemMap[s.get_id()]){var o=new r._recentConversationsItem(i,s,null);n._contactListItemMap[s.get_id()]=o,n._itemsContainer$1.addChild(o),e(o).bind("clicked",l.Delegate.create(n,n._onItemClicked$1)),e(o).bind("propertyChanged",l.Delegate.create(n,n._onItemPropertyChanged)),i.get_currentConversation()instanceof a.GroupConversation&&i.get_currentConversation().get_userInitiated()&&(i.get_currentConversation().set_userInitiated(!1),e(o).triggerHandler("clicked",[o]))}})},f._removeListItem=function(t){o.Logger.logAction("RecentConversationsControl.DeleteConversation.");var n=this,i=t.get_buddyContact();if(null!=i&&!l.isNullOrEmpty(i.get_id())){var s=n._contactListItemMap[i.get_id()];n._itemsContainer$1.removeChild(s),e(s).unbind("clicked"),e(s).unbind("propertyChanged"),n._contactListItemMap[i.get_id()]=null}},f._onAddListItemsCompleted=function(){this._addPending=!1,this._loadingIndicator$1.set_isVisible(!1),this._showMoreLink.set_isVisible((s.getTestFlags()&o.TestFlags.RecentListLoadFailure)==o.TestFlags.RecentListLoadFailure||this._aggregatedConversations.get_hasMoreConversationsOnServer()&&this._user$1.get_contacts().get_count()>1||this._aggregatedConversations.get_count()>this._itemsContainer$1.get_element().children.length),!this._errorMessage.get_isVisible()&&this._noVisibleItems&&0==this.get_visibleItemCount()&&this.set_isVisible(!1),this._initialRenderComplete||(this._initialRenderComplete=!0,e(this).triggerHandler("initialRenderComplete"))},f._onShowMoreLinkClicked=function(){this._addPending=!0,this._showMoreLink.set_isVisible(!1),this._loadingIndicator$1.set_isVisible(!0),this._updateUI()},f._removeConversations$1=function(){var t=this._contactListItemMap;for(var n in t){var i={key:n,value:t[n]},s=i.value;e(s).unbind("clicked",l.Delegate.create(this,this._onItemClicked$1)),s.dispose()}this.__contactListItemMap={},this._itemsContainer$1.clearChildren()},f._moveItem$1=function(e,t){var n=this._itemsContainer$1.get_element();n.removeChild(e.get_element()),n.children.length>t?n.insertBefore(e.get_element(),n.children[t]):n.appendChild(e.get_element())},f._onConversationsCollectionChanged$1=function(e,t,n){switch(n.get_action()){case c.replaced:case c.add:for(var i=n.get_newStartingIndex(),s=l.IEnumerator.getEnumerator(n.get_newItems());s.moveNext();){var o=s.get_current(),r=o.get_buddyContact();r&&r.get_id()&&(this._contactListItemMap[r.get_id()]?this._moveItem$1(this._contactListItemMap[r.get_id()],i):i<this._itemsContainer$1.get_element().children.length||0==this._itemsContainer$1.get_element().children.length&&!this._getConversationsPending$1?(this._addListItems([o]),this._moveItem$1(this._contactListItemMap[r.get_id()],i)):this._updateUI())}break;case c.remove:for(var a=l.IEnumerator.getEnumerator(n.get_oldItems());a.moveNext();){var u=a.get_current();this._removeListItem(u)}}},f._onGetMoreConversationsCompleted=function(e,t){this._getConversationsPending$1=!1,this._errorMessage.set_isVisible(t.callFailed||(s.getTestFlags()&o.TestFlags.RecentListLoadFailure)==o.TestFlags.RecentListLoadFailure),this._updateUI()},f._onItemPropertyChanged=function(e,t,n){this._noVisibleItems&&"IsVisible"===n.get_propertyNamePascal()&&t.get_isVisible()&&(this.set_isVisible(!0),this._noVisibleItems=!1)},f._onItemClicked$1=function(e,t){null!=t&&s.startConversationWithContactId(t.get_buddyContact().get_id(),"recentConversations",!0)}}(window.originaljQuery||jQuery)}),define("upsellcontrol",["recentconversationslistcontrol"],function(){!function(e){var t=window,n=t.$Config,i=t.wLive.People,s=i.NetworkID,o=i.SortOrder,r=t.MsgrUI,a=t.Microsoft.Live.Messenger,c=a.Services.SkyJSHelper,l=i.Reporter,u="<div class='WebIMUpsell' sutra='webimupsellbody'><div class='Separator'></div><div resourceid='Skype' class='Skype' sutra='upsellskype'><h1 resourceid='Title' class='Title' sutra='upsellskypeheader'></h1><div resourceid='Text' class='Text' sutra='upsellskypetext'></div><div resourceid='PictureGridContainer' class='PictureGridContainer' sutra='picturegrid'></div><a resourceid='MoreLink' class='MoreLink' sutra='upsellmorelink' href='#' onclick='return false;'></a><div resourceid='FlyoutContainer' class='FlyoutContainer' sutra='upsellflyout' style='display: none;'></div></div><div resourceid='Other' class='Other' sutra='upsellother'><h1 resourceid='Title' class='Title'></h1></div><a resourceid='CloseLink' class='CloseLink' sutra='nothanks' href='#' onclick='return false;'></a></div>",d="<a class='UpsellItem' href='#' onclick='return false;'><img /><div resourceid='Text' class='Text'></div></a>",_="<div class='FlyoutItem' sutra='upsellflyoutitem'></div>",g=["zh-cn","mn-mong-cn","bo-cn","ug-cn","ii-cn"],h="skype_linking",p="FB",f="GOOG",m="chat,dashboard_agg,status_publish",v="chat",C=16;r._upsellControl=function(i){var y=this,S=null,$=null,w=null,I=null,b=null,M=null,k=null,E=null,T=null,D=null,A=null,x=[],N=!0,P=!0,R=t.$Config.mkt.toLowerCase();for(var O in g)if(g[O]==R){N=!0;break}N||x.push(p),P||x.push(f),y.get_element=function(){return S.get(0)},y.render=function(){return S||(S=e(u),$=S.find("[resourceid='Skype']"),w=$.find("[resourceid='Text']"),I=$.find("[resourceid='PictureGridContainer']"),b=$.find("[resourceid='MoreLink']"),M=S.find("[resourceid='Other']"),k=M.find("[resourceid='Title']"),E=S.find("[resourceid='CloseLink']"),$.find("[resourceid='Title']").text(r._getLocString("upsellSkypeHeader")),E.text(r._getLocString("upsellClose")),H(),U()),S.get(0)},y.activate=function(){T&&(T.activate(),I.click(G)),M.find(".UpsellItem").click(V),b.click(q),E.click(W),e(i.get_networks()).bind("propertyChanged",L),e(c).bind("initCompleted",L),F(!i.get_settings().get_upsellClosedFlag()&&S.find(".UpsellItem").length>0)},y.deactivate=function(){T&&(T.deactivate(),I.unbind("click",G)),M.find(".UpsellItem").unbind("click",V),b.unbind("click",q),E.unbind("click",W),e(i.get_networks()).unbind("propertyChanged",L),e(c).unbind("initCompleted",L)},y.show=function(){S.show(),i.get_settings().set_upsellClosedFlag(!1),L()};var L=function(){S.is(":visible")&&(y.deactivate(),H(),U(),y.activate(),F($.is(":visible")||M.is(":visible")))},H=function(){if($.find(".UpsellItem").remove(),I.empty().hide(),c.skypeEnabled&&c.initCompleted&&!c.getInstance().Outlook.isUserLinkStatusActive()){var i=e(d);i.attr("id",h),i.attr("target","_blank"),i.attr("sutra","skypelink"),i.attr("onclick","window.open('"+n.WebIM.sau+"', '', 'height=520,width=720')"),i.find("img").attr("src",r.Utility.getNetworkIconsPath()+"skypeUpsell.png"),$.append(i);var a=t.$pwc.getPersons({hasPictures:!0,networks:[s.shortCircuit]},o.messagingRelevance);a.length>=3?(T=new r._pictureGridControl(a.slice(0,C)),I.show().append(T.render()),A=a.length>C?a.slice(C,a.length):[],A.concat(t.$pwc.getPersons({hasPictures:!1,networks:[s.shortCircuit]},o.messagingRelevance)),A.length>0?b.css("display","block").text(t.ss.format(r._getLocString("upsellSkypeMoreLink"),A.length)):b.hide(),w.text(r._getLocString("upsellFoundOnSkypeDescription")),i.find("[resourceid='Text']").text(r._getLocString("upsellFoundOnSkype")).addClass("MultiLine")):(w.text(r._getLocString("upsellSkypeDescription")),i.find("[resourceid='Text']").text(r._getLocString("upsellSkype")).removeClass("MultiLine")),$.show()}else $.hide()},U=function(){M.find(".UpsellItem").remove(),k.text($.find(".UpsellItem").length>0?r._getLocString("upsellOtherNetworksHeader"):r._getLocString("upsellOtherNetworksNoSkypeHeader"));
for(var e=i.get_networks(),t=x.slice(0),n=0,s=e.get_count();s>n;n++){var o=e.getItem(n);o.get_id()!=p&&o.get_id()!=f||"Reject"===o.get_tokenState()||!o.get_supportsIM()||t.remove(o.get_id())}for(n=0,s=t.length;s>n;n++)B(t[n]);t.length>0?M.show():M.hide()},B=function(t){var n=e(d);n.attr("netid",t),n.attr("sutra",t.toLowerCase()+"link"),n.find("img").attr("src",a._globalConfiguration._getNetworkIconUrl(t)),n.find("[resourceid='Text']").text(r._getLocString(t==f?"upsellGoogle":"upsellFacebook")),M.append(n)},F=function(t){t?S.show():S.hide(),e(y).triggerHandler("visibilityChanged",{visible:t,hasUpsellNetworks:S.find(".UpsellItem").length>0})},V=function(i){if(i&&i.currentTarget){var s=e(i.currentTarget).attr("netid");if(s){var o=t.ss.format(n.WebIM.nm,s,s==p?m:v);o+=t.location.href;var r=t.open(o,"","height=520,width=720");if(r)try{r.focus()}catch(a){l.logError("WebIM Upsell","Failed to focus on Connect Network window.")}}}},G=function(){$.find(".UpsellItem").click()},W=function(){F(!1),i.get_settings().set_upsellClosedFlag(!0)},q=function(){D||(D=new r._flyout($.find("[resourceid='FlyoutContainer']")[0]),new r.UIElement($).addLogicalChild(D)),D.set_innerHtml("");for(var t=0,n=A.length;n>t;t++){var i=e(_);i.text(A[t].getDisplayNameWithFallback()),D.addChild(new r.UIElement(i[0]))}D.set_isActivated(!0)}}}(window.originaljQuery||jQuery)}),define("landingpagecontrol",["upsellcontrol"],function(){!function(e){var t=window,n=t.MsgrUI,i="<div class='LandingPage'><div resourceid='Scrollable' class='Scrollable'><div resourceid='RecentList' class='RecentConversationsControl_Items' sutra='recentconversations'><h1 resourceid='Title' class='Title' sutra='recentconversationstitle'></h1><ul resourceid='ItemsContainer' class='RecentConversationsContainer' sutra='recentconversationscontainer'></ul><a resourceid='ShowMore' class='ShowMore' sutra='showmore'></a><div resourceid='ErrorMessage' class='ErrorMessage' sutra='recenterror'></div><img resourceid='Spinner' class='Spinner' sutra='recentconversationsloading'></img></div></div><div resourceid='ConnectedTo' class='RecentConversationsControl_ConnectedTo' sutra='connectedtowidget'></div></div>",s="onSidebarOpenCompletedEvent";n.LandingPageControl=function(o){var r=this,a=null,c=null,l=null,u=null,d=null,_=null,g=null,h=null,p=null,f=-1;r.get_element=function(){return a.get(0)},r.render=function(){return a||(a=e(i),c=a.find("[resourceid='Scrollable']"),l=new n.UIElement(a[0]),u=new n._contactSearchControl(o),d=new n._recentConversationsListControl(c.find("[resourceid='RecentList']")[0]),p=new n._recentConversationsConnectedToControl(a.find("[resourceid='ConnectedTo']")[0]),a.prepend(u.render())),a.get(0)},r.activate=function(){u.activate(),e(d).bind("initialRenderComplete",v),e(p).bind("connectedToAddLinkClicked",y),l.addLogicalChild(d),l.addLogicalChild(p),d.set_user(o),p.set_user(o),e(t).resize(m),e(t.$WLXIM.sidebar).bind(s,m)},r.deactivate=function(){u.deactivate(),e(d).unbind("initialRenderComplete",v),e(p).unbind("connectedToAddLinkClicked",y),d.dispose(),p.dispose(),_&&_.deactivate(),g&&g.deactivate(),h&&(e(h).unbind("visibilityChanged",C),h.deactivate()),e(t).unbind("resize",m),e(t.$WLXIM.sidebar).unbind(s,m),f>-1&&(t.clearTimeout(f),f=-1)},r.get_visibleItemCount=function(){return d.get_visibleItemCount()};var m=function(){f>-1&&t.clearTimeout(f),f=t.setTimeout(function(){f=-1;var t=e("#sidebar").height();t-=e(".imCloseImg").outerHeight(!0),t-=e(u.get_element()).outerHeight(!0),t-=e(p.get_element()).outerHeight(!0),h&&e(h.get_element()).is(":visible")&&(t-=e(h.get_element()).outerHeight(!0)),c.css("max-height",t+"px"),c.height()>0?c.removeAttr("collapsed"):c.attr("collapsed","")},50)},v=function(){e(d).unbind("initialRenderComplete",v),_=new n._favoritesControl(o),g=new n._peopleControl(o),h=new n._upsellControl(o),e(h).bind("visibilityChanged",C),c.append(_.render()),c.after(h.render()),_.activate(),h.activate();var t=function(){e(g).unbind("renderComplete",t),g.activate()};e(g).bind("renderComplete",t),c.append(g.render(!0))},C=function(e,t){p.set_addLinkVisible(!t.visible&&t.hasUpsellNetworks),m()},y=function(){h.show()}}}(window.originaljQuery||jQuery)}),define("webimend",["landingpagecontrol"],function(){!function(){var e=window,t=e.$Network;t.registerScript("webimui")}()}),define("appinsights.legacypayload",[],function(){function e(){var e;if("undefined"!=typeof window&&"undefined"!=typeof JSON){var t=window.appInsights||{},i=new n.ApplicationInsights.Initialization(t),s=i.loadAppInsights();for(e in s)t[e]=s[e];i.emptyQueue(),i.pollInteralLogs(s)}}var t,n,i=/(\?|&)authkey=[^&]+&?(.*)?$/;!function(e){!function(e){!function(e){e[e.CRITICAL=0]="CRITICAL",e[e.WARNING=1]="WARNING"}(e.LoggingSeverity||(e.LoggingSeverity={}));var t=(e.LoggingSeverity,function(){function e(){}return e.throwInternalNonUserActionable=function(t,n){if(e.enableDebugExceptions())throw n;e.warn(n),(e.verboseLogging()||0===t)&&this.queue.length<this.MAX_QUEUE_SIZE&&this.queue.push(e.AiNonUserActionable+n)},e.throwInternalUserActionable=function(t,n){if(e.enableDebugExceptions())throw n;e.warn(n),(e.verboseLogging()||0===t)&&this.queue.length<this.MAX_QUEUE_SIZE&&this.queue.push(e.AiUserActionablePrefix+n)},e.warn=function(e){"undefined"==typeof console||!console||("function"==typeof console.warn?console.warn(e):"function"==typeof console.log&&console.log(e))},e.AiUserActionablePrefix="AI: ",e.AiNonUserActionable="AI (Internal): ",e.MAX_QUEUE_SIZE=100,e.enableDebugExceptions=function(){return!1},e.verboseLogging=function(){return!1},e.queue=[],e}());e._InternalLogging=t}(e.ApplicationInsights||(e.ApplicationInsights={}));e.ApplicationInsights}(n||(n={})),function(e){!function(e){var t=function(){function e(){}return e.setCookie=function(t,n){e.document.cookie=t+"="+n+";path=/"},e.getCookie=function(t){var n,i,s,o,r="";if(t&&t.length)for(n=t+"=",i=e.document.cookie.split(";"),s=0;s<i.length;s++)if(o=i[s],o=e.trim(o),o&&0===o.indexOf(n)){r=o.substring(n.length,i[s].length);break}return r},e.trim=function(e){return e.replace(/^\s+|\s+$/g,"")},e.newGuid=function(){for(var e,t,n=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],i="",s=0;4>s;s++)t=4294967296*Math.random()|0,i+=n[15&t]+n[t>>4&15]+n[t>>8&15]+n[t>>12&15]+n[t>>16&15]+n[t>>20&15]+n[t>>24&15]+n[t>>28&15];return e=n[8+4*Math.random()|0],i.substr(0,8)+"-"+i.substr(9,4)+"-4"+i.substr(13,3)+"-"+e+i.substr(16,3)+"-"+i.substr(19,12)},e.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},e.isError=function(e){return"[object Error]"===Object.prototype.toString.call(e)},e.isDate=function(e){return"[object Date]"===Object.prototype.toString.call(e)},e.toISOStringForIE8=function(t){function n(e){var t=String(e);return 1===t.length&&(t="0"+t),t}return e.isDate(t)?Date.prototype.toISOString?t.toISOString():t.getUTCFullYear()+"-"+n(t.getUTCMonth()+1)+"-"+n(t.getUTCDate())+"T"+n(t.getUTCHours())+":"+n(t.getUTCMinutes())+":"+n(t.getUTCSeconds())+"."+String((t.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z":void 0},e.msToTimeSpan=function(e){(isNaN(e)||0>e)&&(e=0);var t=""+e%1e3,n=""+Math.floor(e/1e3)%60,i=""+Math.floor(e/6e4)%60,s=""+Math.floor(e/36e5)%24;return t=1===t.length?"00"+t:2===t.length?"0"+t:t,n=n.length<2?"0"+n:n,i=i.length<2?"0"+i:i,s=s.length<2?"0"+s:s,s+":"+i+":"+n+"."+t},e.document="undefined"!=typeof document?document:{},e}();e.Util=t}(e.ApplicationInsights||(e.ApplicationInsights={}));e.ApplicationInsights}(n||(n={})),function(e){!function(e){var t=function(){function t(){}return t.serialize=function(e){var n=t._serializeObject(e,"root");return JSON.stringify(n)},t._serializeObject=function(n,i){var s,o,r="__aiCircularRefCheck",a={};if(!n)return e._InternalLogging.throwInternalUserActionable(0,"cannot serialize "+i+" because it is null or undefined"),a;if(n[r])return e._InternalLogging.throwInternalUserActionable(1,"Circular reference detected while serializing: '"+i),a;if(!n.aiDataContract){if("measurements"===i)a=t._serializeStringMap(n,"number",i);else if("properties"===i)a=t._serializeStringMap(n,"string",i);else{e._InternalLogging.throwInternalUserActionable(1,"Attempting to serialize an object which does not implement ISerializable: "+i);try{JSON.stringify(n),a=n}catch(c){e._InternalLogging.throwInternalUserActionable(0,c&&"function"==typeof c.toString?c.toString():"Error serializing object")}}return a}n[r]=!0;for(s in n.aiDataContract){var l=n.aiDataContract[s],u="boolean"!=typeof l,d=void 0!==n[s],_="object"==typeof n[s]&&null!==n[s];!l||d||u?(o=_?u?t._serializeArray(n[s],s):t._serializeObject(n[s],s):n[s],void 0!==o&&(a[s]=o)):e._InternalLogging.throwInternalUserActionable(0,"Missing required field specification: The field '"+s+"' is required but not present on source")}return delete n[r],a},t._serializeArray=function(n,i){var s,o,r,a=void 0;if(n)if(e.Util.isArray(n))for(a=[],s=0;s<n.length;s++)o=n[s],r=t._serializeObject(o,i+"["+s+"]"),a.push(r);else e._InternalLogging.throwInternalUserActionable(0,"This field was specified as an array in the contract but the item is not an array.\r\n"+i);return a},t._serializeStringMap=function(t,n,i){var s,o,r=void 0;if(t){r={};for(s in t)o=t[s],"string"===n?r[s]=o.toString():"number"===n?r[s]=parseFloat(o):(r[s]="invalid field: "+i+" is of unknown type.",e._InternalLogging.throwInternalUserActionable(0,r[s]))}return r},t}();e.Serializer=t}(e.ApplicationInsights||(e.ApplicationInsights={}));e.ApplicationInsights}(n||(n={})),function(e){!function(e){!function(t){!function(t){"use strict";var n=function(){function t(){}return t.sanitizeKeyAndAddUniqueness=function(e,n){var i,s,o=e.length,r=t.sanitizeKey(e);if(r.length!==o){for(i=0,s=r.substring(0,t.MAX_NAME_LENGTH-3)+t.padNumber(i);void 0!==n[s];)i++,s=r.substring(0,t.MAX_NAME_LENGTH-3)+t.padNumber(i);r=s}return r},t.sanitizeKey=function(n){return n&&(n=e.Util.trim(n.toString()),n.search(/[^0-9a-zA-Z-._()\/ ]/g)>=0&&(n=n.replace(/[^0-9a-zA-Z-._()\/ ]/g,"_"),e._InternalLogging.throwInternalUserActionable(1,"name contains illegal characters. Illgeal character have been replaced with '_'. new name: "+n)),n.length>t.MAX_NAME_LENGTH&&(n=n.substring(0,t.MAX_NAME_LENGTH),e._InternalLogging.throwInternalUserActionable(1,"name is too long.  It has been truncated to "+t.MAX_NAME_LENGTH+" characters.  name: "+n))),n},t.sanitizeString=function(n){return n&&n.toString().length>t.MAX_STRING_LENGTH&&(n=n.substring(0,t.MAX_STRING_LENGTH),e._InternalLogging.throwInternalUserActionable(1,"string value is too long. It has been truncated to "+t.MAX_STRING_LENGTH+" characters. value: "+n)),n},t.sanitizeUrl=function(n){return n&&n.length>t.MAX_URL_LENGTH&&(n=n.substring(0,t.MAX_URL_LENGTH),e._InternalLogging.throwInternalUserActionable(1,"url is too long, it has been trucated to "+t.MAX_URL_LENGTH+" characters. url: "+n)),n},t.sanitizeMessage=function(n){return n&&n.length>t.MAX_MESSAGE_LENGTH&&(n=n.substring(0,t.MAX_MESSAGE_LENGTH),e._InternalLogging.throwInternalUserActionable(1,"message is too long, it has been trucated to "+t.MAX_MESSAGE_LENGTH+" characters.  message: "+n)),n},t.sanitizeException=function(n){return n&&n.length>t.MAX_EXCEPTION_LENGTH&&(n=n.substring(0,t.MAX_EXCEPTION_LENGTH),e._InternalLogging.throwInternalUserActionable(1,"exception is too long, iit has been trucated to "+t.MAX_EXCEPTION_LENGTH+" characters.  exception: "+n)),n},t.sanitizeProperties=function(e){var n,i,s;if(e){n={};for(i in e)i=t.sanitizeKeyAndAddUniqueness(i,n),s=t.sanitizeString(e[i]),n[i]=s;e=n}return e},t.sanitizeMeasurements=function(e){var n,i,s;if(e){n={};for(i in e)s=e[i],i=t.sanitizeKeyAndAddUniqueness(i,n),n[i]=s;e=n}return e},t.padNumber=function(e){var t="00"+e;return t.substr(t.length-3)},t.MAX_NAME_LENGTH=150,t.MAX_STRING_LENGTH=1024,t.MAX_URL_LENGTH=2048,t.MAX_MESSAGE_LENGTH=32768,t.MAX_EXCEPTION_LENGTH=32768,t}();t.DataSanitizer=n}(t.Common||(t.Common={}));t.Common}(e.Telemetry||(e.Telemetry={}));e.Telemetry}(e.ApplicationInsights||(e.ApplicationInsights={}));e.ApplicationInsights}(n||(n={})),function(e){!function(e){!function(e){!function(e){"use strict";var t=function(){function t(n,i,s){this.ver=1,this.properties=e.DataSanitizer.sanitizeProperties(i),this.measurements=e.DataSanitizer.sanitizeMeasurements(s),this.aiDataContract=t.extendContract({ver:!0,measurements:!1,properties:!1},n)}return t.extendContract=function(e,t){e||t&&(e={});for(var n in t)e[n]=t[n];return e},t}();e.Item=t}(e.Common||(e.Common={}));e.Common}(e.Telemetry||(e.Telemetry={}));e.Telemetry}(e.ApplicationInsights||(e.ApplicationInsights={}));e.ApplicationInsights}(n||(n={})),function(e){!function(e){!function(e){!function(e){"use strict";var t=function(){function t(t,n){this.aiDataContract={type:!0,item:!0},this.type=e.DataSanitizer.sanitizeString(t),this.item=n}return t}();e.Data=t}(e.Common||(e.Common={}));e.Common}(e.Telemetry||(e.Telemetry={}));e.Telemetry}(e.ApplicationInsights||(e.ApplicationInsights={}));e.ApplicationInsights}(n||(n={})),function(e){!function(e){!function(t){!function(t){"use strict";var n=function(){function t(){this.aiDataContract={sdkVersion:!0},this.sdkVersion=e.Version}return t}();t.Internal=n}(t.Common||(t.Common={}));t.Common}(e.Telemetry||(e.Telemetry={}));e.Telemetry}(e.ApplicationInsights||(e.ApplicationInsights={}));e.ApplicationInsights}(n||(n={})),function(e){!function(e){!function(e){var t=function(){function e(e){this.aiDataContract={ver:!1,id:!1},this.id=e}return e}();e.Application=t}(e.Context||(e.Context={}));e.Context}(e.ApplicationInsights||(e.ApplicationInsights={}));e.ApplicationInsights}(n||(n={})),function(e){!function(e){!function(e){var t=function(){function e(){this.aiDataContract={type:!1,id:!0,oemName:!1,model:!1,network:!1,resolution:!1,locale:!0},this.id="browser","undefined"!=typeof screen&&screen.width&&screen.height&&(this.resolution=screen.width+"X"+screen.height),this.locale="undefined"!=typeof screen&&navigator.browserLanguage?navigator.browserLanguage:"unknown"}return e}();e.Device=t}(e.Context||(e.Context={}));e.Context}(e.ApplicationInsights||(e.ApplicationInsights={}));e.ApplicationInsights}(n||(n={})),function(e){!function(e){!function(e){var t=function(){function e(){this.aiDataContract={Latitude:!1,Longitude:!1,IP:!1,Continent:!1,Country:!1,Province:!1,City:!1}}return e}();e.Location=t}(e.Context||(e.Context={}));e.Context}(e.ApplicationInsights||(e.ApplicationInsights={}));e.ApplicationInsights}(n||(n={})),function(e){!function(e){!function(t){var n=function(){function t(){this.aiDataContract={id:!0},this.id=e.Util.newGuid()}return t}();t.Operation=n}(e.Context||(e.Context={}));e.Context}(e.ApplicationInsights||(e.ApplicationInsights={}));e.ApplicationInsights}(n||(n={})),function(e){!function(e){!function(t){var n=function(){function t(n){var i,s,o,r;this.aiDataContract={id:!0,isFirst:!1,isNewSession:!1},n||(n={}),"function"==typeof n.sessionExpirationMs||(n.sessionExpirationMs=function(){return t.acquisitionSpan}),"function"==typeof n.sessionRenewalMs||(n.sessionRenewalMs=function(){return t.renewalSpan}),this.config=n,i=e.Util.getCookie("ai_session"),i&&"function"==typeof i.split&&(s=i.split("|"),s.length>0&&(this.id=s[0]),s.length>1&&(o=s[1],this.acquisitionDate=+new Date(o),this.acquisitionDate=this.acquisitionDate>0?this.acquisitionDate:0),s.length>1&&(r=s[1],this.renewalDate=+new Date(r),this.renewalDate=this.renewalDate>0?this.renewalDate:0)),this.id||(this.renew(),this.isNewSession=!0,this.isFirst=!0)}return t.prototype.update=function(){var e=+new Date,t=e-this.acquisitionDate>this.config.sessionExpirationMs(),n=e-this.renewalDate>this.config.sessionRenewalMs();this.isFirst=void 0,t||n?(this.renew(),this.isNewSession=!0):(this.renewalDate=+new Date,this.setCookie(this.id,this.acquisitionDate,this.renewalDate),this.isNewSession=!1)},t.prototype.renew=function(){this.id=e.Util.newGuid();var t=+new Date;this.acquisitionDate=t,this.renewalDate=t,this.setCookie(this.id,this.acquisitionDate,this.renewalDate)},t.prototype.setCookie=function(t,n,i){var s=e.Util.toISOStringForIE8(new Date(n)),o=e.Util.toISOStringForIE8(new Date(i)),r=[t,s,o];e.Util.setCookie("ai_session",r.join("|"))},t.acquisitionSpan=864e5,t.renewalSpan=18e5,t}();t.Session=n}(e.Context||(e.Context={}));e.Context}(e.ApplicationInsights||(e.ApplicationInsights={}));e.ApplicationInsights}(n||(n={})),function(e){!function(e){!function(t){var n=function(){function t(t){var n,i,s;if(this.aiDataContract={id:!0,accountId:!1},n=e.Util.getCookie("ai_user"),n&&(i=n.split("|"),i.length>0&&(this.id=i[0])),!this.id){this.id=e.Util.newGuid();var o=new Date,r=e.Util.toISOStringForIE8(o);o.setTime(o.getTime()+31536e6),s=[this.id,r],e.Util.setCookie("ai_user",s.join("|")+";expires="+o.toUTCString())}this.accountId=t}return t}();t.User=n}(e.Context||(e.Context={}));e.Context}(e.ApplicationInsights||(e.ApplicationInsights={}));e.ApplicationInsights}(n||(n={})),function(e){!function(e){!function(t){!function(t){"use strict";var n=function(){function n(n,i){this.ver=1,this.name=t.DataSanitizer.sanitizeString(n),this.data=i,this.time=e.Util.toISOStringForIE8(new Date),this.aiDataContract={ver:!0,name:!0,time:!0,iKey:!0,device:!1,application:!1,user:!1,operation:!1,location:!1,session:!1,data:!0,internal:!1},this.internal=new t.Internal}return n}();t.Base=n}(t.Common||(t.Common={}));t.Common}(e.Telemetry||(e.Telemetry={}));e.Telemetry}(e.ApplicationInsights||(e.ApplicationInsights={}));e.ApplicationInsights}(n||(n={})),function(e){!function(e){var t=function(){function t(e){if(this._buffer=[],this._lastSend=0,this._config=e,this._sender=null,"undefined"!=typeof XMLHttpRequest){var t=new XMLHttpRequest;"withCredentials"in t?this._sender=this._xhrSender:"undefined"!=typeof XDomainRequest&&(this._sender=this._xdrSender)}}return t.prototype.send=function(t){var n,i=this;if(!this._config.disableTelemetry()){if(!t)return void e._InternalLogging.throwInternalUserActionable(1,"Cannot send empty telemetry");if(!this._sender)return void e._InternalLogging.warn("No sender could be constructed for this environment, payload will be added to buffer."+e.Serializer.serialize(t));n=e.Serializer.serialize(t),n.length>this._config.maxPayloadSizeInBytes()&&(t=this._truncate(t,n.length),n=e.Serializer.serialize(t)),this._getSizeInBytes(this._buffer)+n.length>this._config.maxBatchSizeInBytes()&&this.triggerSend(),this._buffer.push(n),this._timeoutHandle||(this._timeoutHandle=setTimeout(function(){i._timeoutHandle=null,i.triggerSend()},this._config.maxBatchInterval()))}},t.prototype._getSizeInBytes=function(e){var t,n,i=0;if(e&&e.length)for(t=0;t<e.length;t++)n=e[t],n&&n.length&&(i+=n.length);return i},t.prototype._truncate=function(e){if(e&&e.data&&e.data.item){var t=this._config.maxPayloadSizeInBytes();e.data.item.properties={Error:"optional fields truncated because they exceeded: "+t+" bytes"},delete e.data.item.measurements}return e},t.prototype.triggerSend=function(){if(!this._config.disableTelemetry()){if(this._buffer.length){var e="["+this._buffer.join(",")+"]";this._sender(e)}this._lastSend=+new Date}this._buffer.length=0,clearTimeout(this._timeoutHandle),this._timeoutHandle=null},t.prototype._xhrSender=function(e){var n=new XMLHttpRequest;try{n.open("POST",this._config.endpointUrl(),!0),n.setRequestHeader("Content-type","application/json"),n.onreadystatechange=function(){return t._xhrReadyStateChange(n,e)},n.onerror=function(i){return t._onError(e,n.responseText||n.response||"",i)},n.send(e)}catch(i){}},t.prototype._xdrSender=function(e){var n=new XDomainRequest;n.onload=function(){return t._xdrOnLoad(n,e)},n.onerror=function(i){return t._onError(e,n.responseText||"",i)},n.open("POST",this._config.endpointUrl()),n.send(e)},t._xhrReadyStateChange=function(e,n){4===e.readyState&&((e.status<200||e.status>=300)&&0!==e.status?t._onError(n,e.responseText||e.response||""):t._onSuccess(n))},t._xdrOnLoad=function(e,n){!e||e.responseText+""!="200"&&""!==e.responseText?t._onError(n,e&&e.responseText||""):t._onSuccess(n)},t._onError=function(t,n){e._InternalLogging.throwInternalNonUserActionable(1,"Failed to send telemetry:\n"+n)},t._onSuccess=function(){},t}();e.Sender=t}(e.ApplicationInsights||(e.ApplicationInsights={}));e.ApplicationInsights}(n||(n={})),t=this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);n.prototype=t.prototype,e.prototype=new n},function(e){!function(e){!function(e){var n,i=function(i){function s(t,o,r){var a=new e.Common.Data("Microsoft.ApplicationInsights.MessageData",new n(t,o,r));i.call(this,s.type,a)}return t(s,i),s.type="Microsoft.ApplicationInsights.Message",s}(e.Common.Base);e.Trace=i,n=function(){function t(t,n,i){this.aiDataContract={ver:!0,message:!0,measurements:!1,properties:!1},this.ver=1,this.message=e.Common.DataSanitizer.sanitizeMessage(t),this.properties=e.Common.DataSanitizer.sanitizeProperties(n),this.measurements=e.Common.DataSanitizer.sanitizeMeasurements(i)}return t}()}(e.Telemetry||(e.Telemetry={}));e.Telemetry}(e.ApplicationInsights||(e.ApplicationInsights={}));e.ApplicationInsights}(n||(n={})),function(e){!function(e){!function(n){!function(n){"use strict";var i=function(i){function s(t,s,o,r,a){i.call(this,{name:!1,url:!1,duration:!1},r,a),this.url=n.DataSanitizer.sanitizeUrl(s),this.name=n.DataSanitizer.sanitizeString(t),isNaN(o)||(this.duration=e.Util.msToTimeSpan(o))}return t(s,i),s}(n.Item);n.EventData=i}(n.Common||(n.Common={}));n.Common}(e.Telemetry||(e.Telemetry={}));e.Telemetry}(e.ApplicationInsights||(e.ApplicationInsights={}));e.ApplicationInsights}(n||(n={})),function(e){!function(e){!function(e){var n,i=function(i){function s(){var t=new e.Common.Data("Microsoft.ApplicationInsights.AJAXCallData",new n);i.call(this,s.type,t)}return t(s,i),s.type="Microsoft.ApplicationInsights.AJAXCall",s}(e.Common.Base);e.AjaxCall=i,n=function(e){function n(){e.call(this,"","",0,void 0,void 0),this.ver=1,this.ajaxURL="",this.requestSize="",this.responseSize="",this.timeToFIrstByte="",this.timetoLastByte="",this.callbackDuration="",this.reponseCode="",this.success=!0,this.aiDataContract={ver:!0,name:!0,url:!0,duration:!0,ajaxURL:!0,requestSize:!0,responseSize:!0,timeToFIrstByte:!0,timetoLastByte:!0,callbackDuration:!0,reponseCode:!0,success:!0,measurements:!1,properties:!1}}return t(n,e),n}(e.Common.EventData)}(e.Telemetry||(e.Telemetry={}));e.Telemetry}(e.ApplicationInsights||(e.ApplicationInsights={}));e.ApplicationInsights}(n||(n={})),function(e){!function(e){!function(e){var n=function(n){function i(t,s,o,r){var a=new e.Common.EventData(t,void 0,s,o,r),c=new e.Common.Data("Microsoft.ApplicationInsights.EventData",a);n.call(this,i.type,c)}return t(i,n),i.type="Microsoft.ApplicationInsights.Event",i}(e.Common.Base);e.Event=n}(e.Telemetry||(e.Telemetry={}));e.Telemetry}(e.ApplicationInsights||(e.ApplicationInsights={}));e.ApplicationInsights}(n||(n={})),function(e){!function(e){!function(n){var i=function(e){function i(t,o,r,a){var c=new n.Common.Data("Microsoft.ApplicationInsights.ExceptionData",new s(t,o,r,a));e.call(this,i.type,c)}return t(i,e),i.type="Microsoft.ApplicationInsights.Exception",i}(n.Common.Base);n.Exception=i;var s=function(e){function n(t,n,i,s){e.call(this,{handledAt:!0,exceptions:[]},i,s),this.handledAt=n||"unhandled",this.exceptions=[new o(t)]}return t(n,e),n}(n.Common.Item),o=function(){function t(t){this.aiDataContract={id:!1,outerId:!1,typeName:!0,message:!0,hasFullStack:!1,stack:!1,parsedStack:[]},this.typeName=n.Common.DataSanitizer.sanitizeString(t.name),this.message=n.Common.DataSanitizer.sanitizeMessage(t.message);var i=t.stack;this.parsedStack=this.parseStack(i),this.stack=n.Common.DataSanitizer.sanitizeException(i),this.hasFullStack=e.Util.isArray(this.parsedStack)&&this.parsedStack.length>0}return t.prototype.parseStack=function(e){var t,n,i,s,o,a,c,l,u,d,_=void 0;if("string"==typeof e){for(t=e.split("\n"),_=[],n=0,i=0,s=0;s<=t.length;s++)o=t[s],r.regex.test(o)&&(a=new r(t[s],n++),i+=a.sizeInBytes,_.push(a));if(c=32768,i>c)for(var g=0,h=_.length-1,p=0,f=g,m=h;h>g;){if(l=_[g].sizeInBytes,u=_[h].sizeInBytes,p+=l+u,p>c){d=m-f+1,_.splice(f,d);break}f=g,m=h,g++,h--}}return _},t}(),r=function(){function t(n,i){this.sizeInBytes=0,this.method="",this.aiDataContract={level:!0,method:!0,assembly:!1,fileName:!1,line:!1},this.level=i,this.method="unavailable",this.assembly=e.Util.trim(n);var s=n.match(t.regex);s&&s.length>=5&&(this.method=e.Util.trim(s[2]),this.fileName=e.Util.trim(s[4]),this.line=parseInt(s[5])||0),this.sizeInBytes+=this.method.length,this.sizeInBytes+=this.fileName.length,this.sizeInBytes+=this.assembly.length,this.sizeInBytes+=t.baseSize,this.sizeInBytes+=this.level.toString().length,this.sizeInBytes+=this.line.toString().length}return t.regex=/^([\s]+at)?(.*?)(\@|\s\(|\s)([^\(\@\n]+):([0-9]+):([0-9]+)(\)?)$/,t.baseSize=58,t}()}(e.Telemetry||(e.Telemetry={}));e.Telemetry}(e.ApplicationInsights||(e.ApplicationInsights={}));e.ApplicationInsights}(n||(n={})),function(e){!function(e){!function(e){var n,i=function(i){function s(t,o,r,a,c){var l=new n(t,o,"A",r,a,c),u=new e.Common.Data("Microsoft.ApplicationInsights.MetricData",l);i.call(this,s.type,u)}return t(s,i),s.type="Microsoft.ApplicationInsights.Metric",s}(e.Common.Base);e.Metric=i,n=function(n){function i(t,i,s,o,r,a,c,l){n.call(this,{metrics:[]},c,l),this.metrics=[new e.Common.DataPoint(t,i,s,o,r,a)]}return t(i,n),i}(e.Common.Item)}(e.Telemetry||(e.Telemetry={}));e.Telemetry}(e.ApplicationInsights||(e.ApplicationInsights={}));e.ApplicationInsights}(n||(n={})),function(e){!function(e){!function(e){var n=function(n){function i(t,s,o,r,a){var c=new e.Common.Data("Microsoft.ApplicationInsights.PageviewData",new e.Common.EventData(t,s,o,r,a));n.call(this,i.type,c)}return t(i,n),i.type="Microsoft.ApplicationInsights.Pageview",i}(e.Common.Base);e.PageView=n}(e.Telemetry||(e.Telemetry={}));e.Telemetry}(e.ApplicationInsights||(e.ApplicationInsights={}));e.ApplicationInsights}(n||(n={})),function(e){!function(e){!function(n){var i,s=function(e){function s(t,o,r,a,c){var l=new n.Common.Data(i.type,new i(t,o,r,a,c));e.call(this,s.type,l)}return t(s,e),s.checkPageLoad=function(){var e,t=void 0;return"undefined"!=typeof window&&window.performance&&window.performance.timing&&(e=window.performance.timing,t=e.domainLookupStart>0&&e.navigationStart>0&&e.responseStart>0&&e.requestStart>0&&e.loadEventEnd>0&&e.responseEnd>0&&e.connectEnd>0&&e.domLoading>0),t},s.getDuration=function(e,t){var n=0;return isNaN(e)||isNaN(t)||0===e||0===t||(n=Math.max(t-e,0)),n},s.type="Microsoft.ApplicationInsights.PageviewPerformance",s}(n.Common.Base);n.PageViewPerformance=s,i=function(i){function o(t,o,r,a,c){if("undefined"!=typeof window&&window.performance&&window.performance.timing){var l=window.performance.timing,u=s.getDuration(l.navigationStart,l.loadEventEnd),d=s.getDuration(l.navigationStart,l.connectEnd),_=s.getDuration(l.requestStart,l.responseStart),g=s.getDuration(l.responseStart,l.responseEnd),h=s.getDuration(l.domLoading,l.loadEventEnd);r=u,this.perfTotal=e.Util.msToTimeSpan(u),this.networkConnect=e.Util.msToTimeSpan(d),this.sentRequest=e.Util.msToTimeSpan(_),this.receivedResponse=e.Util.msToTimeSpan(g),this.domProcessing=e.Util.msToTimeSpan(h)}i.call(this,t,o,r,a,c),this.aiDataContract=n.Common.Item.extendContract(this.aiDataContract,{perfTotal:!1,networkConnect:!1,sentRequest:!1,receivedResponse:!1,domProcessing:!1})}return t(o,i),o.type="Microsoft.ApplicationInsights.PageViewPerformanceData",o}(n.Common.EventData)}(e.Telemetry||(e.Telemetry={}));e.Telemetry}(e.ApplicationInsights||(e.ApplicationInsights={}));e.ApplicationInsights}(n||(n={})),function(e){!function(e){!function(t){!function(t){"use strict";var n=function(){function n(n,i,s,o,r,a){this.aiDataContract={name:!0,value:!0,type:!1,count:!1,min:!1,max:!1},this.name=t.DataSanitizer.sanitizeString(n),this.value=i,s||(s="M"),"M"!==s&&"A"!==s&&(e._InternalLogging.throwInternalUserActionable(1,"Invalid type specified '"+s+"', only 'M' or 'A' are allowed. Defaulting to 'M' for single metrics"),s="M"),this.type=s,this.count=o>0?o:void 0,this.min=isNaN(r)||null===r?void 0:r,this.max=isNaN(a)||null===a?void 0:a}return n}();t.DataPoint=n}(t.Common||(t.Common={}));t.Common}(e.Telemetry||(e.Telemetry={}));e.Telemetry}(e.ApplicationInsights||(e.ApplicationInsights={}));e.ApplicationInsights}(n||(n={})),function(e){!function(e){!function(e){var n,i=function(i){function s(t,o,r,a,c,l,u,d){var _=new e.Common.Data("Microsoft.ApplicationInsights.RemoteDependencyData",new n(t,o,r,a,c,l,u,d));i.call(this,s.type,_)}return t(s,i),s.type="Microsoft.ApplicationInsights.RemoteDependency",s}(e.Common.Base);e.RemoteDependency=i,n=function(n){function i(t,i,s,o,r,a,c,l){n.call(this,s,o,r,a,c,l),this.ver=1,this.dependencyKind=t,this.resource=i,this.aiDataContract=e.Common.Item.extendContract(this.aiDataContract,{ver:!0,dependencyKind:!1,resource:!0,measurements:!1,properties:!1})}return t(i,n),i}(e.Common.DataPoint)}(e.Telemetry||(e.Telemetry={}));e.Telemetry}(e.ApplicationInsights||(e.ApplicationInsights={}));e.ApplicationInsights}(n||(n={})),function(e){!function(e){!function(n){var i,s=function(e){function s(t,o,r,a,c,l,u){var d=new n.Common.Data(i.type,new i(t,o,r,a,c,l,u));e.call(this,s.type,d)}return t(s,e),s.type="Microsoft.ApplicationInsights.Request",s}(n.Common.Base);n.Request=s,i=function(){function t(t,i,s,o,r,a,c){this.ver=1,this.name="",this.aiDataContract={ver:!0,name:!0,id:!1,startTime:!1,duration:!1,responseCode:!1,success:!1,measurements:!1,properties:!1},this.ver=1,this.id=e.Util.newGuid(),this.name=n.Common.DataSanitizer.sanitizeString(t),this.startTime=e.Util.toISOStringForIE8(new Date(i)),this.duration=e.Util.msToTimeSpan(s),this.responseCode=o.toString(),this.success=r,this.properties=n.Common.DataSanitizer.sanitizeProperties(a),this.measurements=n.Common.DataSanitizer.sanitizeMeasurements(c)}return t.type="Microsoft.ApplicationInsights.RequestData",t}()}(e.Telemetry||(e.Telemetry={}));e.Telemetry}(e.ApplicationInsights||(e.ApplicationInsights={}));e.ApplicationInsights}(n||(n={})),function(e){!function(e){"use strict";var t=function(){function t(t){this._config=t,this._sender=new e.Sender(t),"undefined"!=typeof window&&(this.device=new e.Context.Device,this.application=t.appUserId()&&new e.Context.Application(t.appUserId()),this.user=new e.Context.User(t.accountId()),this.operation=new e.Context.Operation,this.session=new e.Context.Session(t))}return t.prototype.track=function(t){return t?(t.iKey=t.iKey||this._config.instrumentationKey(),t.device=t.device||this.device,t.user=t.user||this.user,t.session=t.session||this.session,t.application=t.application||this.application,t.operation=t.operation||this.operation,t.location=t.location||this.location,this.applyContext(t,"properties"),this.applyContext(t,"measurements"),t.session&&"function"==typeof t.session.update&&t.session.update(),this._sender.send(t)):e._InternalLogging.throwInternalUserActionable(0,"cannot call .track() with a null or undefined argument"),t},t.prototype.applyContext=function(e,t){var n,i;if(e.data&&e.data.item&&e.data.item&&this[t]){n={},e.data.item[t]&&(n=e.data.item[t]);for(i in this[t])n[i]||(n[i]=this[t][i]);e.data.item[t]=n}},t}();e.TelemetryContext=t}(e.ApplicationInsights||(e.ApplicationInsights={}));e.ApplicationInsights}(n||(n={})),function(e){!function(t){"use strict";var n,s;t.Version="0.12.0.0",n=function(){function n(n){var i,o=this;this.config=n,t._InternalLogging.verboseLogging=function(){return o.config.verboseLogging},t._InternalLogging.enableDebugExceptions=function(){return o.config.enableDebug},i={instrumentationKey:function(){return o.config.instrumentationKey},accountId:function(){return o.config.accountId},appUserId:function(){return o.config.appUserId},sessionRenewalMs:function(){return o.config.sessionRenewalMs},sessionExpirationMs:function(){return o.config.sessionExpirationMs},endpointUrl:function(){return o.config.endpointUrl},maxPayloadSizeInBytes:function(){return o.config.maxPayloadSizeInBytes},maxBatchSizeInBytes:function(){return o.config.maxBatchSizeInBytes
},maxBatchInterval:function(){return o.config.maxBatchInterval},disableTelemetry:function(){return o.config.disableTelemetry}},this.context=new e.ApplicationInsights.TelemetryContext(i),this._eventTracking=new s("trackEvent"),this._eventTracking.action=function(e,n,i,s,r){var a=new t.Telemetry.Event(e,i,s,r);o.context.track(a)},this._pageTracking=new s("trackPageView"),this._pageTracking.action=function(e,n,i,s,r){var a=new t.Telemetry.PageView(e,n,i,s,r);o.context.track(a)}}return n.prototype.startTrackPage=function(e){"string"!=typeof e&&(e=window.document&&window.document.title||""),this._pageTracking.start(e)},n.prototype.stopTrackPage=function(e,t,n,s){"string"!=typeof e&&(e=window.document&&window.document.title||"");var o=window.location&&window.location.href&&window.location.href.replace(i,"$1$2");"string"!=typeof t&&(t=o||""),this._pageTracking.stop(e,t,n,s)},n.prototype.trackPageView=function(e,n,s,o){var r,a,c,l=this;"string"!=typeof e&&(e=window.document&&window.document.title||"");var u=window.location&&window.location.href&&window.location.href.replace(i,"$1$2");"string"!=typeof n&&(n=u||""),r=0,void 0!==t.Telemetry.PageViewPerformance.checkPageLoad()&&(a=window.performance.timing.navigationStart,r=t.Telemetry.PageViewPerformance.getDuration(a,+new Date),c=setInterval(function(){r=t.Telemetry.PageViewPerformance.getDuration(a,+new Date);var i=t.Telemetry.PageViewPerformance.checkPageLoad(),u=r>6e4;(u||i)&&(clearInterval(c),r=t.Telemetry.PageViewPerformance.getDuration(a,+new Date),l.context.track(new t.Telemetry.PageViewPerformance(e,n,r,s,o)),l.context._sender.triggerSend())},100)),this.context.track(new t.Telemetry.PageView(e,n,r,s,o)),setTimeout(function(){l.context._sender.triggerSend()},100)},n.prototype.startTrackEvent=function(e){this._eventTracking.start(e)},n.prototype.stopTrackEvent=function(e,t,n){this._eventTracking.stop(e,void 0,t,n)},n.prototype.trackEvent=function(e,n,i){this.context.track(new t.Telemetry.Event(e,null,n,i))},n.prototype.trackException=function(e,n,i,s){if(!t.Util.isError(e))try{throw new Error(e)}catch(o){e=o}this.context.track(new t.Telemetry.Exception(e,n,i,s))},n.prototype.trackMetric=function(e,n,i,s,o){this.context.track(new t.Telemetry.Metric(e,n,i,s,o))},n.prototype.trackTrace=function(e,n,i){e=e||"",this.context.track(new t.Telemetry.Trace(e,n,i))},n.prototype._onerror=function(e,n,i,s,o){if(!t.Util.isError(o))try{throw new Error(e)}catch(r){o=r,o.stack||(o.stack="@"+n+":"+i+":"+(s||0))}this.trackException(o)},n}(),t.AppInsights=n,s=function(){function e(e){this._name=e,this._events={}}return e.prototype.start=function(e){"undefined"!=typeof this._events[e]&&t._InternalLogging.throwInternalUserActionable(1,"start"+this._name+" was called more than once for this event without calling stop"+this._name+". key is '"+e+"'"),this._events[e]=+new Date},e.prototype.stop=function(e,n,i,s){var o,r,a=this._events[e];a?(o=+new Date,r=t.Telemetry.PageViewPerformance.getDuration(a,o),this.action(e,n,r,i,s)):t._InternalLogging.throwInternalUserActionable(1,"stop"+this._name+" was called without a corresponding start"+this._name+" . Event name is '"+e+"'"),delete this._events[e],this._events[e]=void 0},e}()}(e.ApplicationInsights||(e.ApplicationInsights={}));e.ApplicationInsights}(n||(n={})),function(e){!function(t){"use strict";var n=function(){function t(t){t.queue=t.queue||[];var n=t.config||{};if(n&&!n.instrumentationKey)if(n=t,n.iKey)e.ApplicationInsights.Version="0.10.0.0",n.instrumentationKey=n.iKey;else{if(!n.applicationInsightsId)throw new Error("Cannot load Application Insights SDK, no instrumentationKey was provided.");e.ApplicationInsights.Version="0.7.2.0",n.instrumentationKey=n.applicationInsightsId}n.endpointUrl=n.endpointUrl||"//dc.services.visualstudio.com/v2/track",n.accountId=n.accountId,n.appUserId=n.appUserId,n.sessionRenewalMs=18e5,n.sessionExpirationMs=864e5,n.maxPayloadSizeInBytes=n.maxPayloadSizeInBytes>0?n.maxPayloadSizeInBytes:2e5,n.maxBatchSizeInBytes=n.maxBatchSizeInBytes>0?n.maxBatchSizeInBytes:1e6,n.maxBatchInterval=isNaN(n.maxBatchInterval)?15e3:n.maxBatchInterval,n.enableDebug=!!n.enableDebug,n.autoCollectErrors="boolean"==typeof n.autoCollectErrors?n.autoCollectErrors:!0,n.disableTelemetry=!!n.disableTelemetry,n.verboseLogging=!!n.verboseLogging,n.diagnosticLogInterval=n.diagnosticLogInterval||1e4,this.snippet=t,this.config=n}return t.prototype.loadAppInsights=function(){var t,n,i,s=new e.ApplicationInsights.AppInsights(this.config);return this.config.iKey&&(t=s.trackPageView,s.trackPageView=function(e,n,i){t.apply(s,[null,e,n,i])}),n="logPageView","function"==typeof this.snippet[n]&&(s[n]=function(e,t,n){s.trackPageView(null,e,t,n)}),i="logEvent","function"==typeof this.snippet[i]&&(s[i]=function(e,t,n){s.trackEvent(e,t,n)}),s},t.prototype.emptyQueue=function(){var t,n,i,s;try{if(e.ApplicationInsights.Util.isArray(this.snippet.queue)){for(t=this.snippet.queue.length,n=0;t>n;n++)(i=this.snippet.queue[n])();this.snippet.queue=void 0,delete this.snippet.queue}}catch(o){s="Failed to send queued telemetry",o&&"function"==typeof o.toString&&(s+=": "+o.toString()),e.ApplicationInsights._InternalLogging.throwInternalNonUserActionable(1,s)}},t.prototype.pollInteralLogs=function(t){return setInterval(function(){for(var n=e.ApplicationInsights._InternalLogging.queue,i=n.length,s=0;i>s;s++)t.trackTrace(n[s]);n.length=0},this.config.diagnosticLogInterval)},t}();t.Initialization=n}(e.ApplicationInsights||(e.ApplicationInsights={}));e.ApplicationInsights}(n||(n={})),e()}),define("Wac_s_UnknownScenario",function(){});